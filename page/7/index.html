<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/03/apollo-planning-module/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/03/apollo-planning-module/" itemprop="url">apollo planning module</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-03T08:30:43-05:00">
                2019-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/03/apollo-planning-module/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/03/03/apollo-planning-module/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://yq.aliyun.com/articles/691219" target="_blank" rel="external">决策规划</a>, 根据导航信息及车辆的当前状态，在有限时间内，计算出一条合适的轨迹。</p>
<h2 id="Lattice-Planner"><a href="#Lattice-Planner" class="headerlink" title="Lattice Planner"></a><a href="https://mp.weixin.qq.com/s/YDIoVf20kybu8JEUY3GZWg?spm=a2c4e.11153940.blogcont691219.30.78693edf59tdSa" target="_blank" rel="external">Lattice Planner</a></h2><ul>
<li>Sample candidate trajectories </li>
<li>Assign costs </li>
<li>Select lowest-cost trajectory, to satisfy constraint &amp; collision check in each cycle</li>
<li>Output </li>
</ul>
<h3 id="Frenet-坐标"><a href="#Frenet-坐标" class="headerlink" title="Frenet 坐标"></a>Frenet 坐标</h3><p>定义沿路面的一条光滑参考线（路面中心线）， 汽车位置坐标由纵向偏移量，横向偏移量表示。纵向坐标，由汽车质心在参考线上的投影点，到参考线起点的长度s表示；横向坐标， 由投影点到汽车质心的距离l表示。</p>
<p>在Frenet坐标下，汽车的朝向、速度、加速度可由横、纵向偏移量的一阶导、二阶导表示。另外，由车辆动力学控制方程可知，横向的偏移量变化率与纵向速度相关，即横向运动是由纵向运动诱发的。</p>
<h3 id="生成轨迹"><a href="#生成轨迹" class="headerlink" title="生成轨迹"></a>生成轨迹</h3><p>分别由初始（当前）横向、纵向的状态信息（位置、速度、加速度），和下一时刻的横向、纵向状态信息（位置、速度、加速度），可以得到Frenet坐标下的一个轨迹点。通过一系列的时间点t0，t1, … tn, 可以得到一系列的轨迹点p0, p1, … pn， 即形成一条轨迹。</p>
<h3 id="轨迹集合采样"><a href="#轨迹集合采样" class="headerlink" title="轨迹集合采样"></a>轨迹集合采样</h3><p>轨迹采样，本质上是通过在解空间随机布点，然后贪婪搜索，筛选最低cost function value的点，即为可行轨迹。</p>
<p>横向偏移量由动力学方程可由纵向偏移量唯一决定，即从控制方程上，每个scenario可以变成由纵向偏移量当唯一自变量的控制方程，从而保证有唯一最优解或者无解。但实际上，由纵向偏移量唯一表示的控制方程，需要满足不同scenario的约束条件，即一个带约束条件的优化问题。随机算法是一个鲁棒性很强的方法，而且大部分情况下，至少可以得到一个可行解。apollo中横向轨迹、纵向轨迹分别采样。</p>
<p>apollo的横向轨迹的采样，由内部自定义三种横向偏移量： -0.5， 0， 0.5； 同时，设计到达这些横向偏移量的纵向位移： 10， 20， 40， 80. 两层循环即可得到一个轨迹集合。由此定义的横向轨迹不一定符合运动学、动力学约束。</p>
<p>apollo的纵向轨迹的采样，考虑巡航、跟车、超车、停车等scenario。</p>
<p>比如，巡航场景，通过两层循环采样。外层循环将速度从零到速度上限按等间距均匀遍历，内层循环由1s-8s均匀遍历。对于停车的场景，末状态的速度、加速度是0.</p>
<h3 id="ST-Graph"><a href="#ST-Graph" class="headerlink" title="ST-Graph"></a>ST-Graph</h3><p>横坐标是时刻，纵坐标是障碍车的车头、车尾的位置。st图将描绘障碍车进入当前车道到离开当前车道所占据的位置区域。自驾车必须确保与障碍车所占据位置有重合。跟车，即在被占区域的下方，或超车，即在被占区域的上方。</p>
<p>由跟车或超车，即可采样各个时刻的纵向偏移量，然后同理横向偏移量采样，形成纵向轨迹集合。</p>
<h3 id="轨迹cost"><a href="#轨迹cost" class="headerlink" title="轨迹cost"></a>轨迹cost</h3><p>轨迹规划的约束条件： 达到目的、 横向偏移代价（尽量沿着道路中心行驶）、碰撞代价、符合交规、平稳舒适（横向加速度代价）、 纵向加速度代价（激烈加速）、向心加速度代价（转弯场景）。</p>
<p>对于换道场景，对当前车道、目标车道的参考线做一次采样，并找到最低cost的轨迹。可以设计换道cost 。</p>
<h2 id="EM-planner"><a href="#EM-planner" class="headerlink" title="EM planner"></a>EM planner</h2><p>expectation maximum(EM) ， <a href="https://blog.csdn.net/yuxuan20062007/article/details/83629595" target="_blank" rel="external">最大期望算法</a>，在概率模型中寻找参数最大似然估计或最大后验估计，其概率模型依赖于无法观测的隐性变量。</p>
<p>首先，计算期望（e)， 利用对隐藏变量的现有估计值，计算其最大似然估计值；然后，最大值m， 最大化在e步上求的的最大似然值来计算参数的值。step-2 的参数被用于下一个 step-1 的计算。</p>
<p>em planner 会迭代对路径path、速度velocity进行优化。基于当前步的path和对其他运动物体的预测，优化当前步的速度；然后基于这个新的速度，再优化path。迭代直到收敛。</p>
<p>EM Planner 相比 Lattice Planner，利用了更多当前时间步的状态信息，在每个local timestep 都得到一个可行解。一系列的局部解，相当于弱形式，如果解空间存在可行解，局部解的迭代最终也将给出系统的可行解</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Plan</span><span class="params">(<span class="keyword">const</span> common::vehicle_state::VehicleState &amp;vehicle_state, </span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">bool</span> is_on_auto_mode,</div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> publish_time, </div><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;common::TrajectoryPoint&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/02/apollo-control-module/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/02/apollo-control-module/" itemprop="url">apollo control module</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-02T05:22:51-05:00">
                2019-03-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/02/apollo-control-module/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/03/02/apollo-control-module/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="纵向控制"><a href="#纵向控制" class="headerlink" title="纵向控制"></a><a href="https://blog.csdn.net/u013914471" target="_blank" rel="external">纵向控制</a></h2><p>通过控制刹车、油门实现对车速的控制。由一个级联控制器和标定表构成。级联控制器包括：位置PID闭环控制器，  速度PID闭环控制器。标定表即速度-加速度-刹车-油门命令 标定表。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Status LonController::ComputeControlCommand(</div><div class="line">	<span class="keyword">const</span> localization::LocalizationEstimate *localization,  </div><div class="line">	<span class="keyword">const</span> canbus::Chassis *chassis, </div><div class="line">	<span class="keyword">const</span> planning::ADCTrajectory *planning_published_trajectory,</div><div class="line">	control::ControlCommand *cmd)</div></pre></td></tr></table></figure>
<p>其输出是油门\刹车命令cmd. </p>
<p><img src="/home/Documents/Blog/HexoBlog/source/_posts/apollo-control-module/lon_control.png" alt="avatar"></p>
<h3 id="位置PID闭环控制器"><a href="#位置PID闭环控制器" class="headerlink" title="位置PID闭环控制器"></a>位置PID闭环控制器</h3><p>输入变量：期望位置 + 当前实际位置 </p>
<p>输出变量：速度补偿量</p>
<h3 id="速度PID闭环控制器"><a href="#速度PID闭环控制器" class="headerlink" title="速度PID闭环控制器"></a>速度PID闭环控制器</h3><p>输入变量：速度补偿 + 当前位置-速度偏差</p>
<p>输出变量：加速度补偿量</p>
<h3 id="速度-加速度-刹车-油门命令-标定表"><a href="#速度-加速度-刹车-油门命令-标定表" class="headerlink" title="速度-加速度-刹车/油门命令 标定表"></a>速度-加速度-刹车/油门命令 标定表</h3><p>输入变量： 加速度补偿量 +  规划驾速度， 车速</p>
<p>输出变量： 油门／刹车控制量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> LonController::ComputeLongitudinalErrors(</div><div class="line">	<span class="keyword">const</span> TrajectoryAnalyzer *trajectory_analyzer, </div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> preview_time ,</div><div class="line">	SimpleLongitudinalDebug *debug)</div></pre></td></tr></table></figure>
<p>CarSim/Simulink 与 apollo 连结 ？ </p>
<h2 id="横向控制"><a href="#横向控制" class="headerlink" title="横向控制"></a>横向控制</h2><p>通过调节方向盘转角实现对航向的控制，由一个前馈控制器和反馈控制器组合，实现车辆动力学模型和lqr 模型。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Status LatController::ComputeControlCommand(</div><div class="line">	<span class="keyword">const</span> localization::LocalizationEstimate *localization,</div><div class="line">	<span class="keyword">const</span> canbus::Chassis *chassis,</div><div class="line">	<span class="keyword">const</span> planning::ADCTrajectory *planning_published_trajectory,</div><div class="line">	control::ControlCommand *cmd)</div></pre></td></tr></table></figure>
<p><img src="/home/Documents/Blog/HexoBlog/source/_posts/apollo-control-module/lat_control.png" alt="avatar"></p>
<h3 id="前馈控制器"><a href="#前馈控制器" class="headerlink" title="前馈控制器"></a>前馈控制器</h3><p>输入变量：道路曲率</p>
<p>输出变量：方向盘前馈控制量</p>
<p>前馈控制变量实现补偿道路曲率对稳态误差的影响。</p>
<h3 id="反馈控制器"><a href="#反馈控制器" class="headerlink" title="反馈控制器"></a>反馈控制器</h3><p>输入变量： 期望航向角</p>
<p>输出变量： 方向盘反馈控制量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// update status matrix </span></div><div class="line"><span class="keyword">void</span> LatController::UpdateStateAnalyticalMatching(</div><div class="line">	SimpleLateralDebug *debug)</div><div class="line"></div><div class="line"><span class="comment">// cal lat error </span></div><div class="line"><span class="keyword">double</span> LatController::ComputeLateralErrors(</div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> x, </div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> y,</div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> theta,</div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> linear_v ,</div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> angular_v, </div><div class="line">	<span class="keyword">const</span> TrajectoryAnalyzer &amp;trajectory_analyzer,</div><div class="line">	SimpleLateralDebug *debug)</div><div class="line"></div><div class="line"><span class="keyword">void</span> LatController::UpdateMatrix() </div><div class="line"></div><div class="line"><span class="keyword">void</span> common::math::SolveLQRProblem()  <span class="comment">// gain matrix </span></div><div class="line"></div><div class="line">steer_angle =  steer_angle_feedback + steer_angle_feedforward</div></pre></td></tr></table></figure>
<p>控制模块更新cmd 后，发送给canbus模块。 </p>
<h2 id="MPC-模型"><a href="#MPC-模型" class="headerlink" title="MPC 模型"></a>MPC 模型</h2><p>mpc的实现依赖于过程的动态模型。对时域内，每个当前时刻进行优化，求取每个时刻的最优控制解，从而得到整个时域的优化解。</p>
<ul>
<li>基于线性化的预测</li>
</ul>
<p>实际系统状态-控制方程（系统状态变量、控制变量）具有时域非线性（二次项等）。首先对该系统进行线性近似，从而可以实现通过当前状态变量、控制变量对下一个时刻系统状态和控制的预测。</p>
<ul>
<li>滚动优化</li>
</ul>
<p>设计符合约束条件的目标函数，为状态、控制的离散的能量二次方程。优化的目标就是在每个时刻，寻找最优控制变量，使得目标函数最小。MPC相当于给出每个时刻的局部最优控制值，整个时域的最优控制就是一个控制序列。</p>
<ul>
<li>控制更新</li>
</ul>
<p>每个优化的输出即每个时步的控制增量，用于更新当下时步的系统控制变量。</p>
<h2 id="LQR-模型"><a href="#LQR-模型" class="headerlink" title="LQR 模型"></a>LQR 模型</h2><p>lqr 给出时域系统的全局最优解， 其目标函数是积分函数。相比较，lqr 相当于加权伽辽金方法，给出弹性体的全局最优解，对应强形式的控制方程，解空间非常狭小，甚至不存在。而mpc 相当于有限元方法，给出弹性体每个单元的局部解，对应弱形式的控制方程，每个单元的解空间span可张。理论上弱形式在极限情况给出的解就是强形式的解。</p>
<p>数值方法上，lqr相当于直接法，mpc相当于迭代法。直接法给出控制方程的唯一真实解；迭代法给出近似解，但近似解可收敛到系统的真实解。</p>
<h2 id="车辆模型"><a href="#车辆模型" class="headerlink" title="车辆模型"></a>车辆模型</h2><p>运动学模型给出车辆纵向控制变量，即车辆模型刚体质心参考点及航向角的控制方程；动力学模型给出车辆横向控制变量。</p>
<p>由运动学和动力学模型给出了整车状态-控制方程，采用mpc or lqr 算法求解控制变量，即实现车辆控制。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/自驾初创团队/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/自驾初创团队/" itemprop="url">自驾初创团队</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-26T09:25:39-05:00">
                2019-02-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/26/自驾初创团队/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/26/自驾初创团队/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table>
<thead>
<tr>
<th>name</th>
<th>CEO</th>
<th>start-date</th>
<th>business</th>
<th>funding</th>
</tr>
</thead>
<tbody>
<tr>
<td>宏景智驾</td>
<td>刘飞龙(北美oem 背景）</td>
<td>2018-8</td>
<td>L4 Tier1供应商</td>
<td>天使轮 ¥4千万</td>
</tr>
<tr>
<td>赢彻科技</td>
<td>翟学魂</td>
<td>2018-9</td>
<td>临港物流</td>
<td>-</td>
</tr>
<tr>
<td>拓疆者</td>
<td>隋少龙（北美背景）</td>
<td>2018-4</td>
<td>无人挖掘机</td>
<td>-</td>
</tr>
<tr>
<td>驰加科技</td>
<td>王明彦（国内oem 背景）</td>
<td>2017-10</td>
<td>低成本后装解决方案</td>
<td>-  </td>
</tr>
<tr>
<td>plus ai</td>
<td>刘万千</td>
<td>2017-3</td>
<td>AI 方案？</td>
<td>-</td>
</tr>
<tr>
<td>纽励科技</td>
<td>徐雷（特斯拉）</td>
<td>2017—1</td>
<td>视觉方案 ？</td>
<td>-</td>
</tr>
<tr>
<td>momenta</td>
<td>曹旭东</td>
<td>2016-7</td>
<td>视觉方案</td>
<td>c轮 $2亿 </td>
</tr>
<tr>
<td>极木科技</td>
<td>祁卫（亿航）</td>
<td>2016-7</td>
<td>机器人方案</td>
<td>- </td>
</tr>
<tr>
<td>驭势科技</td>
<td>吴甘沙(intel)</td>
<td>2016</td>
<td>芯片方案 ？</td>
<td>-</td>
</tr>
<tr>
<td>易航智能</td>
<td>陈禹行（吉大）</td>
<td>2015-8</td>
<td>汽车动力学、控制软件</td>
<td>b轮 ¥2.2亿 </td>
</tr>
<tr>
<td>青飞智能</td>
<td>孙一飞（上交）</td>
<td>-</td>
<td>园区短距自驾解决方案</td>
<td>天使轮 ¥千万</td>
</tr>
<tr>
<td>环宇智行  李明（武大）</td>
<td>自驾解决方案</td>
<td>天使轮 ¥千万 </td>
</tr>
<tr>
<td>行深智能</td>
<td>安向京</td>
<td>-</td>
<td>自驾整体解决方案</td>
<td>- </td>
</tr>
<tr>
<td>畅行智能</td>
<td>张祖峰（苏州清华）</td>
<td>物流自驾解决方案</td>
<td>天使轮 ¥千万</td>
</tr>
<tr>
<td>图森未来</td>
<td>陈默</td>
<td>2015-8</td>
<td>自驾卡车、视觉、ai</td>
<td>d轮 $0.95亿 </td>
</tr>
<tr>
<td>纵目科技</td>
<td>唐锐</td>
<td>2013</td>
<td>环视adas供应商</td>
<td>c轮 ¥1亿</td>
</tr>
<tr>
<td>禾多科技</td>
<td>倪凯（清华）</td>
<td>2017-3</td>
<td>L3.5 自驾解决方案</td>
<td>a轮 $千万</td>
</tr>
<tr>
<td>牧月科技</td>
<td>杨庆雄（景驰）</td>
<td>2018-6</td>
<td>-</td>
<td>天使轮 ¥5千万</td>
</tr>
<tr>
<td>深兰科技</td>
<td>陈海波</td>
<td>2012-8</td>
<td>?</td>
<td>a+轮 ¥3亿</td>
</tr>
<tr>
<td>武汉光庭</td>
<td>朱敦尧</td>
<td>2011</td>
<td>智能网联</td>
<td>上汽并购</td>
</tr>
<tr>
<td>主线科技</td>
<td>张天雷</td>
<td>2017-3</td>
<td>港口卡车（天津港）</td>
<td>- </td>
</tr>
<tr>
<td>创昂tron</td>
<td>邓恒（国内oem 背景）</td>
<td>2018-4</td>
<td>天使轮 $百万 </td>
</tr>
<tr>
<td>畅风加行</td>
<td>？</td>
<td>2018-4</td>
<td>L3 解决方案</td>
<td>- </td>
</tr>
<tr>
<td>小马智行</td>
<td>楼天城</td>
<td>2016-12</td>
<td>ai ?</td>
<td>a+ 轮</td>
</tr>
<tr>
<td>智行者</td>
<td>韦忠亚</td>
<td>2015-5</td>
<td>？</td>
<td>b+ 轮</td>
</tr>
<tr>
<td>鹰驾科技</td>
<td>郑智宇</td>
<td>2015-8</td>
<td>adas 视觉软硬件</td>
<td>a轮 ¥千万</td>
</tr>
<tr>
<td>盟识科技</td>
<td>邱长伍</td>
<td>-</td>
<td>矿山、港口、园区自驾解决方案</td>
<td>-</td>
</tr>
<tr>
<td>飞步科技</td>
<td>何晓飞（滴滴）</td>
<td>2018-4</td>
<td>车载 ai 系统</td>
<td>-</td>
</tr>
<tr>
<td>文远知行</td>
<td>韩旭（百度）</td>
<td>-</td>
<td>-</td>
<td>a+$千万</td>
</tr>
<tr>
<td>拿森电子</td>
<td>陶喆</td>
<td>2016-3</td>
<td>汽车电控</td>
<td>b轮 $1亿</td>
</tr>
<tr>
<td>auto brain</td>
<td>李明喜</td>
<td>2017-5</td>
<td>自驾解决方案（长城合作）</td>
<td>- </td>
</tr>
<tr>
<td>踏歌智行</td>
<td>余贵珍（北航）</td>
<td>-</td>
<td>特定场景自驾解决方案</td>
<td>pre-a ¥千万</td>
</tr>
<tr>
<td>云天励飞</td>
<td>陈宁</td>
<td>-</td>
<td>视觉 ai 芯片</td>
<td>-</td>
</tr>
<tr>
<td>有光科技</td>
<td>朱积祥</td>
<td>-</td>
<td>图像方案</td>
<td>-</td>
</tr>
<tr>
<td>云洲智能</td>
<td>张云飞</td>
<td>-</td>
<td>无人船</td>
<td>c轮 ¥4亿</td>
</tr>
<tr>
<td>西井科技</td>
<td>谭黎敏</td>
<td>-</td>
<td>ai 芯片，智能医疗、港口</td>
<td></td>
</tr>
</tbody>
</table>
<p>自动驾驶供应链中，ai算法、芯片、传感器（毫米波、激光、相机）等创业公司不计，传统主机厂、供应商内部相关团队不计。独立的小股团队也不计。直接把自动驾驶解决方案当作团队vision的有将近40家公司，分别来自电子芯片、人工智能、传统主机厂等不同背景。</p>
<p>每年估计烧十几个亿，市场还是有很多热情。2019年也许会死掉很多。另外，对市场时机需要敏感。几个海龟团队都是2018年才开始的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/22/apollo-self-driving-car/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/22/apollo-self-driving-car/" itemprop="url">apollo self driving car</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-22T09:22:31-05:00">
                2019-02-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/22/apollo-self-driving-car/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/22/apollo-self-driving-car/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="apollo-self-driving-car"><a href="#apollo-self-driving-car" class="headerlink" title="apollo self-driving car"></a>apollo self-driving car</h1><h2 id="HD-maps"><a href="#HD-maps" class="headerlink" title="HD maps"></a>HD maps</h2><p>where to define the center-meter fidelity level maps, with landmarks, and even the height dimension as well, which is used as the guiding map and also the global coordinate to locate the vehicle in the world.  </p>
<p>how to keep HD maps updated is a big invest. Baidu has hundreds service cars in China to collect the natural highway HD map data, even still to 2020. </p>
<h2 id="Localization"><a href="#Localization" class="headerlink" title="Localization"></a>Localization</h2><p>SLAM tech is a robot maping the world at the same time localizing itself in the world. with HD maps prepared first, self-driving car only need localize itself at every timestep. and the common idea is comparing a few local landmarks with the corresponding global landmarks, then transfer the local vehicle position to its global position in HD map.</p>
<h3 id="LiDAR-localization"><a href="#LiDAR-localization" class="headerlink" title="LiDAR localization"></a>LiDAR localization</h3><p> either based on the cloud points matching from continous timestamps; or calculating the error between the LiDAR points with the HD maps points; or based on the Karman filter, which give the highest possibility of the location of vehicle</p>
<p>always accessible but not easy to construct, especially requiring HD maps. </p>
<h3 id="Visual-localization"><a href="#Visual-localization" class="headerlink" title="Visual localization"></a>Visual localization</h3><p>based on particle filters, which give the most likely location of the vehicle.</p>
<h2 id="Perception"><a href="#Perception" class="headerlink" title="Perception"></a>Perception</h2><h3 id="detection-amp-amp-classification"><a href="#detection-amp-amp-classification" class="headerlink" title="detection &amp;&amp; classification"></a>detection &amp;&amp; classification</h3><p>where the object located, and classify it. detection CNN to find the object in the image; then use classification CNN to classify it. or use a combined CNN to detect and classify at same time.</p>
<h3 id="tracking"><a href="#tracking" class="headerlink" title="tracking"></a>tracking</h3><p>tracking helps when detection failed; also tracking helps to identity the object, so when objects overlapped in the image, still can tell which is which. </p>
<h2 id="Prediction"><a href="#Prediction" class="headerlink" title="Prediction"></a>Prediction</h2><h3 id="model-based-prediction"><a href="#model-based-prediction" class="headerlink" title="model based prediction"></a>model based prediction</h3><h3 id="data-driven-prediction"><a href="#data-driven-prediction" class="headerlink" title="data driven prediction"></a>data driven prediction</h3><p>after prediction, then generate the trajectory. </p>
<h2 id="Planning"><a href="#Planning" class="headerlink" title="Planning"></a>Planning</h2><p>transfer the world to graph, and find routings in the graph. routing is a global path, comparing to trajectory is the local way.</p>
<h2 id="Vehicle-control"><a href="#Vehicle-control" class="headerlink" title="Vehicle control"></a>Vehicle control</h2><p>linear quadratic regulator</p>
<p>PID </p>
<p>model predictive control</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/14/where-am-I-in-next-5-years-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/14/where-am-I-in-next-5-years-6/" itemprop="url">where am I in next 5 years(6)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-14T23:23:11-05:00">
                2019-02-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/14/where-am-I-in-next-5-years-6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/14/where-am-I-in-next-5-years-6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>things changes faster than I expected, already in China for two weeks. The first few days with family, that was precious, and the last spring festival at home was 5 years ago. </p>
<h2 id="life-in-China"><a href="#life-in-China" class="headerlink" title="life in China"></a>life in China</h2><p>I am searching jobs in China now, the recruiters are highly efficient. almost in 24hrs, a reply return; and they prefer wechat rather than email, Liepin ranther LinkedIn. on the other hand, I went to tongji hosptial at Wuhan for a doctor appoitment, but stay in the line waiting most time. People are everywhere, even in a third-class city, like my hometown, I can only find two caffe shop to sit down and use the free wifi; the skyline buildings are everywhere, the evening scene feel like in the movie: Matrix. </p>
<p>in USA, I never touch the real China, which is attracting but concerned. As many of my friends in USA, we always talking about China, but never take a move back to China. Till the moment I stand in China, things are real. </p>
<p>In general, if people looking for a stable middle-class, USA definitely is a better choice, with few career pressure, 8 hrs a day, 20 days PTO a year, large house with green grass, and income is about 2 times highly as the same engineering in China, without considering 996 in China.</p>
<p>people back to China must think big, rather than looking for a stable income.</p>
<h2 id="self-driving-in-China"><a href="#self-driving-in-China" class="headerlink" title="self-driving in China"></a>self-driving in China</h2><p>OEM level: Changcheng, Audi, Volkswagen, Geely, xiaopeng, Beiqi, and many names I few heared before, are investing in new energy, intelligent vehicles, and self-driving cars and expending, the market sounds high to hell. there are about 500 start-ups focusing on component supply chain, e.g.  in-vehicle sensors, network communication infrastructure, platform solutions, AI algorithms to chips design, specilized scenario applications(mining, seaport, airport, logistics, warehousing, city bus, city-cleaners) </p>
<p>it was the best of times, it was the worst of times. many start-up companies will die so sure, but the market is the training course for next BIG.</p>
<p>The second half of 2018 is my time to feel  everything is accelerated. </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/review-planning-pipelien-in-self-driving-car/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/22/review-planning-pipelien-in-self-driving-car/" itemprop="url">review planning pipelien in self-driving car</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-22T16:17:01-05:00">
                2019-01-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/22/review-planning-pipelien-in-self-driving-car/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/22/review-planning-pipelien-in-self-driving-car/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>when understanding planning in self-driving car, all other modules make sense. </p>
<h2 id="perception-layer"><a href="#perception-layer" class="headerlink" title="perception layer"></a>perception layer</h2><p>with all concepts such as lidar, radar, camera, sensors, GPS, CAN, data fusion, computer vision, SLAM, AI-based detect/tracking algorithms, they are all perception related, which helps the car to understand itself and the surroundings.</p>
<p>perception first helps the car understand itself located in the world; then helps to predict the intensions of other vehicles/pedestrains around. </p>
<h2 id="behavior-layer"><a href="#behavior-layer" class="headerlink" title="behavior layer"></a>behavior layer</h2><p>there are two steps here: behavior predictation, behavior planning. </p>
<p>based on the prediction info of other agents intensions from previous timestep/configuration, the behavior predictation module predicts current behavior of the self-driving car, which usually implemented either by model based methods or data driven method (AI-trained), and which output all the possible feasible maneuvers for current timestep. </p>
<p>the car choose only one maneuver at each timestep/configuration, and the behavior planning module is used to weight all the feasible maneuvers from the behavior predictation, and find the most-likely maneuver, which usually is implemented based on a cost function with constraints.</p>
<p>the all possible manuever is also called trajectory planning, and the choosen manuever is also called motion planning, which is locally-space and time-depended. </p>
<h2 id="control-layer"><a href="#control-layer" class="headerlink" title="control layer"></a>control layer</h2><p>since motion planning, then send the command to vehicle control actor and update the car physically. </p>
<h2 id="end-2-end-motion-planning"><a href="#end-2-end-motion-planning" class="headerlink" title="end-2-end motion planning"></a>end-2-end motion planning</h2><p>deep learning is also used to demo end2end motion planning. e.g. from camera output to vehicle control output frame to frame, while many situations may not be trained in the model, so not that realisty. </p>
<h2 id="path-routine-planning"><a href="#path-routine-planning" class="headerlink" title="path/routine planning"></a>path/routine planning</h2><p>the motion planning pipleline above is happening every timestep for self-driving car and locally.</p>
<p>at high-level is path/routine planning, bascially given the start point and destination point. there are a few algorithms, like global graph search, random tree, incremental graph search. </p>
<h2 id="reinforcement-learing-in-simulator"><a href="#reinforcement-learing-in-simulator" class="headerlink" title="reinforcement learing in simulator"></a>reinforcement learing in simulator</h2><p><a href="https://zjli2013.github.io/2018/12/01/reinforce-learning-in-simulator/" target="_blank" rel="external">previous blog</a>, it is also popular to learn behavior in simulation environement and train with reinforcement learning. </p>
<h2 id="simulation-in-self-driving"><a href="#simulation-in-self-driving" class="headerlink" title="simulation in self-driving"></a>simulation in self-driving</h2><p>how simulation tool chain can accelerate self-driving development ? </p>
<p>usually simualtion enviornemnt can help to verify and test the perception, behavior, control algorithms. </p>
<p>if working with reinforcement learning, a virtual simulator is required also.</p>
<p>what else ?</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/21/where-am-I-in-next-5-years/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/21/where-am-I-in-next-5-years/" itemprop="url">where am I in next 5 years</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-21T15:12:17-05:00">
                2019-01-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/21/where-am-I-in-next-5-years/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/21/where-am-I-in-next-5-years/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I love reading autographies, especially these with life-time stories. it’s a window to explore kinds of life possibilites. and recently I readed &lt;&lt; the only girl &gt;&gt;, Robbin at Rolling Stone magazines in 1970s. </p>
<p>I remember <a href="https://coolshell.cn/articles/17583.html" target="_blank" rel="external">some toughts</a> about life meanings. there are three kinds:  1) to crazy satisfy yourself, or pursue a free life, live the way you really want. e.g the freelancer;  2) ladder up to the higher social class, which is happening a lot in developing countries, and to be rich and success is the guarantee; 3) enjoy the beauty of nature and civilazation in this short period of life time.</p>
<p>the last two meanings can not be done immediately, to crazily or desperately satisfy self, is then the easiest way to fight against the fucking environment. like when getting tired of this busy world, I behave more like a hippie, no big deal to anything, and kill time on drama, books, or drugs or sex. </p>
<p>the hippie lifestyle is momental, it creats a space to seperate from daily troubles; after a few days or nights, I am back to real life, continuing on career stuff.  </p>
<p>so take it, the reality for me, as born in Asian developing country, with traditional family responsibility, is pursuing career, and of course it helps to take a break, and enjoying hippies, but don’t take it as the life-time way.</p>
<p>mostly of my inner voices are:  either busy to live or busy to die; problem-solving skills, leadership; to figure out how the economy machine functions in small and big roles; and be the smart guy in market and at office. </p>
<p>and no need with another degree or matured platform to be problem-solvingable or leadershipable. these skills are in everywhere.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/13/未来五年在哪里（3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/未来五年在哪里（3/" itemprop="url">未来五年在哪里（3)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-13T23:10:31-05:00">
                2019-01-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/13/未来五年在哪里（3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/13/未来五年在哪里（3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在美国开长途，沿途总是遇见wendy’s, McDonald’s， auto zone 等等连锁店。也不论在toledo等中部小城市，还是芝加哥、纽约等国际大城市，这些店也到处都有。甚至costco商店在底特律，布法罗，哥伦布，三番等城市的商品布局摆放都是一摸一样的。</p>
<p>中国很少有这种在从三四线城市到一线城市都连锁的服务品牌，除了重资产的，比如商业地产（万达广场）， 酒店，大型购物超市，阿里仓库，烟草局等。而餐饮、汽修、家装等等基本都是地方特色。</p>
<p>美国各州相对很独立。比如，buffalo wings 从布法罗开到了全美国， kfc 从肯塔基开到了全美国。把产品、模式从一个地方复制到另一个地方很容易实现。而且不仅产品本身，其背后的供应链也同样反映了平坦。所以是整个体系很成熟，容易实现规模效益，从而正向强化成功。</p>
<p>中国地方性壁垒比较高，一个成功的产品、模式难轻松复制。好处是发展了很多地方性的特色服务。当然对资本而言是不经济的。好奇麦当劳进入中国，是怎么做供应链的，如何在不规范、体系不成熟的环境下复制美国模式的。</p>
<p>一个顶级成功的商业，应该是建立系统。然后，利润就在系统运营和管理中流淌出来。就像顶级的造车公司，是能够把研发、生产、销售等subsystem打通，建立一个造车system的公司。这也是matured market 的特征，系统成熟运作，利润稳定地流淌。emerging market 就处于探索建立系统的过程。一般是从新科技、产品subsystem出发，因为商业模式、市场等subsystem比较好从已经有的成熟体系里借鉴，然后融合、打通。</p>
<p>中国出现了两种特有的经济行为：外卖和淘宝。他们的价值就是打通原本因为地域壁垒很难复制的产品。互联网不存在地域壁垒，所以有效最优化资源，并实现规模效益。相比，美国不存在大范围的外卖、淘宝，因为产品复制在地域上很容易。</p>
<p>商业的本质，就是建立一套稳定运转的系统，不论中美。因为美国的资本、商业环境、企业规范、地方行政等方面的成熟，即游戏规则已经稳固且清晰，成功是更容易的。相比，在中国，就需要官商结合重资本打开局面。因此在中国，赚大钱更容易。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/04/未来五年在哪里-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/04/未来五年在哪里-2/" itemprop="url">未来五年在哪里(2)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-04T10:39:32-05:00">
                2019-01-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/04/未来五年在哪里-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/01/04/未来五年在哪里-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>很多汽车公司（供应商，oem）都有大量职位招：CAN, control, EE 背景的同学。相反，cae产品却很少出现在供应商的招聘中。先给个预判：汽车电子处于草莽时代。</p>
<h2 id="汽车电子"><a href="#汽车电子" class="headerlink" title="汽车电子"></a>汽车电子</h2><p>首先，汽车电子，不论硬件、软件，都很面向产品。出来的直接可以拿到市场去卖。另一方面，这类产品又很成熟，不论是电子元器件，汽车网络，摄像头等传感器，控制算法都不是新技术，而更像是一次“组合创新”。基于已有部件，在新的应用场景，重新组合，研发需求本身很低。</p>
<p>即使前沿应用场景，比如自动驾驶，其实是需要重新定义很多基础部件，包括通信协议、ai算法、传感器的融合、路面设备等，必然有很多研发需求，但目前的自动驾驶大多在现有adas基础上的迭代，还没有真正的超越。</p>
<p>另外，因为各个终端产品的差异性，市面上会出现各种解决方案。这是一个行业的草莽时代，各家都自立山头。还没有出现几家鼎力。</p>
<p>由于应用层的需求，而不是研发需求，汽车电子需要熟练的软件/硬件工程师去拼装产品。这也是ME, EE偏控制方向的同学，在汽车行业就业的窗口期。</p>
<h2 id="汽车CAE"><a href="#汽车CAE" class="headerlink" title="汽车CAE"></a>汽车CAE</h2><p>CAE行业的黄金期是80年代到2000年，当时也是各个解决方案在市场上乱飞，甚至应用商（汽车厂等)内部都有独立的CAE开发团队，而且做了很牛逼的产品。那个年代，CAE算是emerging tech，很吸引投资和就业。到现在，这样的窗口期已经结束，北美几大CAE厂商三足鼎立： 加州msc, 密西根altair, 匹兹堡ansys，还有一些小众厂商。还有就是更大只的PLM厂商： 西门子， 达索等。</p>
<p>整个行业处于成熟期。产品的研发、市场、客户都已经形成了模式。应用行业也基本稳定，民用品：汽车、电子消费品、医疗等，军用：航空航天、核物理等。当然，未来会拓展新的应用领域，以及需求新产品研发。</p>
<p>虽然整个行业处于成熟期，进入门槛很高了。实际上，如果不在大厂里，CAE还是辅助的。有接触到设计制造供应商，都会使用CAE分析，但经常是Design engineer 顺带跑一下cae分析。也可以看到供应商更需要直接面向产品的设计工程师，而不是CAE应用工程师。</p>
<p>大厂里面有CAE研究部门，尝试新的分析场景；CAE支持部门，包括部署、debug、用户支持；以及CAE工程师。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/21/未来五年在哪里/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/21/未来五年在哪里/" itemprop="url">未来五年在哪里</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-21T15:55:34-05:00">
                2018-12-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/12/21/未来五年在哪里/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/12/21/未来五年在哪里/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="两种思维"><a href="#两种思维" class="headerlink" title="两种思维"></a>两种思维</h2><p>不同的思维反映了不同的背景。面对一个商业想法，一个对细节严肃的工程师，首先会估量自己对讨论的领域是否足够熟悉，然后会考虑技术上是否可行。马云说他是阿里巴巴最不懂技术的人，却能够把握大方向；相反往往问题没解决，责怪技术不够的，会陷入用一个技术解决另一个技术的游戏中，而远离了大方向。</p>
<p>张首晟教授有分享在知识信息爆炸的时代该怎么学习。因为最优秀的书籍也已经多到一个人一辈子都读不完了，所以重要的是抓住道(principle)。举个极端的例子，如果地球毁灭，最后一个人只能带1kb 的信息离开地球，这个信息该是什么，能够保证人类文明不断流。</p>
<p>道与术的例子， 日本远海70公里发生了地震，多久巨浪会到达海岸线？一个细节严苛的学流体力学仿真的研究生，要跑一套cfd程序，考虑近似若干边界初始条件，然后花一两天调试，运行得到结果。而一个有物理常识的人，大概能估计几个跟巨浪速度有关的变量，就可以得到一个近似结果。</p>
<p>我的经验就是太容易过分依赖技术（本质是一种惰性，想回避该用人脑的分析），而忘了新技术的初衷，单纯为了迭代技术本身而发展新技术。世界正在把太多新技术太快速地塞进普通人的视野，不要说思考这些新技术到底意味什么，甚至这些新技术到底将如何产业化，进入普通人的生活都没有清晰。</p>
<p>很长时间，我对工程仿真技术有这样的误区。我已经忽略了cae本身要解决的问题，而只是沉迷在cae技术本身。或者说是，从研究（学生）到商业（职场）的角色没有转变过来。而商业需要的是一个能够打穿新技术与产品落地。他／她可以不懂技术的深度，但一定有广度和连结，能觉察到新技术可以在哪里发挥价值。</p>
<p>越来越感受到，思维会决定行为，而具有倾向性的行为会强化思维。一个没有商业经验的且受过高等技能教育的年轻人，会倾向强调技术，放大其重要性，而看不到其在企业经济大方向上的不合理性。比如，工程师倾向使用最新的技术在产品开发中，但企业定位可能是一款廉价快速打入市场的产品。这时候，在工程师看来完美的合理方案，于企业战略就是不合理的。</p>
<h2 id="emerging-market"><a href="#emerging-market" class="headerlink" title="emerging market"></a>emerging market</h2><table>
<thead>
<tr>
<th></th>
<th>emerging</th>
<th>matured</th>
</tr>
</thead>
<tbody>
<tr>
<td>platform</td>
<td>start up</td>
<td>large business</td>
</tr>
<tr>
<td>management</td>
<td>new</td>
<td>matured</td>
</tr>
<tr>
<td>involving</td>
<td>multi-role</td>
<td>single-role</td>
</tr>
<tr>
<td>stability</td>
<td>high-risk</td>
<td>low-risk</td>
</tr>
<tr>
<td>working env</td>
<td>shining</td>
<td>mediocre</td>
</tr>
<tr>
<td>creativity</td>
<td>knowledge-based</td>
<td>manage-based</td>
</tr>
</tbody>
</table>
<p>由新知识引导的商业创新，比如，生物科技，基因技术，新材料，量子计算，人工智能，核物理等，首先很容易给人带来极大的快感，特别让年轻人欲罢不能， 更吸引投资、社会关注。但是，emerging tech存在周期性：从新技术到产品的会有很长的空窗期。历史上电气时代（1830 - 1860年），在爱迪生开发电灯泡之后，数百家电气公司迅速出现，但20年内大部分被淘汰掉；铁路公司，PC电脑, 汽车制造，消费电子，包括最近的AI、自驾车行业，都体现着emerging market的规律：早期快速极度膨胀，然后几年内极度跌落，再慢慢恢复理性。</p>
<p>经济学上还有一个概念，就是新技术带来的就业远不能弥补旧行业消失造成的失业。时间久了，emerging market也会成为matured market。 </p>
<h2 id="团队选择"><a href="#团队选择" class="headerlink" title="团队选择"></a>团队选择</h2><p>emerging tech非常强调先发优势。很多新知识引导的商业创新，源自学校研究第一梯队，他们本身就是某项技术的原创团队，具有极强的先发优势，而且因为新知识门槛，被市场快速复制的可能性极低。比如，机器人、柔性可穿戴电子器件、基因检测、ai等等。</p>
<p>普通人的第一次团队选择，大多是在高校完成的。聪明人跟对了团队，在博士期间就可以引领emerging market。《新资本论》中提到，21世纪，劳动力与资本收益分配是1:7。 稍微感受下，知识经济将明显比资本有更高收益。</p>
<p>如果错过了第一次团队选择，普通人很难有后发优势，没钱没技术。所以，除非对该领域具有极强的认同感，执着的信仰，否则想在创业团队谋一份职业，可能是误判。</p>
<p>现实与认知之间的矛盾，往往反映一个人还没成熟。我的假象包括：创业团队更锻炼人，更吸引眼球，站在风头浪尖上，然而没有一个因素是因为我对该领域的认同感，不过是渴望它附加的虚荣。另外，个人成长动力不该仅源自环境，而必须是内心。环境在满足基本需求后，只叫人不讨厌它了；但爱上它，必须是从心发出的。</p>
<p>普通人的第二次团队选择，大多是在职场完成的。明确自己该要什么，不该要什么，也许对普通人选择matured market更友好。一方面是老生常谈的大企业病：成熟平庸。但是，创新成功并不都是声名噪动，也有闷声发大财。 成熟行业或成熟企业的创新，也许不是产品／技术本身，而在体系和管理。</p>
<p>而在一个成熟行业待不少于5年，才有可能了解系统，接触到管理。写到这里，不由又盘算要不要读MBA了，正好遇到明年经济糟糕。</p>
<p>– 感谢Selena</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">119</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
