<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/reinforcement-learning-in-nutshell-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/reinforcement-learning-in-nutshell-2/" itemprop="url">reinforcement learning in nutshell-2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T10:30:40-04:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/13/reinforcement-learning-in-nutshell-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/13/reinforcement-learning-in-nutshell-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="function-approximation"><a href="#function-approximation" class="headerlink" title="function approximation"></a>function approximation</h2><p>write the mapping from \<state action=""> pair to value as $ <strong>S</strong> X <strong>A</strong> -&gt; <strong>Q</strong> $.</state></p>
<p>usually <strong>S</strong>, <strong>Q</strong> can be continuous high-dimensional space, and even in discrete state problem. e.g. in GO game, the state space is about 10^170, to store each \<state action=""> pair in a table is almost impossible. a good and approximated way is using a hash map, where input a state, and through this hash map to get its value, which is one step, rather than many steps even with a tree strucutre of the whole state-action/value space.</state></p>
<p>in math, this is called <code>function approximation</code>, it’s very intuitive idea, to fit a function from the sample points; then any point in the space, it can be represented by the function’s paramters, rather than search in all  the sample points, which may be huge; and further as only the function’s parameters is required to store, rather than the whole sample points information, which is really a pleasure.</p>
<h2 id="Deep-Q-Learning"><a href="#Deep-Q-Learning" class="headerlink" title="Deep Q-Learning"></a>Deep Q-Learning</h2><p><a href="https://zjli2013.github.io/2019/09/18/reinforcement-learning-in-nutshell-1/" target="_blank" rel="external">previously in Q-Learning</a>, to update Q(S,A):</p>
<pre><code>$ Q(S,A) &lt;- \delta ( Q(S, A) + R + \gamma ( Q(S&apos;, A&apos;) - Q(S, A))
</code></pre><p>to approximate <code>q(s,a)</code> can use a neural network(NN), the benefit of NN is  to approximate any function to any precise, similar to any <a href="https://zjli2013.github.io/2019/09/29/warm-up-Hilber-space/" target="_blank" rel="external">complete orthonormal sequence</a>, e.g. Fourier Series.</p>
<h3 id="CNN-approximator"><a href="#CNN-approximator" class="headerlink" title="CNN approximator"></a>CNN approximator</h3><p>the input to Q neural network is the eigenvector of state <strong>S</strong>, assuming the action set is finite. the output is action value in <code>state-action-hyperparameter</code>: q(s, a, \theta), </p>
<pre><code>Q(S, A, \theta) ~= Q(S, A)
</code></pre><p><img src="https://img2018.cnblogs.com/blog/1042406/201809/1042406-20180928142605652-445522913.jpg" alt="image"></p>
<p>as the right most section, here assuming the action set is finite, so for each action, there is an output.</p>
<h3 id="experience-replay"><a href="#experience-replay" class="headerlink" title="experience replay"></a>experience replay</h3><p>instead of discarding experiences after one stochastic gradient descent, the agent remembers past expereicnes and learns from them repeatdely, as if the experience has happened again. this allows for greater data efficiency. another reason, as DNN is easily overfitting current episodes, once DNN is overfitted, it’s difficult to produce various experinces. so exprience replay can store experiences including state transitions, rewards, and actions, which are necessary to perform Q learning. </p>
<p>at time <code>t</code>, the agent’s experience <code>e_t</code> is defined as:</p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=e_t&space;=&space;(s_t,&space;a_t,&space;r_{t&plus;1},&space;s_{t&plus;1})" target="_blank"><img src="https://latex.codecogs.com/gif.latex?e_t&space;=&space;(s_t,&space;a_t,&space;r_{t&plus;1},&space;s_{t&plus;1})" title="e_t = (s_t, a_t, r_{t+1}, s_{t+1})"></a></p>
<p>all of agent’s experiences at each time step over all episodes played by the agent are stored in the <code>replay memory</code>. actually, usually the replay memory/buffer set to some finite size limit, namely only store the recent N experiences. and then choose random samples from the replay buffer to train the network.</p>
<p>the key reason here is to break the correction between consecutive samples. if the CNN learned from consecutive samples of experience as they occurred sequentially in the environment, the samples are highly correlated, taking random samples from replay buffer.</p>
<h3 id="target-network"><a href="#target-network" class="headerlink" title="target network"></a>target network</h3><p>use a separate network to estimate the target, this target network has the same architecture as the CNN approximator but with frozen parameters. every T steps(a hyperparameter) the parameters from the Q network are copied to this target network, which leads to more stable training because it keeps the target function fixed(for a while)</p>
<h2 id="go-futher-in-DQN"><a href="#go-futher-in-DQN" class="headerlink" title="go futher in DQN"></a>go futher in DQN</h2><h3 id="Double-DQN"><a href="#Double-DQN" class="headerlink" title="Double DQN"></a>Double DQN</h3><p>here use two networks, the DQN network is for action selection and the target network is for target Q value generation. </p>
<p>the problem comes: how to be sure the best action for the next state is the action with the highest Q-value ? </p>
<h3 id="Prioritized-Replay-DQN"><a href="#Prioritized-Replay-DQN" class="headerlink" title="Prioritized Replay DQN"></a>Prioritized Replay DQN</h3><h3 id="Dueling-DQN"><a href="#Dueling-DQN" class="headerlink" title="Dueling DQN"></a>Dueling DQN</h3><h2 id="yet-a-summary"><a href="#yet-a-summary" class="headerlink" title="yet a summary"></a>yet a summary</h2><p>at the begining of this series, I was thinking to make a simple summary about DQN, which looks promising in self-driving. After almost one month, there are more and more topics and great blogs jumping out, the simple idea to make a summary is not easy any more. I will stop here, and once back.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="http://www.hostmath.com" target="_blank" rel="external">math equation editor</a></p>
<p><a href="https://www.mcs.anl.gov/petsc/" target="_blank" rel="external">Petsc Krylov</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/28223841" target="_blank" rel="external">zhihu: function approximate</a></p>
<p><a href="https://www.dqnbook.com/2/experience-replay" target="_blank" rel="external">dqnbook: experience replay</a></p>
<p><a href="https://towardsdatascience.com/welcome-to-deep-reinforcement-learning-part-1-dqn-c3cab4d41b6b" target="_blank" rel="external">Toward Data Science</a></p>
<p><a href="https://deeplizard.com/learn/video/Bcuj2fTH4_4" target="_blank" rel="external">explained replay memory</a></p>
<p><a href="https://danieltakeshi.github.io/2016/12/01/going-deeper-into-reinforcement-learning-understanding-dqn/" target="_blank" rel="external">going deeper into RL: understanding DQN</a></p>
<p><a href="https://www.freecodecamp.org/news/improvements-in-deep-q-learning-dueling-double-dqn-prioritized-experience-replay-and-fixed-58b130cc5682/" target="_blank" rel="external">improvements in DQN</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/configure-pgAdmin4-in-server-mode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/configure-pgAdmin4-in-server-mode/" itemprop="url">configure pgAdmin4 in server mode</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T06:35:25-04:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/13/configure-pgAdmin4-in-server-mode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/13/configure-pgAdmin4-in-server-mode/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>pgSQL is common used to store hd map in ADS stack, and the client is usually pgAdmin4. in big tech companies, e.g. Tencent, Alibaba, Uber e.t.c, their <code>data infrastructure</code> for ADS stack development is usually based on pgSQL. for our team work, we also store most map info in pgSQL, and for better development toolchain, there is a need to configure the client pgAdmin4 as a web server, rather than request every developer to install a copy of pgAdmin4 at their local side.</p>
<p>in LAN web server, apache2 is used to serve a few services, so there is a need to configure multi virutal host in Aapche2, with differnt port and same IP.</p>
<h2 id="pgSQLServer"><a href="#pgSQLServer" class="headerlink" title="pgSQLServer"></a>pgSQLServer</h2><ul>
<li><p><a href="https://www.postgresql.org/download/linux/ubuntu/" target="_blank" rel="external">official install postgresql</a></p>
</li>
<li><p><a href="https://www.postgresql.org/docs/current/server-start.html" target="_blank" rel="external">start pgSQLserver</a></p>
</li>
<li><p>jump into pgSQL server:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/etc/init.d/postgresql start </div><div class="line"></div><div class="line">sudo su - postgres</div></pre></td></tr></table></figure>
<h2 id="pgAdmin4"><a href="#pgAdmin4" class="headerlink" title="pgAdmin4"></a>pgAdmin4</h2><p>installed by <code>apt-get install pgadmin4</code>, will put pgAdmin4 under local user or root permission, which will be rejected if accessed by remote clients, whose permission is <code>www-data</code></p>
<p>so it’s better to install from src and in a different Python virtual env.</p>
<ul>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-python-3-and-set-up-a-programming-environment-on-an-ubuntu-18-04-server" target="_blank" rel="external">setup Python virtual Env</a></p>
</li>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-configure-pgadmin4-server-mode" target="_blank" rel="external">install pgAdmin4 from src</a></p>
</li>
</ul>
<p>there maybe a few errors as following:</p>
<pre><code>*  No package &apos;libffi&apos; found  

*  error: invalid command &apos;bdist_wheel&apos; [sol](https://stackoverflow.com/questions/34819221/why-is-python-setup-py-saying-invalid-command-bdist-wheel-on-travis-ci)

* error: command &apos;x86_64-linux-gnu-gcc&apos; failed with exit status 1, [sol](https://stackoverflow.com/questions/21530577/fatal-error-python-h-no-such-file-or-directory)
</code></pre><h2 id="configure-pgAdmin4"><a href="#configure-pgAdmin4" class="headerlink" title="configure pgAdmin4"></a>configure pgAdmin4</h2><p>follow <a href="https://www.digitalocean.com/community/tutorials/how-to-install-configure-pgadmin4-server-mode" target="_blank" rel="external">this configure pgadmin4 in Server mode</a></p>
<h2 id="configure-Apache2"><a href="#configure-Apache2" class="headerlink" title="configure Apache2"></a>configure Apache2</h2><p>follow previous blog to set Apache2 for pgadmin4:</p>
<pre><code class="script">&lt;VirtualHost *:8084&gt;
    ServerName 10.20.181.119:8084
    ErrorLog  &quot;/var/www/pgadmin4/logs/error.log&quot;
    WSGIDaemonProcess pgadmin  python-home=/home/david/py_venv/pgenv
    WSGIScriptAlias /pgadmin4 /home/david/py_venv/pgenv/lib/python3.5/site-packages/pgadmin4/pgAdmin4.wsgi

    &lt;Directory &quot;/home/david/py_venv/pgenv/lib/python3.5/site-packages/pgadmin4/&quot;&gt;
        WSGIProcessGroup pgadmin
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
<p>restart Apache2 server will make this works.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://serverfault.com/questions/601140/whats-the-difference-between-sudo-su-postgres-and-sudo-u-postgres" target="_blank" rel="external">why sudo - su</a></p>
<p><a href="https://www.godaddy.com/garage/how-to-install-postgresql-on-ubuntu-14-04/" target="_blank" rel="external">godaddy about sudo - su</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-configure-pgadmin4-server-mode" target="_blank" rel="external">configure pgadmin4 in Server mode</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/host-mod-wsgi-in-Apache2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/host-mod-wsgi-in-Apache2/" itemprop="url">host mod_wsgi in Apache2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T06:33:40-04:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/13/host-mod-wsgi-in-Apache2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/13/host-mod-wsgi-in-Apache2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Apache2-Background"><a href="#Apache2-Background" class="headerlink" title="Apache2 Background"></a>Apache2 Background</h2><h3 id="Apache2-virutal-host"><a href="#Apache2-virutal-host" class="headerlink" title="Apache2 virutal host"></a>Apache2 virutal host</h3><ul>
<li>site-available </li>
</ul>
<p>all virtual hosts are configured in individual files with <code>/etc/apache2/sites-available</code> </p>
<ul>
<li>site-enabled </li>
</ul>
<p>until the *.config in site-available are enabled, Apache2 won’t know know.</p>
<pre><code>sudo sevice apache2 reload 
</code></pre><ul>
<li>IP based virtual host </li>
</ul>
<p>use IP address of the connection to determine the correct virtual host to serve, so each host needs a separate IP</p>
<p>we had name-based vhost in LAN, a few web servers sharing the same IP in the same physical machine, but with different Ports, and even we don’t use DNS server to tell the domains. </p>
<h3 id="apache-mode-cores"><a href="#apache-mode-cores" class="headerlink" title="apache mode cores"></a>apache mode cores</h3><p><a href="https://httpd.apache.org/docs/2.4/mod/core.html#servername" target="_blank" rel="external">refer</a></p>
<ul>
<li>VirtualHost </li>
</ul>
<p>the title to define this virutal host, and tell which port to listen. by default is port80</p>
<ul>
<li>ServerName</li>
</ul>
<p>sets the request scheme, hostname, and port that the server uses to identify itself</p>
<ul>
<li>ServerAlias</li>
</ul>
<p>sets the alternate name for a host </p>
<ul>
<li>WSGIDaemonProcess</li>
</ul>
<p>for wsgi app, which usually define in a seperate Python virtual environment, rather than the default localhost user or root. so <code>WSGIDaemonProcess</code> point to the python virtual env. </p>
<ul>
<li>WSGIScriptAlias</li>
</ul>
<p>point to the wsgi_app.wsgi </p>
<ul>
<li>DocumentRoot </li>
</ul>
<p>set the directory from which httpd/apache2 will serve files <code>/var/www/html</code></p>
<h2 id="mod-wsgi"><a href="#mod-wsgi" class="headerlink" title="mod_wsgi"></a>mod_wsgi</h2><ul>
<li>install <code>apt-get install apache2  libapache2-mode-wsgi-py3</code></li>
</ul>
<h3 id="config-in-Apache2"><a href="#config-in-Apache2" class="headerlink" title="config in Apache2"></a>config in Apache2</h3><h4 id="config-with-configure-file"><a href="#config-with-configure-file" class="headerlink" title="config with configure file"></a>config with configure file</h4><ul>
<li>create  example.conf under  /etc/apache2/conf-available/</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;VirtualHost *:8084&gt;</div><div class="line">        ServerName  10.20.181.119:8084</div><div class="line">        ServerAlias example.com</div><div class="line">        DocumentRoot &quot;/var/www/html&quot;</div><div class="line">        ErrorLog &quot;/var/www/example/logs/error.log&quot;</div><div class="line"> </div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
<p>the served web content is stored at <code>/var/www/html</code>, which can simple include a index.html or a few js.</p>
<ul>
<li><p>enable configure, which will create corresponding conf under <code>conf-enable</code> folder</p>
<pre><code>sudo a2enconf example 
</code></pre></li>
<li><p>check configure</p>
<pre><code>sudo apachectl -S 
sudo apachectl configtest 
</code></pre></li>
</ul>
<h4 id="config-with-virtual-host"><a href="#config-with-virtual-host" class="headerlink" title="config with virtual host"></a>config with virtual host</h4><ul>
<li>create <code>example.conf</code> under  <code>/etc/apache2/site-available/</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;VirtualHost *:8085&gt;</div><div class="line">        ServerName  10.20.181.119:8085</div><div class="line">        ServerAlias application.com</div><div class="line">        DocumentRoot &quot;/var/www/wsgy_example&quot;</div><div class="line">        ErrorLog &quot;/var/www/wsgy_example/logs/error.log&quot;</div><div class="line">        WSGIScriptAlias /application /var/www/wsgy_app/application.wsgi</div><div class="line"></div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>here used the additional <code>WSGI script</code>, <a href="https://www.linode.com/docs/web-servers/apache/apache-and-modwsgi-on-ubuntu-14-04-precise-pangolin/" target="_blank" rel="external">link</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import os</div><div class="line">import sys</div><div class="line"></div><div class="line">sys.path.append(&apos;/var/www/wsgy_app/&apos;)</div><div class="line"></div><div class="line">os.environ[&apos;PYTHON_EGG_CACHE&apos;] = &apos;/var/www/wsgy_app/.python-egg&apos;</div><div class="line"></div><div class="line">def application(environ, start_response):</div><div class="line">        status = &apos;200 OK&apos;</div><div class="line">        output = b&apos;Helo World&apos;</div><div class="line"></div><div class="line">        response_headers = [(&apos;Content-type&apos;, &apos;text/plain&apos;),</div><div class="line">                            (&apos;Content-length&apos;, str(len(output)))]</div><div class="line"></div><div class="line">        start_response(status, response_headers)</div><div class="line"></div><div class="line">        return [output]</div></pre></td></tr></table></figure>
<ul>
<li><p>enable configure, which will create corresponding conf under <code>site-enable</code> folder</p>
<pre><code>sudo a2ensite wsgy_example 
</code></pre></li>
<li><p>check configure</p>
<pre><code>sudo apachectl -S 
sudo apachectl configtest 
</code></pre></li>
</ul>
<h3 id="add-multi-ports"><a href="#add-multi-ports" class="headerlink" title="add multi ports:"></a>add multi ports:</h3><p>in /etc/apache2/ports.conf:</p>
<pre><code>Listen 8083
Listen 8084
</code></pre><p>since this Apache server host system_engineering web and pgadmin4 web, and share the same IP.</p>
<h3 id="restart-apache"><a href="#restart-apache" class="headerlink" title="restart apache"></a>restart apache</h3><pre><code>sudo systemctl restart apache2 
</code></pre><h3 id="test-apache"><a href="#test-apache" class="headerlink" title="test apache"></a>test apache</h3><p>in browser:</p>
<pre><code>10.20.181.119:8085/application
</code></pre><p>should view “hello world”</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://httpd.apache.org/docs/2.4/vhosts/name-based.html" target="_blank" rel="external">name based virtual host</a></p>
<p><a href="https://httpd.apache.org/docs/2.4/vhosts/" target="_blank" rel="external">Apache2 virutal host</a></p>
<p><a href="https://serverfault.com/questions/246445/how-do-i-create-virtual-hosts-for-different-ports-on-apache" target="_blank" rel="external">vhost with different ports</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/09/Gitlab-integrated-Jenkins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/09/Gitlab-integrated-Jenkins/" itemprop="url">Gitlab integrated Jenkins</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-09T06:59:28-04:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/09/Gitlab-integrated-Jenkins/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/09/Gitlab-integrated-Jenkins/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>after built the Gitlab server in LAN for two month, managing about 20 projects in ADS group currently. the needs for CI is coming up. at very beginning, I tried Gitlab CI runner, doesn’t work through. so Jenkins!</p>
<h2 id="Jenkins-installation"><a href="#Jenkins-installation" class="headerlink" title="Jenkins installation"></a>Jenkins installation</h2><p>there is a great series <a href="https://github.com/maxfields2000/dockerjenkins_tutorial" target="_blank" rel="external">Maxfields jekins-docker tutorial</a>, since originally I had Docker env and which is a prepartion for cloud deployment in future.</p>
<ul>
<li><p><a href="https://jenkins.io/doc/book/installing/#debian-ubuntu" target="_blank" rel="external">Jenkins in Docker installation</a>, </p>
</li>
<li><p>start Jenkins in Docker</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --rm -p 8080:8080 -p 50000:50000 -v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock  jenkinsci/blueocean</div></pre></td></tr></table></figure>
<ul>
<li><a href="https://jenkins.io/doc/book/installing/#setup-wizard" target="_blank" rel="external">setup wizard</a></li>
</ul>
<p>also Jenkins installed directly in <a href="https://linuxize.com/post/how-to-install-jenkins-on-ubuntu-18-04/" target="_blank" rel="external">Ubuntu</a></p>
<h2 id="Jenkins-integrated-with-Gitlab"><a href="#Jenkins-integrated-with-Gitlab" class="headerlink" title="Jenkins integrated with Gitlab"></a>Jenkins integrated with Gitlab</h2><p>Jenkins default has integrated with BitBucket and Github, to integrate with Gitlab:</p>
<ul>
<li>set Gitlab token</li>
</ul>
<p>in Gitlab Project main page, go to <code>User Profile</code> &gt;&gt; <code>Settings</code> &gt;&gt; <code>Peronsal Access Token</code>, naming the token and click <code>api</code> domain, the token is generated. </p>
<ul>
<li>install Gitlab Plugins   </li>
</ul>
<p>in Jenkins main page: <code>Manage Jenkins</code> &gt;&gt; <code>Manage Plugins</code> &gt;&gt; Search Available Plugins (gitlab).</p>
<ul>
<li>add gitlab key credentials </li>
</ul>
<p>in Jenkins main page, go to <code>Credentials</code>, choose the key type to <code>Gitlab API token</code>, then generate the key credential, used to access Gitlab project. </p>
<ul>
<li>configure Jenkins with gitlab</li>
</ul>
<p>in Jenkins main page, go to <code>Manage Jenkins</code> &gt;&gt; <code>Configure System</code>, at the gitlab section, add the gitlab host url and use the credential created at previous step.</p>
<p>since the gitlab server is hosted in LAN, even don’t have DNS for the gitlab server, purely raw IP address. so the gitlab host URL is like:</p>
<pre><code>http://10.20.110.110:80 
</code></pre><p>rather than the project git url (e.g.  <a href="http://10.20.110.110/your_name/your_project.git" target="_blank" rel="external">http://10.20.110.110/your_name/your_project.git</a>)</p>
<h2 id="Gitlab-Hook-Plugin"><a href="#Gitlab-Hook-Plugin" class="headerlink" title="Gitlab Hook Plugin"></a>Gitlab Hook Plugin</h2><p>gitlab events will be post to Jenkins through webhook, which is a common way to notify external serivces, e.g. dingding office chat, JIRA e.t.c. To set it up, need to configure <code>Gitlab Hook</code> plugin in Jenkins.</p>
<p>as mentioned in <a href="https://linuxize.com/post/how-to-install-jenkins-on-ubuntu-18-04/" target="_blank" rel="external">this post</a>, JDK10 or 11 is not supported  for Jenkins, if the current OS system has already JDK11, need addtionally install jdk8, and configure the default jdk=8: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">update-java-alternatives --list </div><div class="line"></div><div class="line">sudo update-alternatives --config java </div><div class="line"></div><div class="line">java -version</div></pre></td></tr></table></figure>
<h2 id="Jenkins-Project"><a href="#Jenkins-Project" class="headerlink" title="Jenkins Project"></a>Jenkins Project</h2><p>add a new Jenkins Item, select <code>FreeStyle</code>, go to <code>Configure</code>.</p>
<p>in <code>Source Code Management</code> section, select <code>Git</code>. add Repository URL and set gitlab username and password as Jenkins Credentials. </p>
<p>in <code>Build Triggers</code> section, select <code>Build when a change is pushed to Gitlab</code>, which display the Gitlab webhook URL: <a href="http://localhost:8080/jenkins/project/demo" target="_blank" rel="external">http://localhost:8080/jenkins/project/demo</a>; go to <code>Adavance</code> section to generate the secret token.</p>
<p>when getting all these done, back to Gitlab project, as Admin or Maintainer, in Project <code>Settings</code> &gt;&gt; <code>Integrations</code> &gt;&gt; <code>Add Webhooks</code>.URL and Secret Token are from the previous settings.</p>
<p>there is a common issue: <strong>Url is blocked: Requests to localhost are not allowed</strong>, please refer to <a href="https://docs.gitlab.com/ee/security/webhooks.html" target="_blank" rel="external">allow request to localhost network from system hooks</a></p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://technology.riotgames.com/news/putting-jenkins-docker-container" target="_blank" rel="external">riot games: putting jenkins in docker</a></p>
<p><a href="https://github.com/jenkinsci/gitlab-plugin#jenkins-to-gitlab-authentication" target="_blank" rel="external">jenkins to gitlab authentication</a></p>
<p><a href="https://emilwypych.com/emil-wypych/" target="_blank" rel="external">devops expert: Emil</a></p>
<p><a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="external">mind the product: PM’s guide to CD &amp; DevOps</a><br><a href="https://www.oodlestechnologies.com/blogs/Managing-Multiple-version-of-JDK-on-Ubuntu/" target="_blank" rel="external">manage multi version of JDK on Ubuntu</a></p>
<p><a href="https://www.jianshu.com/p/7dd79e6c0ac5" target="_blank" rel="external">a jianshu refer</a></p>
<p><a href="https://yq.aliyun.com/articles/659876" target="_blank" rel="external">a aliyun refer</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1465854" target="_blank" rel="external">tencent refer</a></p>
<p><a href="https://docs.gitlab.com/ee/security/webhooks.html" target="_blank" rel="external">allow request to localhost network from system hooks</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/29/warm-up-Hilber-space/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/warm-up-Hilber-space/" itemprop="url">warm up Hilber space</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T10:39:22-04:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/29/warm-up-Hilber-space/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/29/warm-up-Hilber-space/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="abstract-space"><a href="#abstract-space" class="headerlink" title="abstract space"></a>abstract space</h2><ul>
<li>Cauchy Series</li>
</ul>
<p>in metric space, existing an any positive and small \etta, exist a natural number <code>N</code>, $m, n &gt; N$, which satisfies:</p>
<p><img src="https://latex.codecogs.com/gif.latex?|x_m&space;-&space;x_n|&space;<&space;\varepsilon" title="|x_m - x_n| < \varepsilon"></p>
<p>it’s called a Cauchy Series. intuitively, as the numbers goes above, the elements get closer. </p>
<ul>
<li>Complete Space </li>
</ul>
<p>any Caunchy Series in these abstract space, its convergence is still in the original space. </p>
<p>e.g. rational number space is not complete space, as <img src="https://latex.codecogs.com/gif.latex?\sqrt{2}" title="\sqrt{2}"> is not in rational number space anymore. </p>
<p>intuitively, a complete space is like a shell without any holes on its surface. </p>
<ul>
<li>Linear Space </li>
</ul>
<p>with linear structural set, which can be described by <code>base vector</code>, so any hyper-point in a linear space can be represented by the linear combination of its <code>base</code>, so also called as <code>vector space</code>. in another way, linear space has only <code>add</code> and <code>scalar multi</code> operator.</p>
<ul>
<li>Metric Space </li>
</ul>
<p>to describe length or distance in linear space, adding  <code>normal</code> in the linear space, gives <code>normed linear space</code> or <code>metric space</code>.</p>
<ul>
<li>Banach Space</li>
</ul>
<p>a complete metric space</p>
<ul>
<li>Inner Product Space </li>
</ul>
<p>with <code>inner product</code> feature in metric space. for the infinite space, there are two different sub space, either the inner product of the series converged or not. </p>
<p>the convergence sub space is a completed space. </p>
<ul>
<li>Hilbert Space</li>
</ul>
<p>a completed inner product space</p>
<ul>
<li>Eurepean Space</li>
</ul>
<p>a finite  Hilbert Space. </p>
<h2 id="functional-analysis"><a href="#functional-analysis" class="headerlink" title="functional analysis"></a>functional analysis</h2><p>the optimzed control theory problem, is to find the functional, under system dynamic constraints, which gives the extremum point(function) in the infinite normed linear space; in general.</p>
<p>in general, the functional is depends on the system dynamic path, which gives some famuous theorem: Banach fixed point. </p>
<p>PDE theory, partial geometry, optimized control theory are all part of functional analysis. from computational mechanics field, there is a chance go to PDE theory; from modern control field, there is a chance go to optimized control theory; from modern physics field, the students may also get familiar with partial geometry. the beauty of math is show up, all these big concepts finally arrive to one source:  functional analysis. </p>
<p>to transfer all these big things into numerial world, which gives CAE solver, DQN solvers e.t.c.</p>
<h3 id="the-closest-point-property-of-Hilbert-Space"><a href="#the-closest-point-property-of-Hilbert-Space" class="headerlink" title="the closest point property of Hilbert Space"></a>the closest point property of Hilbert Space</h3><p>A subset of <code>A</code> of a vector space is <strong>convex</strong>: if for all a, b belongs to <code>A</code>, all \lamba such that <code>0 &lt; \lamba &lt; 1</code>, the point <img src="https://latex.codecogs.com/gif.latex?\lambda&space;a&space;&plus;&space;(1-\lambda)&space;b" title="\lambda a + (1-\lambda) b"> belongs to <code>A</code></p>
<p>assuming <code>A</code> is non-empty closed convex set in Hilbert Space <code>H</code>, for any x belongs to <code>H</code>, there is a unique point <code>y</code> of <code>A</code> which is closer to x than any ohter point of <code>A</code>:</p>
<p><img src="https://latex.codecogs.com/gif.latex?||&space;x&space;-&space;y&space;||&space;=&space;{R}_{a&space;\sphericalangle&space;R}&space;||&space;x&space;-&space;a||" title="|| x - y || = {R}_{a \sphericalangle R} || x - a||"></p>
<h3 id="orthogonal-expansions"><a href="#orthogonal-expansions" class="headerlink" title="orthogonal expansions"></a>orthogonal expansions</h3><p>if (e_n) is an orthonormal sequence in a Hilbert space <code>H</code>, for any x belongs to <code>H</code>, (x, e_n) is the nth Fourier coefficient of x with respect to (e_n), the Fourier series of x with respect to the sequence (e_n) is the series: </p>
<p><img src="https://latex.codecogs.com/gif.latex?\sum_i(x,&space;e_i)e_i" title="\sum_i(x, e_i)e_i"></p>
<ul>
<li>pointwise converges</li>
</ul>
<p><img src="https://latex.codecogs.com/gif.latex?\sum_{n=1}^{\infty&space;}&space;f_n(t)&space;=&space;f(t)" title="\sum_{n=1}^{\infty } f_n(t) = f(t)"></p>
<p>where <code>f_n</code>is a sequence of functions in <img src="https://latex.codecogs.com/gif.latex?L^2(0,1)" title="L^2(0,1)"></p>
<ul>
<li>complete orthonormal sequence </li>
</ul>
<p>given an orthonormal sequence of (e_n) and a vector <code>x</code> belongs to <code>H</code> then:</p>
<p><img src="https://latex.codecogs.com/gif.latex?x&space;=&space;\sum_{n=1}^{\infty&space;}&space;(x,&space;e_n)&space;e_n" title="x = \sum_{n=1}^{\infty } (x, e_n) e_n"></p>
<p>but only when this sequence is complete, the right-hand side converge to  left-hand side workks.</p>
<p>an orthonormal sequence (e_n) in Hilbert Space <code>H</code> is complete if the only member of <code>H</code> which is orthogonal to every e_n is the zero vector.</p>
<p>a complete orthonal sequence in <code>H</code> is also called an <code>orthonormal basis</code> of <code>H</code>.</p>
<p><code>H</code> is separable if it contains a complete orthonormal sequence, </p>
<p>the orthogonal complement (which named as E^T) of a subset <code>E</code> of <code>H</code> is the set:</p>
<p><img src="https://latex.codecogs.com/gif.latex?{&space;x&space;\in&space;H:&space;(x,&space;y)&space;=&space;0&space;for&space;all&space;y&space;\in&space;E}" title="{ x \in H: (x, y) = 0 for all y \in E}"></p>
<p>for any set <code>E</code> in <code>H</code>, <code>E^T</code> is a closed linear subspace of <code>H</code>.</p>
<p>the knowledge above gives the convergence in Hilbert Space, application like FEA, once created the orthonormal basis of solution space, the solution function represented by the linear combination of these basis is guranted to convergence. </p>
<h3 id="Fourier-series"><a href="#Fourier-series" class="headerlink" title="Fourier series"></a>Fourier series</h3><p>it is a complete orthonormal sequence in <code>L^2(-\pi, \pi)</code>, and any function represented by a linear combination of Fourier basis is converged. </p>
<p>but here Fourier basis is the arithmetic means of the nth partial sum of the Fourier series of f, not the direct basis itself. </p>
<h3 id="Dual-space"><a href="#Dual-space" class="headerlink" title="Dual space"></a>Dual space</h3><h3 id="FEA-solutions-for-PDE"><a href="#FEA-solutions-for-PDE" class="headerlink" title="FEA solutions for PDE"></a>FEA solutions for PDE</h3><p>PDE can be represented in a differential representation:</p>
<p><img src="https://latex.codecogs.com/gif.latex?\bigtriangledown&space;\cdot&space;(-k&space;\bigtriangledown&space;T)&space;=&space;g(T,&space;x)&space;,&space;in&space;\Omega" title="\bigtriangledown \cdot (-k \bigtriangledown T) = g(T, x) , in \Omega"></p>
<p>or an integral representation: </p>
<p><img src="https://latex.codecogs.com/gif.latex?\int_{\Omega}{&space;\bigtriangledown&space;\cdot&space;(-k&space;\bigtriangledown&space;T)}&space;=\int_{\Omega}&space;g(T,&space;x)&space;,&space;in&space;\Omega" title="\int_{\Omega}{ \bigtriangledown \cdot (-k \bigtriangledown T)} =\int_{\Omega} g(T, x) , in \Omega"></p>
<p>integral formulation has included existing boundary conditions. by multiplying test function <code>\phi</code> on both side of integral representation, and using Green’s first identity will give the weak formulation(variational formulation) of this PDE.</p>
<p><img src="https://latex.codecogs.com/gif.latex?\int_{\Omega}&space;\bigtriangledown&space;T&space;\cdot&space;\bigtriangledown&space;\varphi&space;dV&space;&plus;&space;\int_{S}&space;(-k&space;\bigtriangledown&space;T)&space;\cdot&space;\mathbf{n}&space;\varphi&space;dS&space;=&space;\int_{\Omega}&space;g&space;\varphi&space;dV" title="\int_{\Omega} \bigtriangledown T \cdot \bigtriangledown \varphi dV + \int_{S} (-k \bigtriangledown T) \cdot \mathbf{n} \varphi dS = \int_{\Omega} g \varphi dV"></p>
<p>in FEA, assuming the test function <code>\phi</code> and solution <code>T</code> belong to same Hilbert space, the advantage of Hilbert space, is functions inside can do linear combination, like vectors in a vector space. FEA also provides the error estimates, or bounds for the error. </p>
<p><img src="https://latex.codecogs.com/gif.latex?\phi&space;\in&space;H&space;;&space;T&space;\in&space;H" title="\phi \in H ; T \in H"></p>
<p>the weak formulation should be obtained by all test functions in Hilbert space. this is <code>weak formulation</code> due to now it doesn’t exactly requries all points in the domain need meet the differential representation of the PDE, but in a integral sense. so even a discontinuity of first derivative of solution <code>T</code> still works by weak formulation. </p>
<h3 id="Hilbert-space-and-weak-convergence"><a href="#Hilbert-space-and-weak-convergence" class="headerlink" title="Hilbert space and weak convergence"></a>Hilbert space and weak convergence</h3><p>convergence in another words means, the existence of solution. for CAE, DQN algorithms, the solution space is in Hilbert space. </p>
<h3 id="Lagrange-and-its-duality"><a href="#Lagrange-and-its-duality" class="headerlink" title="Lagrange and its duality"></a>Lagrange and its duality</h3><p>to transfer a general convex optimization problem with lagrange mulitplier:</p>
<p><img src="https://latex.codecogs.com/gif.latex?min&space;f(x)&space;\\&space;s.t.&space;c_i(x)&space;<=&space;0&space;\\&space;h_j(x)&space;=&space;0" title="min f(x) \\ s.t. c_i(x) <= 0 \\ h_j(x) = 0"></p>
<p>=&gt;</p>
<p><img src="https://latex.codecogs.com/gif.latex?L(x,&space;\alpha,&space;\beta)&space;=&space;f(x)&space;&plus;&space;\sum&space;\alpha_i&space;c_i(x)&space;\sum&space;\beta_j&space;h_j(x)" title="L(x, \alpha, \beta) = f(x) + \sum \alpha_i c_i(x) \sum \beta_j h_j(x)"></p>
<p>we always looks for meaning solution, so <code>L</code> should exist maximum extremum. if not, as <code>x</code> grow, the system goes divergence, no meaningful solution. define:</p>
<p><img src="https://latex.codecogs.com/gif.latex?\theta_P(x)&space;=&space;max_{\alpha,&space;\beta&space;\geq&space;0}&space;L(x,&space;\alpha,&space;\beta)" title="\theta_P(x) = max_{\alpha, \beta \geq 0} L(x, \alpha, \beta)"></p>
<p>so the constrainted system equation equals to :</p>
<p><img src="https://latex.codecogs.com/gif.latex?min_x&space;\theta_P(x)&space;=&space;min_x&space;max_{\alpha,&space;\beta&space;\geq&space;0}&space;L(x,&space;\alpha,&space;\beta)" title="min_x \theta_P(x) = min_x max_{\alpha, \beta \geq 0} L(x, \alpha, \beta)"></p>
<p>to rewrite the original equation as: </p>
<p><img src="https://latex.codecogs.com/gif.latex?\theta_D(\alpha,&space;\beta)=&space;min_x&space;L(x,&space;\alpha,&space;\beta)" title="\theta_D(\alpha, \beta)= min_x L(x, \alpha, \beta)"></p>
<p>then the system’s duality is defined as :</p>
<p><img src="https://latex.codecogs.com/gif.latex?max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;\theta_D(\alpha,&space;\beta)=&space;max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;min_x&space;L(x,&space;\alpha,&space;\beta)" title="max_{\alpha, \beta \geqslant 0} \theta_D(\alpha, \beta)= max_{\alpha, \beta \geqslant 0} min_x L(x, \alpha, \beta)"></p>
<p>for a system, if the original state equation and its duality equation both exist extremum solution, then :</p>
<p><img src="https://latex.codecogs.com/gif.latex?d^*&space;=&space;max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;min_x&space;L(x,&space;\alpha,&space;\beta)&space;\leqslant&space;min_x&space;max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;L(x,&space;\alpha,&space;\beta)&space;=&space;p^*" title="d^* = max_{\alpha, \beta \geqslant 0} min_x L(x, \alpha, \beta) \leqslant min_x max_{\alpha, \beta \geqslant 0} L(x, \alpha, \beta) = p^*"></p>
<p>the benefits of duality problems is </p>
<ul>
<li><p>the duality problem is always convex,  even when the original problem is non-convex </p>
</li>
<li><p>the duality solution give an lower boundary for the original solution</p>
</li>
<li><p>when strong duality satisfy, the duality solution is the original solution</p>
</li>
</ul>
<h3 id="Krylov-Space"><a href="#Krylov-Space" class="headerlink" title="Krylov Space"></a>Krylov Space</h3><h3 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h3><p><a href="https://zhuanlan.zhihu.com/p/37108430" target="_blank" rel="external">convex func</a></p>
<p><a href="https://www.comsol.com/multiphysics/finite-element-method" target="_blank" rel="external">finite element method</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/38182879" target="_blank" rel="external">Lagranget duality</a></p>
<p><a href="https://web.stanford.edu/~boyd/cvxbook/bv_cvxbook.pdf" target="_blank" rel="external">standford convex optimization</a></p>
<p><a href="https://danieltakeshi.github.io/2016/10/31/going-deeper-into-reinforcement-learning-understanding-q-learning-and-linear-function-approximation/" target="_blank" rel="external">Going deeper into RF: understaing Q-learning and linear function approximation</a></p>
<p><a href="">Nicholas Young, an introduction to Hilbert Space</a></p>
<p><a href="https://www.quora.com/Why-are-Hilbert-spaces-important-for-finite-element-analysis" target="_blank" rel="external">why are Hilbert Space important to finite element analysis</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/18/reinforcement-learning-in-nutshell-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/18/reinforcement-learning-in-nutshell-1/" itemprop="url">reinforcement learning in nutshell-1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-18T10:36:19-04:00">
                2019-09-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/18/reinforcement-learning-in-nutshell-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/18/reinforcement-learning-in-nutshell-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="RL-concepts"><a href="#RL-concepts" class="headerlink" title="RL concepts"></a>RL concepts</h3><p>assuming timestep <code>t</code>:</p>
<ul>
<li>the environment state <strong>S</strong>(t)</li>
<li>agent’s action <strong>A</strong>(t)</li>
<li>discouted future reward <strong>R</strong>(t), which satisfy: </li>
</ul>
<p><img src="https://latex.codecogs.com/gif.latex?R_t&space;=&space;r_{t&plus;1}&space;&plus;&space;\gamma&space;r_{t&plus;2}&space;&plus;&space;...&space;&plus;&space;\gamma^k&space;r_{t&plus;k&plus;1}" title="R_t = r_{t+1} + \gamma r_{t+2} + ... + \gamma^k r_{t+k+1}"></p>
<pre><code>with current state `s` and taking current action `a`, the env will give the reward `r_{t+1}`. `\gamma` is the discount ratio, which usually in [0,1], when $\gamma = 0 $, agent&apos;s value only consider current reward.  check [discount future reward]() in following chapter.
</code></pre><ul>
<li><p>agent’s policy <strong>P</strong>(a|s), in current state <code>s</code>, the propability of action <code>a</code></p>
</li>
<li><p>agent’s state value <strong>V</strong>(s), in state <code>s</code> and took policy <code>\pi</code>, which usually described as an expectation:</p>
</li>
</ul>
<p><img src="https://latex.codecogs.com/gif.latex?V^\pi(s)&space;=&space;E&space;(R_t&space;)" title="V^\pi(s) = E (R_t )"></p>
<ul>
<li>agent’s action value <strong>Q</strong>(s, a), which consider both state <code>s</code> and action <code>a</code> effects on value calculation. </li>
</ul>
<p><img src="https://latex.codecogs.com/gif.latex?Q^\pi(s,&space;a)&space;=&space;E_{\pi}&space;(&space;R_t&space;|&space;s=s_t,&space;a=a_t)&space;=&space;E_{\pi}&space;(R_{t&plus;1})&space;=&space;E(r_{t&plus;1}&space;&plus;&space;\gamma&space;V^\pi(s_{t&plus;1}))" title="Q^\pi(s, a) = E_{\pi} ( R_t | s=s_t, a=a_t) = E_{\pi} (R_{t+1}) = E(r_{t+1} + \gamma V^\pi(s_{t+1}))"></p>
<p><img src="https://latex.codecogs.com/gif.latex?V^\pi&space;(s)&space;=&space;E&space;(&space;Q^\pi(s,&space;a)|_{a&space;\sim&space;\pi(a|s)}&space;)" title="V^\pi (s) = E ( Q^\pi(s, a)|_{a \sim \pi(a|s)} )"></p>
<p>namely, agent’s value is the expectation of its action value with probability distribution <code>p(a|s)</code>. </p>
<ul>
<li>state transfer propability <strong>P</strong></li>
<li>explore rate <code>\eta</code>,  it’s the chance to choose non-max value during iteration, similar as mutation.</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/17414314-c9a7f64558173b0b.png?imageMogr2/auto-orient/strip|imageView2/2" alt="image"></p>
<h3 id="Markov-decision-process"><a href="#Markov-decision-process" class="headerlink" title="Markov decision process"></a>Markov decision process</h3><p>assuming <code>state transfer propability</code>, <code>agent&#39;s policy</code>, and <code>agent&#39;s value</code> follow <code>Markov assumption</code>. namely, the current state transfer propability, agent’s policy and value only relates to current state.</p>
<p>agent’s value function <strong>V</strong>(s) meets <a href="">Belman’s equation</a>:</p>
<p><img src="https://latex.codecogs.com/gif.latex?V(S)&space;=&space;E(&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;V(S_{t&plus;1})|S_t&space;=s&space;)" title="V(S) = E( R_{t+1} + \gamma V(S_{t+1})|S_t =s )"></p>
<p>and agent’s action value function <strong>q</strong>(s) also has Belman’s equation:</p>
<p><img src="https://latex.codecogs.com/gif.latex?Q(s,&space;a)&space;=&space;E(&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;Q(S_{t&plus;1},&space;A_{t&plus;1}&space;)|S_t&space;=s,&space;A_t&space;=a&space;)" title="Q(s, a) = E( R_{t+1} + \gamma Q(S_{t+1}, A_{t+1} )|S_t =s, A_t =a )"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/17414314-54bb214db83cc7b2.png?imageMogr2/auto-orient/strip|imageView2/2" alt="image"></p>
<p>in general, env’s state is random; the policy to take action is policy <strong>P(a|s)</strong>. Markov Decision process is: state, action, policy, each <code>[state, action, policy]</code> is an <code>episode</code>, which gives the state-action-reward series:</p>
<pre><code>s0, a0, r1, s1, a1, r2, ... s(n-1),  a(n-1), rn, sn
</code></pre><p>Markov assumption is state(n+1) is only depends on state(n).</p>
<h3 id="Belman’s-equation"><a href="#Belman’s-equation" class="headerlink" title="Belman’s equation"></a>Belman’s equation</h3><p>Belman’s equation gives the recurrence relation in two timesteps. the current state value is calcualted from next future status with given current env status.</p>
<p><img src="https://latex.codecogs.com/gif.latex?v(s)&space;=&space;E(&space;R_(t&plus;1)&space;&plus;&space;\gamma&space;v(S_(t&plus;1))|S_t&space;=&space;s&space;)" title="v(s) = E( R_(t+1) + \gamma v(S_(t+1))|S_t = s )"></p>
<h3 id="discounted-future-reward"><a href="#discounted-future-reward" class="headerlink" title="discounted future reward"></a>discounted future reward</h3><p>to achieve better reward in long term, always conside the reward as sum of current and future rewards:</p>
<pre><code>R(t) = r(t) + r(t+1) + ... r(n)
</code></pre><p>on the other side, as the env state is random in time, the same action doesn’t give the same reward usually, and as time goes, the difference is even larger. think about the B-tree, as it goes deeper, the number of nodes is larger. so the reward in future doesn’t count the same weight as earlier reward, here define the discount ratio <code>\gamma</code> &lt;- [0, 1]</p>
<pre><code>R(t) = r(t) + \gamma r(t+1) + ... + \gamma^(n-t) r(n)

R(t) = r(t) = \gamma R(t+1) 
</code></pre><h3 id="policy-iteration"><a href="#policy-iteration" class="headerlink" title="policy iteration"></a>policy iteration</h3><p>there are two steps:  </p>
<ul>
<li><p>policy evaluation, with current policy <code>\pi</code> to evaluate state’s value <code>V&#39;</code></p>
</li>
<li><p>policy improvment, with the state value <code>V&#39;</code>, with a special policy update strategy(e.g. greedy) to update policy.</p>
</li>
</ul>
<p>the ideal result is to find the <code>fixed point</code> in value space, which corresponds to the optimized policy at current state with current policy update strategy.  </p>
<p>in policy iteration, we only consider policy-value mapping.<br><img src="https://upload-images.jianshu.io/upload_images/17414314-40038359d36b0b92.png" alt="image"></p>
<h3 id="value-iteration"><a href="#value-iteration" class="headerlink" title="value iteration"></a>value iteration</h3><p>where policy iteration based valued is implicit, only value iteration explicit by Belman’s equation. this is also a <code>fixed point</code> application, as we can use the explicit mapping (Belman’s equation) in state value space. so there should guarantee existing an optimized policy. </p>
<p><img src="https://upload-images.jianshu.io/upload_images/17414314-6fdea50bdaf6fee7.png?imageMogr2/auto-orient/strip|imageView2/2" alt="image"></p>
<h2 id="an-optimization-problem"><a href="#an-optimization-problem" class="headerlink" title="an optimization problem"></a>an optimization problem</h2><p>reiforcement learning solution is to find the optimal value function to achieve the max reward in each timestep, which leads to optimal policy <code>\pi*</code>, or max value func, or max action value func.</p>
<pre><code>$$ v(s) = max(v_i(s)) foreach i in value funcs $$ 

$$ q(s, a) = max(q_i(s,a)) foreach i in action value funcs $$ 
</code></pre><p>mostly the <code>solution space</code> is not known at hand, if else, the optimal solution can get directly. on the other hand, current state, action set tells a little information about the <code>solution space</code>, as they are part of the <code>solution space</code>, so the optimization algorithms used in convex space can be applied here. </p>
<p>a few common optimization algorithms includes: </p>
<h3 id="dynamic-programming-DP"><a href="#dynamic-programming-DP" class="headerlink" title="dynamic programming(DP)"></a>dynamic programming(DP)</h3><p>DP can used in both <code>policy evaluation</code> and <code>policy iteration</code>, but in each <code>calculation step</code>(not even one physical step, and in one physical step, there can be hundreds or thousands of calculation steps) iteration, DP has to recalculate all state(t=current) value to the very first state(t=0) value, which is disaster for high-dimensional problem, and DP by default is kind of <code>integer programming</code>, not fitted to <code>continuous domain</code> either.</p>
<h3 id="Monte-Carlo-MC"><a href="#Monte-Carlo-MC" class="headerlink" title="Monte Carlo (MC)"></a>Monte Carlo (MC)</h3><p>MC gets a few sample solutions in the <code>solution space</code>, and use these samples solution to approxiamte the <code>solution space</code>. in a geometry explaination, the base vectors of the solution space is unknown, but MC finds a few points in this space, then approximate the (nearly) base vectors, then any point in this space can be approximated by the linear combination of the nearly base vectors.</p>
<p>MC has no ideas of the propability of state transfer, MC doesn’t care the inner relations of state variables, or model-free.</p>
<p>MC is robost as it’s model free, on the other hand, if the <code>solution space</code> is high-dimensional, there is a high chance the sampling points are limited in a lower dimension, which weak the presentation of MC approximation; also MC needs to reach the final status, which may be not avaiable in some applications. </p>
<h3 id="time-serial-Time-Difference-TD"><a href="#time-serial-Time-Difference-TD" class="headerlink" title="time-serial Time Difference(TD)"></a>time-serial Time Difference(TD)</h3><p>MC use the whole list of status for each policy evaluation; in 1st order TD, policy evaluation only use next reward and next state value:</p>
<pre><code>$ v(s) = R(t+1)  + \gamma S(t+1)|S $
</code></pre><p>for n-th order TD, the update will use n-th reward :</p>
<pre><code>$ v(s) = R(t+1) + \gamma R(t+2) + ... + \gamma^(n-1) R(t+n) + \gamma^n S(t+n)|S $
</code></pre><p>it’s clear here, as n-&gt;infinitly, n-th order TD is closer to MC. <strong>so how close is enough usually, namely which n is enough ?</strong></p>
<h3 id="SARSA"><a href="#SARSA" class="headerlink" title="SARSA"></a>SARSA</h3><p>in TD, there are two ways: on-line policy, where the same one policy is using to both update value func and upate action; while off-line policy, where one policy is used to update value func, the other policy is used to update action. </p>
<p>SARSA is kind of on-line policy, and the policy is <code>e-greedy</code>, to choose the max value corresponding action in every iteration with a high probablitiy <code>(1-e)</code>, as <code>e</code> is very small.</p>
<pre><code>$ \delta(t) v(S, A) = R + \gamma (v(S&apos;, A&apos;) - v(S, A)) $
</code></pre><p>in the iteration equation above, <code>\delta(t)</code> will give the iteration timestep size, <code>S&#39;</code>, <code>A&#39;</code> are next state and next action, compare to pure 1-st order TD, where the next state value is modified as:  $(Q(S’, A’) - Q(S, A)$, in this way <code>value func</code> keep updated in every func, which can be considered as local correction, compared to the unchanged pure 1-st order TD, which may be highly unstable/diverge in long time series. </p>
<p>as time-serial TD can’t guarantee converge, so this local correction makes SARSA numerical robost.</p>
<p>SARSA(\lambda) in mutli-step based is same as n-th order TD. </p>
<pre><code>$ v(s) = R(t+1) + \gamma R(t+2) + ... + \gamma^(n-1) R(t+n) + \gamma^n ( v(S`) - v(S) ) $
</code></pre><p>the problem of SARSA is <code>v(S, A)</code> may go huge, as the algorithm is on-line policy, which requires huge memory. </p>
<h3 id="Q-learning"><a href="#Q-learning" class="headerlink" title="Q-learning"></a>Q-learning</h3><p>Q-learning is off-line policy TD. the policy iteration is use <code>e-greedy policy</code>, same as SARSA; while the policy evaluation to update value func use <code>greedy policy</code>. </p>
<p>in a word: from status <code>S</code>, using <code>e-greedy policy</code> to choose action <code>A</code>, and get reward <code>R</code>, and in status <code>S&#39;</code>, and using <code>greed policy</code> to get action <code>A&#39;</code>.</p>
<pre><code>$ \delta(t) Q(S, A) = R + \gamma (Q(S&apos;, A&apos;) - Q(S, A)) $   (a)
</code></pre><p>where $ A<code>= max v(a|S</code>) $. while in SARSA, both <code>S&#39;</code> and <code>A&#39;</code> update using <code>e-greed</code>.</p>
<p>usually <code>Q(S,A)</code> is called Q-valued.</p>
<p>the benefit of choosing a different policy to update action, is kind of decouping status and action, so in this way, they can reach more area in <code>real state-action space</code>, which also lead the <code>solution space</code> a little more robost. </p>
<p>but still equation (a) is not guaranted to converge as time goes. the converged <code>Q(S,A)</code> should be <strong>convex</strong>, which means its second-order derivative must be less than 0, then the max Q values (max extremum) achieves when first-order derivate is 0.</p>
<p>while Q-learning has the same problem as SARSA, the huge memory to store Q(S,A) table.</p>
<p>to make intuitive example, think about an robot walk with 2 choice(e.g. turn left, turn right), and the grid world has 20 box in line, which has 2^20 ~= 10e6 elements in Q(S, A). it can’t scale to any real problem. </p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://web.stanford.edu/class/psych209/Readings/SuttonBartoIPRLBook2ndEd.pdf" target="_blank" rel="external">Sutton &amp; Barto, Reinforcement learning: an introduction</a></p>
<p><a href="https://www.cnblogs.com/pinard/p/9426283.html" target="_blank" rel="external">Pinard</a></p>
<p><a href="https://www.jianshu.com/p/b392405115bb" target="_blank" rel="external">fromeast</a></p>
<p><a href="http://www.w3.org/1998/Math/MathML" target="_blank" rel="external">mathxml editor</a></p>
<p><a href="https://www.codecogs.com/latex/eqneditor.php" target="_blank" rel="external">equation html editor</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/26365534" target="_blank" rel="external">fixed point mechanism</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/18/python-modules-in-help/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/18/python-modules-in-help/" itemprop="url">python modules in help</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-18T09:09:48-04:00">
                2019-09-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/18/python-modules-in-help/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/18/python-modules-in-help/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="unittest"><a href="#unittest" class="headerlink" title="unittest"></a>unittest</h2><h3 id="why-unit-test"><a href="#why-unit-test" class="headerlink" title="why unit test ?"></a>why unit test ?</h3><p>unit test is to test the components of a program automatically. a few good reasons of unit tests:</p>
<ul>
<li>test driving practice </li>
<li>early sanity checking </li>
<li>for regression test, that the new changes won’t break early work </li>
<li>unit test is to test the isolated piece of code, usually white box test written by developer; functional test is to test the function requirements, usually black box test written by testers.</li>
</ul>
<p>the testcase output can be <code>OK</code>, <code>FAIL</code>, <code>ERROR</code>.</p>
<h3 id="assertion-functions"><a href="#assertion-functions" class="headerlink" title="assertion functions"></a>assertion functions</h3><ul>
<li><p>basic boolean asserts:</p>
<pre><code>assertEqual(arg1, arg2, msg=None)
assertIsNot(arg1, arg2, msg=None)
</code></pre></li>
<li><p>comparative asserts:</p>
<pre><code>assertAlmostEqual(first, second, places=7, msg=None, delta=None)
</code></pre></li>
<li><p>asserts for collections:</p>
<pre><code>assertListEqual(list1, list2, msg=None)
assertTupleEqual(tuple1, tuple2, msg=None)
assertSetEqual(set1, set2, msg=None)
assertDictEqual(dic1, dic2, msg=None)    
</code></pre><h3 id="command-line-interface"><a href="#command-line-interface" class="headerlink" title="command line interface"></a>command line interface</h3></li>
<li><p>run all unittests</p>
<pre><code>python3 -m unittest discover -v -c
</code></pre></li>
<li><p>run single test module</p>
<pre><code>python3 -m unittest -v -c tests/test_XXXX.py
</code></pre></li>
<li><p>run individual test case</p>
<pre><code>python3 -m unittest -v tests.test_XXX.TestCaseXXX.test_XXX
</code></pre></li>
</ul>
<h2 id="how-to-write-a-unittest"><a href="#how-to-write-a-unittest" class="headerlink" title="how to write a unittest"></a>how to write a unittest</h2><h3 id="unittest-TestCase"><a href="#unittest-TestCase" class="headerlink" title="unittest.TestCase"></a>unittest.TestCase</h3><p>any user defined test class should first derived from <code>unittest.TestCase</code> </p>
<h3 id="setUp-amp-tearDown"><a href="#setUp-amp-tearDown" class="headerlink" title="setUp() &amp; tearDown()"></a>setUp() &amp; tearDown()</h3><p>setUp() provides the way to set up things before running any method starting with <code>test_xx()</code>  in user defined test class. tearDown() is where to end the setting ups </p>
<h3 id="depends-on-other-modules-class"><a href="#depends-on-other-modules-class" class="headerlink" title="depends on other modules/class"></a>depends on other modules/class</h3><p>usually the class/methods we try to test have depends on other modules/class, but as unit test want to isolate these depends, so either mock the other methods or fake data. in general there are three types of depends:</p>
<h4 id="pure-variable"><a href="#pure-variable" class="headerlink" title="pure variable"></a>pure variable</h4><p>this is the most simple case, then you can directly define the same pure type variable in your <code>test_xx()</code> method </p>
<h4 id="methods-in-other-modules"><a href="#methods-in-other-modules" class="headerlink" title="methods in other modules"></a>methods in other modules</h4><p>here need to use <code>patch</code>, to mock the method and define its return value is your <code>test_xx()</code> method, then in the class where call the real method will be replace by this mocked one.</p>
<h4 id="methods-in-other-class"><a href="#methods-in-other-class" class="headerlink" title="methods in other class"></a>methods in other class</h4><p>here need to use <code>mock</code>, either MagicMock or Mock will works.</p>
<h3 id="mock-amp-patch"><a href="#mock-amp-patch" class="headerlink" title="mock &amp; patch"></a>mock &amp; patch</h3><p><a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank" rel="external">mock module</a> is built in <code>unittest.mock</code> after a later Python version, if not, <code>mock</code> module can be installed by <strong>pip install mock</strong>, then directly <code>import mock</code> in code.</p>
<p>the philosophy of unit test is to isolate classes test, but in reality most classes have some instances of other classes, so to test the ego class isolated from other classes, that’s where <code>mock</code> helps. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> MagicMock, patch</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestScenario</span><span class="params">(TestCase)</span>:</span></div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">test_mock</span><span class="params">(self)</span>:</span></div><div class="line">		sim.method = MagicMock(return_value=<span class="string">"xx"</span>)</div><div class="line">		agent = sim.method()</div><div class="line">		self.assertEqual(agent, <span class="string">"xx"</span>)</div><div class="line">		</div><div class="line"><span class="meta">	@patch("module/add_agent")</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">test_patch</span><span class="params">(self, mock_add_agent)</span>:</span></div><div class="line">		mock_add_agent.return_value = <span class="string">"xx"</span></div><div class="line">		agent = module.add_agent()</div><div class="line">		self.assertEqual(agent, <span class="string">"xx"</span>)</div></pre></td></tr></table></figure>
<p><code>Mock</code> helps to mock the method in a class, while <code>patch</code> helps to mock a global method in a module.</p>
<h3 id="automatical-unittest-generator"><a href="#automatical-unittest-generator" class="headerlink" title="automatical unittest generator"></a>automatical unittest generator</h3><p>there are projects assit to generate unittest code automatically, e.g <a href="">auger</a></p>
<h3 id="test-with-while-Loop"><a href="#test-with-while-Loop" class="headerlink" title="test with while Loop"></a>test with while Loop</h3><p>TODO</p>
<h3 id="test-with-raise-Error"><a href="#test-with-raise-Error" class="headerlink" title="test with raise Error"></a>test with raise Error</h3><p>TODO</p>
<h2 id="coverage-py"><a href="#coverage-py" class="headerlink" title="coverage.py"></a>coverage.py</h2><ul>
<li><p>(one time only) install coverage.py</p>
<p>  pip3 install –user coverage</p>
</li>
<li><p>run all tests with coverage</p>
<p>  ~/.local/bin/coverage run -m unittest discover</p>
</li>
<li><p>generate html report</p>
<p>  ~/.local/bin/coverage html –omit “~/.local/<em>“,”tests/</em>“</p>
</li>
</ul>
<p>ps, output is in htmlcov/index.html</p>
<h2 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h2><p><code>logging()</code> supports more detail message type(info, warn, error, debug) than <code>print()</code>, and the message format is more strict with <code>\%</code>. while <code>print()</code> works both formatted message and message as string simply:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">"1+1 = "</span>, num)</div><div class="line">print(<span class="string">"1+1 = %d"</span>, % num)</div></pre></td></tr></table></figure>
<p>the following is a general log class, which can plug in any existing Python project:</p>
<pre><code class="python">
<span class="keyword">import</span> logging 
<span class="keyword">import</span> os 

<span class="class"><span class="keyword">class</span> <span class="title">log</span><span class="params">(object)</span>:</span>
    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logger_name)</span>:</span>
        self.log = logging.getLogger(logger_name)
        self.log.setLevel(logging.DEBUG)
        console_handler = logging.StreamHandler()
        console_handler.setLevel(logging.DEBUG)
        self.log.addHandler(console_handler)

    <span class="function"><span class="keyword">def</span> <span class="title">set_output_file</span><span class="params">(self, filename)</span>:</span>
        file_handler = logging.FileHandler(filename)
        file_handler.setLevel(logging.INFO)
        formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)
        file_handler.setFormatter(formatter)
        self.log.addHandler(file_handler)

<span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span>
    test = log(<span class="string">'scenario-mm'</span>)
    file_name = <span class="string">"record.log"</span> 
    dir_name = <span class="string">"/home/python_test/"</span>
    <span class="keyword">try</span>:
        os.makedirs(dir_name)
    <span class="keyword">except</span> OSError:
        <span class="keyword">pass</span> 
    file_path =  os.path.join(dir_name, file_name)
    test.set_output_file(file_path)
    test.log.debug(<span class="string">"debug in episode 1..."</span>)
    test.log.info(<span class="string">"info ..."</span>)
    test.log.warning(<span class="string">"warn ..."</span>)
    test2 = log(<span class="string">"zjjj"</span>)
    test2.set_output_file(<span class="string">'record.log'</span>)
    test2.log.info(<span class="string">"test2 info"</span>)
    test2.log.warning(<span class="string">"test2 warn"</span>)


<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    main()
</code></pre>
<h2 id="pygame"><a href="#pygame" class="headerlink" title="pygame"></a>pygame</h2><h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://www.cnblogs.com/beer/p/5075619.html" target="_blank" rel="external">python automatic test series</a></p>
<p><a href="https://github.com/laffra/auger" target="_blank" rel="external">auger: automated Unittest generation for Python</a></p>
<p><a href="https://docs.python.org/3/library/unittest.html" target="_blank" rel="external">unittest official</a></p>
<p><a href="https://github.com/lgsvl/PythonAPI/tree/master/tests" target="_blank" rel="external">unittest in lg-sim project</a></p>
<p><a href="https://coverage.readthedocs.io/en/stable/" target="_blank" rel="external">coverage.py official</a>  </p>
<p><a href="https://www.jianshu.com/p/013b9bdecb0d" target="_blank" rel="external">unittest + mock + tox</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/14/math-in-ADS-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/14/math-in-ADS-system/" itemprop="url">math in ADS system</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-14T06:43:04-04:00">
                2019-09-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/14/math-in-ADS-system/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/14/math-in-ADS-system/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>when dealing with plan and control models in ADS system, there are plenty of basic math, and the understanding of these math are definitely helpful to build a better and stronger algorithm.</p>
<p>to design a ADS software system, there are two parts, the engineering background and software development. enginneering side is the core logic, while software is about how to organize the software and present, especially with new ideas, e.g. cloud based architecture, web user interface.</p>
<h2 id="vector-analysis"><a href="#vector-analysis" class="headerlink" title="vector analysis"></a>vector analysis</h2><h3 id="coordinate-system"><a href="#coordinate-system" class="headerlink" title="coordinate system"></a>coordinate system</h3><p>asssumed a Cartesian system [O: e1, e2, e3], a vector <strong>r</strong> can be represented as (x, y, z).</p>
<h3 id="vector-operator"><a href="#vector-operator" class="headerlink" title="vector operator"></a>vector operator</h3><ul>
<li><p>vector add </p>
<p>  <strong>a</strong> + <strong>b</strong> = (a_x + b_x) <strong>i</strong> + (a_y + b_y) <strong>j</strong> + (a_z + b_z) <strong>k</strong></p>
</li>
</ul>
<p>the triangle inequality is:</p>
<p>|<strong>a</strong> + <strong>b</strong>| &lt;= |<strong>a</strong>| + |<strong>b</strong>|</p>
<ul>
<li><p>multiply scalar </p>
<p><strong>a</strong> . <strong>b</strong> =  a . b_x <strong>i</strong> + a . b_y <strong>j</strong> + a . b_z <strong>k</strong>  </p>
</li>
</ul>
<p>namely, by multiplying each direction component of the vector by <code>a</code>.</p>
<ul>
<li><p>dot product </p>
<p><strong>a</strong> . <strong>b</strong> = |a|.|b|. \cos<a,b> = a_x . b_x +  a_y . b_y +  a_z . b_z </a,b></p>
</li>
</ul>
<p>a simple physical explaination: assume <code>a</code> is displacement, <code>b</code> is force, then the power of force in the displacement is by <code>dot product</code>.</p>
<p>the geometric meaning of <code>dot product</code> is projection. namely, |a|cos<a,b> means project of vector <code>a</code> on vector <code>b</code>, which also gives the decomposion of <code>a</code>, which has a unique <code>projection component vector</code> and <code>vertical component vector</code>.</a,b></p>
<p><strong>a</strong> =  <strong>a_p</strong> + <strong>a_v</strong></p>
<p><strong>a_p</strong> = ( <strong>a</strong> . <strong>e_p</strong> ) . <strong>e_p</strong></p>
<ul>
<li>cross product </li>
</ul>
<p>assume three vectors non-co-plane, (a, b, c), rotating start from a to b, the thumb point to c, which is a right-hand-coordinate system. </p>
<p>a simple physical meaning: assume <code>a</code> is the force, <code>b</code> is the force arm, then <code>a x b</code> gives the torque, which perpendicular to <a, b=""> plane. </a,></p>
<p> <strong>a</strong> x <strong>b</strong> = |a||b| \sin<a, b=""> </a,></p>
<p>the geometric meaning of <code>cross product</code> is the area of parallelogram by <a, b="">. </a,></p>
<p>base vectors in right-hand Cartesian coordiante system satisfy:</p>
<pre><code>ei x ej = ek (i != j)
</code></pre><ul>
<li><p>mixed product </p>
<pre><code>$$ a x b \cdot c  $$
</code></pre></li>
</ul>
<p>which gives the volume of parallel hexagonal propped by <a, b,="" c=""></a,></p>
<h3 id="curve-volume-integration"><a href="#curve-volume-integration" class="headerlink" title="curve(volume) integration"></a>curve(volume) integration</h3><ul>
<li><p>Gauss integration </p>
</li>
<li><p>Stokes integration </p>
</li>
</ul>
<h3 id="scalar-field"><a href="#scalar-field" class="headerlink" title="scalar field"></a>scalar field</h3><ul>
<li>directional derivative </li>
</ul>
<p>assuming vector <code>l</code> in space, its unitfied vector can be present as directional cosine [cos\alpha, cos\beta, cos\gamma]^T. for any function <code>u=u(x, y, z)</code>, who is derivable at <code>M0(x0, y0, z0)</code>, then:</p>
<pre><code>\frac{\partial u}{\partial l} = dot_product(\Delta u, &lt;\cos \alpha, \cos \beta, \cos \gamme&gt; )
</code></pre><ul>
<li><p>gradient </p>
<pre><code>\Delta u =  \frac{\partial u}{\parial x} \b{i} + \frac{\partial u}{\parial y} \b{j} +  \frac{\partial u}{\parial z} \b{k}
</code></pre></li>
</ul>
<p>the directional derivative which gives the maximum of <code>\Delta u</code> at a point, it’s the gradient direction. the gradient direction in space, stands for the direction from lowest co-value layer to highest co-value layer, which in physical, means the most high rate of change in general. </p>
<ul>
<li><p>Halmilton operator </p>
<pre><code>\Delta  =  \frac{\partial}{\parial x} \b{i} + \frac{\partial}{\parial y} \b{j} +  \frac{\partial}{\parial z} \b{k}
</code></pre></li>
</ul>
<h3 id="vector-field"><a href="#vector-field" class="headerlink" title="vector field"></a>vector field</h3><ul>
<li>directional derivative</li>
</ul>
<p>the gradient field of a vector field gives a tensor field, which raise the dimension one more. the dot product(inner product) of a vector field, decrease to scalar field, the cross product of a vector field keeps a vector field. for a vector field, usually talk about its flux and divergence.</p>
<h2 id="analytical-geometry"><a href="#analytical-geometry" class="headerlink" title="analytical geometry"></a>analytical geometry</h2><h3 id="plane-equation"><a href="#plane-equation" class="headerlink" title="plane equation"></a>plane equation</h3><p>assume plane <code>\pi</code> in Cartesian coordinate system [O: X, Y, Z], <code>O</code>‘s projection in plane is <code>N</code>,  the directional cosine of <code>ON</code> is <code>(l, m, n)</code>, </p>
<p>for any point <code>P</code> in plane, <code>NP</code> is always perpendicular to the directional cosine, namely:</p>
<p>dot_product( <strong>NP</strong>, <strong>(l, m, n)</strong> ) = 0 </p>
<p>as <code>l**2 + m**2 + n**2 == 1</code>, which gives:</p>
<pre><code>lx + my + nz - p = 0            (1)
</code></pre><p>equation 1) is the normalized plane equation. and <code>(l, m, n)</code> is the normal vector of lane <code>\pi</code>, and <code>p</code> should be no lesss than 0.</p>
<h3 id="linear-equation"><a href="#linear-equation" class="headerlink" title="linear equation"></a>linear equation</h3><p>assumed a line  go across point <code>P_0</code> $(x_0, y_0, z_0)$ and in direction <code>\lamba</code>, then any point <code>P</code> $(x,y,z)$ on this line, satisfy:</p>
<pre><code>x - x_0 = |PP_0| . l 
y - y_0 = |PP_0| . m 
z - z_0 = |PP_0| . n 
</code></pre><p>taking |PP_0| as <code>t</code>, the equation above is the parmeterized line equation, namely:</p>
<pre><code>\frac{x-x0}{l} =  \frac{y-y0}{m} =  \frac{z-z0}{n} 
</code></pre><p>in general, a linear is the cross interface of two linear plane, so its genearl equation is to satisfy both plane equation:</p>
<pre><code>A1.x + B1.y + C1.z + P1 = 0
A2.x + B2.y + C2.z + P2 = 0
</code></pre><h3 id="coordiante-transfer"><a href="#coordiante-transfer" class="headerlink" title="coordiante transfer"></a>coordiante transfer</h3><p>in general, coordiante transfer means <code>base vector</code> linear transfer. assuming original coordinate system [O: e1, e2, e3], and new coordinate system [O’, e1’, e2’, e3’]</p>
<p>both the original base vector <e1, e2,="" e3=""> and new base vector &lt;e1’, e2’, e3’&gt; prop up the same 3D linear space. </e1,></p>
<p>and there should be transfer matrix between them:</p>
<p><strong>e</strong> = matrix[3x3] \cdot <strong>e’</strong></p>
<p>for any point <code>P</code> transfer from original to new coordinate system, </p>
<p>{<strong>x</strong>} = {<strong>a</strong>} + {<strong>x’</strong>} . matrix[3x3]</p>
<p>matrix[3x3] is:</p>
<table>
<thead>
<tr>
<th>a11</th>
<th>a21</th>
<th>a31</th>
</tr>
</thead>
<tbody>
<tr>
<td>a12</td>
<td>a22</td>
<td>a32</td>
</tr>
<tr>
<td>a13</td>
<td>a23</td>
<td>a33</td>
</tr>
</tbody>
</table>
<p>each raw in the matix above, stands for a <code>base vector</code> tranfer from original one to the new one, namely:</p>
<pre><code>$$ e1&apos; = a11.e1 + a21.e2 + a31.e3 $$ 
</code></pre><p>the component value of each coordinate, can be simply by:</p>
<p>x1’ =  <strong>e1’</strong> . <strong>OP’</strong></p>
<h3 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h3><p><a href="http://csrgxtu.github.io/2015/03/20/Writing-Mathematic-Fomulars-in-Markdown/" target="_blank" rel="external">write mathematic fomulars in Markdown</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/14/未来5年在哪里-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/14/未来5年在哪里-10/" itemprop="url">未来5年在哪里 10</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-14T05:11:40-04:00">
                2019-09-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/14/未来5年在哪里-10/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/14/未来5年在哪里-10/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>个人与公司的生存和发展法则。因为企业生存状态以及老板的眼光，国内企业会有一种氛围：老板花钱是让来工作的，来学习都不该提倡。个人而言，学习才能保持议价权。也需要有个良好的心态，面对这样的企业现状。</p>
<p>国内就业大环境也长期不看好。本来优质的大公司和岗位不多，相对缺乏壁垒的，最近的一个新闻： 一汽大众不招传统专业，比如，车辆、机械。不过话说回来，一汽大众的工作在长春也是绝对高薪。不招人背后，是技术岗位都在德国，那国内的年轻人在这样的企业怎么积累？ 当然，即使在这样的企业内，还会分三六九等。年轻人被局限的穷迫程度可想而知，这样缺乏格局的环境，也没办法培养年轻人的领导力。</p>
<p><a href="https://zjli2013.github.io/2019/08/31/未来5年在哪里-9/" target="_blank" rel="external">上一篇</a> 提到北欧国家。国家大环境，确实对年轻人的选择有太大影响。国内年轻人如果能选择行业，确实应该避开传统制造业、农业等低增长周期的企业。当然，互联网、金融、地产、消费服务等快增长周期的行业，算适应国家的大环境，人也不轻松。</p>
<h2 id="国与家"><a href="#国与家" class="headerlink" title="国与家"></a>国与家</h2><p>选择一个国家，就是选择了一套制度。在中秋夜，每有悠闲的时候，心里反而更沉，似乎只有加班工作，可以抵消内心深处的不安。</p>
<p>回来看了很多关于中国发展的报道《中国制造2025》以及生活现状：住在筒子楼里的爱情，缺乏社会秩序和行业规则的生活和工作环境，慢慢溢出。</p>
<p>回国前，对国内的生活的1万种可能，都不包括现实的样子。</p>
<p>小镇青年的生活，完全是另一个折叠。我以为的真实生活到底只是我愿意认知的真实吧了，包括对国与家的态度。有时候觉得，是不是自己跟周围的人太格格不入了，可惜看到《计算机应用》学报上的文章，真的很无奈，大部分年轻人在这样的状态下追求的是什么价值？</p>
<h2 id="商业的逻辑"><a href="#商业的逻辑" class="headerlink" title="商业的逻辑"></a>商业的逻辑</h2><p>小城唯一的一家沃尔玛，进去看到商品的丰富，真的是感动了一下。想当年在美国，出入walmart, whole food, wegments, kroger, 虽然也感谢生活的便利舒适和优雅，不过没有这么渴望。</p>
<p>在国内生活，思路也发生了转变。进沃尔玛看到陈列的各式衣服、首饰，第一反应，竟然是如何成为沃尔玛的供货商。这个平台大到足够小富即安，年入百万。这样的思路，放在美国生活的时候，估计有点丧心病狂。</p>
<p>也可能国内的环境慢慢教人认识到：商人和企业家是不同的吧。</p>
<p>记得之前评价恒大造车，说他是对行业的玷污，那不过是把恒大想成了汽车行业的企业家，需要对这一行有超出商业范畴的责任。不过人家本质上是一名商人。</p>
<p>读《中国制造2025》另外一个感受，就是制造业升华的制约，已经不在制造业本身，而是体制。企业家、商人做了他们该做的，甚至在中国这样行业秩序、商业秩序、社会秩序相对匮乏的条件下，他们已经做了足够多了。</p>
<p>记得有位中国vp评价说，相比中国的投资人，哪有外国的投资团队的活路。大概就是想表达，中国各行各业的生存之多艰，相对好的制度下的培育的行业团队，中国行业是颇有杀伤力的。</p>
<p>当然，这样的杀伤力更是“劣币驱逐良币”。长久看是恶化商业环境，既不是鼓励了资源优化、也不是鼓励创新、更不是鼓励更人性的生存环境。所以这样的“强势”，真叫人哭笑不得。也大约是全世界都逐渐清醒地抵制中国发展模式的根因。</p>
<p>商人与企业家的不同，更突出的体现在mindset不同。于我，可能默认自己对行业还有一些初心，不是唯利是图的。所以，愿意了解的都是行业内技术、管理实践等等。当我在拼命地理解和转化自动驾驶新技术和趋势，对国外成熟管理模式的移植，当然也很力不从心。开淘宝店，开咖啡馆的朋友，根本没有这样的mindset。服务行业不是没有科学管理和技巧可言，只是偏技术迭代的mindset偏离了服务的本质。</p>
<p>然鹅，在基础科学研究和应用科学转化上的各种弊病，以及反应在知名企业可供选择的求职口上的差距，实际上让国内想成长为企业家的年轻人，或安心当工程师的年轻人，是非常吃亏的。即便比美国年轻人更努力，也不会比他们生活的更舒适和自信。在这样的实体环境下，谈技术积累，应用转化，企业家精神，就像明知无望，还让人上的理想主义。可是现在的年轻人，才不会为了“爱国“二字义无反顾，国家欠着我等年轻人多了，收割我等韭菜，还要我等为着看不到的未来埋单。</p>
<p>相比实业，在国内，服务业的发展，至少不会明显存在差距。因为人总是要吃喝拉撒被服务的，虽然服务质量、体验、管理等，不如发达经济体，但是服务业没准备国际化：开饭店的、洗衣房的、健身房的等等，没准备打入国际市场，总之还可以混个体面生活。</p>
<p>国家抱怨国内的小老板，小企业家，小富即安，不思进取，不能担当“百年老店”。说实话，心里都明白：有制度保障，企业家大富吗，保障企业百年长青吗？与其显山露水，被制度卡脖子，大家都不愿做被拍死的出头鸟。也大概是万一做大了，就赶紧换国籍的原因。</p>
<p>我不再抱怨企业家、商人和个体，什么样的社会体制孕育企业和个人。说国内企业无奸不商，老百姓缺乏仁心仁德，只是国家的问题。在对国内实业无望之后，大量实业人才流入金融证券等服务业，大量企业家沦为商人，投机买地，也是无奈之举。不知道还有没有明天，今天就做一回人吧。谁不爱惜一次的生命呢。</p>
<p>两个人都挣50万，在学校承包食堂的经理a和在大公司上班的工程师b，显然是不同的。</p>
<p><code>国内混久了，初心早就喂狗了。活着，才是中国人的最高哲学。</code></p>
<p>ps, 不吐槽，不快乐。you just can’t change your role in life, even you don’t like it sometimes, so enjoy it happy or unhappy.</p>
<h3 id="个人技能进阶"><a href="#个人技能进阶" class="headerlink" title="个人技能进阶"></a>个人技能进阶</h3><p>带团队，会有一个时间段特别兴奋，感觉每天都有很多进步；也有一个时间段，非常阻塞，看不清下一步。又在一个阻塞期，想到了底层实力。</p>
<h4 id="底层实力"><a href="#底层实力" class="headerlink" title="底层实力"></a>底层实力</h4><p>做技术/工程应用，前期缺乏很高明的应用框架设计，大部分时候就是解决具体的问题。手段如何都不重要。大概是<code>测试驱动</code>的开发，不断调试，试错，直到找到一个通畅的解决。下次再碰到新问题，继续试错调整。这样的工作模式，也许不算agile。</p>
<p>目前阶段开发的几个层次：</p>
<ul>
<li>熟悉项目，写简单的逻辑</li>
<li>使用成熟的库/框架（网络，前端，分布式）</li>
<li>掌握新编程思想(协程、异步、容器、微服务）</li>
</ul>
<p>与此同时，对开发工具，生产环境(git, Docker)，应用场景的拓展逐渐成型。</p>
<h4 id="产品导向"><a href="#产品导向" class="headerlink" title="产品导向"></a>产品导向</h4><p>缺乏底层实力，会容易被卡住。或者说缺乏产品导向，走着走着，不知道下一步在哪儿了。产品导向，需要一个人多任务，多人协调能力。</p>
<h3 id="初创公司生存"><a href="#初创公司生存" class="headerlink" title="初创公司生存"></a>初创公司生存</h3><h4 id="技术突破"><a href="#技术突破" class="headerlink" title="技术突破"></a>技术突破</h4><p>做ai等技术场景的初创公司，花大量的资源和人力，研究和实现新算法，提高算法的识别率，精度等。</p>
<h4 id="产品入口"><a href="#产品入口" class="headerlink" title="产品入口"></a>产品入口</h4><p>相反，传统行业的创业，并没有领先技术和雄厚资本，总是从最不起眼的组装产品开始的。</p>
<h4 id="资本壁垒"><a href="#资本壁垒" class="headerlink" title="资本壁垒"></a>资本壁垒</h4><p>一些规模效应的创业团队，投资人大量投入资本拼杀。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/11/npc-wp-planner-in-ADS-simulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/11/npc-wp-planner-in-ADS-simulation/" itemprop="url">npc wp planner in ADS simulation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-11T09:52:39-04:00">
                2019-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/11/npc-wp-planner-in-ADS-simulation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/11/npc-wp-planner-in-ADS-simulation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>a ADS simulation platform should have the three components:</p>
<ul>
<li><code>vehicle dynamics model</code></li>
</ul>
<p>for game engine(e.g. unReal, Unity3D) based ADS simulation platform, there has simple game-level vehicel dynamics(VD), and in engineering side, there are more precise VD, such as <code>Carsim</code>, <code>CarMaker</code>, and a few smaller ones.</p>
<ul>
<li><code>sensor models</code> </li>
</ul>
<p>currently camera and Lidar model are pretty good, for mm Radar, which has a frequency around 24G hz or 77G hz, which is far more beyond the digital computer can sample, so to simulate Radar(or Radar model) is not that practicalable.</p>
<p>as can find in famous simulator, e.g. lg-sim and Carla, they are puting a lot efforts in sensor models, which should be more useful in future.</p>
<p>another good way of sensor model simulation, is to test and verify the vendor’s sensors. most time, the performance test from vendors are not fit well. and as the physical model of the sensors is not visible, to simualate as a black box is useful then.</p>
<ul>
<li><code>scenario describe</code></li>
</ul>
<p><code>PEGSUS</code> project used <code>OpenScenario</code> xml language; in other case, the scenario can be described directly in Python. </p>
<p>basically what need to define during scenario descibtion, includes:</p>
<ul>
<li>scenario static env </li>
<li>scenario npc actors movement</li>
</ul>
<p>in more advanced solutions, the process of builing virtual envs directly start from dronze/cars images or cloud point images.</p>
<p>what’s in this post is one part of npc movement control: lane change.</p>
<h2 id="lane-change-done-event"><a href="#lane-change-done-event" class="headerlink" title="lane_change_done event"></a>lane_change_done event</h2><p>at default lg-sim, there is a <code>lane-change</code> event, which describes when lane change happens; for a more precise npc control, here adds a <code>lane-chagne-done</code> event, basically to describe when the lane change is done. </p>
<p>similar to <code>lane-change</code> event, here defines the <code>lane-change-done</code> event in both server and client side. </p>
<h2 id="Unity-transform-position-vs-local-position"><a href="#Unity-transform-position-vs-local-position" class="headerlink" title="Unity.transform.position  vs  local position"></a>Unity.transform.position  vs  local position</h2><p>here is the math part. Unity has plenty APIs to handle these, which is good to study in.</p>
<ul>
<li><p>dot product </p>
<pre><code>Vector3.Dot()
</code></pre></li>
<li><p>cross product </p>
</li>
<li><p>p2p distance</p>
<pre><code>Vector3.Distance()
</code></pre></li>
<li><p>interpolate</p>
<pre><code>Mathf.Lerp()
</code></pre></li>
<li><p>world 2 local transfer</p>
<pre><code>Transform.InverseFromPoint(position)
</code></pre></li>
<li><p>camera matrix </p>
</li>
<li><p>equations of lines    </p>
</li>
</ul>
<h2 id="waypoints-described-lane"><a href="#waypoints-described-lane" class="headerlink" title="waypoints described lane"></a>waypoints described lane</h2><p>NPC agents are drived by waypoints embedded in the virtual roads, in lg-sim, waypoints is inside <code>LaneSegmentBuilder</code>. but in general the waypoints are not ideal:</p>
<ul>
<li>their distance is not unique</li>
<li>their index in neighboring lanes doesn’t keep consistent</li>
<li>they don’t care of curves of real roads</li>
</ul>
<p>for waypoints based planner, rather AI-based planner, e.g. lane-change planner, the processes are as following: </p>
<ul>
<li>get currentTarget in target(current) lane</li>
</ul>
<p>which is usually not pointed by the same currentIndex as the previous lane, so need to figure out the closeset wp from the waypoint list in current lane, and this closest wp should be in front of NPC (no consider NPC retrograde).</p>
<ul>
<li>keep currentTarget update </li>
</ul>
<p>during NPC (lane-change) operation, there is case when the <code>currentTarget</code> is behind NPC position, if it’s not expected, it’s always a error planner, leading NPC header turn over. so need to check currentTarget is always in front of NPC, if not, update currentTarget to next wp. </p>
<p>1) driving direction vs currentTarget2NPCposition</p>
<p>driving direction in global <code>dot product</code> currentTarget2NPCposition should greater than zero, if not, update currentTarget </p>
<p>2) NPC in currentTarget local position</p>
<p>NPC local position should always in negative axis, if not, update currentTarget. the trick here, can’t use currentTarget in nPC local position, as when NPC is head of currentTarget, NPC will be pointed in reverse, which makes the local coordinate reverse as well. but  currentTarget is the fixed wp always.</p>
<ul>
<li>lane-change-done criteria</li>
</ul>
<p>ideally when the whole NPC occupied in the target lane, that’s when the lane-change operation done. but that’s never the reality. as then, if there is the next next lane, the NPC is partly in the next next lane, so can’t keep lane change in only one neighboring lane.</p>
<p>but in reality, highway or express way, the vehicle can’t across two lane in one time. so to keep lane-change-done and done in just the next lane, the criteria is when the NPC position in Z or X direction projection to currentTarget X or Z direction projection is more than half of the lane width:</p>
<pre><code>Mathf.Abs(frontCenter.position.z - currentTarget.z) &lt; laneWidth/2.0
</code></pre><p>usually in game engine, NPC can be controlled by AI, will discuss later.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">136</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
