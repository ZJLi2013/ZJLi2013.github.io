<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/how-broad-first-search-works/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/how-broad-first-search-works/" itemprop="url">how broad first search works</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T23:35:58-04:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/how-broad-first-search-works/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/how-broad-first-search-works/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetCode 45 (jump game): Given an array of non-negative integers, you are initially positioned at the first index of the array.Each element in the array represents your maximum jump length at that position.Your goal is to reach the last index in the minimum number of jumps.</p>
<p> e.g. [2, 3, 1, 1, 4] –&gt; 2 </p>
<p>solution: at current position, bfs all the next positions it can jump to, when the back element is in next position list, then reached.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sol</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums )</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator  it, cur_it ;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; *adj = <span class="keyword">new</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;[nums.size()]; 	</div><div class="line">	<span class="keyword">int</span> cur_node ; </div><div class="line">	<span class="keyword">for</span>(it=nums.begin(); it &lt; nums.end();  it++)</div><div class="line">	&#123;</div><div class="line">		cur_node = *it; </div><div class="line">		adj[cur_node].push_back(cur_node); </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=cur_node; i++)</div><div class="line">		&#123;</div><div class="line">			cur_it =  <span class="built_in">std</span>::next(it, i);</div><div class="line">			adj[cur_node].push_back(*cur_it); </div><div class="line">			<span class="keyword">if</span>( *cur_it == nums.back())&#123;</div><div class="line">				it = nums.end();  <span class="comment">//reach the last element, so return </span></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp; </div><div class="line">	<span class="keyword">int</span> last_element = nums.back(); </div><div class="line">	<span class="keyword">int</span> mini_path = <span class="number">1</span>; </div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; nums.size(); i++)</div><div class="line">	&#123;</div><div class="line">		tmp = adj[i]; </div><div class="line">		<span class="keyword">if</span>(!tmp.empty())</div><div class="line">		&#123; </div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;tmp.size(); j++)</div><div class="line">			&#123;</div><div class="line">				<span class="built_in">cout</span>&lt;&lt; tmp[j] &lt;&lt; <span class="string">' '</span> ;</div><div class="line">			&#125;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>; </div><div class="line">			<span class="keyword">if</span>(tmp.back() == last_element)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">return</span> mini_path; </div><div class="line">			&#125;</div><div class="line">			mini_path++; </div><div class="line">		&#125;</div><div class="line">	&#125;	</div><div class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/how-recursive-works/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/how-recursive-works/" itemprop="url">how recursive works</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T23:31:12-04:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/how-recursive-works/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/how-recursive-works/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetCode 46 Permutations: given a collection of distinct integers, return all possible permutations.</p>
<pre><code>Input: [1, 2, 3]

Output:
[ [1,2,3], [1,3,2], [2, 1, 3], [2, 3, 1], [3, 1,2], 
[3,2,1] ] 
</code></pre><p>At first glipmse, it’s middle difficult, jump to recursive implementation. But there always confused failures, e.g. passing vector as reference to the recursive calls, and even do a deep copy of that vector, the base vector is always modified by the copied vector. This problem blocks me a whole day, actually I don’t know how to make a recursive calls work.</p>
<p>tip1) each recursive fun has its independent local variables ;</p>
<p>tip2) recursive calls are serialized, namely only when inside recursive fun is done, then the outside recursive will continue.</p>
<p>tip1 helps to explain when local variables changed unexpected; tip2 helps cause I trend to think all recursive calls are parallezed running, but the real running order is serialized, so no twist.</p>
<p>simulate how human brain solve this problem:</p>
<pre><code>&lt;1(fix), 2(fix), 3&gt; ;  &lt;1(fix), 3(fix), 2&gt; …
</code></pre><p>the first position has n potentional values, then the second position has (n-1) potentional values, etc. so design the very first implementation as:  traverse all potentional values in first position, and push it; then travers all potentional values in next position, and push it; till the last position, while only one element left, and push it. so a new combination is created. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; sol1(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; idx_vector ;</div><div class="line">		</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; nums.size(); i++) </div><div class="line">	&#123;</div><div class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp ;</div><div class="line">		tmp.push_back(nums[i]);  <span class="comment">//the first element in new created vector </span></div><div class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums1 =  nums ;</div><div class="line">		nums1.erase(nums1.begin()+i);  <span class="comment">//the second element in new created vector  </span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt; nums1.size(); j++)</div><div class="line">		&#123;</div><div class="line">			tmp.push_back(nums1[j]);</div><div class="line">			<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums2 = nums1; </div><div class="line">			nums2.erase(nums2.begin() + j);</div><div class="line">			<span class="keyword">if</span>(nums2.size() == <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">					tmp.push_back(nums2[<span class="number">0</span>]);</div><div class="line">					idx_vector.push_back(tmp); 	</div><div class="line">					tmp.pop_back();</div><div class="line">			&#125;</div><div class="line">		tmp.pop_back(); </div><div class="line">		&#125;	</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> idx_vector; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>the first implmenation only works for fixed input <1, 3="" 2,="">, so how to design a recursive fun to make this idea more general ? it’s easy to abstract the process above: for ith position in the new combination vector, the potentional values is one less from (i-1)th position, traverse all possible values in ith position and push it, don’t forget pop it out for traversing to the next possible value; and the end of recursive is when only one element left.</1,></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sol</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; tmp, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; idx_vector )</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(nums.size() == <span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		tmp.push_back(nums[<span class="number">0</span>]);</div><div class="line">		idx_vector.push_back(tmp);</div><div class="line">		tmp.pop_back();</div><div class="line">		<span class="keyword">return</span> ;</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; nums.size(); i++)</div><div class="line">	&#123;</div><div class="line">		tmp.push_back(nums[i]);</div><div class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums2 = nums; </div><div class="line">		nums2.erase(nums2.begin()+i);</div><div class="line">		sol(nums2, tmp, idx_vector);</div><div class="line">		tmp.pop_back();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>test:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;; 	</div><div class="line">	<span class="keyword">int</span> size =  nums.size(); </div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp ;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; outs;</div><div class="line">	sol(nums, tmp, outs);</div><div class="line">	</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it ;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; size*(size<span class="number">-1</span>); i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">for</span>(it = outs[i].begin();  it != outs[i].end(); it++)</div><div class="line">			<span class="built_in">cout</span>&lt;&lt; *it &lt;&lt; <span class="string">' '</span> ; </div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"\n"</span> &lt;&lt; <span class="built_in">endl</span> ;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/10/MIT-s094/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/10/MIT-s094/" itemprop="url">MIT 6.S094 Deep Learning for Self Driving Cars</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-10T16:45:19-04:00">
                2018-08-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/10/MIT-s094/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/10/MIT-s094/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Deep-Reinforcement-Learning-link"><a href="#1-Deep-Reinforcement-Learning-link" class="headerlink" title="1 Deep Reinforcement Learning link"></a>1 Deep Reinforcement Learning <a href="https://www.dropbox.com/s/2z7276330jaw37k/lecture2.pdf?dl=1" target="_blank" rel="external">link</a></h2><pre><code>apps:  motion planning 
</code></pre><h2 id="2-Convolutional-Neural-Networks-link"><a href="#2-Convolutional-Neural-Networks-link" class="headerlink" title="2 Convolutional Neural Networks link"></a>2 Convolutional Neural Networks <a href="https://www.dropbox.com/s/q34bi7t0udms01x/lecture3.pdf?dl=1" target="_blank" rel="external">link</a></h2><pre><code>apps: End-2-end driving task(pedestrian detect)
</code></pre><h2 id="3-Recurrent-Neural-Networks-link"><a href="#3-Recurrent-Neural-Networks-link" class="headerlink" title="3 Recurrent Neural Networks link"></a>3 Recurrent Neural Networks <a href="https://goo.gl/qG4Ys9" target="_blank" rel="external">link</a></h2><pre><code>apps: steering control through time
</code></pre><h3 id="CNN-Project-DeepTesla"><a href="#CNN-Project-DeepTesla" class="headerlink" title="CNN Project: DeepTesla"></a>CNN Project: <a href="http://selfdrivingcars.mit.edu/deeptesla/" target="_blank" rel="external">DeepTesla</a></h3><h3 id="DRL-Project-DeepTraffic"><a href="#DRL-Project-DeepTraffic" class="headerlink" title="DRL Project: DeepTraffic"></a>DRL Project: <a href="http://selfdrivingcars.mit.edu/deeptraffic/" target="_blank" rel="external">DeepTraffic</a></h3><h3 id="Framework-ConvNetJS"><a href="#Framework-ConvNetJS" class="headerlink" title="Framework:  ConvNetJS"></a>Framework:  <a href="https://github.com/karpathy/convnetjs" target="_blank" rel="external">ConvNetJS</a></h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/10/C-template-and-STL-containers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/10/C-template-and-STL-containers/" itemprop="url">C++ template and STL containers</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-10T16:36:52-04:00">
                2018-08-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/10/C-template-and-STL-containers/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/10/C-template-and-STL-containers/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I used C++ couple years already, but never take a close look at it. when looking back to few C++ demo works at school, I had a strong feeling at that time, to make the code running is my only goal, how it work or how to improve it, is always ignored, I am afraid in the language details, as the wisdom say: the evil is in details.</p>
<p>after working for three years, I feel the necessary and urgent to back to the language itself(e.g. Linux, C/C++) as the first step to move forward in application development. Frameworks, engineering-based APIs are more close to final products, making them easy to be attracted, compared to how the details implemented. like the mechanical undergradute students, who first-time run ABAQUS with beatiful visulized results, feels so good. </p>
<p>anyway I have to delay the short satification or self-feeling-good. C is clean and the applications have clear structure, C++ is more metaphysics, I even don’t know where to start. even I thought I knew C++ well, but actualy there are many details behind, e.g. allocator in STL.</p>
<h2 id="template"><a href="#template" class="headerlink" title="template"></a>template</h2><p>template is used for generic programming, e.g. both vector<int> and vector<user-define-object> smell same at compiler time. Template reels off or abstract the common part “vector” as a container, and whatever type is ok to store in.  </user-define-object></int></p>
<h3 id="function-template"><a href="#function-template" class="headerlink" title="function template"></a>function template</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></div><div class="line">	<span class="title">void</span> <span class="title">func</span>(<span class="title">T</span> <span class="title">arg</span>)</div><div class="line"></div><div class="line"><span class="title">template</span> &lt;typename T&gt;</div><div class="line">	<span class="title">void</span> <span class="title">func</span>(<span class="title">T</span> <span class="title">arg</span>)</div><div class="line"></div><div class="line"><span class="title">template</span> &lt;class T&gt;</div><div class="line">	<span class="title">T</span> <span class="title">add</span>(<span class="title">T</span> <span class="title">n1</span>, <span class="title">int</span> <span class="title">v</span>)&#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>, <span class="title">class</span> <span class="title">T2</span>, <span class="title">class</span> <span class="title">T3</span>&gt;</span></div><div class="line">	<span class="title">T3</span> <span class="title">func</span>(<span class="title">T1</span> <span class="title">a1</span>, <span class="title">T2</span> <span class="title">a2</span>, <span class="title">int</span> <span class="title">arg3</span>=3)&#123;&#125;;</div></pre></td></tr></table></figure>
<p>the actual meaning of TYPE is deduced by compiler depending on the arg passed to this function.  “class” or “typename” is similar.</p>
<p>template supports default parameters, once the i-th argument is set with default value, all arguments after it must using default values.</p>
<h3 id="class-template"><a href="#class-template" class="headerlink" title="class template"></a>class template</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>, <span class="title">class</span> _<span class="title">Ref</span>, <span class="title">class</span> _<span class="title">Ptr</span>&gt;</span></div><div class="line"><span class="title">class</span> _<span class="title">list_iterator</span> &#123;</div><div class="line">	<span class="keyword">typedef</span> _List_iterator&lt;_Tp, _Tp&amp;, _Tp*&gt;  iterator ;</div><div class="line">	<span class="keyword">typedef</span> _List_iterator&lt;_Tp, <span class="keyword">const</span> _Tp&amp;, <span class="keyword">const</span> _Tp*&gt;  const_iterator ;</div><div class="line">	<span class="keyword">typedef</span> _List_iterator&lt;_Tp, _Ref, _Ptr&gt;  _Self ;</div><div class="line"></div><div class="line">	<span class="keyword">typedef</span> _Tp value_type ;</div><div class="line">	<span class="keyword">typedef</span> _Ptr  pointer;</div><div class="line">	<span class="keyword">typedef</span> _Ref  reference ;</div><div class="line">	<span class="keyword">typedef</span> _List_node&lt;_Tp&gt;  _Node; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>feel the power of template in STL source code. </p>
<h2 id="STL-containers"><a href="#STL-containers" class="headerlink" title="STL containers"></a>STL containers</h2><p>references:<br>&lt;&lt; the annotated STL source using SGI STL &gt;&gt; by jjHou<br><a href="https://rawgit.com/google/cxx-std-draft/allocator-paper/allocator_user_guide.html" target="_blank" rel="external">a visitor guide to C++ allocator</a><br><a href="https://www.kancloud.cn/digest/stl-sources/177262" target="_blank" rel="external">the annotated STL source</a><br>I took several days to start, cause the first section on allocator already blocked me.</p>
<h3 id="why-allocator"><a href="#why-allocator" class="headerlink" title="why allocator ?"></a>why allocator ?</h3><p>The logic of a dynamic container doesn’t depend on the specifies of how memory is obtained; namely, the design of container classes should be decoupled from the memory allocation policy. </p>
<h3 id="how-allocator-works"><a href="#how-allocator-works" class="headerlink" title="how allocator works ?"></a>how allocator works ?</h3><p>memory allocation and object construction is separated, allocator has four operations: allocate(), deallocate(), construct(), destroy(). there are std interface to allocators</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">AllocTraits = <span class="built_in">std</span>::allocator_traits&lt;alloc&gt; </div><div class="line"><span class="comment">// define an allocator of type "alloc" </span></div><div class="line">AllocTraits::pointer  p = AllocTraits::allocate(a, n)  </div><div class="line"><span class="comment">//get memory space for n objects of type T, but not construct yet </span></div><div class="line">AllocTraits::construct(a, trueaddress(ptr), x, y, z) ;    <span class="comment">//construct a T(x, y, z)</span></div><div class="line">AllocTraits::destroy(a, trueaddress(ptr));  <span class="comment">// ~T()</span></div><div class="line">AllocTraits::deallocate(a, ptr, <span class="number">1</span>) ;   <span class="comment">// deallocate the space for one T object</span></div></pre></td></tr></table></figure>
<p>WHEN we say A is an allocator for T , where T is a type e.g. AllocatTraits::value_type. we mean, A knows how to obtain and release memory to store objects of type T. <a href="https://github.com/cacay/MemoryPool/blob/master/C-11/" target="_blank" rel="external">git:allocator</a></p>
<h3 id="iterator"><a href="#iterator" class="headerlink" title="iterator"></a>iterator</h3><p>iterator is used to build algorithms in containers. while I don’t really get the traits </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Iterator</span>&gt;</span></div><div class="line"><span class="title">struct</span> <span class="title">iterator_traits</span> &#123;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::iterator_category  iterator_category ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::value_type	 value_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::difference_type  difference_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::pointer	pointer;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::reference reference ;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></div><div class="line"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;_Tp*&gt; &#123;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> random_access_iterator_tag  iterator_category ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Tp	 value_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="keyword">ptrdiff_t</span>  difference_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Tp*	pointer;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Tp&amp; eference ;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><p>std::vector is dynamic, continous.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">template &lt;class _Tp,  class _Alloc = __STL_DEFAULT_ALLOCATOR(_Tp)&gt;</div><div class="line">class vector:: protected _Vector_base&lt;_Tp,  _Alloc&gt;</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef  _Tp value_type ;</div><div class="line">		typedef  value_type*  pointer ;</div><div class="line">		typedef  const value_type*  const_pointer ;</div><div class="line">		typedef value_type* iterator ;</div><div class="line">		typedef const value_type*  const_iterator ;</div><div class="line"></div><div class="line">		iterator begin() &#123;return _M_start;&#125;;</div><div class="line">		iterator end() &#123;return _M_finish ;&#125;;</div><div class="line"></div><div class="line">	protected:</div><div class="line">		_Tp* _M_start ; // the starting point of current used space </div><div class="line">		_Tp* _M_finish; // the ending point of current sued space </div><div class="line">	      _Tp*  _M_end_of_storage; // the end of total avialable space(capacity)</div><div class="line"></div><div class="line">	public:</div><div class="line">		explicit vector(const allocator_type&amp; __a = allocator_type())</div><div class="line">			: _Base(__a)&#123;&#125;  //default constructor </div><div class="line"></div><div class="line">		// construt of n elements of initial-value </div><div class="line">		vector(size_type __n, const _Tp&amp; __value, const allocator_type&amp; __a = allocator_type())</div><div class="line">			: _Base(__n, __a)</div><div class="line">		&#123;</div><div class="line">			_M_finish = uninitialized_fill_n(_M_start, __n, __value);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//copy construtor</div><div class="line">		vector(const vector&lt;_Tp, _Alloc&gt;&amp; __x)</div><div class="line">			:_Base(__x.size(),  __x.get_allocator())</div><div class="line">		&#123;</div><div class="line">			_M_finish = uninitialized_copy(__x.begin(),  __x.end(), _M_start);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		size_type  size() const &#123;return size_type(end() - begin());&#125;</div><div class="line">		size_type capacity() const &#123;return size_type(_M_end_of_storage - begin()); </div><div class="line">		bool empty() const&#123;return begin() == end();&#125;</div><div class="line">		reference operator[](size_type __n)&#123;return *(begin() + __n);&#125;</div><div class="line">		void reserve(size_type __n)&#123;</div><div class="line">			if (capacity() &lt; __n)</div><div class="line">			&#123;</div><div class="line">				const size_type __old_size = size(); </div><div class="line">				iterator __tmp = _M_allocate_and_copy(__n, _M_start, _M_finish);</div><div class="line">				destroy(_M_start, _M_finish);</div><div class="line">				_M_deallocate(_M_start, _M_end_of_storage-_M_start); </div><div class="line"></div><div class="line">				_M_start = __tmp;</div><div class="line">				_M_finish = __tmp + __old_size ;</div><div class="line">				_M_end_of_storage = _M_start + __n ;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void push_back(const _Tp&amp; __x)</div><div class="line">		&#123;</div><div class="line">			if(_M_finish != _M_end_of_storage)</div><div class="line">			&#123;</div><div class="line">				construct(_M_finish, __x);</div><div class="line">				++_M_finish;</div><div class="line">			&#125;else</div><div class="line">				_M_insert_aux(end(), __x);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		template&lt;class _Tp,  class _Alloc&gt;</div><div class="line">		inline bool operator==(const vector&lt;_Tp, _Alloc&gt;&amp; __x, const vector&lt;_Tp, _Alloc&gt;&amp; __y)</div><div class="line">		&#123;</div><div class="line">			return __x.size() == __y.size() &amp;&amp; </div><div class="line">			equal(__x.begin(), __x.end(), __y.begin());</div><div class="line">		&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>std::list is cycling double-direction link list.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">struct _List_node_base </div><div class="line">&#123;</div><div class="line">	_List_node_base * _M_next ;</div><div class="line">	_List_node_base * _M_prev ;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template &lt;class _Tp&gt;</div><div class="line">struct _List_node : public _List_node_base </div><div class="line">&#123;</div><div class="line">	_Tp _M_data;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">struct _List_iterator_base </div><div class="line">&#123;</div><div class="line">	typedef size_t   size_type ;</div><div class="line">	typedef ptrdiff_t   difference_type ;</div><div class="line">	typedef bidirectional_iterator_tag  iterator_category; </div><div class="line"></div><div class="line">	_List_node_base*  _M_node ;</div><div class="line"></div><div class="line">	//constructor </div><div class="line">	_List_iterator_base(_List_node_base* __x) : _M_node(__x)&#123;&#125;</div><div class="line">	_List_iterator_base()&#123;&#125;;</div><div class="line"></div><div class="line">	void _M_incr() &#123; _M_node = _M_node-&gt;_M_next; &#125;;</div><div class="line">	void _M_decr() &#123; _M_node = _M_node-&gt;_M_prev; &#125;;</div><div class="line">	bool operator==(const _List_iterator_base&amp; __x) const</div><div class="line">	&#123;</div><div class="line">		return _M_node == __x.M_node ;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template&lt;class _Tp,  class _Ref,  class _Ptr&gt;</div><div class="line">struct _List_iterator : public _List_iterator_base </div><div class="line">&#123;</div><div class="line">	typedef _List_iterator&lt;_Tp, _Tp&amp;, _Tp*&gt;  iterator ;</div><div class="line">	typedef _List_iterator&lt;_Tp, const _Tp&amp;, const _Tp*&gt;  const_iterator ;</div><div class="line">	typedef _List_iterator&lt;_Tp, _Ref, _Ptr&gt;  _Self ;</div><div class="line"></div><div class="line">	typedef _Tp value_type ;</div><div class="line">	typedef _Ptr  pointer;</div><div class="line">	typedef _Ref  reference ;</div><div class="line">	typedef _List_node&lt;_Tp&gt;  _Node; </div><div class="line"></div><div class="line">	//constructor </div><div class="line">	_List_iterator(_Node* __x): _List_iterator_base(__x)&#123;&#125;</div><div class="line">	_List_iterator()&#123;&#125;</div><div class="line"></div><div class="line">	reference operator*() const &#123;return ( (_Node*) _M_node)-&gt;_M_data; &#125;</div><div class="line"></div><div class="line">	_Self&amp;  operator++()</div><div class="line">	&#123;</div><div class="line">		this-&gt;_M_incr();</div><div class="line">		return *this;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template &lt;class _Tp,  class _Alloc=_STL_DEFAULT_ALLOCATOR(_Tp)&gt;</div><div class="line">class list : protected _List_base&lt;_Tp, _Alloc&gt;</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef _List_node&lt;_Tp&gt; _Node;</div><div class="line">	protected:</div><div class="line">		_List_node&lt;_Tp&gt; * _M_node; </div><div class="line">	public:</div><div class="line">		list(size_type __n,   const _Tp&amp;  __value,</div><div class="line">			const allocator_type&amp; __a = allocator_type())</div><div class="line">			: Base_(__a)</div><div class="line">		&#123;</div><div class="line">			insert(begin(), __n, __value);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		explicit list(size_type __n)</div><div class="line">			:_Base(allocator_type())</div><div class="line">		&#123;</div><div class="line">			insert(begin(), __n, _Tp());</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	protected:</div><div class="line">		_Node* _M_create_node(const _Tp&amp; __x)</div><div class="line">		&#123;</div><div class="line">			_Node* __p = _M_get_node(); </div><div class="line">			__STL_TRY</div><div class="line">			&#123;</div><div class="line">				_Construct(&amp;_p-&gt;_M_data, __x);</div><div class="line">			&#125;</div><div class="line">			return __p;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	public:</div><div class="line">		iterator begin() &#123; return (_Node*)(_M_node-&gt;_M_next);&#125;</div><div class="line">		iterator end() &#123; return _M_node; &#125;</div><div class="line">		bool empty() const &#123;return _M_node-&gt;_M_next == _M_node ;&#125; </div><div class="line">		size_type size() const &#123;</div><div class="line">			size_type  __result = 0;</div><div class="line">			distance( begin(),  end(), __result);</div><div class="line">			return __result;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		size_type max_size() const &#123;return size_type(-1);&#125;</div><div class="line">		reference front() &#123;return *begin();&#125;</div><div class="line">		reference back() &#123;return *(--end());&#125;</div><div class="line">		void swap(list&lt;_Tp, _Alloc&gt;&amp; __x)</div><div class="line">		&#123;</div><div class="line">			__STD::swap(_M_node, __x._M_node);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		interator insert(iterator __position,  const _Tp&amp; __x)</div><div class="line">		&#123;</div><div class="line">			_Node* __tmp = _M_create_node(__x);</div><div class="line"></div><div class="line">			__tmp-&gt;_M_next = __position._M_node ;</div><div class="line">			__tmp-&gt;_M_prev = __position._M_node-&gt;_M_prev ;</div><div class="line">			</div><div class="line">			__position._M_node-&gt;_M_prev-&gt;_M_next = __tmp;</div><div class="line">			__position._M_node-&gt;_M_prev  = __tmp;</div><div class="line">			</div><div class="line">			return __tmp;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void push_front(const _Tp&amp; __x)&#123;insert(begin(), __x);&#125;</div><div class="line">		void push_back(const _Tp&amp; __x)&#123;insert(end(), __x);&#125;</div><div class="line"></div><div class="line">		iterator erase(iterator __position)</div><div class="line">		&#123;</div><div class="line">			_List_node_base* __next_node = __position._M_node-&gt;_M_next ;</div><div class="line">			_List_node_base* __prev_node = __position._M_node-&gt;_M_prev ;</div><div class="line"></div><div class="line">			_Node* __n = (_Node*) __position._M_node ;</div><div class="line"></div><div class="line">			__prev_node-&gt;next = __next_node ;</div><div class="line">			__next_node-&gt;prev = __prev_node;</div><div class="line">	</div><div class="line">			_Destroy(&amp;__n-&gt;_M_data);</div><div class="line">			_M_put_data(__n);</div><div class="line">			return iterator((_Node*) __next_node);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="dequeue"><a href="#dequeue" class="headerlink" title="dequeue"></a>dequeue</h3><p>std::dequeue can operate elements at both ends, and the memory is multi-sectional, in each memory section is linear continous, with advantage of vector and list.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line">template &lt;class _Tp,  class _Ref,  class _Ptr&gt;</div><div class="line">struct _Deque_iterator &#123;</div><div class="line">	typedef _Deque_iterator&lt;_Tp, _Tp&amp;, _Tp*&gt;   iterator ;</div><div class="line">	typedef _Deque_iterator&lt;_Tp, const _Tp&amp;, const  _Tp*&gt;  const_iterator ;</div><div class="line">	static size_t _S_buffer_size() &#123;return __deque_buf_size(sizeof(_Tp));&#125;</div><div class="line"></div><div class="line">	typedef random_access_iterator_tag  iterator_category;</div><div class="line">	typedef _Tp value_type ;</div><div class="line">	typedef _Ptr  pointer;</div><div class="line">	typedef _Ref reference;</div><div class="line">	typedef size_t  size_type ;</div><div class="line">	typedef ptrdiff_t  difference_type ;</div><div class="line">	typedef _Tp** _Map_pointer ;</div><div class="line"></div><div class="line">	typedef _Deque_iterator _Self; </div><div class="line"></div><div class="line"></div><div class="line">	_Tp* _M_cur ; //current point in cache</div><div class="line">	_Tp* _M_first; //first point in cache</div><div class="line">	_Tp* _M_last; </div><div class="line">	_Map_pointer _M_node ; </div><div class="line">	/* deque support multi-section memory space, in each memory section is linear continous</div><div class="line">	 * Map index is used to point to the memory sections</div><div class="line">	 */</div><div class="line">	</div><div class="line">	_Deque_iterator(_Tp* __x, _Map_pointer __y)</div><div class="line">		:_M_cur(__x), </div><div class="line">		 _M_first(*__y),</div><div class="line">		 _M_last(*__y + _S_buffer_size()), </div><div class="line">		 _M_node(__y)</div><div class="line">	&#123;&#125;</div><div class="line"></div><div class="line">	//default </div><div class="line">	//copy</div><div class="line">	</div><div class="line">	difference_type operator-(const _Self&amp; __x) const</div><div class="line">	&#123;</div><div class="line">		return difference_type(_S_buffer_size()) *  (_M_node - __x.M_node - 1) + </div><div class="line">			(_M_cur - _M_first) + (__x._M_last - __x._M_cur);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_Self&amp; operator++()</div><div class="line">	&#123;</div><div class="line">		++_M_cur ; </div><div class="line">		if(_M_cur == _M_last)&#123;</div><div class="line">			_M_set_node(_M_node + 1);</div><div class="line">			_M_cur = _M_first;</div><div class="line">		&#125;</div><div class="line">		return *this;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_Self&amp; operator--()</div><div class="line">	&#123;</div><div class="line">		if(_M_cur == _M_first)&#123;</div><div class="line">			_M_set_node(_M_node - 1);</div><div class="line">			_M_cur = _M_last;</div><div class="line">		&#125;</div><div class="line">		--_M_cur ;</div><div class="line">		return *this;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">	</div><div class="line">/*  deque has two iterator:</div><div class="line">   start -&gt; the first element in first cache space;  </div><div class="line">   finish -&gt; the last element in last cache space */</div><div class="line"></div><div class="line">template &lt;class _Tp,  class _Alloc&gt;</div><div class="line">class _Deque_base &#123;</div><div class="line">	protected:		</div><div class="line">		_Tp** _M_map ;</div><div class="line">		size_t _M_map_size; </div><div class="line">		iterator _M_start;</div><div class="line">		iterator _M_finish;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template &lt;class _Tp,  class _Alloc = __STL_DEFAULT_ALLOCATOR(_Tp)&gt;</div><div class="line">class deque : protected _Deque_base&lt;_Tp, _Alloc&gt;</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef typename _Base::iterator  iterator ;</div><div class="line">		typedef typename _Base::const_iterator  const_iterator ;</div><div class="line">	protected:</div><div class="line">		using _Base::_M_map ; </div><div class="line">		using _Base::_M_map_size ;</div><div class="line">		using _Base::_M_start ; </div><div class="line">		using _Base::_M_finish ;</div><div class="line"></div><div class="line">	public:</div><div class="line">		explicit deque(const allocator_type&amp; __a = allocator_type())</div><div class="line">			:_Base(__a, 0)</div><div class="line">		&#123;&#125;</div><div class="line"></div><div class="line">		deque(const deque&amp; __x):</div><div class="line">			_Base(__x.get_allocator(), __x.size())</div><div class="line">		&#123;</div><div class="line">			uninitialized_copy(__x.begin(),  __x.end(), _M_start);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		~deque()&#123; destroy(_M_start, _M_finish);&#125;</div><div class="line"></div><div class="line">		void push_back(const value_type&amp; __t)</div><div class="line">		&#123;</div><div class="line">			if(_M_finish._M_cur != _M_finish._M_last - 1)</div><div class="line">			&#123;</div><div class="line">				construct(_M_finish._M_cur, __t);</div><div class="line">				++_M_finish._M_cur ;</div><div class="line">			&#125;else</div><div class="line">				_M_push_back_aux(__t);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void push_front(const value_type&amp;  __t)</div><div class="line">		&#123;</div><div class="line">			if(_M_start._M_cur != _M_start._M_first)</div><div class="line">			&#123;</div><div class="line">				construct(_M_start._M_cur - 1,  __t);</div><div class="line">				--_M_start._M_cur;</div><div class="line">			&#125;else</div><div class="line">				_M_push_front_aux(__t);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void pop_back()</div><div class="line">		&#123;</div><div class="line">			if(_M_finish._M_cur != _M_finish._M_first)</div><div class="line">			&#123;</div><div class="line">				--_M_finish._M_cur;</div><div class="line">				destroy(_M_finish._M_cur);</div><div class="line">			&#125;else</div><div class="line">				_M_pop_back_aux();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void pop_front()</div><div class="line">		&#123;</div><div class="line">			if(_M_start._M_cur != _M_start._M_last -1)</div><div class="line">			&#123;</div><div class="line">				destroy(_M_start._M_cur);</div><div class="line">				++_M_start._M_cur;</div><div class="line">			&#125;else</div><div class="line">				_M_pop_back_aux();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		iterator insert(iterator position, const value_type&amp;  __x)</div><div class="line">		&#123;</div><div class="line">			if(position._M_cur == _M_start._M_cur)</div><div class="line">			&#123;</div><div class="line">				push_front(__x);</div><div class="line">				return _M_start;</div><div class="line">			&#125;else if(position._M_cur == _M_finish._M_cur)</div><div class="line">			&#123;</div><div class="line">				push_back(__x);</div><div class="line">				iterator __tmp = _M_finish;</div><div class="line">				--__tmp;</div><div class="line">				return __tmp;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h3><p>std::stack only operate on the top element (first in last out), can’t iterate the container, the default container for stack is deque. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">temlate &lt;class _Tp, class _Sequence&gt;</div><div class="line">class stack</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef typname _Sequence::value_type  value_type ;</div><div class="line">		typedef typname _Sequence::size_type   size_type ;</div><div class="line">		typedef typname _Sequence	  container_type ;</div><div class="line">		typedef typname _Sequence::reference  reference ;</div><div class="line">		typedef typname _Sequence::const_reference const_reference;</div><div class="line">	protected:</div><div class="line">		_Sequence c;  // the fundmental container:  deque by default</div><div class="line">	public:</div><div class="line">		stack() : c() &#123;&#125;</div><div class="line">		explicit stack(const _Sequence&amp; __s) : c(__s) &#123;&#125;</div><div class="line">		</div><div class="line">		bool empty() const &#123; return c.empty();&#125;</div><div class="line">		size_type size() const &#123;return c.size();&#125;</div><div class="line">		reference top() &#123;return c.back(); &#125;</div><div class="line">		void push(const value_type&amp; __x)&#123; c.push_back(__x);&#125;</div><div class="line">		void pop() &#123; c.pop_back();&#125;</div><div class="line">	</div><div class="line">		template&lt;class _Tp,  class _Seq&gt;</div><div class="line">			bool operator==(const stack&lt;_Tp, _Seq&gt;&amp; __x, const stack&lt;_Tp, _Seq&gt;&amp; __y)</div><div class="line">			&#123;</div><div class="line">				return __x.c == __y.c ;</div><div class="line">			&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h2><p>std::queue supports only pop element from front, and push element into end, the default container is dequeue </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">template &lt;class _Tp, class _Sequence&gt;</div><div class="line">class queue</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef typname _Sequence::value_type  value_type ;</div><div class="line">		typedef typname _Sequence::size_type   size_type ;</div><div class="line">		typedef typname _Sequence	  container_type ;</div><div class="line">		typedef typname _Sequence::reference  reference ;</div><div class="line">		typedef typname _Sequence::const_reference const_reference;</div><div class="line">	protected:</div><div class="line">		_Sequence c;  // the fundmental container:  deque by default</div><div class="line">	public:</div><div class="line">		queue() : c() &#123;&#125;</div><div class="line">		explicit queue(const _Sequence&amp; __s) : c(__s) &#123;&#125;</div><div class="line"></div><div class="line">		bool empty() const &#123; return c.empty();&#125;</div><div class="line">		size_type size() const &#123;return c.size();&#125;</div><div class="line">		reference top() &#123;return c.back(); &#125;</div><div class="line">		void push(const value_type&amp; __x)&#123; c.push_back(__x);&#125;</div><div class="line">		void pop() &#123; c.pop_front();&#125;</div><div class="line">	</div><div class="line">		template&lt;class _Tp,  class _Seq&gt;</div><div class="line">			bool operator==(const queue&lt;_Tp, _Seq&gt;&amp; __x, const queue&lt;_Tp, _Seq&gt;&amp; __y)</div><div class="line">			&#123;</div><div class="line">				return __x.c == __y.c ;</div><div class="line">			&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="priority-queue"><a href="#priority-queue" class="headerlink" title="priority queue"></a>priority queue</h3><p>std::priority_queue is queue with priority.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/02/design-a-threadpool-in-pure-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/02/design-a-threadpool-in-pure-C/" itemprop="url">design a threadpool in pure C</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-02T00:44:08-04:00">
                2018-08-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/02/design-a-threadpool-in-pure-C/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/02/design-a-threadpool-in-pure-C/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>actually this post should be named as “pure C multithreads”, while it’s better to write some real code. <a href="https://github.com/Pithikos/C-Thread-Pool" target="_blank" rel="external">a simple threadpool in pure C</a></p>
<h2 id="exposed-APIs"><a href="#exposed-APIs" class="headerlink" title="exposed APIs"></a>exposed APIs</h2><p>at most simple case, what a threadpool object should do? </p>
<pre><code>thpool_init(num_threads);
thpool_destory(threapool_obj);
thpool_add_work(callback, args); 
// so user define event callback() can be passed in;  
</code></pre><p>threadpool is used to assign jobs (from job list) to a thread. so joblist should be an internal class; and it’s better to package thread, job as separate class too;  to add work, what kind of funcs need for joblist ?  at least, to add new job(from outside) to the joblist.</p>
<h2 id="internal-structures"><a href="#internal-structures" class="headerlink" title="internal structures:"></a>internal structures:</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread</span> &#123;</span></div><div class="line"> 	<span class="keyword">int</span> id;</div><div class="line"> 	<span class="keyword">pthread_t</span> thread;   <span class="comment">//pthread_t is a unsigned long int; it's system assigned</span></div><div class="line"> 	threadpool *thpool;  <span class="comment">//so thread know its domain</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">job</span> &#123;</span></div><div class="line">	(<span class="keyword">void</span>*) func(<span class="keyword">void</span>*); <span class="comment">// each job/task should have a callback func</span></div><div class="line">	(<span class="keyword">void</span>*) func_arg ; <span class="comment">//and func args</span></div><div class="line">	<span class="comment">//since consider joblist as a list, it's helpful to add pointers to neighbors</span></div><div class="line">	job* prev;</div><div class="line">	job* next;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">jobqueue</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> num_jobs;</div><div class="line">    job* front;</div><div class="line">    job* rear;</div><div class="line">    <span class="comment">//some flags to support add new node(job) to the list</span></div><div class="line"></div><div class="line">&#125;    </div><div class="line">   	 </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">threadpool_</span> &#123;</span></div><div class="line">    thread* threads_array;</div><div class="line">    jobqueue job_queue;</div><div class="line">    <span class="comment">// some flags</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="consider-syncronlization"><a href="#consider-syncronlization" class="headerlink" title="consider syncronlization"></a>consider syncronlization</h2><p>will multi threads call add_task() simutaneously? if so, jobqueue should have a mutex object;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">jobqueue</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> num_jobs;</div><div class="line">    job* front;</div><div class="line">    job* rear;</div><div class="line">    <span class="keyword">pthread_mutex_t</span>  jq_mutex;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>during threadpool initialization, will all threads be created simultaneously and immediately? if not, there should be thread status flags (creating, exisiting-but-idle, working, died); and to update these flags need protect by mutex object;    </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">threadpool_</span> &#123;</span></div><div class="line">    thread* threads_array;</div><div class="line">    jobqueue job_queue;</div><div class="line">    <span class="keyword">int</span> num_threads; <span class="comment">//stands for the number of all existing threads</span></div><div class="line">    <span class="keyword">pthread_mutex_t</span> tp_mutex;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>this is an interesting, when design a lib, what’s in my mind. hopefully implement by the end of week.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/31/pure-C-socket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/31/pure-C-socket/" itemprop="url">pure C socket</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-31T19:26:58-04:00">
                2018-07-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/31/pure-C-socket/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/31/pure-C-socket/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>this is a review from <a href="https://www.gnu.org/software/libc/manual/html_node/Sockets.html" target="_blank" rel="external">GNU C lib</a>. socket is a two-way communication channel, both read and write can be performed at either end.  </p>
<h2 id="sys-socket-h"><a href="#sys-socket-h" class="headerlink" title="sys/socket.h"></a>sys/socket.h</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">socket</span><span class="params">(AF_INET, SOCK_STREAM, protocol)</span></span>; </div><div class="line"><span class="comment">/* return fd for this new socket, or -1 as error */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">close</span><span class="params">(<span class="keyword">int</span> socket_fd)</span></span>; </div><div class="line"><span class="comment">/* return 0 when close successfuly, else return -1 */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(<span class="keyword">int</span> socket, struct sockaddr *addr, <span class="keyword">socketlen_t</span> len)</span></span>;</div><div class="line"><span class="comment">/* initiate a connection from (client) socket to (server) address; by default, the connection is blocking untill server respond */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">listen</span><span class="params">(<span class="keyword">int</span> socket, <span class="keyword">int</span> n)</span></span>;</div><div class="line"><span class="comment">/* n specifies the length of queue for pending connections; when the queue fills up, new clients attempting to connect will fail */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">accept</span><span class="params">(<span class="keyword">int</span> socket, struct sockaddr *addr,  <span class="keyword">socketlen_t</span> *len_ptr)</span></span>;</div><div class="line"><span class="comment">/* if successfully, accept return a new socket fd, the original (server) socket remains open and unconnected;  the address and len_ptr are used to return information about the name of client socket that initiated this connection */</span></div><div class="line"></div><div class="line"><span class="keyword">size_t</span> send(<span class="keyword">int</span> socket, <span class="keyword">const</span> <span class="keyword">void</span> *buffer, <span class="keyword">size_t</span> size, <span class="keyword">int</span> flags);</div><div class="line"><span class="comment">/* param socket is the fd of current sending socket. no receiver socket explicitly defined, since connection-oriented(TCP)protocol will connect first prior to send/receive  */</span></div><div class="line"></div><div class="line"><span class="keyword">size_t</span> recv(<span class="keyword">int</span> socket, <span class="keyword">const</span> <span class="keyword">void</span> *buffer,  <span class="keyword">size_t</span> size, <span class="keyword">int</span> flags);</div><div class="line"><span class="comment">/* param socket is the fd of current receiving socket */</span></div><div class="line"></div><div class="line"></div><div class="line">``` </div><div class="line"></div><div class="line"></div><div class="line">#<span class="meta"># network socket </span></div><div class="line"></div><div class="line">I didn't realize GNU C socket I/O is so related to network socket. the missing part when reading muduo, libuv is here. </div><div class="line"></div><div class="line">The server listens the connection requests on the special server socket, then accept each incoming connection. select() blocks/sleeps the program until input is available/ready on the special server socket/fd. </div><div class="line"></div><div class="line">```<span class="function">c</span></div><div class="line"><span class="keyword">void</span> <span class="title">FD_ZERO</span><span class="params">(fd_set *<span class="built_in">set</span>)</span> </div><div class="line"><span class="comment">/* initialized the file descriptor set to empty set */</span></div><div class="line"><span class="keyword">void</span> <span class="title">FD_SET</span><span class="params">(<span class="keyword">int</span> fd, fd_set *<span class="built_in">set</span>)</span> <span class="comment">/* add fd to set */</span></div><div class="line"><span class="keyword">void</span> <span class="title">FD_CLR</span><span class="params">(<span class="keyword">int</span> fd,  fd_set *<span class="built_in">set</span>)</span> <span class="comment">/*remove fd from set */</span></div><div class="line"><span class="keyword">void</span> <span class="title">FD_ISSET</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> fd_set * <span class="built_in">set</span>)</span>  </div><div class="line"><span class="comment">/* return true(non-zero) if fd is in  set; else return 0 */</span></div><div class="line">STDIN_FILENO ; <span class="comment">/*  file descriptor for std input “1” */</span></div></pre></td></tr></table></figure>
<p>how to debug server/client code? <a href="https://github.com/alphadose/Alpha-Chat/blob/master/" target="_blank" rel="external">chatRoom</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/31/pure-C-i-o/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/31/pure-C-i-o/" itemprop="url">pure C I/O</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-31T19:14:28-04:00">
                2018-07-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/31/pure-C-i-o/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/31/pure-C-i-o/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>this is a review from <a href="https://www.gnu.org/software/libc/manual/html_node/I_002fO-Overview.html#I_002fO-Overview" target="_blank" rel="external">GNU C programming</a></p>
<h1 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h1><p>two basic mechanism for representing the connection between your program and the file: streams &amp;  file descriptors.  FD is represented as objects of type int; streams are represented as FILE * objects </p>
<p>a stream is an abstract concept reprensenting a communication channel to a file, a device, or consider it as a sequence of characters with functions to take characters out of one end, and put characters into the other end, like a pipe. </p>
<h1 id="file-position"><a href="#file-position" class="headerlink" title="file position"></a>file position</h1><p>an integer representing the number of bytes from the beginning of the file; each time a character read or written, the file position is incremented, namely, access to a file is sequential.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">int</span> <span class="title">ftell</span><span class="params">(FILE \* stream)</span></span>; <span class="comment">//return file position </span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fseek</span><span class="params">(FILE \*stream, <span class="keyword">long</span> <span class="keyword">int</span> offset, <span class="keyword">int</span> whence)</span></span>;</div><div class="line">/\* whence is SEEK\_SET |  SEEK\_CUR | SEEK\_END \*/</div><div class="line"></div><div class="line">``` </div><div class="line"></div><div class="line">“write to a file” is always appended sequentially to the end of the file, regardless of the file position; but “read from a file” is used the current file position. which means multiple reading can happens simultaneously with an independent file pointer. In fact, each opening creates an independent file position pointer, even in the same program to open a file twice.  </div><div class="line"></div><div class="line">#<span class="meta"># std streams</span></div><div class="line"></div><div class="line">```c</div><div class="line"></div><div class="line">	FILE *<span class="built_in">stdin</span> ;</div><div class="line">	FILE *<span class="built_in">stdout</span>;</div><div class="line">	FILE *<span class="built_in">stderr</span>;</div><div class="line">	<span class="function">FILE *<span class="title">fopen</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *openMode)</span></span>;  </div><div class="line">	<span class="comment">/* create a new stream connected to the file */</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">fclose</span><span class="params">(FILE *stream)</span></span></div><div class="line">	<span class="comment">/* disconnected between the stream and the file, any buffered output is written and any buffered input will discarded */</span></div></pre></td></tr></table></figure>
<h2 id="ASCII-IO"><a href="#ASCII-IO" class="headerlink" title="ASCII IO"></a>ASCII IO</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputs</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s, FILE *stream)</span> </span>;</div><div class="line"><span class="comment">/* write a char array into stream. this call doesn't add a newline or terminal null character */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">char</span> *<span class="title">fgets</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> n, FILE *stream)</span></span>;</div><div class="line"><span class="comment">/* read n number of char array from stream, default add a newline character */</span></div><div class="line"></div><div class="line"><span class="keyword">ssize_t</span> getline(<span class="keyword">char</span> **lineptr, <span class="keyword">size_t</span> *n, FILE *stream);</div><div class="line"><span class="comment">/* read a whole line from stream */</span></div></pre></td></tr></table></figure>
<h2 id="block-IO"><a href="#block-IO" class="headerlink" title="block IO"></a>block IO</h2><p>usually block stands for either block data or text in fixed-size, instead of characters or lines</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">size_t</span> fread(<span class="keyword">void</span> *data, <span class="keyword">size_t</span> size, <span class="keyword">size_t</span> n, FILE *stream);</div><div class="line"><span class="comment">/* read #n block, each block has size from stream, and store in data */</span></div><div class="line"></div><div class="line"><span class="keyword">size_t</span> fwrite(<span class="keyword">const</span> <span class="keyword">void</span> *data, <span class="keyword">size_t</span> size, <span class="keyword">size_t</span> n, FILE *stream);</div><div class="line"><span class="comment">/* write #n block, each block has size from buffer data to stream */</span></div></pre></td></tr></table></figure>
<h2 id="formatted-IO"><a href="#formatted-IO" class="headerlink" title="formatted IO"></a>formatted IO</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">printf</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">template</span>, …)</span></span>;  <span class="comment">//write to std output</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fprintf</span><span class="params">(FILE *stream, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">template</span>, ...)</span></span>; <span class="function">write to stream</span></div><div class="line"><span class="keyword">int</span> <span class="title">sprintf</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">template</span>, ...)</span>; <span class="comment">//write to a string</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">scanf</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">template</span>, …)</span> <span class="comment">//formatted read from stdin</span></span></div><div class="line"><span class="keyword">int</span> <span class="title">fscanf</span><span class="params">(FILE *stream, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">template</span>, …)</span> <span class="comment">// read from stream </span></div><div class="line"><span class="keyword">int</span> <span class="title">sscanf</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">template</span>, …)</span> <span class="comment">// read from a string</span></div></pre></td></tr></table></figure>
<h2 id="EOF"><a href="#EOF" class="headerlink" title="EOF"></a>EOF</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">feof</span><span class="params">(FILE* stream)</span> </span>; </div><div class="line"><span class="comment">/* return nonzero iff end of file indicator is set for stream */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ferror</span><span class="params">(FILE* stream)</span> </span>; </div><div class="line"><span class="comment">/* return nonzero iff error indicator is set for stream */</span></div></pre></td></tr></table></figure>
<h2 id="stream-buffer"><a href="#stream-buffer" class="headerlink" title="stream buffer"></a>stream buffer</h2><p>stream and file is not communicated character-by-character, there is a buffer for I/O.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fflush</span><span class="params">(FILE *stream)</span> </span></div><div class="line"><span class="comment">/* take any buffered output on stream to be delivered to the file */</span></div></pre></td></tr></table></figure>
<h2 id="file-descriptor"><a href="#file-descriptor" class="headerlink" title="file descriptor"></a>file descriptor</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">open</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">int</span> flags)</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">open64</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename,  <span class="keyword">int</span> flags)</span> </span>;</div><div class="line"><span class="comment">// allow large file mode </span></div><div class="line"><span class="keyword">size_t</span> read(<span class="keyword">int</span> fd,  <span class="keyword">void</span> *buffer, <span class="keyword">size_t</span> size) </div><div class="line"><span class="comment">//  read from fd  size bytes into buffer </span></div><div class="line"><span class="keyword">size_t</span> pread(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buffer,  <span class="keyword">size_t</span> size, <span class="keyword">off_t</span>  offset) </div><div class="line"><span class="comment">// start reading from position “offset” </span></div><div class="line"><span class="keyword">size_t</span>  write(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buffer,  <span class="keyword">size_t</span> size) </div><div class="line"><span class="keyword">off_t</span>  lseek(<span class="keyword">int</span> fd,  <span class="keyword">off_t</span> offset,  <span class="keyword">int</span> whence)  </div><div class="line"><span class="comment">// change the file position of fd </span></div><div class="line"><span class="function">FILE *<span class="title">fdopen</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">char</span> *opentype)</span> </span></div><div class="line"><span class="comment">// return a new stream for this fd</span></div></pre></td></tr></table></figure>
<h2 id="synchronizing-I-O"><a href="#synchronizing-I-O" class="headerlink" title="synchronizing I/O"></a>synchronizing I/O</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">(<span class="keyword">void</span>)</span> </span>;</div><div class="line"><span class="comment">// to ensure all operations finished before they return </span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fsync</span><span class="params">(<span class="keyword">int</span> fd)</span> </span>;</div><div class="line"><span class="comment">// to ensure all data associated with the fd is written to the device</span></div></pre></td></tr></table></figure>
<h2 id="not-yet"><a href="#not-yet" class="headerlink" title="not yet"></a>not yet</h2><p>async I/O, event I/O, interrupt driven I/O, GPIO …</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/26/Linux-at-work/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/26/Linux-at-work/" itemprop="url">Linux at work</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-26T00:10:49-04:00">
                2018-07-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/26/Linux-at-work/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/26/Linux-at-work/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="bash-environment"><a href="#bash-environment" class="headerlink" title="bash environment"></a>bash environment</h2><pre><code>/etc/profile -&gt;  hold shell environment &amp; startup settings 
~/.bashrc  -&gt; system wide definitions for shell funcs &amp; alias 
~/.bash_profile -&gt; user environment individually
</code></pre><p>ususally during coapplication configuration on Mac or Linux, mostly use ~/.bashrc to add project related environment variables. </p>
<h2 id="regular-expressions"><a href="#regular-expressions" class="headerlink" title="regular expressions"></a>regular expressions</h2><ul>
<li>the$ :matches the line ending with “the”</li>
<li>^the :matches the line starting with “the”</li>
<li>[^g]abc : search “abc” but not starting with “g” </li>
<li>[^abc…z][0-9] : search numbers but not with alphabet in front </li>
<li>^[a-z] : search the line starting with low alphabet</li>
<li>^[^a-z]: search the line starting without low alphabet</li>
<li>^$ :  match white space </li>
<li>[xyz]: general match anyone from “xyz” </li>
<li>[!xyz]: general match in opposite, neither from “xyz” </li>
</ul>
<h2 id="shell-expressions"><a href="#shell-expressions" class="headerlink" title="shell expressions"></a>shell expressions</h2><ul>
<li>command &amp; :  to run command in bg</li>
<li>$! : current PID</li>
<li>$# : number of arguments</li>
<li>$1 : the first paramter</li>
<li>$* : wildcard for all variables</li>
</ul>
<h2 id="Linux-commands"><a href="#Linux-commands" class="headerlink" title="Linux commands"></a>Linux commands</h2><ul>
<li>ldd:  check runtime lib</li>
<li>unix2dos  / dos2unix:  change file format between Windows and Linux</li>
<li>ps : print running processes in current terminal </li>
<li>ipcs : check share memory portion in current system </li>
<li>ipcrm -M ipc_key :  remove the shared memory portion id by ipc_key </li>
<li>top: print  virtual,resident,shared memory percentage</li>
<li>basename:  e.g.  basename /path/to/file -&gt;  file </li>
<li>wc -l .file:  print total lines of the file </li>
<li>df: check the usage of disk</li>
<li>find . -type f -print0 | xargs -0 grep -l “xx” </li>
<li>find D:\  | grep xml </li>
<li>less .file  : read the last few lines of file</li>
<li>ln item link : soft link</li>
<li>ln -s item link : hard link</li>
<li>type command : check the type of command</li>
<li>cat f1 f2 &gt; merged </li>
<li>sort </li>
<li>uniq </li>
<li>comm f1 f2 :  the common part of f1 and f2 </li>
<li>diff f1 f2 : the difference of f1 and f2 </li>
<li>2 &gt;&amp; 1: redirect std output(fd=2) to std error(fd=1)</li>
<li>nm :  check libs used in current executable(T defined, U undefined) </li>
</ul>
<h2 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h2><p>MPI gdb: (each MPI thread will have an independent terminal window)<br>    mpirun -np #cpus  xterm -e gdb ./exe </p>
<p>set breakpoint in different src:<br>    b sth.cxx:20</p>
<p>print an array:<br>    p (int[length]* a)</p>
<p>add input file:<br>    set args -j input_file </p>
<p>load src after triggering GDB:<br>    gdb<br>    file exe<br>    set args -j input_file </p>
<h2 id="books-about-Linux"><a href="#books-about-Linux" class="headerlink" title="books about Linux"></a>books about Linux</h2><p>bash guide for beginners<br>tao of regular expression<br>Linux programmer’s manual<br>Linux system administrators guide<br>C expert programming<br>what every programmer should know about CPU caches</p>
<h2 id="resources-in-multi-core-optimization"><a href="#resources-in-multi-core-optimization" class="headerlink" title="resources in multi-core optimization"></a>resources in multi-core optimization</h2><p>understand CPU utilization &amp; optimization<br>Intel: optimization applications for NUMA<br>Intel guide for developing multithreaded applications<br>MPI parallel programming in Python<br>considerations in software design for multi-core, multiprocessor architectures<br>how to optimize GEMM<br>optimize for Intel AVX using MKL with DGEMM<br>GEMM: from pure C to SSE optimized micro kernel<br>a practical guide to SSE SIMDD with C++<br>multi-core design<br>Unix and pthread programming </p>
<h2 id="resources-in-applications"><a href="#resources-in-applications" class="headerlink" title="resources in applications"></a>resources in applications</h2><p>introduction to post processing finite element results with AVS<br>CAE Linux: FEA inter-operability<br>open sourcing a Python project the right way<br>PPSS<br>pyNastran<br>hdfviewer<br>valgrind</p>
<h2 id="postscript"><a href="#postscript" class="headerlink" title="postscript"></a>postscript</h2><p>starting from 2016, I had went through each hot topic nowadays, even did some study in DL, AV, CV etc. every time the passion burst out and I promised to e.g. study a framework, or contribute an open project. in reality, the passion dies away soon. It’s like a new and very attracting concept bump out in the market, but no business model can handle it, then it dies out. </p>
<p>downside of this learning pattern is that the fundmental is ignored. e.g. I can’t success in code interview, few experience in basic algorithms. kind of person always vision the big, but don’t realize how to reach there. it’s kind of wasting finally, just want to be focus at this moment.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/26/Pure-C-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/26/Pure-C-structure/" itemprop="url">pure C structure</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-26T00:03:29-04:00">
                2018-07-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/26/Pure-C-structure/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/26/Pure-C-structure/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="definition"><a href="#definition" class="headerlink" title="definition"></a>definition</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">gid_</span> &#123;</span></div><div class="line">			<span class="keyword">double</span> x;</div><div class="line">			<span class="keyword">double</span> y;</div><div class="line">			<span class="keyword">char</span>* name ;</div><div class="line">		&#125; gid ;</div></pre></td></tr></table></figure>
<p>typedef defines “gid” as an alias name to “struct gid_ “. typedef also alias function handle/pointer, which is often used in asynchronous/event callback programming. other data encapsulation are:<br>    enum : map a list of const names to integral constants<br>    union: store many data type in one memory address</p>
<h2 id="initialization"><a href="#initialization" class="headerlink" title="initialization"></a>initialization</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gid g1=&#123;<span class="number">2.0</span>, <span class="number">3.0</span>, <span class="string">"g1"</span>&#125;;</div><div class="line">gid g2=&#123;.x=<span class="number">2.0</span>, .y=<span class="number">3.0</span>, .name=<span class="string">"g2"</span>&#125;;</div><div class="line">gid g3=(gid)&#123;<span class="number">2.0</span>, <span class="number">3.0</span>, <span class="string">"g3"</span>&#125;;</div></pre></td></tr></table></figure>
<p>in C++, structure initialization can also be done in constructor. </p>
<h2 id="memory-alignment"><a href="#memory-alignment" class="headerlink" title="memory alignment"></a>memory alignment</h2><p>for better memory access in CPU architecture, <a href="http://www.catb.org/esr/structure-packing/" target="_blank" rel="external">memory alignment</a> in structure is considered. namely:</p>
<pre><code>chars can start on any byte address
2-bytes shorts must start on an even address 
4-bytes ints/floats must start on an address divisible by 4
8-bytes doubles/longs must start on an address divisible by 8 
</code></pre><p>the size of the whole structure, is aligned to intergeral times of the max size of its member variable. e.g. sizeof(gid) = 24, not 8+8+4.</p>
<p>to put the member variables in ascending/descending order is good practice.</p>
<h2 id="structure-pointer-arithmetic"><a href="#structure-pointer-arithmetic" class="headerlink" title="structure pointer arithmetic"></a>structure pointer arithmetic</h2><p>“gid++” will step forward the sizeof(gid); structure also supports self-reference:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">gid_</span> &#123;</span></div><div class="line">		<span class="keyword">char</span> *name ;</div><div class="line">		<span class="keyword">double</span> x;</div><div class="line">		<span class="keyword">double</span> y;</div><div class="line">		gid_ *next_gid ; </div><div class="line">	&#125; gid ;</div></pre></td></tr></table></figure>
<p>another common utils is structure array: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gid gid_list[MAX_SIZE]; </div><div class="line">gid **gid_list_p ;</div></pre></td></tr></table></figure>
<h2 id="structure-as-function-parameters"><a href="#structure-as-function-parameters" class="headerlink" title="structure as function parameters"></a>structure as function parameters</h2><p>in general, structure can be passing to function by value or by pointer, but not by reference in pure C. also structure as return value from function can be value or a pointer</p>
<h2 id="structure-in-C"><a href="#structure-in-C" class="headerlink" title="structure in C++"></a>structure in C++</h2><p>in C++, structure supports member functions, is same as a public class. and the initialization can be done either in constructor function or direct initialization during definition. see <a href="https://www.quora.com/What-is-the-difference-between-C-structure-C++-structure" target="_blank" rel="external">the difference of struct between C and C++</a></p>
<h2 id="stdlib-h"><a href="#stdlib-h" class="headerlink" title="stdlib.h"></a>stdlib.h</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> /* convert string s1 to an int*/	</div><div class="line">	int atoi(const char* s1);</div><div class="line"> </div><div class="line"> /* memory op */</div><div class="line">	void* malloc(size_t size); </div><div class="line">	void free(void *ptr);</div><div class="line">	</div><div class="line"> /* system level op */</div><div class="line">	char* getenv(const char *name);</div><div class="line">	int system(const char *command); </div><div class="line"></div><div class="line">/* algorithms */</div><div class="line">	void* bsearch(const void* key, const void* base,</div><div class="line">	size_t nitems, size_t size,  int(*compar)(const void*, const void*))  </div><div class="line"></div><div class="line">	void qsort(void *base, size_t nitems, size_t size, </div><div class="line">int(*compar)(const void*, const void*))</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/24/pure-C-string/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/24/pure-C-string/" itemprop="url">pure C string</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-24T18:43:37-04:00">
                2018-07-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/24/pure-C-string/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/24/pure-C-string/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="string-initialization"><a href="#string-initialization" class="headerlink" title="string initialization"></a>string initialization</h2><p>in pure C, string is a char array terminating with NULL(‘\0’). To initialize an array of char(string) is with a string literal(a double-quotaed string).</p>
<p>in general, the string literal is used as the initializer for an array of char; anywhere else, it is a static array of chars, which shouldn’t be modified by a pointer.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* initialize a string in C </span></div><div class="line"> * the size of s1 is taken from the size of the initializer</div><div class="line"> */</div><div class="line">	<span class="keyword">char</span> s1[] = <span class="string">"hello world"</span> ; </div><div class="line"><span class="comment">// or </span></div><div class="line">	<span class="keyword">char</span> s1[<span class="number">12</span>] = <span class="string">"hello world"</span>; </div><div class="line"></div><div class="line"><span class="comment">/* common errors */</span></div><div class="line">	<span class="keyword">char</span> s2[];</div><div class="line">	s2 = <span class="string">"hello world"</span></div><div class="line"><span class="comment">// error: storage size of 's2' isn't known </span></div><div class="line"></div><div class="line">	<span class="keyword">char</span> s2[<span class="number">12</span>];</div><div class="line">	s2 = <span class="string">"hello world"</span></div><div class="line"><span class="comment">// error:  invalid array assignment </span></div><div class="line"><span class="comment">/* there is no "=" operator defined for char array in C </span></div><div class="line">   using strcpy()</div><div class="line">*/</div><div class="line"></div><div class="line">``` </div><div class="line"></div><div class="line">## <span class="keyword">char</span> pointer arithmetic </div><div class="line"></div><div class="line">```c</div><div class="line"></div><div class="line">	<span class="keyword">char</span> s1[<span class="number">12</span>];</div><div class="line">	*s1++ ;	</div><div class="line"><span class="comment">/* error:  lvalue requied as increment operand</span></div><div class="line"> * s3 is an array, can't modify the address of an array. the difference between pointer and array </div><div class="line">*/ </div><div class="line">	 <span class="keyword">char</span>* s2 = s1; </div><div class="line">	 *s2++;</div><div class="line"><span class="comment">/* s2 is a pointer to s1, ++ is ok */</span></div></pre></td></tr></table></figure>
<h2 id="string-h"><a href="#string-h" class="headerlink" title="string.h"></a>string.h</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* concatenate two strings */</span></div><div class="line"><span class="built_in">strcat</span>(<span class="keyword">char</span>* s1, <span class="keyword">const</span> <span class="keyword">char</span>* s2) ;</div><div class="line"><span class="built_in">strncat</span>(<span class="keyword">char</span>* s1, <span class="keyword">const</span> <span class="keyword">char</span>* s2, <span class="keyword">size_t</span> n); </div><div class="line"></div><div class="line"><span class="comment">/*  locate the first/last occurance of char c in string s */</span></div><div class="line"><span class="built_in">strchr</span>(<span class="keyword">const</span> <span class="keyword">char</span>* s1, <span class="keyword">int</span> c);</div><div class="line"><span class="built_in">memchr</span>(<span class="keyword">const</span> <span class="keyword">void</span>* s1, <span class="keyword">int</span> c, <span class="keyword">size_t</span> n);</div><div class="line"><span class="built_in">strrchr</span>(<span class="keyword">const</span> <span class="keyword">char</span>* s1, <span class="keyword">int</span> c); </div><div class="line"></div><div class="line"><span class="comment">/*  compare s1 and s2 alphabetically */</span></div><div class="line"><span class="built_in">strcmp</span>(<span class="keyword">const</span> <span class="keyword">char</span>* s1, <span class="keyword">const</span> <span class="keyword">char</span>* s2);	</div><div class="line"><span class="built_in">strncmp</span>(<span class="keyword">const</span> <span class="keyword">char</span>* s1, <span class="keyword">const</span> <span class="keyword">char</span>* s2, <span class="keyword">size_t</span> n);</div><div class="line"><span class="built_in">memcmp</span>(<span class="keyword">const</span> <span class="keyword">void</span>* s1, <span class="keyword">const</span> <span class="keyword">void</span>* s2, <span class="keyword">size_t</span> n);</div><div class="line"></div><div class="line"><span class="comment">/*  copy s2 to s1 */</span></div><div class="line"><span class="built_in">strcpy</span>(<span class="keyword">char</span> *s1, <span class="keyword">const</span> <span class="keyword">char</span> *s2); </div><div class="line"><span class="built_in">memcpy</span>(<span class="keyword">void</span>* s1, <span class="keyword">void</span>* s2, <span class="keyword">size_t</span> n);</div><div class="line"></div><div class="line"><span class="comment">/* number of bytes, not including terminating NULL; sizeof() will inlcude the terminating NULL */</span></div><div class="line"><span class="built_in">strlen</span>(<span class="keyword">const</span> <span class="keyword">char</span>* s1); </div><div class="line"></div><div class="line"><span class="comment">/* find the first occurance of substring s2 in s1 */</span></div><div class="line"><span class="built_in">strstr</span>(<span class="keyword">const</span> <span class="keyword">char</span> *s1,  <span class="keyword">const</span> <span class="keyword">char</span> *s2);</div><div class="line"></div><div class="line"><span class="comment">/* split string s1 into a sequence of tokens by s2 */</span></div><div class="line">strtok(<span class="keyword">char</span>* s1, <span class="keyword">const</span> <span class="keyword">char</span>* s2);</div></pre></td></tr></table></figure>
<p>\<string.h> is replaced by <cstring> in C++.<br>and be aware of <a href="https://www.cs.fsu.edu/~myers/cop3330/notes/strings.html" target="_blank" rel="external">downs of C string</a>.</cstring></string.h></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">96</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
