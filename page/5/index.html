<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/lg-sim-source-code-review-2019-09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/22/lg-sim-source-code-review-2019-09/" itemprop="url">lg-sim source code review (2019.09)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T09:02:53-04:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/22/lg-sim-source-code-review-2019-09/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/22/lg-sim-source-code-review-2019-09/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>the recent version of lg-sim <a href="https://github.com/lgsvl/simulator" target="_blank" rel="external">2019.09</a> has additionally support for webUI, cloud, which is a big enhencement. the following code review is focusing on new components to support WebUI, cluster management.</p>
<h2 id="database"><a href="#database" class="headerlink" title="database"></a>database</h2><p>database used <code>sqlite</code> project, which is an embedded in-memory db; the ORM used <code>PetaPoco</code> project; there are a few db related serices, e.g.  vehicleService, simulationService, which will be used in RESTful web request.</p>
<ul>
<li><code>DatabaseManager</code>:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">static IDatabaseBuildConfiguration  DbConfig ;</div><div class="line"></div><div class="line">Init()&#123;</div><div class="line"></div><div class="line">	DbConfig = GetConfig(connectionString)</div><div class="line">	using  db =  new SqliteConnection(connectionString)&#123;</div><div class="line">		db.Open()</div><div class="line">&#125;</div><div class="line"></div><div class="line">CreateDefaultDbAssets()&#123;</div><div class="line"></div><div class="line">	using db = Open() </div><div class="line">	if (info.DownloadEnvs != null)&#123;</div><div class="line">		map =  new MapModel()&#123;url = url  LocalPath=localPath;&#125;</div><div class="line">		id =  db.Insert(map)</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	if (info.DownloadVehicles != null)&#123;&#125;</div><div class="line"></div><div class="line">	if(defaultMap.HasValue)</div><div class="line">	&#123;</div><div class="line">		sim1 = new SimulationModel()&#123; Cluster=0,  Map=defaultMap.Value,   ApiOnly=false&#125;;</div><div class="line">		AddSimulation(db, sim1, noBridgeVehicle);</div><div class="line">		AddSimulation(db, sim, apolloVehicle);</div><div class="line">		db.Insert(simx)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">AddSimulation(IDatabase db, sim,vehicle)&#123;</div><div class="line">	conn = new ConnectionModel()&#123;</div><div class="line">		simulation = id,</div><div class="line">		vehicle = vehicle.Value,</div><div class="line">	&#125;</div><div class="line">	db.Insert(conn)</div><div class="line">&#125;</div><div class="line"></div><div class="line">AddVehicle(db, sim,vehicle)&#123;</div><div class="line">	conn = new VehicleModel()&#123;</div><div class="line">		Url = url ,</div><div class="line">	&#125;</div><div class="line">	db.Insert(vehicle)</div><div class="line">	</div><div class="line">	return vehicle.Id;</div><div class="line">&#125;</div><div class="line"></div><div class="line">PendingVehicleDownloads()&#123;</div><div class="line">	using db=Open()&#123;</div><div class="line">		var sql =  Sql.Builder.From(&quot;vehicles&quot;).Where(&quot;status=00&quot;, &quot;Downloading&quot;);</div><div class="line">		return db.Query&lt;VehicleModel&gt;(sql);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="database-ORMs"><a href="#database-ORMs" class="headerlink" title="database ORMs"></a>database ORMs</h3><p>using <code>PetaPoco</code> to define <code>ORM</code> models, such as<br><code>users</code>, <code>sessions</code>, <code>maps</code>, <code>vehicles</code>, <code>clusters</code>, <code>simulations</code> </p>
<h4 id="PetaPoco"><a href="#PetaPoco" class="headerlink" title="PetaPoco"></a>PetaPoco</h4><p>a few operators in PetaPoco, such as <code>Page</code>, used to query a page; <code>Single</code>, used to query a single item; <code>Insert</code>; <code>Delete</code>; <code>Update</code></p>
<h3 id="database-provider"><a href="#database-provider" class="headerlink" title="database provider"></a>database provider</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">SQLiteDatabaseProvider =&gt; </div><div class="line">GetFactory(&quot;Mono.Data.Sqlite.SqliteFactory, Mono.Data.Sqlit&quot;)</div></pre></td></tr></table></figure>
<p>called inside <code>DatabaseManager::Init()</code>.</p>
<h3 id="database-services"><a href="#database-services" class="headerlink" title="database services"></a>database services</h3><ul>
<li><p>VehicleService : IVehicleService </p>
</li>
<li><p>MapService </p>
</li>
<li><p>NotificationService =&gt;  NotificationManager.SendNotification()</p>
</li>
<li><p>DownloadService =&gt;  DownloadManager.AddDownloadToQueue()</p>
</li>
<li><p>ClusterService </p>
</li>
<li><p>SessionService </p>
</li>
<li><p>SimulationService</p>
</li>
</ul>
<h2 id="Web-model"><a href="#Web-model" class="headerlink" title="Web model"></a>Web model</h2><p>web model is where WebUI server located, which is served by <code>Nancy</code> project, in which a new design metholody is applied: Inversin of Control Contaner(IoC), namely <code>控制反转</code> in chinese. IoC is used to inject implementation of class, and manage lifecycle,  dependencies.    </p>
<p>web model is the server where talk to webUI through routes, which is defined in the React project.</p>
<h3 id="Nancy"><a href="#Nancy" class="headerlink" title="Nancy"></a>Nancy</h3><p>used to build HTTP based web service,</p>
<ul>
<li>FileStream</li>
<li>StreamResponse  </li>
<li><a href="https://github.com/grumpydev/TinyIoC" target="_blank" rel="external">TinyIoC</a>   </li>
<li>UnityBootstrapper : <a href="https://github.com/NancyFx/Nancy/wiki/Bootstrapper" target="_blank" rel="external">DefaultNancyBootstrapper</a>, used to automatic discovery of modules, custm model binders, dependencies.</li>
</ul>
<ul>
<li>/Assets/Scripts/Web/Nancy/NancyUnityUtils</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">ConfigureApplicatinContainer(TinyIoCContainer container)</div><div class="line">&#123;</div><div class="line">  container.Register&lt;UserMapper&gt;();</div><div class="line">  container.Register&lt;IMapService&gt;(); </div><div class="line">  container.Register&lt;IClusterService&gt;();</div><div class="line">  container.Register&lt;IVehicleService&gt;();</div><div class="line">  container.Register&lt;ISimulationService&gt;();</div><div class="line">&#125; </div><div class="line">``` </div><div class="line"></div><div class="line">### route modules </div><div class="line"></div><div class="line">```c#</div><div class="line"></div><div class="line">SimulationModule : NancyModule()</div><div class="line">&#123;</div><div class="line">  class SimulationRequest&#123;&#125;</div><div class="line">  class SimulationResponse&#123;&#125;</div><div class="line">  </div><div class="line">  Get(&quot;/&quot;,  x=&#123;&#125;)</div><div class="line">  Post(&quot;/&quot;,  x=&#123;&#125;)</div><div class="line">  Put(&quot;/&#123;id:long&#125;&quot;, x=&#123;&#125;)</div><div class="line">  Post(&quot;/&#123;id:long&#125;/start&quot;, x=&#123;&#125;)</div><div class="line">  Post(&quot;/&#123;id:long&#125;/stop&quot;, x=&#123;&#125;)  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>inside some of the route modules will do query or update the sqlite database for special objects. till here is the complete web back-end server, with a http server and an in-memory database.</p>
<p>the webUI frontend is based on React, about React check <a href="https://zjli2013.github.io/2019/08/30/reactjs-introduction/" target="_blank" rel="external">a previous blog</a>. in the React WebUI project will have http requests corresponding to each of routes defined here. </p>
<p>React front end is very independent framework, which should be handled by an independent team in standard pipeline.</p>
<h3 id="Config-amp-Loader"><a href="#Config-amp-Loader" class="headerlink" title="Config &amp; Loader"></a>Config &amp; Loader</h3><ul>
<li>/Assets/Scripts/Web/Config.cs: </li>
</ul>
<p>used to define <code>WebHost</code>,  <code>WebPort</code>, <code>ApiHost</code>, <code>ClourUrl</code>, <code>Headless</code>, <code>Sensors</code>, <code>Bridges</code> e.t.c   </p>
<ul>
<li>Loader.cs :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Loader Instance ;    //Loader object is never destroyed, even between scene reloads</div><div class="line"></div><div class="line">Loader.Start()&#123;</div><div class="line"></div><div class="line">	DatabaseManager.Init();</div><div class="line">	var config = new HostConfguration&#123;&#125; ;   // ?</div><div class="line">	Server = new NancyHost(Config.WebHost);</div><div class="line">	Server.Start();</div><div class="line">	DownloadManager.Init();</div><div class="line">&#125;</div><div class="line"></div><div class="line">Loader.StartAsync(simulation)&#123;</div><div class="line"></div><div class="line">	Instance.Actions.Enqueue() =&gt;</div><div class="line">	var db = DatabaseManager.Open()</div><div class="line">	AssetBundle mapBundle = null; </div><div class="line">		</div><div class="line">	simulation.Status &quot;Starting&quot; </div><div class="line">	NotificationManager.SendNotification();</div><div class="line">	Instance.LoaderUI.SetLoaderUIState();</div><div class="line"></div><div class="line">	Instance.SimConfig = new SimlationConfig()&#123;</div><div class="line">		Clusters, ApiOnly, Headless, Interative, TimeOfDay, UseTraffic...</div><div class="line">	&#125;	</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">Loader.SetupScene(simulation)&#123;</div><div class="line"></div><div class="line">	var db = DatabaseManager.Open()</div><div class="line">	foreach var agentConfig in Instance.SimConfig.Agents:</div><div class="line">		var bundlePath = agentConfig.AssetBundle </div><div class="line">		var vehicleBundle = AssetBundle.LoadfromFile(bundlePath)</div><div class="line">		var vehicleAssets = vehicleBundle.GetAllAssetNames();</div><div class="line">		agentConfig.Prefab = vehicleBundle.LoadAsset&lt;GO&gt;(vehicleAssets[0])</div><div class="line">		</div><div class="line">	var sim = CreateSimulationManager();	</div><div class="line">	Instance.CurrentSimulation = simulation </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>DownloadManager</li>
</ul>
<pre><code class="c#">
class Download();
Init(){ client = new WebClient();  ManageDownloads(); }
</code></pre>
<h2 id="network-module"><a href="#network-module" class="headerlink" title="network module"></a>network module</h2><p><code>network module</code> is used for communication among master and clients(workers) in the cluster network for cloud support. the P2P network is built on <code>LiteNetLib</code> which is a reliable UDP lib. </p>
<h3 id="LiteNetLib"><a href="#LiteNetLib" class="headerlink" title="LiteNetLib"></a>LiteNetLib</h3><p><a href="https://github.com/RevenantX/LiteNetLib" target="_blank" rel="external">LiteNetLib</a>is Udp package, used to P2P communication among master node and slave nodes here, where are defined as <code>MasterManager</code>, <code>ClientManager</code>.</p>
<p>usage of LiteNetLib can be found in the <a href="https://github.com/RevenantX/LiteNetLib/wiki/NetPacketProcessor-(NetSerializer" target="_blank" rel="external">wiki</a>-usage)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/IoC-in-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/22/IoC-in-C/" itemprop="url">IoC in C#</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T08:58:37-04:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/22/IoC-in-C/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/22/IoC-in-C/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Inversion of Control(IoC) is a design mechanism to decouple components dependencies, a light-weight implementation is: <a href="https://github.com/grumpydev/TinyIoC" target="_blank" rel="external">TinyIoC</a>, which is also part of <a href="http://nancyfx.org" target="_blank" rel="external">Nancy</a>.  </p>
<p>IoC idea uses commonly in webUI(and backend server) apps,  which is an user friendly solution to cloud deployment management as well as apps in mobile, which should be the right direction in future ADS software tool development.</p>
<p>the idea of IoC can be explained by the following example from <a href="https://www.tutorialsteacher.com/ioc/register-and-resolve-in-unity-container" target="_blank" rel="external">register and resolve in unity container</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">public interface ICar</div><div class="line">&#123;</div><div class="line">    int Run();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class BMW : ICar</div><div class="line">&#123;</div><div class="line">    private int _miles = 0;</div><div class="line"></div><div class="line">    public int Run()</div><div class="line">    &#123;</div><div class="line">        return ++_miles;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Ford : ICar</div><div class="line">&#123;</div><div class="line">    private int _miles = 0;</div><div class="line"></div><div class="line">    public int Run()</div><div class="line">    &#123;</div><div class="line">        return ++_miles;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Driver</div><div class="line">&#123;</div><div class="line">    private ICar _car = null;</div><div class="line"></div><div class="line">    public Driver(ICar car)</div><div class="line">    &#123;</div><div class="line">        _car = car;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void RunCar()</div><div class="line">    &#123;</div><div class="line">        Console.WriteLine(&quot;Running &#123;0&#125; - &#123;1&#125; mile &quot;, _car.GetType().Name, _car.Run());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>the <code>Driver</code> class depends on <code>ICar</code> interface. so when instantiate the <code>Driver</code> class object, need to pass an instance of <code>ICar</code>, e.g.  BMW, Ford as following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Driver driver = new Driver(new Ford());</div><div class="line">driver.RunCar()</div><div class="line"></div><div class="line">``` </div><div class="line"></div><div class="line"></div><div class="line">**to use IoC**, taking UnityContainer framework as example, a few other choices: TinyIoC e.t.c.</div><div class="line"></div><div class="line">```c#</div><div class="line"></div><div class="line"> var container = new UnityContainer();</div></pre></td></tr></table></figure>
<ul>
<li>Register </li>
</ul>
<p>create an object of the <code>BMW</code> class and inject it through a constructor whenever you need to inject an ojbect of <code>ICar</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">container.Register&lt;ICar, BMW&gt;();</div></pre></td></tr></table></figure>
<ul>
<li>Resolve</li>
</ul>
<p><code>Resolve</code> will create an object of the <code>Driver</code> class by automatically creating and njecting a <code>BMW</code> object in it, since previously register <code>BMW</code> type with <code>ICar</code>.</p>
<pre><code class="c#">
Driver  drv =  container.Resolve&lt;Driver&gt;();
drv.RunCar()
</code></pre>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>there are two obvious advantages with IoC. </p>
<ul>
<li><p>the instantiate of dependent class can be done in run time, rather during compile. e.g.  <code>ICar</code> class doesn’t instantiate in <code>Driver</code> definition</p>
</li>
<li><p>automatic <code>new class</code> management in back. </p>
</li>
</ul>
<p>the power of IoC will be scaled, once the main app is depends on many little services.    </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/21/rosbag-tools-in-ADS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/21/rosbag-tools-in-ADS/" itemprop="url">rosbag tools in ADS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-21T06:18:47-04:00">
                2019-10-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/21/rosbag-tools-in-ADS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/21/rosbag-tools-in-ADS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>in ADS,  data fusion, sensor performance, L3+ perception, localization algorithms development relys a lot on physicall data collection, commonly in rosbag format with information/data about gps, rtk, camera, Lidar, radar e.t.c.</p>
<p>to build up the development process systemly is a critial thing, but also ignored by most ADS teams. for large OEMs, each section may have their own test vehicles, e.g. data fusion team,  sensor team e.t.c, but few of them take care data systematically, or build a solution to manage data. one reason is the engineers are lack of ability to give software tool feedbacks/requirements, so they still stay and survive with folders or Excel management, which is definitely not acceptable and scalable for massive product team. </p>
<p>thanks for ROS open source community conributing a great rosbag database manage tool: <a href="http://wiki.ros.org/TheBagDatabase" target="_blank" rel="external">bag_database</a>. with docker installation, this tool is really easy to configure. a few tips:</p>
<ul>
<li>web server IP port in Docker can be accessed from LAN by parameter <code>-p</code> during docker run.</li>
</ul>
<h2 id="mount-sbm-drive"><a href="#mount-sbm-drive" class="headerlink" title="mount sbm drive"></a>mount sbm drive</h2><p>as mentioned, most already collected rosbag is stored in a share drive, one way is to mount these data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo mount -t cifs //share_ip_address/ROS_data /home/david/repo/rosbag_manager/data  -o uid=david -o gid=david -o credentials=/home/david/repo/rosbag_manager/data/.pwd </div><div class="line"></div><div class="line"></div><div class="line">sudo umount -t cifs /home/david/repo/rosbag_manager/data</div></pre></td></tr></table></figure>
<h2 id="Tomcat-server-configure"><a href="#Tomcat-server-configure" class="headerlink" title="Tomcat server configure"></a>Tomcat server configure</h2><p>bag_database is hosted by Tomcat, the default port is 8080. For our services, which already host pgAdmin4 for map group; gitlab for team work; xml server for system engineering; for webviz. check the port is occupied or not:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netstat -an | grep 8088</div></pre></td></tr></table></figure>
<p>so configure <code>/usr/loca/tomcat/conf/server.xml</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">&lt;Service name="Catalina"&gt;</div><div class="line">   &lt;Connector port="your_special_port"</div><div class="line">   ...</div><div class="line">&lt;/Service&gt;</div></pre></td></tr></table></figure>
<h2 id="a-few-other-tools"><a href="#a-few-other-tools" class="headerlink" title="a few other tools"></a>a few other tools</h2><h3 id="ros-hadoop"><a href="#ros-hadoop" class="headerlink" title="ros_hadoop"></a>ros_hadoop</h3><p><a href="https://github.com/valtech/ros_hadoop" target="_blank" rel="external">ros_hadoop</a> is a rosbag analysis tool based on hdfs data management. which is a more scalable platform for massive ADS data requirements. if there is massive ros bag process in need, ros_hadoop should be a great tool. there is a discussion in <a href="https://discourse.ros.org/t/working-with-large-ros-bag-files-on-hadoop-and-spark/2314" target="_blank" rel="external">ros wiki</a></p>
<p><img src="https://github.com/valtech/ros_hadoop/blob/master/doc/images/concept.png" alt="image"></p>
<p><img src="https://github.com/valtech/ros_hadoop/blob/master/doc/images/rosbag-analytics.png" alt="image"></p>
<h4 id="install-hadoop"><a href="#install-hadoop" class="headerlink" title="install hadoop"></a>install hadoop</h4><p><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="external">apache hadoop download</a></p>
<p><a href="https://poweruphosting.com/blog/install-hadoop-ubuntu/" target="_blank" rel="external">single alone install</a></p>
<h4 id="concept-in-hdfs"><a href="#concept-in-hdfs" class="headerlink" title="concept in hdfs"></a>concept in hdfs</h4><ul>
<li>namenode </li>
</ul>
<p>daemon process, used to manage file system</p>
<ul>
<li>datanode </li>
</ul>
<p>used to data block store and query</p>
<ul>
<li>secondary namenode</li>
</ul>
<p>used to backup</p>
<ul>
<li><p><a href="https://cloud.tencent.com/developer/article/1456436" target="_blank" rel="external">hdfs shell command</a></p>
</li>
<li><p><a href="https://www.thomashenson.com/find-hdfs-path-url/" target="_blank" rel="external">hdfs path URL</a></p>
</li>
</ul>
<h4 id="hdfs-site-xml"><a href="#hdfs-site-xml" class="headerlink" title="hdfs-site.xml"></a>hdfs-site.xml</h4><pre><code>/usr/local/hadoop/etc/hadoop/hdfs-site.xml
</code></pre><p><a href="https://hadoop.apache.org/docs/r2.4.1/hadoop-project-dist/hadoop-hdfs/hdfs-default.xml" target="_blank" rel="external">configure file</a></p>
<ul>
<li>dfs.datanode.data.dir -&gt;  local file system where to store data blocks on DataNodes </li>
<li>dfs.replicaiton -&gt;  num of replicated datablocks for protecting data </li>
<li>dfs.namenode.https-address -&gt;  location for NameNode URL </li>
<li>dfs.https.port -&gt; </li>
</ul>
<h4 id="copy-local-data-into-hdfs"><a href="#copy-local-data-into-hdfs" class="headerlink" title="copy local data into hdfs"></a>copy local data into hdfs</h4><pre><code class="script">
hdfs dfs -put /your/local/file/or/folder   [hdfs default data dir]

hdfs dfs -ls
</code></pre>
<h3 id="mongodb-store"><a href="#mongodb-store" class="headerlink" title="mongodb_store"></a>mongodb_store</h3><p><a href="https://github.com/strands-project/mongodb_store" target="_blank" rel="external">mongodb_store</a> is a tool to store and analysis ROS systems. also in <a href="https://answers.ros.org/question/240699/ros_databases/" target="_blank" rel="external">ros wiki</a></p>
<h3 id="mongo-ros"><a href="#mongo-ros" class="headerlink" title="mongo_ros"></a>mongo_ros</h3><p><a href="https://wiki.ros.org/mongo_ros" target="_blank" rel="external">mongo_ros</a> used to store ROS message n MongoDB, with C++ and Python clients.</p>
<h3 id="mongo-hadoop"><a href="#mongo-hadoop" class="headerlink" title="mongo-hadoop"></a>mongo-hadoop</h3><p><a href="https://github.com/mongodb/mongo-hadoop/" target="_blank" rel="external">mongo-hadoop</a> allows MongoDB to be used as an input source or output destination for Hadoop taskes. </p>
<h3 id="ros-pandas"><a href="#ros-pandas" class="headerlink" title="ros_pandas"></a>ros_pandas</h3><p><a href="https://nimbus.unl.edu/2014/11/using-rosbag_pandas-to-analyze-rosbag-files/" target="_blank" rel="external">rosbag_pandas</a></p>
<h3 id="tabbles"><a href="#tabbles" class="headerlink" title="tabbles"></a>tabbles</h3><p><a href="https://tabbles.net/" target="_blank" rel="external">tabbles</a> used to tag any rosbags or folders.</p>
<h3 id="hdfs-fdw"><a href="#hdfs-fdw" class="headerlink" title="hdfs_fdw"></a>hdfs_fdw</h3><p><a href="https://github.com/EnterpriseDB/hdfs_fdw" target="_blank" rel="external">hdfs for postSQL</a> </p>
<h2 id="at-the-end"><a href="#at-the-end" class="headerlink" title="at the end"></a>at the end</h2><p>talked with a friend from DiDi software team, most big Internet companies have their own software tool teams in house, which as I know so far, doesn’t exist in any traditional OEMs. is there a need for tool team in OEMs? the common sense is at the early stage, there is no need to develop and maintain in-house tools, the commericial ones should be more efficient; as the department grows bigger and requires more user special development and commericial tools doesn’t meet the needs any more, tool teams may come out. still most decided by the industry culture, OEM’s needs is often pre-defined by big suppliers, so before OEMs are clear their software tool requirements/need, the suppliers already have the solutions there – this situation is epecially true for Chinese OEMs, as their steps is behind Europen suppliers maybe 50 years.\</p>
<p>I am interested at the bussiness model of <a href="https://autovia.ai/" target="_blank" rel="external">autovia.ai</a>, which focus on <code>distributed machine learning</code> and <code>sensor data analytics</code> in cloud with <code>petabyte of data</code>, with the following skills: </p>
<ul>
<li><p>large scale sensor data(rosbag) processing with Apache Spark</p>
</li>
<li><p>large scale sensro data(rosbag) training with TensorFlow</p>
</li>
<li><p>parallel processing with fast serialization between nodes and clusters </p>
</li>
<li><p>hdmap generation tool in cloud </p>
</li>
<li><p>metrics and visulization in web</p>
</li>
<li><p>loading data directly from hdfs, Amazon S3</p>
</li>
</ul>
<p>all these functions will be a neccessary for a full-stack ADS team in future to development safety products, which I called “ data infrastructure for ADS”.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="http://moore-mike.com/ros-analysis-part-2.html" target="_blank" rel="external">MooreMike: ros analysis in Jupter</a></p>
<p><a href="https://askubuntu.com/questions/29535/how-do-i-access-a-mounted-windows-share-from-the-command-line" target="_blank" rel="external">mount smb share drive to ubuntu</a></p>
<p><a href="https://autovia.ai/" target="_blank" rel="external">autovia.ai</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/16/safety-guy-in-AV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/16/safety-guy-in-AV/" itemprop="url">safety guy in AV</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-16T07:10:58-04:00">
                2019-10-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/16/safety-guy-in-AV/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/16/safety-guy-in-AV/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>why Waymo still can’t release fully driveless cars on road; why vehicle startups, NIO is going to brankruptcy? one of the hidden reasons vehicle as a consumer product can’t go to fast iteration as social media, mobility apps in Internet companies, is safety. </p>
<p>vehicle development(VD) needs to satisfy safety requiements at first priority. so in VD,  the cutting edge tech/ new solutions usually doesn’t make a difference, but the processes, how to handle safety requirements, system requirements, e.t.c are really the first thing in vehicle engineers’ mind.</p>
<p>so now, deep learning AI in object detection is fairly matured, but it’s not used common in vehicle camera products. and for these start ups, who say themselves as tech-driven doesn’t survive well, because VD should be process driven. </p>
<p> the best managment/survive way for original equipment manufacture(OEM) companies is build up their process system. e.g. GM managemnet is about process, and Toyota agile management is about a more flexible process, too. no OEMs said their team is tech-driven. </p>
<h3 id="what-is-SOTIF"><a href="#what-is-SOTIF" class="headerlink" title="what is SOTIF ?"></a>what is SOTIF ?</h3><p>safety of the intended functionality(SOTIF): the absence of unreasonable risk due to hazards resulting from functional insufficiencies of the intended functionaliyt or by reasonably foreseeable misuse by persons.</p>
<p>SOTIF is a way to define <code>safey by design</code>, while still there are <code>unsafe post design</code>, which is beyond the standards can handle. </p>
<h3 id="safety-chanllenges-in-ADS"><a href="#safety-chanllenges-in-ADS" class="headerlink" title="safety chanllenges in ADS"></a>safety chanllenges in ADS</h3><p>is conserative behaivor of AI unsafe ? YES. as Waymo cars driving in San Fransisco, it’s more conservative than human drivers, which makes itself unsafe and surrounding vehicles unsafe. and the definiation of conservative or aggressive of driving behavior is further area depends, e.g. how human drivers drive in San Fransisco is different than drivers from Michigan, how AI handle this? </p>
<p>how does AI satisfy VD requirements, and how to verify the AI really satisfy? there is no standard solution yet. since AI is black box, it may satisfy VD requirements in 99.9% situations, but failed in 0.1% case. </p>
<p>an ADS solution works well in 99% scenarios is not an acceptable solution at all, which is really big chanllenge for most self driving full-stack solution start-ups. so Waymo and a few giants are working on test driven verification, which requires build up a very strong simulation team to power up safety test by simulation, which’s even chanllenging for most traditional OEMs.</p>
<p>and definitely, there is no way to handle unstructured stochastic traffic environments,  </p>
<h2 id="classification-of-safety-hazards"><a href="#classification-of-safety-hazards" class="headerlink" title="classification of safety hazards"></a>classification of safety hazards</h2><ul>
<li><p>IS26262</p>
</li>
<li><p>internal cyber security (ISO21434)</p>
</li>
<li><p>functional insufficient &amp; human misuse (IS02148)</p>
</li>
<li><p>external infrastructura cyber security (traffic light system, jamming sensors signals)</p>
</li>
</ul>
<h2 id="malfunction-behaviors-of-EE"><a href="#malfunction-behaviors-of-EE" class="headerlink" title="malfunction behaviors of EE"></a>malfunction behaviors of EE</h2><p>Harzard Analysis &amp; Risk Assignment </p>
<pre><code>    |
    |
    V

ASIL B/C/D         &lt;--   sys requires 

* func redundency 

* system safety mechanism 

* predictive safety mechanism 
</code></pre><p>this is a close-loop analysis, to satisfy <code>sys requirement</code> will get new situations, which lead to new system requirements </p>
<pre><code>system requirements 

  ^ 
  |
  |
  V

SOTIF Analysis 
</code></pre><p>this is a double direction design, with any new requiremenst, there is a need to do SOTIF analysis, which may find out some potential bugs/problems in the design, then back to new system requirements.</p>
<p>in summary, the input to SOTIF analysis is system requirements, and output is new system requirements.</p>
<h2 id="functional-insufficients"><a href="#functional-insufficients" class="headerlink" title="functional insufficients"></a>functional insufficients</h2><ul>
<li>unsafe by design </li>
</ul>
<p>e.g. full pressure brake design, is not sufficient in scenarios, when there is rear following vehicle in full speed</p>
<h2 id="Tech-limitations"><a href="#Tech-limitations" class="headerlink" title="Tech limitations"></a>Tech limitations</h2><ul>
<li><p>safe known </p>
</li>
<li><p>unsafe known </p>
</li>
<li><p>safe unknown</p>
</li>
<li><p>unsafe unknown </p>
</li>
</ul>
<p>SOTIF is to identify all unsafe cases and requies to make them safe, but not know how, but SOTIF can’t predict unknown. </p>
<p>back to why Waymo doesn’t release their driveless vehicle yet, cause they don’t have a way to prove their ADS system has zero unsafe unknown situations, and most possiblely the current ADS solution may be reached 80% functions of the final completed fully ADS solution, but that’s even not the turning point for ADS system. </p>
<h2 id="where-to-go"><a href="#where-to-go" class="headerlink" title="where to go?"></a>where to go?</h2><ul>
<li>rule based vs AI based </li>
</ul>
<p>as neither purely rule based nor purely AI based can achieve safety goals, so there are combined ways, but then there need a manager module to decide which should be weighted more in a special situation.</p>
<ul>
<li>a new undeterministic/unpredicted system explaination</li>
</ul>
<p>reinforcement learning is actually a good way to train agents in unpredicted simulation environemnt, but even in simulation, it can’t travel every case in the state space; then to use R.L to train vehicles in real traffic environment with random pedestrains, npcs, situations, which’s impossible so far. </p>
<ul>
<li>a new AI system </li>
</ul>
<p>current AI is still correlation analysis, while human does causal reasoning. </p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="">safety first for automated driving handover to PR</a></p>
<p><a href="https://www.iso.org/standard/70939.html" target="_blank" rel="external">ISO 26262 standard</a></p>
<p><a href="https://hal.archives-ouvertes.fr/hal-01190734/document" target="_blank" rel="external">how to reach complete safety requirement refinement for autonomous vehicle</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/16/cruise-webriz-configure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/16/cruise-webriz-configure/" itemprop="url">cruise webriz configure</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-16T07:09:19-04:00">
                2019-10-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/16/cruise-webriz-configure/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/16/cruise-webriz-configure/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>during ADS development, ros bag is used a lot to record the sensor, CAN and scenario info, which helps in vehicle test, data fusion, perception.<br><a href="https://github.com/cruise-automation/webviz" target="_blank" rel="external">cruise webviz</a> is an open source tool to visualize rosbag and allow user defined layout in web environment, without the pain to run <code>roscore</code> and other ros nodes.</p>
<p>while js is not a common tool in my visibility, the way how an js project is organized is really confused at the first time. there are a punch of new things:</p>
<ul>
<li><a href="https://create-react-app.dev/" target="_blank" rel="external">react</a></li>
<li>[regl]<a href="https://www.giacomodebidda.com/how-to-get-started-with-regl-and-webpack/" target="_blank" rel="external">https://www.giacomodebidda.com/how-to-get-started-with-regl-and-webpack/</a>)</li>
</ul>
<p>and <code>js</code> functions/modules are really patches, they can be pached anywhere in the project, so usually it requires a patch manager(e.g. lerna) to deal with versions, dependencies etc; and bigger there are packages, which is independent function component.</p>
<p>webviz has a few packages, e.g. regl-worldview, webviz-core, which has more than 40 patches(modules) used.</p>
<ul>
<li><p><a href="https://webviz.io/worldview/#/docs/tutorial/introduction" target="_blank" rel="external">cruise:worldview</a></p>
</li>
<li><p><a href="">cruise:webviz core</a></p>
</li>
<li><p><a href="https://github.com/cruise-automation/rosbag.js" target="_blank" rel="external">rosbag.js</a></p>
</li>
</ul>
<h2 id="lerna"><a href="#lerna" class="headerlink" title="lerna"></a>lerna</h2><p><a href="https://github.com/lerna/lerna" target="_blank" rel="external">lerna</a> is an open source tool to manage js project with multi packages.</p>
<ul>
<li><p><code>lerna init</code> will generate <code>lerna.json</code>, which defines the required modules</p>
</li>
<li><p><code>package.json</code> defines useful infomation about the module depencies,  CLI(which give a detail about how things work behind) and project description</p>
</li>
<li><p><code>lerna bootstrap --hoist react</code> will install all required modules in the root folder <code>/node_modules</code>, if doesn’t work well, leading to <code>Can&#39;t Resovle module errors</code>,  may need manually install some.</p>
</li>
</ul>
<h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><p><a href="https://webpack.js.org/guides/getting-started/" target="_blank" rel="external">webpack</a> is an open source tool for js module bundler. </p>
<p><code>webpack.config.js</code>, defines <code>entry</code>, where the compiler start; <code>output</code> , where the compiler end; <code>module</code>, how to deal with each module; <code>plugin</code>, additionaly content post compiliation; <code>resovle.alias</code> define alias for modules.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var path=require(<span class="string">"path"</span>)</div><div class="line"></div><div class="line">module.exports =&#123;</div><div class="line">	entry: &#123; app:[<span class="string">"./app/main.js"</span>] &#125;</div><div class="line">     	output: &#123;path: path.resolve(__dirname, <span class="string">"build"</span>)&#125; </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">npm install webpack-dev-server</div><div class="line"></div><div class="line">npm list | head -n <span class="number">1</span> </div><div class="line"></div><div class="line">webpack-dev-server --inline --hot</div></pre></td></tr></table></figure>
<p>the JS bundle could be loaded from a static HTML page, served with any simple web server. That’s exactly what this /packages/webviz-core/public/index.html file is, which is used for <a href="https://webviz.io/try" target="_blank" rel="external">https://webviz.io/try</a>. The webpack dev server is configured to serve it at /webpack.config.js</p>
<h2 id="npm-commands"><a href="#npm-commands" class="headerlink" title="npm commands"></a>npm commands</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">npm config list </div><div class="line">npm install packages@version.minor [-g] [--save]</div><div class="line">npm uninstall packages </div><div class="line">npm search packages</div><div class="line">npm cache clean --force</div></pre></td></tr></table></figure>
<h2 id="webpack-server"><a href="#webpack-server" class="headerlink" title="webpack-server"></a>webpack-server</h2><p><a href="https://github.com/webpack/docs/wiki/webpack-dev-server" target="_blank" rel="external">webpack-server</a> is a little nodejs Express server. to install it as a CLI tool first, then run it under the webviz project root folder, with optional parameters, e.g.  –host, –port e.t.c</p>
<h2 id="webviz-configure"><a href="#webviz-configure" class="headerlink" title="webviz configure"></a>webviz configure</h2><ul>
<li>npm config set registry <a href="https://r.npm.taobao.org" target="_blank" rel="external">https://r.npm.taobao.org</a></li>
<li>npm install puppeteer –unsafe-perm=true</li>
<li>npm run bootstrap</li>
</ul>
<p>if failed: </p>
<ul>
<li>sudo npm cache  clean –force </li>
<li>npm install -g lerna </li>
<li>npm run bootstrap     </li>
<li>sudo npm install/rebuild node-sass </li>
<li>npm run build</li>
</ul>
<p>if failed, manually installed unresovled modules</p>
<ul>
<li>npm test   </li>
</ul>
<p>if failed based on a few test modules, install then</p>
<ul>
<li>npm install  webpack-dev-server –save </li>
</ul>
<p>webpack-dev-server.js –host IP –port 8085  #under project root</p>
<p>a little hack, by default <code>npm install inter-ui</code> <a href="https://github.com/philipbelesky/inter-ui/tree/master/Inter%20(web" target="_blank" rel="external">phli’s inter-ui</a>), where inside<br><code>webviz/packages/webvix-core/src/styles/fonts.module.scess</code>, it uses: <code>url(&quot;~inter-ui/Inter UI (web)/Inter-UI.var.woff2&quot;) format(&quot;woff2-variations&quot;)</code>, modified this line to: <code>url(&quot;~inter-ui/Inter (web)/Inter.var.woff2&quot;) format(&quot;woff2-variations&quot;)</code></p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://tabbles.net/" target="_blank" rel="external">tabbles</a></p>
<p><a href="https://discourse.ros.org/t/webviz-ros-data-visualization-in-the-browser/9783" target="_blank" rel="external">webviz in ros community</a></p>
<p><a href="https://stackoverflow.com/questions/33272967/how-to-make-the-webpack-dev-server-run-on-port-80-and-on-0-0-0-0-to-make-it-publ" target="_blank" rel="external">access web-server in LAN</a></p>
<p><a href="https://github.com/cruise-automation/webviz/issues/161" target="_blank" rel="external">issue: how to run cruise webviz</a></p>
<p><a href="https://ternaris.com/marv-robotics/" target="_blank" rel="external">Ternaris Marv</a></p>
<p><a href="https://min.io/" target="_blank" rel="external">minio: high performance object storage for AI</a></p>
<p><a href="https://github.com/cruise-automation/webviz/issues/247" target="_blank" rel="external">webviz on remote bag</a></p>
<p><a href="https://github.com/cruise-automation/webviz/issues/118" target="_blank" rel="external">visuaize data from a live server</a></p>
<p><a href="https://stackoverflow.com/questions/22764407/npm-install-goes-to-dead-in-china" target="_blank" rel="external">npm package install in China</a></p>
<p><a href="https://npm.taobao.org/package/cnpm" target="_blank" rel="external">taobao.npm</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/reinforcement-learning-in-nutshell-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/reinforcement-learning-in-nutshell-2/" itemprop="url">reinforcement learning in nutshell-2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T10:30:40-04:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/13/reinforcement-learning-in-nutshell-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/13/reinforcement-learning-in-nutshell-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="function-approximation"><a href="#function-approximation" class="headerlink" title="function approximation"></a>function approximation</h2><p>write the mapping from \<state action=""> pair to value as $ <strong>S</strong> X <strong>A</strong> -&gt; <strong>Q</strong> $.</state></p>
<p>usually <strong>S</strong>, <strong>Q</strong> can be continuous high-dimensional space, and even in discrete state problem. e.g. in GO game, the state space is about 10^170, to store each \<state action=""> pair in a table is almost impossible. a good and approximated way is using a hash map, where input a state, and through this hash map to get its value, which is one step, rather than many steps even with a tree strucutre of the whole state-action/value space.</state></p>
<p>in math, this is called <code>function approximation</code>, it’s very intuitive idea, to fit a function from the sample points; then any point in the space, it can be represented by the function’s paramters, rather than search in all  the sample points, which may be huge; and further as only the function’s parameters is required to store, rather than the whole sample points information, which is really a pleasure.</p>
<h2 id="Deep-Q-Learning"><a href="#Deep-Q-Learning" class="headerlink" title="Deep Q-Learning"></a>Deep Q-Learning</h2><p><a href="https://zjli2013.github.io/2019/09/18/reinforcement-learning-in-nutshell-1/" target="_blank" rel="external">previously in Q-Learning</a>, to update Q(S,A):</p>
<pre><code>$ Q(S,A) &lt;- \delta ( Q(S, A) + R + \gamma ( Q(S&apos;, A&apos;) - Q(S, A))
</code></pre><p>to approximate <code>q(s,a)</code> can use a neural network(NN), the benefit of NN is  to approximate any function to any precise, similar to any <a href="https://zjli2013.github.io/2019/09/29/warm-up-Hilber-space/" target="_blank" rel="external">complete orthonormal sequence</a>, e.g. Fourier Series.</p>
<h3 id="CNN-approximator"><a href="#CNN-approximator" class="headerlink" title="CNN approximator"></a>CNN approximator</h3><p>the input to Q neural network is the eigenvector of state <strong>S</strong>, assuming the action set is finite. the output is action value in <code>state-action-hyperparameter</code>: q(s, a, \theta), </p>
<pre><code>Q(S, A, \theta) ~= Q(S, A)
</code></pre><p><img src="https://img2018.cnblogs.com/blog/1042406/201809/1042406-20180928142605652-445522913.jpg" alt="image"></p>
<p>as the right most section, here assuming the action set is finite, so for each action, there is an output.</p>
<h3 id="experience-replay"><a href="#experience-replay" class="headerlink" title="experience replay"></a>experience replay</h3><p>instead of discarding experiences after one stochastic gradient descent, the agent remembers past expereicnes and learns from them repeatdely, as if the experience has happened again. this allows for greater data efficiency. another reason, as DNN is easily overfitting current episodes, once DNN is overfitted, it’s difficult to produce various experinces. so exprience replay can store experiences including state transitions, rewards, and actions, which are necessary to perform Q learning. </p>
<p>at time <code>t</code>, the agent’s experience <code>e_t</code> is defined as:</p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=e_t&space;=&space;(s_t,&space;a_t,&space;r_{t&plus;1},&space;s_{t&plus;1})" target="_blank"><img src="https://latex.codecogs.com/gif.latex?e_t&space;=&space;(s_t,&space;a_t,&space;r_{t&plus;1},&space;s_{t&plus;1})" title="e_t = (s_t, a_t, r_{t+1}, s_{t+1})"></a></p>
<p>all of agent’s experiences at each time step over all episodes played by the agent are stored in the <code>replay memory</code>. actually, usually the replay memory/buffer set to some finite size limit, namely only store the recent N experiences. and then choose random samples from the replay buffer to train the network.</p>
<p>the key reason here is to break the correction between consecutive samples. if the CNN learned from consecutive samples of experience as they occurred sequentially in the environment, the samples are highly correlated, taking random samples from replay buffer.</p>
<h3 id="target-network"><a href="#target-network" class="headerlink" title="target network"></a>target network</h3><p>use a separate network to estimate the target, this target network has the same architecture as the CNN approximator but with frozen parameters. every T steps(a hyperparameter) the parameters from the Q network are copied to this target network, which leads to more stable training because it keeps the target function fixed(for a while)</p>
<h2 id="go-futher-in-DQN"><a href="#go-futher-in-DQN" class="headerlink" title="go futher in DQN"></a>go futher in DQN</h2><h3 id="Double-DQN"><a href="#Double-DQN" class="headerlink" title="Double DQN"></a>Double DQN</h3><p>here use two networks, the DQN network is for action selection and the target network is for target Q value generation. </p>
<p>the problem comes: how to be sure the best action for the next state is the action with the highest Q-value ? </p>
<h3 id="Prioritized-Replay-DQN"><a href="#Prioritized-Replay-DQN" class="headerlink" title="Prioritized Replay DQN"></a>Prioritized Replay DQN</h3><h3 id="Dueling-DQN"><a href="#Dueling-DQN" class="headerlink" title="Dueling DQN"></a>Dueling DQN</h3><h2 id="yet-a-summary"><a href="#yet-a-summary" class="headerlink" title="yet a summary"></a>yet a summary</h2><p>at the begining of this series, I was thinking to make a simple summary about DQN, which looks promising in self-driving. After almost one month, there are more and more topics and great blogs jumping out, the simple idea to make a summary is not easy any more. I will stop here, and once back.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="http://www.hostmath.com" target="_blank" rel="external">math equation editor</a></p>
<p><a href="https://www.mcs.anl.gov/petsc/" target="_blank" rel="external">Petsc Krylov</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/28223841" target="_blank" rel="external">zhihu: function approximate</a></p>
<p><a href="https://www.dqnbook.com/2/experience-replay" target="_blank" rel="external">dqnbook: experience replay</a></p>
<p><a href="https://towardsdatascience.com/welcome-to-deep-reinforcement-learning-part-1-dqn-c3cab4d41b6b" target="_blank" rel="external">Toward Data Science</a></p>
<p><a href="https://deeplizard.com/learn/video/Bcuj2fTH4_4" target="_blank" rel="external">explained replay memory</a></p>
<p><a href="https://danieltakeshi.github.io/2016/12/01/going-deeper-into-reinforcement-learning-understanding-dqn/" target="_blank" rel="external">going deeper into RL: understanding DQN</a></p>
<p><a href="https://www.freecodecamp.org/news/improvements-in-deep-q-learning-dueling-double-dqn-prioritized-experience-replay-and-fixed-58b130cc5682/" target="_blank" rel="external">improvements in DQN</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/configure-pgAdmin4-in-server-mode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/configure-pgAdmin4-in-server-mode/" itemprop="url">configure pgAdmin4 in server mode</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T06:35:25-04:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/13/configure-pgAdmin4-in-server-mode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/13/configure-pgAdmin4-in-server-mode/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>pgSQL is common used to store hd map in ADS stack, and the client is usually pgAdmin4. in big tech companies, e.g. Tencent, Alibaba, Uber e.t.c, their <code>data infrastructure</code> for ADS stack development is usually based on pgSQL. for our team work, we also store most map info in pgSQL, and for better development toolchain, there is a need to configure the client pgAdmin4 as a web server, rather than request every developer to install a copy of pgAdmin4 at their local side.</p>
<p>in LAN web server, apache2 is used to serve a few services, so there is a need to configure multi virutal host in Aapche2, with differnt port and same IP.</p>
<h2 id="pgSQLServer"><a href="#pgSQLServer" class="headerlink" title="pgSQLServer"></a>pgSQLServer</h2><ul>
<li><p><a href="https://www.postgresql.org/download/linux/ubuntu/" target="_blank" rel="external">official install postgresql</a></p>
</li>
<li><p><a href="https://www.postgresql.org/docs/current/server-start.html" target="_blank" rel="external">start pgSQLserver</a></p>
</li>
<li><p>jump into pgSQL server:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/etc/init.d/postgresql start </div><div class="line"></div><div class="line">sudo su - postgres</div></pre></td></tr></table></figure>
<h2 id="pgAdmin4"><a href="#pgAdmin4" class="headerlink" title="pgAdmin4"></a>pgAdmin4</h2><p>installed by <code>apt-get install pgadmin4</code>, will put pgAdmin4 under local user or root permission, which will be rejected if accessed by remote clients, whose permission is <code>www-data</code></p>
<p>so it’s better to install from src and in a different Python virtual env.</p>
<ul>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-python-3-and-set-up-a-programming-environment-on-an-ubuntu-18-04-server" target="_blank" rel="external">setup Python virtual Env</a></p>
</li>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-configure-pgadmin4-server-mode" target="_blank" rel="external">install pgAdmin4 from src</a></p>
</li>
</ul>
<p>there maybe a few errors as following:</p>
<pre><code>*  No package &apos;libffi&apos; found  

*  error: invalid command &apos;bdist_wheel&apos; [sol](https://stackoverflow.com/questions/34819221/why-is-python-setup-py-saying-invalid-command-bdist-wheel-on-travis-ci)

* error: command &apos;x86_64-linux-gnu-gcc&apos; failed with exit status 1, [sol](https://stackoverflow.com/questions/21530577/fatal-error-python-h-no-such-file-or-directory)
</code></pre><h2 id="configure-pgAdmin4"><a href="#configure-pgAdmin4" class="headerlink" title="configure pgAdmin4"></a>configure pgAdmin4</h2><p>follow <a href="https://www.digitalocean.com/community/tutorials/how-to-install-configure-pgadmin4-server-mode" target="_blank" rel="external">this configure pgadmin4 in Server mode</a></p>
<h2 id="configure-Apache2"><a href="#configure-Apache2" class="headerlink" title="configure Apache2"></a>configure Apache2</h2><p>follow previous blog to set Apache2 for pgadmin4:</p>
<pre><code class="script">&lt;VirtualHost *:8084&gt;
    ServerName 10.20.181.119:8084
    ErrorLog  &quot;/var/www/pgadmin4/logs/error.log&quot;
    WSGIDaemonProcess pgadmin  python-home=/home/david/py_venv/pgenv
    WSGIScriptAlias /pgadmin4 /home/david/py_venv/pgenv/lib/python3.5/site-packages/pgadmin4/pgAdmin4.wsgi

    &lt;Directory &quot;/home/david/py_venv/pgenv/lib/python3.5/site-packages/pgadmin4/&quot;&gt;
        WSGIProcessGroup pgadmin
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
<p>restart Apache2 server will make this works.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://serverfault.com/questions/601140/whats-the-difference-between-sudo-su-postgres-and-sudo-u-postgres" target="_blank" rel="external">why sudo - su</a></p>
<p><a href="https://www.godaddy.com/garage/how-to-install-postgresql-on-ubuntu-14-04/" target="_blank" rel="external">godaddy about sudo - su</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-configure-pgadmin4-server-mode" target="_blank" rel="external">configure pgadmin4 in Server mode</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/13/host-mod-wsgi-in-Apache2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/host-mod-wsgi-in-Apache2/" itemprop="url">host mod_wsgi in Apache2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T06:33:40-04:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/13/host-mod-wsgi-in-Apache2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/13/host-mod-wsgi-in-Apache2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Apache2-Background"><a href="#Apache2-Background" class="headerlink" title="Apache2 Background"></a>Apache2 Background</h2><h3 id="Apache2-virutal-host"><a href="#Apache2-virutal-host" class="headerlink" title="Apache2 virutal host"></a>Apache2 virutal host</h3><ul>
<li>site-available </li>
</ul>
<p>all virtual hosts are configured in individual files with <code>/etc/apache2/sites-available</code> </p>
<ul>
<li>site-enabled </li>
</ul>
<p>until the *.config in site-available are enabled, Apache2 won’t know know.</p>
<pre><code>sudo sevice apache2 reload 
</code></pre><ul>
<li>IP based virtual host </li>
</ul>
<p>use IP address of the connection to determine the correct virtual host to serve, so each host needs a separate IP</p>
<p>we had name-based vhost in LAN, a few web servers sharing the same IP in the same physical machine, but with different Ports, and even we don’t use DNS server to tell the domains. </p>
<h3 id="apache-mode-cores"><a href="#apache-mode-cores" class="headerlink" title="apache mode cores"></a>apache mode cores</h3><p><a href="https://httpd.apache.org/docs/2.4/mod/core.html#servername" target="_blank" rel="external">refer</a></p>
<ul>
<li>VirtualHost </li>
</ul>
<p>the title to define this virutal host, and tell which port to listen. by default is port80</p>
<ul>
<li>ServerName</li>
</ul>
<p>sets the request scheme, hostname, and port that the server uses to identify itself</p>
<ul>
<li>ServerAlias</li>
</ul>
<p>sets the alternate name for a host </p>
<ul>
<li>WSGIDaemonProcess</li>
</ul>
<p>for wsgi app, which usually define in a seperate Python virtual environment, rather than the default localhost user or root. so <code>WSGIDaemonProcess</code> point to the python virtual env. </p>
<ul>
<li>WSGIScriptAlias</li>
</ul>
<p>point to the wsgi_app.wsgi </p>
<ul>
<li>DocumentRoot </li>
</ul>
<p>set the directory from which httpd/apache2 will serve files <code>/var/www/html</code></p>
<h2 id="mod-wsgi"><a href="#mod-wsgi" class="headerlink" title="mod_wsgi"></a>mod_wsgi</h2><ul>
<li>install <code>apt-get install apache2  libapache2-mode-wsgi-py3</code></li>
</ul>
<h3 id="config-in-Apache2"><a href="#config-in-Apache2" class="headerlink" title="config in Apache2"></a>config in Apache2</h3><h4 id="config-with-configure-file"><a href="#config-with-configure-file" class="headerlink" title="config with configure file"></a>config with configure file</h4><ul>
<li>create  example.conf under  /etc/apache2/conf-available/</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;VirtualHost *:8084&gt;</div><div class="line">        ServerName  10.20.181.119:8084</div><div class="line">        ServerAlias example.com</div><div class="line">        DocumentRoot &quot;/var/www/html&quot;</div><div class="line">        ErrorLog &quot;/var/www/example/logs/error.log&quot;</div><div class="line"> </div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
<p>the served web content is stored at <code>/var/www/html</code>, which can simple include a index.html or a few js.</p>
<ul>
<li><p>enable configure, which will create corresponding conf under <code>conf-enable</code> folder</p>
<pre><code>sudo a2enconf example 
</code></pre></li>
<li><p>check configure</p>
<pre><code>sudo apachectl -S 
sudo apachectl configtest 
</code></pre></li>
</ul>
<h4 id="config-with-virtual-host"><a href="#config-with-virtual-host" class="headerlink" title="config with virtual host"></a>config with virtual host</h4><ul>
<li>create <code>example.conf</code> under  <code>/etc/apache2/site-available/</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;VirtualHost *:8085&gt;</div><div class="line">        ServerName  10.20.181.119:8085</div><div class="line">        ServerAlias application.com</div><div class="line">        DocumentRoot &quot;/var/www/wsgy_example&quot;</div><div class="line">        ErrorLog &quot;/var/www/wsgy_example/logs/error.log&quot;</div><div class="line">        WSGIScriptAlias /application /var/www/wsgy_app/application.wsgi</div><div class="line"></div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>here used the additional <code>WSGI script</code>, <a href="https://www.linode.com/docs/web-servers/apache/apache-and-modwsgi-on-ubuntu-14-04-precise-pangolin/" target="_blank" rel="external">link</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import os</div><div class="line">import sys</div><div class="line"></div><div class="line">sys.path.append(&apos;/var/www/wsgy_app/&apos;)</div><div class="line"></div><div class="line">os.environ[&apos;PYTHON_EGG_CACHE&apos;] = &apos;/var/www/wsgy_app/.python-egg&apos;</div><div class="line"></div><div class="line">def application(environ, start_response):</div><div class="line">        status = &apos;200 OK&apos;</div><div class="line">        output = b&apos;Helo World&apos;</div><div class="line"></div><div class="line">        response_headers = [(&apos;Content-type&apos;, &apos;text/plain&apos;),</div><div class="line">                            (&apos;Content-length&apos;, str(len(output)))]</div><div class="line"></div><div class="line">        start_response(status, response_headers)</div><div class="line"></div><div class="line">        return [output]</div></pre></td></tr></table></figure>
<ul>
<li><p>enable configure, which will create corresponding conf under <code>site-enable</code> folder</p>
<pre><code>sudo a2ensite wsgy_example 
</code></pre></li>
<li><p>check configure</p>
<pre><code>sudo apachectl -S 
sudo apachectl configtest 
</code></pre></li>
</ul>
<h3 id="add-multi-ports"><a href="#add-multi-ports" class="headerlink" title="add multi ports:"></a>add multi ports:</h3><p>in /etc/apache2/ports.conf:</p>
<pre><code>Listen 8083
Listen 8084
</code></pre><p>since this Apache server host system_engineering web and pgadmin4 web, and share the same IP.</p>
<h3 id="restart-apache"><a href="#restart-apache" class="headerlink" title="restart apache"></a>restart apache</h3><pre><code>sudo systemctl restart apache2 
</code></pre><h3 id="test-apache"><a href="#test-apache" class="headerlink" title="test apache"></a>test apache</h3><p>in browser:</p>
<pre><code>10.20.181.119:8085/application
</code></pre><p>should view “hello world”</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://httpd.apache.org/docs/2.4/vhosts/name-based.html" target="_blank" rel="external">name based virtual host</a></p>
<p><a href="https://httpd.apache.org/docs/2.4/vhosts/" target="_blank" rel="external">Apache2 virutal host</a></p>
<p><a href="https://serverfault.com/questions/246445/how-do-i-create-virtual-hosts-for-different-ports-on-apache" target="_blank" rel="external">vhost with different ports</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/09/Gitlab-integrated-Jenkins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/09/Gitlab-integrated-Jenkins/" itemprop="url">Gitlab integrated Jenkins</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-09T06:59:28-04:00">
                2019-10-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/10/09/Gitlab-integrated-Jenkins/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/10/09/Gitlab-integrated-Jenkins/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>after built the Gitlab server in LAN for two month, managing about 20 projects in ADS group currently. the needs for CI is coming up. at very beginning, I tried Gitlab CI runner, doesn’t work through. so Jenkins!</p>
<h2 id="Jenkins-installation"><a href="#Jenkins-installation" class="headerlink" title="Jenkins installation"></a>Jenkins installation</h2><p>there is a great series <a href="https://github.com/maxfields2000/dockerjenkins_tutorial" target="_blank" rel="external">Maxfields jekins-docker tutorial</a>, since originally I had Docker env and which is a prepartion for cloud deployment in future.</p>
<ul>
<li><p><a href="https://jenkins.io/doc/book/installing/#debian-ubuntu" target="_blank" rel="external">Jenkins in Docker installation</a>, </p>
</li>
<li><p>start Jenkins in Docker</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --rm -p 8080:8080 -p 50000:50000 -v jenkins-data:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock  jenkinsci/blueocean</div></pre></td></tr></table></figure>
<ul>
<li><a href="https://jenkins.io/doc/book/installing/#setup-wizard" target="_blank" rel="external">setup wizard</a></li>
</ul>
<p>also Jenkins installed directly in <a href="https://linuxize.com/post/how-to-install-jenkins-on-ubuntu-18-04/" target="_blank" rel="external">Ubuntu</a></p>
<h2 id="Jenkins-integrated-with-Gitlab"><a href="#Jenkins-integrated-with-Gitlab" class="headerlink" title="Jenkins integrated with Gitlab"></a>Jenkins integrated with Gitlab</h2><p>Jenkins default has integrated with BitBucket and Github, to integrate with Gitlab:</p>
<ul>
<li>set Gitlab token</li>
</ul>
<p>in Gitlab Project main page, go to <code>User Profile</code> &gt;&gt; <code>Settings</code> &gt;&gt; <code>Peronsal Access Token</code>, naming the token and click <code>api</code> domain, the token is generated. </p>
<ul>
<li>install Gitlab Plugins   </li>
</ul>
<p>in Jenkins main page: <code>Manage Jenkins</code> &gt;&gt; <code>Manage Plugins</code> &gt;&gt; Search Available Plugins (gitlab).</p>
<ul>
<li>add gitlab key credentials </li>
</ul>
<p>in Jenkins main page, go to <code>Credentials</code>, choose the key type to <code>Gitlab API token</code>, then generate the key credential, used to access Gitlab project. </p>
<ul>
<li>configure Jenkins with gitlab</li>
</ul>
<p>in Jenkins main page, go to <code>Manage Jenkins</code> &gt;&gt; <code>Configure System</code>, at the gitlab section, add the gitlab host url and use the credential created at previous step.</p>
<p>since the gitlab server is hosted in LAN, even don’t have DNS for the gitlab server, purely raw IP address. so the gitlab host URL is like:</p>
<pre><code>http://10.20.110.110:80 
</code></pre><p>rather than the project git url (e.g.  <a href="http://10.20.110.110/your_name/your_project.git" target="_blank" rel="external">http://10.20.110.110/your_name/your_project.git</a>)</p>
<h2 id="Gitlab-Hook-Plugin"><a href="#Gitlab-Hook-Plugin" class="headerlink" title="Gitlab Hook Plugin"></a>Gitlab Hook Plugin</h2><p>gitlab events will be post to Jenkins through webhook, which is a common way to notify external serivces, e.g. dingding office chat, JIRA e.t.c. To set it up, need to configure <code>Gitlab Hook</code> plugin in Jenkins.</p>
<p>as mentioned in <a href="https://linuxize.com/post/how-to-install-jenkins-on-ubuntu-18-04/" target="_blank" rel="external">this post</a>, JDK10 or 11 is not supported  for Jenkins, if the current OS system has already JDK11, need addtionally install jdk8, and configure the default jdk=8: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">update-java-alternatives --list </div><div class="line"></div><div class="line">sudo update-alternatives --config java </div><div class="line"></div><div class="line">java -version</div></pre></td></tr></table></figure>
<h2 id="Jenkins-Project"><a href="#Jenkins-Project" class="headerlink" title="Jenkins Project"></a>Jenkins Project</h2><p>add a new Jenkins Item, select <code>FreeStyle</code>, go to <code>Configure</code>.</p>
<p>in <code>Source Code Management</code> section, select <code>Git</code>. add Repository URL and set gitlab username and password as Jenkins Credentials. </p>
<p>in <code>Build Triggers</code> section, select <code>Build when a change is pushed to Gitlab</code>, which display the Gitlab webhook URL: <a href="http://localhost:8080/jenkins/project/demo" target="_blank" rel="external">http://localhost:8080/jenkins/project/demo</a>; go to <code>Adavance</code> section to generate the secret token.</p>
<p>when getting all these done, back to Gitlab project, as Admin or Maintainer, in Project <code>Settings</code> &gt;&gt; <code>Integrations</code> &gt;&gt; <code>Add Webhooks</code>.URL and Secret Token are from the previous settings.</p>
<p>there is a common issue: <strong>Url is blocked: Requests to localhost are not allowed</strong>, please refer to <a href="https://docs.gitlab.com/ee/security/webhooks.html" target="_blank" rel="external">allow request to localhost network from system hooks</a></p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://technology.riotgames.com/news/putting-jenkins-docker-container" target="_blank" rel="external">riot games: putting jenkins in docker</a></p>
<p><a href="https://github.com/jenkinsci/gitlab-plugin#jenkins-to-gitlab-authentication" target="_blank" rel="external">jenkins to gitlab authentication</a></p>
<p><a href="https://emilwypych.com/emil-wypych/" target="_blank" rel="external">devops expert: Emil</a></p>
<p><a href="https://www.mindtheproduct.com/what-the-hell-are-ci-cd-and-devops-a-cheatsheet-for-the-rest-of-us/" target="_blank" rel="external">mind the product: PM’s guide to CD &amp; DevOps</a><br><a href="https://www.oodlestechnologies.com/blogs/Managing-Multiple-version-of-JDK-on-Ubuntu/" target="_blank" rel="external">manage multi version of JDK on Ubuntu</a></p>
<p><a href="https://www.jianshu.com/p/7dd79e6c0ac5" target="_blank" rel="external">a jianshu refer</a></p>
<p><a href="https://yq.aliyun.com/articles/659876" target="_blank" rel="external">a aliyun refer</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1465854" target="_blank" rel="external">tencent refer</a></p>
<p><a href="https://docs.gitlab.com/ee/security/webhooks.html" target="_blank" rel="external">allow request to localhost network from system hooks</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/29/warm-up-Hilber-space/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/warm-up-Hilber-space/" itemprop="url">warm up Hilber space</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T10:39:22-04:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/29/warm-up-Hilber-space/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/09/29/warm-up-Hilber-space/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="abstract-space"><a href="#abstract-space" class="headerlink" title="abstract space"></a>abstract space</h2><ul>
<li>Cauchy Series</li>
</ul>
<p>in metric space, existing an any positive and small \etta, exist a natural number <code>N</code>, $m, n &gt; N$, which satisfies:</p>
<p><img src="https://latex.codecogs.com/gif.latex?|x_m&space;-&space;x_n|&space;<&space;\varepsilon" title="|x_m - x_n| < \varepsilon"></p>
<p>it’s called a Cauchy Series. intuitively, as the numbers goes above, the elements get closer. </p>
<ul>
<li>Complete Space </li>
</ul>
<p>any Caunchy Series in these abstract space, its convergence is still in the original space. </p>
<p>e.g. rational number space is not complete space, as <img src="https://latex.codecogs.com/gif.latex?\sqrt{2}" title="\sqrt{2}"> is not in rational number space anymore. </p>
<p>intuitively, a complete space is like a shell without any holes on its surface. </p>
<ul>
<li>Linear Space </li>
</ul>
<p>with linear structural set, which can be described by <code>base vector</code>, so any hyper-point in a linear space can be represented by the linear combination of its <code>base</code>, so also called as <code>vector space</code>. in another way, linear space has only <code>add</code> and <code>scalar multi</code> operator.</p>
<ul>
<li>Metric Space </li>
</ul>
<p>to describe length or distance in linear space, adding  <code>normal</code> in the linear space, gives <code>normed linear space</code> or <code>metric space</code>.</p>
<ul>
<li>Banach Space</li>
</ul>
<p>a complete metric space</p>
<ul>
<li>Inner Product Space </li>
</ul>
<p>with <code>inner product</code> feature in metric space. for the infinite space, there are two different sub space, either the inner product of the series converged or not. </p>
<p>the convergence sub space is a completed space. </p>
<ul>
<li>Hilbert Space</li>
</ul>
<p>a completed inner product space</p>
<ul>
<li>Eurepean Space</li>
</ul>
<p>a finite  Hilbert Space. </p>
<h2 id="functional-analysis"><a href="#functional-analysis" class="headerlink" title="functional analysis"></a>functional analysis</h2><p>the optimzed control theory problem, is to find the functional, under system dynamic constraints, which gives the extremum point(function) in the infinite normed linear space; in general.</p>
<p>in general, the functional is depends on the system dynamic path, which gives some famuous theorem: Banach fixed point. </p>
<p>PDE theory, partial geometry, optimized control theory are all part of functional analysis. from computational mechanics field, there is a chance go to PDE theory; from modern control field, there is a chance go to optimized control theory; from modern physics field, the students may also get familiar with partial geometry. the beauty of math is show up, all these big concepts finally arrive to one source:  functional analysis. </p>
<p>to transfer all these big things into numerial world, which gives CAE solver, DQN solvers e.t.c.</p>
<h3 id="the-closest-point-property-of-Hilbert-Space"><a href="#the-closest-point-property-of-Hilbert-Space" class="headerlink" title="the closest point property of Hilbert Space"></a>the closest point property of Hilbert Space</h3><p>A subset of <code>A</code> of a vector space is <strong>convex</strong>: if for all a, b belongs to <code>A</code>, all \lamba such that <code>0 &lt; \lamba &lt; 1</code>, the point <img src="https://latex.codecogs.com/gif.latex?\lambda&space;a&space;&plus;&space;(1-\lambda)&space;b" title="\lambda a + (1-\lambda) b"> belongs to <code>A</code></p>
<p>assuming <code>A</code> is non-empty closed convex set in Hilbert Space <code>H</code>, for any x belongs to <code>H</code>, there is a unique point <code>y</code> of <code>A</code> which is closer to x than any ohter point of <code>A</code>:</p>
<p><img src="https://latex.codecogs.com/gif.latex?||&space;x&space;-&space;y&space;||&space;=&space;{R}_{a&space;\sphericalangle&space;R}&space;||&space;x&space;-&space;a||" title="|| x - y || = {R}_{a \sphericalangle R} || x - a||"></p>
<h3 id="orthogonal-expansions"><a href="#orthogonal-expansions" class="headerlink" title="orthogonal expansions"></a>orthogonal expansions</h3><p>if (e_n) is an orthonormal sequence in a Hilbert space <code>H</code>, for any x belongs to <code>H</code>, (x, e_n) is the nth Fourier coefficient of x with respect to (e_n), the Fourier series of x with respect to the sequence (e_n) is the series: </p>
<p><img src="https://latex.codecogs.com/gif.latex?\sum_i(x,&space;e_i)e_i" title="\sum_i(x, e_i)e_i"></p>
<ul>
<li>pointwise converges</li>
</ul>
<p><img src="https://latex.codecogs.com/gif.latex?\sum_{n=1}^{\infty&space;}&space;f_n(t)&space;=&space;f(t)" title="\sum_{n=1}^{\infty } f_n(t) = f(t)"></p>
<p>where <code>f_n</code>is a sequence of functions in <img src="https://latex.codecogs.com/gif.latex?L^2(0,1)" title="L^2(0,1)"></p>
<ul>
<li>complete orthonormal sequence </li>
</ul>
<p>given an orthonormal sequence of (e_n) and a vector <code>x</code> belongs to <code>H</code> then:</p>
<p><img src="https://latex.codecogs.com/gif.latex?x&space;=&space;\sum_{n=1}^{\infty&space;}&space;(x,&space;e_n)&space;e_n" title="x = \sum_{n=1}^{\infty } (x, e_n) e_n"></p>
<p>but only when this sequence is complete, the right-hand side converge to  left-hand side workks.</p>
<p>an orthonormal sequence (e_n) in Hilbert Space <code>H</code> is complete if the only member of <code>H</code> which is orthogonal to every e_n is the zero vector.</p>
<p>a complete orthonal sequence in <code>H</code> is also called an <code>orthonormal basis</code> of <code>H</code>.</p>
<p><code>H</code> is separable if it contains a complete orthonormal sequence, </p>
<p>the orthogonal complement (which named as E^T) of a subset <code>E</code> of <code>H</code> is the set:</p>
<p><img src="https://latex.codecogs.com/gif.latex?{&space;x&space;\in&space;H:&space;(x,&space;y)&space;=&space;0&space;for&space;all&space;y&space;\in&space;E}" title="{ x \in H: (x, y) = 0 for all y \in E}"></p>
<p>for any set <code>E</code> in <code>H</code>, <code>E^T</code> is a closed linear subspace of <code>H</code>.</p>
<p>the knowledge above gives the convergence in Hilbert Space, application like FEA, once created the orthonormal basis of solution space, the solution function represented by the linear combination of these basis is guranted to convergence. </p>
<h3 id="Fourier-series"><a href="#Fourier-series" class="headerlink" title="Fourier series"></a>Fourier series</h3><p>it is a complete orthonormal sequence in <code>L^2(-\pi, \pi)</code>, and any function represented by a linear combination of Fourier basis is converged. </p>
<p>but here Fourier basis is the arithmetic means of the nth partial sum of the Fourier series of f, not the direct basis itself. </p>
<h3 id="Dual-space"><a href="#Dual-space" class="headerlink" title="Dual space"></a>Dual space</h3><h3 id="FEA-solutions-for-PDE"><a href="#FEA-solutions-for-PDE" class="headerlink" title="FEA solutions for PDE"></a>FEA solutions for PDE</h3><p>PDE can be represented in a differential representation:</p>
<p><img src="https://latex.codecogs.com/gif.latex?\bigtriangledown&space;\cdot&space;(-k&space;\bigtriangledown&space;T)&space;=&space;g(T,&space;x)&space;,&space;in&space;\Omega" title="\bigtriangledown \cdot (-k \bigtriangledown T) = g(T, x) , in \Omega"></p>
<p>or an integral representation: </p>
<p><img src="https://latex.codecogs.com/gif.latex?\int_{\Omega}{&space;\bigtriangledown&space;\cdot&space;(-k&space;\bigtriangledown&space;T)}&space;=\int_{\Omega}&space;g(T,&space;x)&space;,&space;in&space;\Omega" title="\int_{\Omega}{ \bigtriangledown \cdot (-k \bigtriangledown T)} =\int_{\Omega} g(T, x) , in \Omega"></p>
<p>integral formulation has included existing boundary conditions. by multiplying test function <code>\phi</code> on both side of integral representation, and using Green’s first identity will give the weak formulation(variational formulation) of this PDE.</p>
<p><img src="https://latex.codecogs.com/gif.latex?\int_{\Omega}&space;\bigtriangledown&space;T&space;\cdot&space;\bigtriangledown&space;\varphi&space;dV&space;&plus;&space;\int_{S}&space;(-k&space;\bigtriangledown&space;T)&space;\cdot&space;\mathbf{n}&space;\varphi&space;dS&space;=&space;\int_{\Omega}&space;g&space;\varphi&space;dV" title="\int_{\Omega} \bigtriangledown T \cdot \bigtriangledown \varphi dV + \int_{S} (-k \bigtriangledown T) \cdot \mathbf{n} \varphi dS = \int_{\Omega} g \varphi dV"></p>
<p>in FEA, assuming the test function <code>\phi</code> and solution <code>T</code> belong to same Hilbert space, the advantage of Hilbert space, is functions inside can do linear combination, like vectors in a vector space. FEA also provides the error estimates, or bounds for the error. </p>
<p><img src="https://latex.codecogs.com/gif.latex?\phi&space;\in&space;H&space;;&space;T&space;\in&space;H" title="\phi \in H ; T \in H"></p>
<p>the weak formulation should be obtained by all test functions in Hilbert space. this is <code>weak formulation</code> due to now it doesn’t exactly requries all points in the domain need meet the differential representation of the PDE, but in a integral sense. so even a discontinuity of first derivative of solution <code>T</code> still works by weak formulation. </p>
<h3 id="Hilbert-space-and-weak-convergence"><a href="#Hilbert-space-and-weak-convergence" class="headerlink" title="Hilbert space and weak convergence"></a>Hilbert space and weak convergence</h3><p>convergence in another words means, the existence of solution. for CAE, DQN algorithms, the solution space is in Hilbert space. </p>
<h3 id="Lagrange-and-its-duality"><a href="#Lagrange-and-its-duality" class="headerlink" title="Lagrange and its duality"></a>Lagrange and its duality</h3><p>to transfer a general convex optimization problem with lagrange mulitplier:</p>
<p><img src="https://latex.codecogs.com/gif.latex?min&space;f(x)&space;\\&space;s.t.&space;c_i(x)&space;<=&space;0&space;\\&space;h_j(x)&space;=&space;0" title="min f(x) \\ s.t. c_i(x) <= 0 \\ h_j(x) = 0"></p>
<p>=&gt;</p>
<p><img src="https://latex.codecogs.com/gif.latex?L(x,&space;\alpha,&space;\beta)&space;=&space;f(x)&space;&plus;&space;\sum&space;\alpha_i&space;c_i(x)&space;\sum&space;\beta_j&space;h_j(x)" title="L(x, \alpha, \beta) = f(x) + \sum \alpha_i c_i(x) \sum \beta_j h_j(x)"></p>
<p>we always looks for meaning solution, so <code>L</code> should exist maximum extremum. if not, as <code>x</code> grow, the system goes divergence, no meaningful solution. define:</p>
<p><img src="https://latex.codecogs.com/gif.latex?\theta_P(x)&space;=&space;max_{\alpha,&space;\beta&space;\geq&space;0}&space;L(x,&space;\alpha,&space;\beta)" title="\theta_P(x) = max_{\alpha, \beta \geq 0} L(x, \alpha, \beta)"></p>
<p>so the constrainted system equation equals to :</p>
<p><img src="https://latex.codecogs.com/gif.latex?min_x&space;\theta_P(x)&space;=&space;min_x&space;max_{\alpha,&space;\beta&space;\geq&space;0}&space;L(x,&space;\alpha,&space;\beta)" title="min_x \theta_P(x) = min_x max_{\alpha, \beta \geq 0} L(x, \alpha, \beta)"></p>
<p>to rewrite the original equation as: </p>
<p><img src="https://latex.codecogs.com/gif.latex?\theta_D(\alpha,&space;\beta)=&space;min_x&space;L(x,&space;\alpha,&space;\beta)" title="\theta_D(\alpha, \beta)= min_x L(x, \alpha, \beta)"></p>
<p>then the system’s duality is defined as :</p>
<p><img src="https://latex.codecogs.com/gif.latex?max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;\theta_D(\alpha,&space;\beta)=&space;max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;min_x&space;L(x,&space;\alpha,&space;\beta)" title="max_{\alpha, \beta \geqslant 0} \theta_D(\alpha, \beta)= max_{\alpha, \beta \geqslant 0} min_x L(x, \alpha, \beta)"></p>
<p>for a system, if the original state equation and its duality equation both exist extremum solution, then :</p>
<p><img src="https://latex.codecogs.com/gif.latex?d^*&space;=&space;max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;min_x&space;L(x,&space;\alpha,&space;\beta)&space;\leqslant&space;min_x&space;max_{\alpha,&space;\beta&space;\geqslant&space;0}&space;L(x,&space;\alpha,&space;\beta)&space;=&space;p^*" title="d^* = max_{\alpha, \beta \geqslant 0} min_x L(x, \alpha, \beta) \leqslant min_x max_{\alpha, \beta \geqslant 0} L(x, \alpha, \beta) = p^*"></p>
<p>the benefits of duality problems is </p>
<ul>
<li><p>the duality problem is always convex,  even when the original problem is non-convex </p>
</li>
<li><p>the duality solution give an lower boundary for the original solution</p>
</li>
<li><p>when strong duality satisfy, the duality solution is the original solution</p>
</li>
</ul>
<h3 id="Krylov-Space"><a href="#Krylov-Space" class="headerlink" title="Krylov Space"></a>Krylov Space</h3><h3 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h3><p><a href="https://zhuanlan.zhihu.com/p/37108430" target="_blank" rel="external">convex func</a></p>
<p><a href="https://www.comsol.com/multiphysics/finite-element-method" target="_blank" rel="external">finite element method</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/38182879" target="_blank" rel="external">Lagranget duality</a></p>
<p><a href="https://web.stanford.edu/~boyd/cvxbook/bv_cvxbook.pdf" target="_blank" rel="external">standford convex optimization</a></p>
<p><a href="https://danieltakeshi.github.io/2016/10/31/going-deeper-into-reinforcement-learning-understanding-q-learning-and-linear-function-approximation/" target="_blank" rel="external">Going deeper into RF: understaing Q-learning and linear function approximation</a></p>
<p><a href="">Nicholas Young, an introduction to Hilbert Space</a></p>
<p><a href="https://www.quora.com/Why-are-Hilbert-spaces-important-for-finite-element-analysis" target="_blank" rel="external">why are Hilbert Space important to finite element analysis</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">161</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
