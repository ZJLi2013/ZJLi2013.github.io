<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/page/16/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/16/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/12/vehicle-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/12/vehicle-network/" itemprop="url">vehicle network</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-12T17:55:12-04:00">
                2018-07-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/12/vehicle-network/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/12/vehicle-network/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>vehicle networ is what connects the different parts together as a vehile. </p>
<h2 id="the-lower-level-basic"><a href="#the-lower-level-basic" class="headerlink" title="the lower-level basic"></a>the lower-level basic</h2><p>A few basic concepts:  TCP/UDP socket, CAN Bus, Ethernet, MCU register, Ip address, MAC address, Ethernet driver, network configure, how to code a ECU/MCU etc. </p>
<p>there are EE students working on this close to physical level implementation, on how to talk with register, MCU pins and controls, and some implementing the data traffic protocol in network. While both are isolated from top applications, since no matter where the data come from, either AV application or connected vehicle or media data, doesn’t make a difference.  </p>
<h2 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h2><p> <a href="https://autoelectricalsystems.wordpress.com/2015/11/07/typical-vehicle-network-architecture/" target="_blank" rel="external">typical vehicle network architecture</a></p>
<p>beyond the basic, network architecture brings a good vision to understand what makes a vehicle electronicly as a whole. and which is serving all apps with v2x, in-vehicle entertainment, AV.</p>
<p>I was thought ECU handling events the same as web server. while they are very different. each ECU is doing only one special task. e.g. ABS ECU only dealing with ABS events, there are no many ABS events happening simultaneously to seize the ECU computing resource; however, a web server have to deal with multiplex request simultaneously, either using thread pool or asynchronous event callbacks. </p>
<p>each ECU actually has an easy life, but the bus seems easily choked since around 100+ ECU nodes in the vehicle network. however again, typical vehicle network architecture is very matured products, without data-heavy applications arising, current CAN bus is great.</p>
<h2 id="smart-phone-in-wheels"><a href="#smart-phone-in-wheels" class="headerlink" title="smart phone in wheels?"></a>smart phone in wheels?</h2><p>one day in future, every vehicle running on road is requesting some data from cloud seamlessly, the scenario is like billions of browsers send requests to Google server seamlessly, then the cloud may face same issues in today’s web server. </p>
<p>Service oriented architecture(SOA) is also rising in vehicle network architeture design, but what kind of services is better locally in vehicle, and which services in cloud ? as hardwares evolution, even the computing-heavy tasks, e.g. vision based detection, path planning in AV, suppose not be a burden for local ECUs. so these services make sense locally served.  </p>
<p>except that, I only image future vehicle as a smart phone on wheels. so remote cloud server do connect to, e.g. talk to another vehicle, play online game during driving, check weather, find out a parking lot, resturant or similar, or the car company want to steal user data privately? </p>
<p>SOA is a good move to decouple ECU modules and make the network bus light, and it’s fun to try some vehicle network architecture open project or play with ROS simulator if hardware required. but in a business view, I don’t know a good story to attract investors, namely vehicle network sounds not that blinking amazing.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/29/gnu-make/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/29/gnu-make/" itemprop="url">gnu-make</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-29T17:45:40-04:00">
                2018-06-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/29/gnu-make/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/29/gnu-make/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> websocket projects recently reviewed: <a href="https://github.com/uNetworking/uWebSockets" target="_blank" rel="external">uWebSocket</a>, which is used in Udacity self-driving car term2 projects. the other is <a href="https://github.com/warmcat/libwebsockets" target="_blank" rel="external">libwebsocket</a>, which is used in <a href="https://github.com/otcshare/automotive-message-broker/tree/master/ambd" target="_blank" rel="external">automotive message broker</a>(amb). </p>
<h2 id="gcc-compiler-options"><a href="#gcc-compiler-options" class="headerlink" title="gcc compiler options"></a>gcc compiler options</h2><p><a href="https://www3.ntu.edu.sg/home/ehchua/programming/cpp/gcc_make.html" target="_blank" rel="external">gcc and make:  a tutorial on how to compile, link and build c/c++ projects</a></p>
<pre><code>-wall : print all warning messages 
-c : compile into object, by default the object has same name as the source file
-o : specify the output executable filename
</code></pre><h2 id="headers-h-static-libs-lib-a-amp-shared-libs-dll-so"><a href="#headers-h-static-libs-lib-a-amp-shared-libs-dll-so" class="headerlink" title="headers(.h), static libs(.lib, .a) &amp; shared libs(.dll, .so)"></a>headers(.h), static libs(.lib, .a) &amp; shared libs(.dll, .so)</h2><p>gcc by default, links to the shared libraries if available.</p>
<p>the compiler search “include-paths” for headers, which is specified via -L\<dir\> option or CPATH; </dir\></p>
<p>the linker search “library-paths” to link the program into an executable object, which is specified via -L\<dir\> or LIBRARY_PATH, in addition, need to specify the library name via -l<name></name></dir\></p>
<p>the system default “include-paths” can be found by “cpp -v”</p>
<h2 id="gcc-environment-variables"><a href="#gcc-environment-variables" class="headerlink" title="gcc environment variables"></a>gcc environment variables</h2><p>PATH is used to search executable and run-time shared libs. (woo, this suppose to replace LD-LIBRARY-PATH)<br>CPATH is used to search “include-paths”, it’s searched after paths specified in -I&lt;dir> options. C_INCLUDE_PATH &amp; CPLUS_INCLUDE_PATH can be used to specify C &amp; C++ headers<br>LIBRARY_PATH is used to search linking-time “library-paths”, it’s searched after paths specified in -L\<dir\> options. the standard directories is  /usr/lib </dir\></p>
<h2 id="Linux-utils"><a href="#Linux-utils" class="headerlink" title="Linux utils"></a>Linux utils</h2><p>1) readelf: read <a href="https://amir.rachum.com/blog/2016/09/17/shared-libraries/" target="_blank" rel="external">ELF</a> </p>
<p>2) ldconfig : by default, read /etc/ls.so.conf, sets up the appropirate symbolic links in the dynamic link dir, and then write a cache to /etc/ld.so.cache, which then is used by other programs</p>
<p>3) ldd: to see recursive shared library dependencies</p>
<p>4) file: determine file type </p>
<p>5) nm: list symbol table of an object file, commonly-used to check if a particular func or variable is defined in an object file. “T” indicates   it is defined; “U” means undefined, which should be resolved by the linker.</p>
<h2 id="make-amp-cmake"><a href="#make-amp-cmake" class="headerlink" title="make &amp; cmake"></a>make &amp; cmake</h2><p>[gnu make] (<a href="https://www.gnu.org/software/make/manual/html_node/index.html#SEC_Contents" target="_blank" rel="external">https://www.gnu.org/software/make/manual/html_node/index.html#SEC_Contents</a>) </p>
<p>there are many best practical, e.g. <a href="https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1" target="_blank" rel="external">effective cmake</a></p>
<h2 id="build-libuv"><a href="#build-libuv" class="headerlink" title="build libuv"></a>build libuv</h2><p>it’s built based on GNU autotools</p>
<pre><code>sh autogen.sh  
&quot;libtoolize: AC_CONFIG_MACRO_DIR([m4]) conflicts with ACLOCAL_AMFLAGS=-I m4&quot;
</code></pre><p><a href="https://pete.akeo.ie/2010/12/that-darn-libtoolize-acconfigmacrodirm4.html" target="_blank" rel="external">fixing-solution</a>, then make all &amp; make install, so here is libuv.so, add the directory to \$LIBRARY_PATH in ~/.bashrc </p>
<h2 id="build-uWebSockets"><a href="#build-uWebSockets" class="headerlink" title="build uWebSockets"></a>build uWebSockets</h2><p>it’s built based on gnu make. the tests command has dependents on libuv. since already added libuv directory to \$LIBRARY_PATH, run through. if else, errors output:</p>
<pre><code>cannot find -luv
collect2: error: ld returned 1 exit status
Makefile:xx recipe for targe &apos;tests&apos; failed    
make: *** [tests] Error 1 
</code></pre><p>try to run ./testsBin, get another error:</p>
<pre><code>error while loading shared libraries: libuWS.so: cannot open shared object file: No such file or directory 
</code></pre><p>that’s run-time error, since libuWS.so is not included in \$PATH or speically for building/testing purpose, define $LD_LIBRARY_PATH. </p>
<h2 id="build-libwebsockets"><a href="#build-libwebsockets" class="headerlink" title="build libwebsockets"></a>build libwebsockets</h2><p>it’s built based on cmake. there is some dependent, but should go through well.</p>
<h2 id="beyond-the-note"><a href="#beyond-the-note" class="headerlink" title="beyond the note"></a>beyond the note</h2><p>when 2-months ago, looking at amb project, which has websocket plugin module, then find uWebSocket lib, during reading this tiny lib, where libuv APIs are highly-used, and soon found out libuv is actually the event-loop in nodejs. Woo, somehow they are related.</p>
<p>build tools are highly used in each project, but prior experience is more done by luck.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/25/career-thoughts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/25/career-thoughts/" itemprop="url">career thoughts</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-25T16:49:59-04:00">
                2018-06-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/25/career-thoughts/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/25/career-thoughts/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="product-data-managment"><a href="#product-data-managment" class="headerlink" title="product data managment"></a>product data managment</h2><p>an interesting meeting with material research group, these guys have some IT needs, but does’nt reach there. e.g. there are plenty of material fatigue data, including metadata, tables, S-N plots, so how to organize/manage them? one solution is from MSC Material Center[<a href="http://www.mscsoftware.com/news/msc-software-reinvents-materials-lifecycle-management-materialcenter" target="_blank" rel="external">http://www.mscsoftware.com/news/msc-software-reinvents-materials-lifecycle-management-materialcenter</a>]</p>
<p>what triggered me is “data management” in general. In manufacturing industry, like automotive, many old style data used and storied in different departments, e.g. the material property data, load time history data for CAE department, the vehicle diagnostic logging data in vehcile control department, the vehicle dynamics records in vehicle test department. but neither are well-structured nor easy to track.</p>
<p>two fields so far:  data dashboard, requires data visulization and data mining; product lifecycle management, it’s a product driven, and may also have data dashboard needs. currently as I see, most data analysis is in bussiness driven view, not in product itself. how to accelerate product iteration through better using history products data suppose to be a big thing. </p>
<p>on another side, industry data management is a little different than bussiness/market data. e.g. every year Ford releases a new F-150 truck, does it start out of new? no, the 2018 mois stly iterate by the 2017. so there is product data management, just managed through all component departments. </p>
<p>maybe the questions should ask is: 1 do we get the most value from these whole product level data? 2 how to make special data manageble at subsystem level? it needs more experience in the whole process, but bring some thoughts in next career: PLM software and data management in special domain, e.g. material datacenter product. </p>
<h2 id="cloud-CAE"><a href="#cloud-CAE" class="headerlink" title="cloud CAE"></a>cloud CAE</h2><p>since dashboard is so popluar to migrate the traditional software GUI to web/mobile app; and CAE solver can deployed in cloud, which is a better stronger reason to do user-side dashboard: with job submission, job status, and result plot/visulization sections.</p>
<p>but why is it necessary to migrate CAE solvers in cloud? why the manufacturing product companines would like to share their prodcuts data with cloud providers? </p>
<p>turn one step back, the most obvious reason is whenever internet is needed, e.g. communication among different end-users, cloud is good chonice; and for startup companies, who can’t afford to run jobs locally, have to migrate their calculation in cloud. </p>
<p>I am kind of curious who is using AWS? Netflix, BMW, Autodesk! I was so suprised at first, how BMW and Autodesk would like to use AWS? anyway Netflix is data-flow based company, the core business is client-server communication, which make sense to use AWS. </p>
<p>while BMW is using AWS for new business: connected service, all a sudden it makes sense. the car product business won’t be shared with AWS, but cloud is required as infrastructure for v2x connected service. that’s amazing.</p>
<p>AutoDesk say a different story in cloud, since they sell CAD softwares,  few people want to buy and own an expensive software but choose to pay for the service, by all meaning, this is not a new business, but AWS offer a mature channel.</p>
<p>even though, cloud providers say they are cost-reducing, high-scalability, but I don’t think manufacturing companies will buy it due to security,  instead they maintain their own clusters and share limited business in cloud.</p>
<p>so standing in manufacturing industry, it’s better to figure out new services, which require communications through cloud, than migrate CAE solvers to cloud. that’s my second point.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/20/muduo3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/20/muduo3/" itemprop="url">muduo 3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-20T17:17:33-04:00">
                2018-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/20/muduo3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/20/muduo3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>one concern yesterday: does each worker thread call loop() and run the whole active channels callback ?</p>
<p>suppose no. let’s track the process :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">tcpServer.start() -&gt;</div><div class="line">	threadPool.start() -&gt;</div><div class="line">		<span class="keyword">new</span> EventLoopThread(eventLoopThread::threadFunc, threadName)</div><div class="line">		eventLoopThread-&gt;startLoop() -&gt;</div><div class="line">	   		thread.start() -&gt; detail::startThread() -&gt; </div><div class="line">	   		runInThread()::func_()</div></pre></td></tr></table></figure>
<p>the real func_ during creating new eventLoopThread, is threadFunc(), in which call loop.loop().</p>
<p>first, this loop object is created inside this new eventLoopThread object, no issue that the loop.threadId_ is current threadID. </p>
<p>when multiple worker threads exist, what happens ?</p>
<table>
<thead>
<tr>
<th>threads</th>
<th style="text-align:center">A</th>
<th style="text-align:center">B</th>
<th style="text-align:right">C</th>
</tr>
</thead>
<tbody>
<tr>
<td>conns</td>
<td style="text-align:center">T1</td>
<td style="text-align:center">T2</td>
<td style="text-align:right">T3</td>
</tr>
</tbody>
</table>
<p>suppose T1 is assigend to worker thread A, etc. when calling  eventLoopThread A.loop(),  epoll_wait() is first called and return number of active events, epoll_wait() is thread-safe, no worry.</p>
<p>then activeChannels:HandleEvents() is called. the real executor of this handleEvents is in the TcpConnection objects, namely: T1 or T2 or T3.</p>
<p>each TcpConnection object has its own loop-, and only the worker thread with the same loop- can execute the events. so even though threadA get the list of all active events, but only events in T1 conenction will be executed by threadA.</p>
<p>so we can see, in per (worker) thread per epoll, each (worker) epoll looks like only return the active channels/events in current worker thread’s eventLoop. There is no conflict among multiple worker threads, since each worker threas has its own eventLoop. </p>
<h2 id="how-about-eventLoop-in-server-client"><a href="#how-about-eventLoop-in-server-client" class="headerlink" title="how about eventLoop in server/client"></a>how about eventLoop in server/client</h2><p>the eventLoopThread is kind of triggered inside Muduo, where is Tcp server/client eventLoop triggered ? from outsiders.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/19/muduo2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/19/muduo2/" itemprop="url">moduo 2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-19T22:16:11-04:00">
                2018-06-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/19/muduo2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/19/muduo2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The several classes defined in Moduo: TcpServer,  Acceptor, TcpConnection, EventLoop, epoller, channel, eventLoopThread, eventLoopThreadPool.</p>
<h2 id="1-TcpServer-construction"><a href="#1-TcpServer-construction" class="headerlink" title="1) TcpServer construction"></a>1) TcpServer construction</h2><p>each TcpServer suppose have multi- tcp connections, the acceptor works as the main I/O thread, which listen the server-side I/O socket, and handle all client input connections at first, (later will assign the connection task to each worker thread from pool). so the input argument “loop” during TcpServer construction is the main I/O eventLoop. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">TcpServer::TcpServer(EventLoop* loop,</div><div class="line">                     <span class="keyword">const</span> InetAddress&amp; listenAddr,</div><div class="line">                     <span class="keyword">const</span> <span class="built_in">string</span>&amp; nameArg,</div><div class="line">                     Option option)</div><div class="line">  : loop_(CHECK_NOTNULL(loop)),	                  ipPort_(listenAddr.toIpPort()),</div><div class="line">    name_(nameArg),</div><div class="line">    acceptor_(<span class="keyword">new</span> Acceptor(loop, listenAddr, option == kReusePort)),</div><div class="line">    threadPool_(<span class="keyword">new</span> EventLoopThreadPool(loop, name_)),		    connectionCallback_(defaultConnectionCallback),</div><div class="line">    messageCallback_(defaultMessageCallback),</div><div class="line">    nextConnId_(<span class="number">1</span>)</div><div class="line">&#123;</div><div class="line">  acceptor_-&gt;setNewConnectionCallback(</div><div class="line">      boost::bind(&amp;TcpServer::newConnection, <span class="keyword">this</span>, _1, _2));</div><div class="line">&#125;</div><div class="line"></div><div class="line">``` </div><div class="line"></div><div class="line">one advantage of bind/callback is to <span class="keyword">import</span> functors to different <span class="class"><span class="keyword">class</span> <span class="title">domain</span>. <span class="title">and</span> <span class="title">server</span> <span class="title">has</span> <span class="title">always</span> <span class="title">one</span> <span class="title">I</span>/<span class="title">O</span> <span class="title">socket</span>, <span class="title">but</span> <span class="title">client</span>-<span class="title">socket</span>-<span class="title">fd</span> <span class="title">suppose</span> <span class="title">be</span> <span class="title">a</span> <span class="title">lot</span>. </span></div><div class="line"></div><div class="line">## 2) <span class="title">TcpServer</span> <span class="title">newConnection</span></div><div class="line"><span class="title">Each</span> <span class="title">new</span> <span class="title">tcp</span> <span class="title">connection</span>, <span class="title">will</span> <span class="title">assign</span> <span class="title">a</span> <span class="title">worker</span> <span class="title">thread</span> <span class="title">to</span> <span class="title">execute</span> <span class="title">the</span> <span class="title">speical</span> <span class="title">callback</span> <span class="title">functor</span> <span class="title">for</span> <span class="title">this</span> <span class="title">new</span> <span class="title">connection</span>, <span class="title">How</span> <span class="title">to</span> <span class="title">schedule</span> <span class="title">thread</span> <span class="title">in</span> <span class="title">threadpool</span> <span class="title">is</span> <span class="title">implemented</span> <span class="title">by</span> <span class="title">round</span>-<span class="title">robin</span>, <span class="title">which</span> <span class="title">are</span> <span class="title">implemented</span> <span class="title">as</span>:</div><div class="line"></div><div class="line">```c</div><div class="line">ioLoop-&gt;runInLoop(boost::bind(&amp;TcpConnection::connectEstablished, conn));  </div><div class="line">EventLoopThreadPool::getNextLoop()</div></pre></td></tr></table></figure>
<h3 id="does-each-worker-thread-run-EventLoop-loop-which-will-call-epoll-wait-and-execute-all-active-channels-suppose-no"><a href="#does-each-worker-thread-run-EventLoop-loop-which-will-call-epoll-wait-and-execute-all-active-channels-suppose-no" class="headerlink" title="does each worker thread run EventLoop.loop(), which will call epoll_wait(), and execute all active channels? suppose no."></a>does each worker thread run EventLoop.loop(), which will call epoll_wait(), and execute all active channels? suppose no.</h3><h2 id="3-TcpConnection-construction"><a href="#3-TcpConnection-construction" class="headerlink" title="3) TcpConnection construction"></a>3) TcpConnection construction</h2><p>each new client connection will reponse to a new socket fd, and a new channel. (channel is actually the container of socket fd); and the functors on this connection is also imported to channel callbacks. basically from outside, we only see channel objects, TcpConnection object is the inner class. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">TcpConnection::TcpConnection(EventLoop* loop,</div><div class="line">                             <span class="keyword">const</span> <span class="built_in">string</span>&amp; nameArg,</div><div class="line">                             <span class="keyword">int</span> sockfd,</div><div class="line">                             <span class="keyword">const</span> InetAddress&amp; localAddr,</div><div class="line">                             <span class="keyword">const</span> InetAddress&amp; peerAddr)</div><div class="line">  : loop_(CHECK_NOTNULL(loop)),</div><div class="line">    name_(nameArg),</div><div class="line">    state_(kConnecting),</div><div class="line">    reading_(<span class="literal">true</span>),</div><div class="line">    socket_(<span class="keyword">new</span> Socket(sockfd)),</div><div class="line">    channel_(<span class="keyword">new</span> Channel(loop, sockfd)),</div><div class="line">    localAddr_(localAddr),</div><div class="line">    peerAddr_(peerAddr),</div><div class="line">    highWaterMark_(<span class="number">64</span>*<span class="number">1024</span>*<span class="number">1024</span>)</div><div class="line">&#123;</div><div class="line">  channel_-&gt;setReadCallback(</div><div class="line">      boost::bind(&amp;TcpConnection::handleRead, <span class="keyword">this</span>, _1));</div><div class="line">  channel_-&gt;setWriteCallback(</div><div class="line">      boost::bind(&amp;TcpConnection::handleWrite, <span class="keyword">this</span>));</div><div class="line">  channel_-&gt;setCloseCallback(</div><div class="line">      boost::bind(&amp;TcpConnection::handleClose, <span class="keyword">this</span>));</div><div class="line">  channel_-&gt;setErrorCallback(</div><div class="line">      boost::bind(&amp;TcpConnection::handleError, <span class="keyword">this</span>));</div><div class="line">  LOG_DEBUG &lt;&lt; <span class="string">"TcpConnection::ctor["</span> &lt;&lt;  name_ &lt;&lt; <span class="string">"] at "</span> &lt;&lt; <span class="keyword">this</span></div><div class="line">            &lt;&lt; <span class="string">" fd="</span> &lt;&lt; sockfd;</div><div class="line">  socket_-&gt;setKeepAlive(<span class="literal">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>so where are channel (read/write/error/close) handleEvent callbacks triggered? it is during the eventloop.loop, after epoller return the active events, based on the status of each revent, special handleEvent is called.</p>
<h2 id="4-eventLoop-construction"><a href="#4-eventLoop-construction" class="headerlink" title="4) eventLoop construction"></a>4) eventLoop construction</h2><p>during constrution of eventLoop, a new poller is created based on this eventLoop itself, also a new wakeupfd and a new wakeupChannel. the purpose of wakeup fd/channel is to  immediately wake up the work thread, rather than waiting till PollTime. and the wakeupfd bind handleRead, in which read one byte to make this wakeupfd I/O readable, which then is ready for I/O. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">EventLoop::EventLoop()</div><div class="line">  : looping_(<span class="literal">false</span>),</div><div class="line">    quit_(<span class="literal">false</span>),</div><div class="line">    eventHandling_(<span class="literal">false</span>),</div><div class="line">    callingPendingFunctors_(<span class="literal">false</span>),</div><div class="line">    iteration_(<span class="number">0</span>),</div><div class="line">    threadId_(CurrentThread::tid()),</div><div class="line">    poller_(Poller::newDefaultPoller(<span class="keyword">this</span>)),</div><div class="line">    timerQueue_(<span class="keyword">new</span> TimerQueue(<span class="keyword">this</span>)),</div><div class="line">    wakeupFd_(createEventfd()),		</div><div class="line">    wakeupChannel_(<span class="keyword">new</span> Channel(<span class="keyword">this</span>, wakeupFd_)),</div><div class="line">    currentActiveChannel_(<span class="literal">NULL</span>)</div><div class="line">&#123;</div><div class="line">  LOG_DEBUG &lt;&lt; <span class="string">"EventLoop created "</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">" in thread "</span> &lt;&lt; threadId_;</div><div class="line">  <span class="keyword">if</span> (t_loopInThisThread)</div><div class="line">  &#123;</div><div class="line">    LOG_FATAL &lt;&lt; <span class="string">"Another EventLoop "</span> &lt;&lt; t_loopInThisThread</div><div class="line">              &lt;&lt; <span class="string">" exists in this thread "</span> &lt;&lt; threadId_;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">    t_loopInThisThread = <span class="keyword">this</span>;</div><div class="line">  &#125;</div><div class="line">  wakeupChannel_-&gt;setReadCallback(</div><div class="line">      boost::bind(&amp;EventLoop::handleRead, <span class="keyword">this</span>));	    <span class="comment">// we are always reading the wakeupfd</span></div><div class="line">  wakeupChannel_-&gt;enableReading();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>“activeChannels” suppose to be a class variable, which is shared by eventLoop objects, but it’s ok to keep a copy for each eventLoop object to avoid multi-thread competing. and suppose epoll_wait() is thread-safe, so later during construction of eventLoopThreadPool, multi eventLoopThreads won’t conflict with “active channels”</p>
<h2 id="5-epoller-construction"><a href="#5-epoller-construction" class="headerlink" title="5) epoller construction"></a>5) epoller construction</h2><p>epoller object is created during eventloop construction. since the three interface of epoll instance are thread-safe, they look like global funcs.</p>
<p>epoll_create(), return an epfd referring to the new epoll instance, this epfd is used by all subsequent calsl to the epoll interface. </p>
<p>epoll_wait(), return all ready events on the epoll instance referred by epfd. </p>
<p>epoll_ctl(), traverse the red-black tree strucutre to return the existing fd, or add new fd to the tree. </p>
<h2 id="6-channel-construction"><a href="#6-channel-construction" class="headerlink" title="6) channel construction"></a>6) channel construction</h2><p>channel is the container of one fd, and is related to one eventLoop. channel is not responsible to create/delete fd, the real owner of each fd is TcpConnection or acceptor. Channel object works like a pipe to send fd from inner object TcpConnection to the eventLoop. the advantage  here is eventLoop is independent from connections. </p>
<h2 id="7-channel-update"><a href="#7-channel-update" class="headerlink" title="7) channel:update()"></a>7) channel:update()</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">channel::update() --&gt;</div><div class="line">	loop-&gt;updateChannel() --&gt; </div><div class="line">		poller-&gt;updateChannel() --&gt;</div><div class="line">			<span class="comment">//poller maintain a channel list, call epoll_ctl to add/return/delete the requiring channel</span></div></pre></td></tr></table></figure>
<h2 id="8-one-epoll-threadpool-vs-per-thread-per-epoll"><a href="#8-one-epoll-threadpool-vs-per-thread-per-epoll" class="headerlink" title="8) one epoll + threadpool vs per thread per epoll"></a>8) one epoll + threadpool vs per thread per epoll</h2><p>the first method, one global epoll listens all new connections, and send each connection callback to a new thread to execute. method 2, to listen the server I/O socket need to bind a unique epoll, in Moduo which is the acceptor epoll. then all client connection socket will be dealt with their own worker epoll.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/14/muduo1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/14/muduo1/" itemprop="url">moduo 1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-14T23:35:28-04:00">
                2018-06-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/14/muduo1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/14/muduo1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/chenshuo/muduo" target="_blank" rel="external">Moduo: A C++ non-blocking network library for multi-threaded server in Linux</a>. </p>
<h2 id="C-11-features"><a href="#C-11-features" class="headerlink" title="C++ 11 features"></a>C++ 11 features</h2><h3 id="a-functional-bind"><a href="#a-functional-bind" class="headerlink" title="a.    functional, bind"></a>a.    functional, bind</h3><p>in C++11, function declartion can be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	return-type func(args)</div><div class="line">//or</div><div class="line">	auto func(args) -&gt; return_type</div><div class="line"></div><div class="line">//	the good part of &quot;-&gt;&quot; is to use &quot;decltype&quot; to decide the return type from future.</div><div class="line"></div><div class="line">	std::function&lt;return_type(arg1_type, arg2_type..)&gt; ;</div><div class="line">	[](type1, type2..)&#123;&#125; ; //lambda func, anonymous func</div><div class="line">	std::forward</div></pre></td></tr></table></figure>
<p>std::bind() is used to assign existed variables to func parameters during compile-time, and unassigned parameters stand as placeholders, which then replace by real parameters during running-time, and return a new func. bind() can be used to bind static func, global func, class member func.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	   std::bind(global_func, 1.0, _2) ; </div><div class="line">	   std::bind(&amp;class:memberfunc, classPointer[this], _1); </div><div class="line">``` 		</div><div class="line">		</div><div class="line"></div><div class="line">### b.  multi-threads synchronized primitives </div><div class="line"></div><div class="line">Q: what is condition variable ? </div><div class="line">	</div><div class="line">A: used to block one or more threads, till been notified by another thread or overtime been wakeup. But if all threads are waiting, that&apos;s a problem, so at least for one thread, the condition variable should be true.</div></pre></td></tr></table></figure>
<pre><code>threadA.wait(condition_variable);
while(;;)
{
    threadB.do();    
}
threadB.notify();
threadA.do();
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">Q: what is mutex?</div><div class="line">	</div><div class="line">A: it works like a lock, to block any other thread to access special part of memory, at any time, only one thread can own the mutex. in reality, to define mutexLock class will manage lock/unlock automatically due to the constructor/destructor of the object. </div><div class="line"></div><div class="line">### c.  rvalue reference, universal reference, std::forward </div><div class="line">	</div><div class="line">Q: why need right-value reference ?</div><div class="line">	</div><div class="line">A: to use rvalue like lvalue, save object/variable copying, the detail is about move constructor. universal reference, means either rvalue reference or lvalue reference,  is to declare a variable /parameter with type T&amp;&amp; for some deduced type T</div><div class="line"></div><div class="line">### d.  functional template, variadic arguments </div><div class="line">	</div><div class="line">basically, it&apos;s to support any type, any number of parameters in function template. </div><div class="line">	</div><div class="line"></div><div class="line">``` </div><div class="line">		template&lt;typename… Args&gt;  class  tuple&#123;&#125; //a template class</div><div class="line">		template&lt;typename T, typename… Args&gt; void func()&#123;&#125; 	</div><div class="line">	/* Args :: a template type parameter pack, a list of parameters</div><div class="line">	   T ::  a normal template type parameter</div><div class="line">  	*/ </div><div class="line"></div><div class="line">		func(T, args...) </div><div class="line">		/* (...) at right of func parameters is meta operator </div><div class="line">		used to unpack &quot;args&quot; into separate arguments  */</div></pre></td></tr></table></figure>
<h2 id="a-simple-thread-thread-pool-lib"><a href="#a-simple-thread-thread-pool-lib" class="headerlink" title="a simple thread / thread pool lib"></a>a simple thread / thread pool lib</h2><p>take a look at: <a href="https://github.com/mtrebi/thread-pool" target="_blank" rel="external">thread-pool</a> </p>
<p>basically, a task queue to store all todo tasks; a thread pool, to store the worker threads, each of which takes one task from the task queue continuously till the queue empty. </p>
<p>racing condition happens when two threads try to take the same task simultaneously, so mutex. and all operators requrieing thread-safe should use mutex, e.g. enqueue/dequeue task<br>then callback functors, how each worker thread deal with the task at hand? to design function template with variadic arguments.</p>
<h2 id="a-simple-Tcp-network-lib"><a href="#a-simple-Tcp-network-lib" class="headerlink" title="a simple Tcp network lib"></a>a simple Tcp network lib</h2><p>take a look at: <a href="https://github.com/kashimAstro/SimpleNetwork" target="_blank" rel="external">simpleNetwork</a></p>
<p>in server:  socket() -&gt; bind() -&gt; listen() -&gt; accept() –&gt; send()/write()</p>
<p>in client: socket() -&gt; connect() -&gt; recv()/send()</p>
<p>a basic idea is that each connection, the server will create a new thread to handle it. But it consume server quickly. </p>
<h2 id="I-O-nonblocking-event-driven-amp-multiplex"><a href="#I-O-nonblocking-event-driven-amp-multiplex" class="headerlink" title="I/O nonblocking/event-driven &amp;  multiplex"></a>I/O nonblocking/event-driven &amp;  multiplex</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;poll.h&gt;</span></span></div><div class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></div><div class="line"><span class="keyword">int</span> fd; <span class="comment">//file descriptor, non-negative</span></div><div class="line"><span class="keyword">short</span> events; <span class="comment">//events to watch, set by user</span></div><div class="line"><span class="keyword">short</span> revents; <span class="comment">//returned events, return from system kernel</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">POLLIN | POLLPRI ; <span class="comment">//event read</span></div><div class="line">POLLOUT | POLLWRBAND ; <span class="comment">//event write</span></div><div class="line">POLLER ; <span class="comment">//event error</span></div><div class="line">POLLHUP ; <span class="comment">//event hang up</span></div></pre></td></tr></table></figure>
<p>the basic idea of multplex(Linux APIs: poll(), epoll()) is to use one single thread to listen many connections/socket/fd, once any socket is ready for I/O, the thread will execute the write/read callback. </p>
<p>epoll() on success, return the number of revents or 0; on error return -1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> &#123;</span></div><div class="line">	__u32 events ;</div><div class="line">	<span class="keyword">union</span>&#123;</div><div class="line">		<span class="keyword">void</span>* ptr,  <span class="comment">//if need to store a pointer </span></div><div class="line">		<span class="keyword">int</span> fd,     <span class="comment">// if need to store socket fd </span></div><div class="line">		__u32 u32, <span class="comment">// to store general 32 bit number </span></div><div class="line">		__u64  u64  <span class="comment">// to store general 64 bit number</span></div><div class="line">	&#125; data;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/05/coding-is-the-system-engineering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/05/coding-is-the-system-engineering/" itemprop="url">coding is the system engineering</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-05T23:04:36-04:00">
                2018-06-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/05/coding-is-the-system-engineering/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/05/coding-is-the-system-engineering/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>during this week studying: automotive message broker. It’s a framework to support in-vehicle network communication, based on which many vehicle applications can build up.</p>
<p>After jumped into the source code, soonly I found the dependent third-party libs, e.t. Qt, Glib, libwebsockets. None of these basis libs looks familiar, that’s really headache. </p>
<p>So had to jump to learn a little about these libs first. Qt is heavy, give up on reading source code, basically to know what’s used for; Glib has a core on eventloop, after review the concept: nonblocking event I/O; and few lighter projects are found, e.g. event.js in RocketEngine. so I was happy to read js source code, but after reading nothing really keep in my head due to don’t know where to use them, neither don’t understand why these implement is necessary. </p>
<p>maybe a bigger project with more details, so picked moduo, written by a Chinese. there is a book on this project, which started with multi-thread programming issues, no help. same problem, I am not familar with the application scenario, so can’t really catch the essential. </p>
<p>back to the question: how to effciently read source code?<br>1) I suppose, first to understand the application scenario<br>2) compile and run in debug to track the data flow for projects, which you can’t see the flow by once<br>3) if it’s a framework/foundmental libs, write demo</p>
<p>The company IT system is not developer-friendly, git, cmake, npm, python lib are missing. that’s maybe the reason I am becoming lazy, if tools at-hand, may give a try; if not, nothing really do. The company has itself gmake system, but the bottom code never been touched. </p>
<p>Then I compiled the demo libwebsocket, many failures bump out, during school time, I used a lot cmake, g++ with local headers, link to LD/_LIBRARY/_PATH, all out of practice for couple years. </p>
<p>Anyway, at this moment, I realize that coding is a system enginnering. first to be really familar with OS, then the basic libs, then think about to write applications. </p>
<p>For me, the first occupy with software is from (industry) application layer, lack of foundmental. now when to do sth, I feel hands are bounded, that push me to the root.</p>
<p>Rome is not built in one day, OMG.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/31/open-source-project-checked/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/31/open-source-project-checked/" itemprop="url">open source project checked</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-31T19:27:22-04:00">
                2018-05-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/31/open-source-project-checked/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/31/open-source-project-checked/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>pen source projects I scatched</p>
<p>To review how many open source projects I tried to study has been in my mind for a long time. I am always interested in new areas, new trends, and want to understand a little more, few contribution by now. One college friend, who worked at Intel China, first brought me to GTC 2008 at Beijing, where my eyes is opened first time, to know there is so many amazing works around the world.   </p>
<h2 id="1-HPC-FEA-CFD"><a href="#1-HPC-FEA-CFD" class="headerlink" title="1) HPC/FEA/CFD"></a>1) HPC/FEA/CFD</h2><p>after 2008, I was driven by computing mechanics more    </p>
<p>HPCG: a benchmark work to test FLOPs, which I used as a class project at Buffalo </p>
<p>PETSC: a large sparse matrix solver, developed from Texas Austin, also met at Buffalo. the math is attracted me more and it is complex and a good learning material for C++  </p>
<p>LibMesh: based on PETSC to do FEM. ran some demo and interested in math more </p>
<p>GPU-SPH: GPU implementd of SPH(CFD algorithm), during 2011, GPU is popular in applied mechanics. </p>
<p>PetIBM: immersed boundary method (CFD algorithm), used as a class project </p>
<p>OpenFEM, OpenFOAM etc. during that period, I collected many small/big open source CFD/FEA projects, but few study. </p>
<h2 id="2-Game-Engine"><a href="#2-Game-Engine" class="headerlink" title="2) Game Engine"></a>2) Game Engine</h2><p>at 2011, Virtual Reality is attracting</p>
<p>CHAI3D: my friend show me a demo, but I didn’t go through</p>
<p>LiquidFun: google product</p>
<p>Box2D:  for fun, like LiquidFun, where cmake, configure skills played</p>
<p>That time I also collected many other game engines from web, e.g. Unreal, skynet..  it’s so cool to be a game developer, but no time to deep in</p>
<h2 id="3-Robot"><a href="#3-Robot" class="headerlink" title="3) Robot"></a>3) Robot</h2><p>at 2014, robot is hot</p>
<p>ROS: that’s my way to study the platform first, with a few study and no more </p>
<p>SLAM: the cool concept when to uderstand the core algorithm</p>
<p>OpenCV: used everywhere, read some docs, but not used independtely </p>
<p>Arduino: platform, when I joined the Detroit Hacking Night(DHN) meetup</p>
<p>RasiBerry: similar experience during DHN, later I tried to implement deep learning detection algorithm on a race car, not finished till now </p>
<p>RTOS: go through like 2-month ago, when I feel I need more understand at embedded system. simple to understand, but not sure how can I master in practice </p>
<h2 id="4-Deep-Learning"><a href="#4-Deep-Learning" class="headerlink" title="4) Deep Learning"></a>4) Deep Learning</h2><p>after 2016, DL is so popular, many frameworks, online courses, papers bursting, no way to keep calm.</p>
<p>TensorFlow: I thought it’s easy at first, but really didn’t go to the code, but implemented some examples</p>
<p>Caffe: the DL framework jumped in, first knew about Google protocol buffer, very confused at that time</p>
<p>ChatAI: I tried to add some fun in WeChat public platform</p>
<h2 id="5-Vehicle"><a href="#5-Vehicle" class="headerlink" title="5) Vehicle"></a>5) Vehicle</h2><p>Buffalo Car simulator: at Buffalo lab, there was a physical car simulator, and code in OSG, cool project to learn C++ </p>
<p>SimCar: later I had chance to know many open source/ commercial car simulators </p>
<p>AGL: at 2017, started to view AGL updates, try to keep in mind the new trends in vehicle software fields </p>
<p>GEVIVI: same time with AGL, interested in IVI as a sub-field</p>
<p>openXC, SmartDeviceLink: OEM level apps</p>
<h2 id="6-Web-amp-Mobile"><a href="#6-Web-amp-Mobile" class="headerlink" title="6) Web &amp; Mobile"></a>6) Web &amp; Mobile</h2><p>at 2017, luckly transfered to a web project, have the chance to know AngularJS, Node.js and event driven, REST, AJAX, async, many new and exciting ideas here.</p>
<p>Hexo.io:  a static blog engine</p>
<p>web crawler: looks like a hack skill </p>
<p>async event I/O lib: moduo, event.js </p>
<p>top github Rankers have js projects, looks very intersting </p>
<h2 id="7-OS-related"><a href="#7-OS-related" class="headerlink" title="7) OS related"></a>7) OS related</h2><p>many little tools when playing with Linux, system level, apps. One big stuff is Linux Process Communication(IPC). I used share memory in one product but never had a chance to know the big picture of IPC, later want to know about Linux network, and see socket, signal… feel connected. </p>
<p>CMAKE: </p>
<p>QT:</p>
<p>Glib:  </p>
<p>MKL: intel math kernal lib, cool in first impression</p>
<p>plugin-pattern in embedded software</p>
<p>the good is know diversity, the short I don’t have done any contribution to combine these experince </p>
<p>GBM</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/22/W3C-automotive-open-web-platform/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/22/W3C-automotive-open-web-platform/" itemprop="url">W3C automotive open web platform</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-22T21:16:59-04:00">
                2018-05-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/22/W3C-automotive-open-web-platform/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/22/W3C-automotive-open-web-platform/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="W3C-automotive-open-web-platform"><a href="#W3C-automotive-open-web-platform" class="headerlink" title="W3C automotive open web platform"></a>W3C automotive open web platform</h1><p>Main page: <a href="https://www.w3.org/auto/wg/" target="_blank" rel="external">Link</a></p>
<p>A clear web framework: 1) define the network communication APIs(based WebSocket protocol); 2) standarlize vehicle data; 3) define APIs to access vehicle data. </p>
<h2 id="Vehicle-Information-Service-Specification-VISS"><a href="#Vehicle-Information-Service-Specification-VISS" class="headerlink" title="Vehicle Information Service Specification(VISS)"></a>Vehicle Information Service Specification(VISS)</h2><p>Object: to define WebSocket based APIs for a vehicle information service to enable client apps to get, set, subscribe, unsubscribe to vehicle signals, data attributes<br><a href="https://w3c.github.io/automotive/vehicle_data/vehicle_information_service.html" target="_blank" rel="external">Link</a></p>
<p><img src="VISS.png" alt="VISS architecture"> </p>
<h2 id="Vehicle-Data"><a href="#Vehicle-Data" class="headerlink" title="Vehicle Data"></a>Vehicle Data</h2><p>doc <a href="https://rawgit.com/w3c/automotive/master/vehicle_data/data_spec.html" target="_blank" rel="external">Link</a></p>
<p>Object: to define a standard Vehicle Data with might be available in a vehicle </p>
<p>1)    VehicleInterface<br>2)    VehicleCommonDataType<br>3)    VehicleConfigurationInterface (identification, sizeConfiguration, fuelConfiguration, transmissionConfiguration, wheelConfiguration, steeringWheelConfiguration)<br>4)    Running Status Interface(vehicleSpeed, wheelSpeed, engineSpeed, vehiclePowerMode, powertrain, acceleratorPedalPosition, throttlePosition, tripMeters, transmission, cruiseControlStatus, lightStatus, interiorLightStatus, horn, chime, fuel, engineOil, acceleration, engineeCoolant, steeringWheel, wheelTick, ignitionTime, gyro, brakeOperation, buttonEvent, drivingStatus, nightMode, startStopMode)<br>5)    Maintenance Interfaces(odometer, transmissionOil, transmissionClutch, brakeMaintenance, washerFluid, malfuncitonIndicator, battery Status, Tire, trouble Code, diagnostic)<br>6)    Personalization Interfaces ( languageConfiguration, unitsOfMeasures, mirror, driveMode, seatAdjustment, dashboardIllumination, vehicleSound )<br>7)    DrivingSafety Interfaces ( antilockBrakingSystem, tractionControlSystem, electroniceStabilitySystem, topSpeedLimit, airbagStatus, door, childSafetyLock, seat)<br>8)    Climate Interfaces (temperature, rainSensor, wiperStatus, defrost, sunroof, convertibleRoof, sideWindow, climateControl, atmosphericPressure)<br>9)    Vision &amp; Parking Interfaces( laneDepartureDetection, alarm, parkingBrake, parkingSensors) </p>
<h2 id="Vehicle-Information-API-Specification"><a href="#Vehicle-Information-API-Specification" class="headerlink" title="Vehicle Information API Specification"></a>Vehicle Information API Specification</h2><p>Object: define a high level API for accessing vehicle signals, data attributes and communicate with in-vehicle data servers </p>
<p>doc <a href="https://www.w3.org/TR/vehicle-information-api/#vehicleinterface-interface" target="_blank" rel="external">Link</a></p>
<ul>
<li>VISClient Interface<br>  used to define any on-board, off-board clients</li>
<li>VISClientOptions Interface<br>  used to define a connection to a vehicle signal     server(speicifiable by protocal, host, port) </li>
<li>VISSubscription Interface<br>  used as return value from subscribed() methods  </li>
<li>VSS Interface<br>  used as return value from getVSS(), which should be sufficent to fully traverse the VSS tree </li>
</ul>
<h2 id="Vehicle-Information-Access-API"><a href="#Vehicle-Information-Access-API" class="headerlink" title="Vehicle Information Access API"></a>Vehicle Information Access API</h2><p>doc <a href="https://rawgit.com/w3c/automotive/master/vehicle_data/vehicle_spec.html" target="_blank" rel="external">Link</a></p>
<p>Object: enable connectivity through in-vehicle infotainment systems and vehicle data access protocols </p>
<p>1)    Navigator Interface: exposes the interface to vehicle information services<br>2)    Vehicle Interface:  the initial entry point to get access to the vehicle information<br>3)    Zone interface: physical and logical zones<br>4)    VehicleIneterfaceCallback<br>5)    AvailableCallback<br>6)    VehicleInterfaceError  (permission denied, invalid operation, timeout, invalid zone, unknown, error, message)<br>7)    VehicleInterface : the base interface to get all vehicle properties<br>8)    VehicleCOnfigurationInterface :  access to static vehicle information<br>9)    VehicleSignalInterface:  access to variables vehicle info<br>10)    Data Availability :  available,  not supported, not supported security policy, supported …</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/18/where-are-you-in-next-5-years-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/18/where-are-you-in-next-5-years-2/" itemprop="url">where are you in next 5 years(2)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-18T16:32:42-04:00">
                2018-05-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/18/where-are-you-in-next-5-years-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/18/where-are-you-in-next-5-years-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="the-billions-level-product"><a href="#the-billions-level-product" class="headerlink" title="the billions level product"></a>the billions level product</h2><p>Think about these guys in the world, who defined products/services used by billions people, they are more than model innovation, but really make a diffrence in most people’s life. </p>
<p>e.g. iPhone, facebook, Google, they are not created from nowhere, but went through product iterations by iterations, and they only imerge when the tech, the market, the time all are in perfect. </p>
<p>How many people in history achieved here? in any sense, it’s the history choose that person, not that person made history. so take it easy even you are not the 0.01%.</p>
<h2 id="in-the-promising-market"><a href="#in-the-promising-market" class="headerlink" title="in the promising market"></a>in the promising market</h2><p>most people in their life time neither can be the next Jobs, nor Bill Gates. that’s the reality, no sad but clean expectation in the end before really in the last day of life. </p>
<p>the second goal is easier, find a promising market and lead a small product, maybe lucky invovled in a domain market finally. You are not significant, but one of other 5000 competitors. Even this career path, however, you can’t expect the normal lifestyle: start at 25 and retire at 55 with enough 401K to death. If so, mostly you will be fired out someday in 30s or 40s. Chinese say, “if you dont plan far, you will be in trouble soon”</p>
<p>so what may be the promising market subset in automotive software in next 5 years? generally say: 1) service, consulting; 2) self-business; 3)tech expert. in specificly saying: 1) electricity, energy infrastructure;  2) connected, cloud infrastructure; 3) autonomous vehicle.4) mobile apps, which is the carrier for the first 3.  </p>
<p>I mean the trend is so clear these days. No one can say he dont’ know where should stand in future. but where are you now? I like the model Elon Musk mentioned when do future plan: what’s your reality, what’s your goal, how to meet the gap, than focus on acting.</p>
<h2 id="will-automotive-software-like-mobile-smartphones"><a href="#will-automotive-software-like-mobile-smartphones" class="headerlink" title="will automotive software like mobile smartphones ?"></a>will automotive software like mobile smartphones ?</h2><p>It’s interesting even now there are few third-party or independent “automotive software” companines, on opposite, in mobile market, there are lots of small or big third-party developing companines around Andriod, iOS, the mobile ecosystem is plenty and diversity. the reality in automotive field is lack of abstraction and separation between bottom hardware and top applications.</p>
<p>in a mature mobile ecosystem, developer -&gt; end-users<br>in automotive software ecosystem, devleoper –&gt; OEM –&gt; end-users</p>
<p>some auto allience is working on(AutoSAR). as developers, either gain some knowledge in hardware/control to solve the gap, or waiting for the day. </p>
<p>what I expect on the way, may be like mobile time:<br>1) automotive OS platform<br>2) vehicle apps<br>3) infrastures extending</p>
<p>once the platform is unified, suppose many new auto branchs will emergy. like HTC, Xiaomi, Vivo, Huawei, Lenvo branches after Andriod OS. then new market stratgey is highly required, also traditional OEMs will be heavily impacted. </p>
<h2 id="OEM-don’t-like-mobile-ecosystem"><a href="#OEM-don’t-like-mobile-ecosystem" class="headerlink" title="OEM don’t like mobile ecosystem"></a>OEM don’t like mobile ecosystem</h2><p>this may happen soon or never, since OEM don’t like this trend. most possiblely, automotive software developers will highly rely on OEMs. so where will I stand in next 5-years ?</p>
<p>OEM is good at strategy study and product integration. at a tech supplier, the benefit is more product driven experience. </p>
<p>OEM suppose to have the advantage at automotive platform built-up, but reality is big Internet/software companies with product-level solutions, and OEM doesn’t. </p>
<p>it is clear for me in next 5-years to jump into electric, connected, autonomous related industries, either at OEM level or supplier level. Also it is the time to do some study at automotive platform vendors.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">163</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
