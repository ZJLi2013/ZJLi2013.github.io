<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/page/16/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/16/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/11/object-creating-in-C-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/11/object-creating-in-C-C/" itemprop="url">object creating in C/C++</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-11T21:09:08-04:00">
                2018-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/11/object-creating-in-C-C/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/11/object-creating-in-C-C/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="construct-an-object"><a href="#construct-an-object" class="headerlink" title="construct an object"></a>construct an object</h2><p>the compiler will define a default constructor with no parameters, if there is no user defined default constructors. usually the parameters for user defined(UD) default constructors should have default values. </p>
<p>directly call the UD constructor will create an object; call the UD through new keyword will create an object pointer.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> val; </div><div class="line">	TreeNode *right ;</div><div class="line">	TreeNode *left;</div><div class="line">	TreeNode(<span class="keyword">int</span> x=<span class="number">0</span>): val(x), left(<span class="literal">NULL</span>), right(<span class="literal">NULL</span>)&#123;&#125;; <span class="comment">//user defined constructor </span></div><div class="line">	TreeNode(<span class="keyword">const</span> TreeNode *cp) <span class="comment">//copy constructor </span></div><div class="line">	&#123;</div><div class="line">		val = cp-&gt;val;</div><div class="line">		right = cp-&gt;right;</div><div class="line">		left = cp-&gt;left;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">TreeNode node1; </div><div class="line"><span class="function">TreeNode <span class="title">node2</span><span class="params">(<span class="number">100</span>)</span></span>;</div><div class="line">TreeNode *node_p = <span class="keyword">new</span> TreeNode(<span class="number">10</span>);</div></pre></td></tr></table></figure>
<h2 id="create-an-object-in-pure-C"><a href="#create-an-object-in-pure-C" class="headerlink" title="create an object in pure C"></a>create an object in pure C</h2><p><code>new</code> operator do two things: allocate memory for a C++ class object, then call the object’s constructor to initialize this object. basically, <code>new</code> packages memory management of objects and objects initialization.</p>
<p>while in pure C,  since there is no object constructor, after <code>malloc</code>  memory for the structure, either call an initial function or manually initialize this structure member variables.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">TreeNode </div><div class="line">&#123;</div><div class="line">	int val; </div><div class="line">	TreeNode *right ;</div><div class="line">	TreeNode *left;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">   TreeNode *p =  (TreeNode*) malloc( sizeof(struct TreeNode)); </div><div class="line">   p-&gt;val = 0;</div><div class="line">   p-&gt;right = NULL; </div><div class="line">   p-&gt;left = NULL ; </div><div class="line">&#125;</div><div class="line">``` </div><div class="line">  </div><div class="line">## construct an object array </div><div class="line"></div><div class="line">beyond creating one object (pointer), how to create object array.  </div><div class="line"></div><div class="line">```c </div><div class="line">int nums = 5;</div><div class="line">TreeNode tree_array[nums];</div><div class="line">TreeNode *tree_p = (TreeNode*) new TreeNode[nums];</div></pre></td></tr></table></figure>
<p>be aware, each element in tree_array has the whole memory of TreeNode structure; and tree_p++ will go to next TreeNode structure, tree_p[i] is also a whole memory of TreeNode structure. </p>
<h2 id="create-an-object-array-in-pure-C"><a href="#create-an-object-array-in-pure-C" class="headerlink" title="create an object array in pure C"></a>create an object array in pure C</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> nums = <span class="number">5</span>;</div><div class="line">TreeNode *tree_p = (TreeNode*) <span class="built_in">malloc</span>(nums * <span class="keyword">sizeof</span>(TreeNode));</div></pre></td></tr></table></figure>
<p>basically <code>malloc</code> will return a pointer to a block of memory, but it’s not responsible to initialize this block of memory. </p>
<h2 id="the-rule-of-five"><a href="#the-rule-of-five" class="headerlink" title="the rule of five"></a>the rule of five</h2><p><a href="https://cpppatterns.com/patterns/rule-of-five.html" target="_blank" rel="external">rule of three</a> is about how to manage dynamically allocated resources in C++.</p>
<p>why it is necessary? </p>
<p>1) when parameter B is copying by value from A, if no user defined copy constructor, the compiler will do a shallow copy from A to B by default, in which  a new pointer point to the same content address. at the end of function call, the parameter B is out of scope, so destructor is called, and A is still there. but at the end of the main function, A is out of scope, need deallocating, then error is B already deallocate the content of A. </p>
<p>with a user defined copy constructor, B will get a deep copy of A, so no sharing content, no problems when deallocating either B or A.</p>
<p>2) if no user specified assignment constructor, a shallow copy happens, then error-potential. and assignment constructor (operator=) can be implemented with copy constructor. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	TreeNode node1;</div><div class="line">	TreeNode node2 = node1; <span class="comment">//actually a copy-construct, same as node2(node1)</span></div><div class="line">	TreeNode node3 ;</div><div class="line">	node3 = node1 ; <span class="comment">//a compiler assignment-construct by default(shallow copy)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/11/scrabmle-string/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/11/scrabmle-string/" itemprop="url">scrabmle string</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-11T21:07:03-04:00">
                2018-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/11/scrabmle-string/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/11/scrabmle-string/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/scramble-string/description/" target="_blank" rel="external">scramble string</a> at leetCode 87. sol: get all possible scrambled strings of s1, then compare if s2 is in it.</p>
<pre><code>for 1-char:   scramble(&quot;a&quot;) --&gt; &quot;a&quot; 
    for 2-chars :  scramble(&quot;ab&quot;) --&gt; &quot;ba&quot;  
for 3-chars:  scramble(&quot;abc&quot;) --&gt; &quot;bac&quot;, &quot;cba&quot;,  &quot;acb&quot;, &quot;cba&quot;      for 4-chars:   scramble(&quot;abcd&quot;) --&gt;  (a | bcd) + (ab | cd) +  (abc | d) 
for 5-chars:  scramble(&quot;abcde&quot;) --&gt; (a | bcde) +  (ab | cde) +  (abc |  de) + (abcd | e) 
</code></pre><p>from the enumaration, there is always a left-substring and a right-substring, and recursive in each substring. consider the push_back order, there are two:  left-&gt;\right and right-&gt;\left at each two slibings.</p>
<p>additional routines: how to do substring join and how to delete duplicate string from string-vector.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> <span class="function"><span class="built_in">string</span> <span class="title">join</span><span class="params">(<span class="built_in">string</span>&amp; sub1, <span class="built_in">string</span>&amp; sub2)</span></span></div><div class="line"> &#123;</div><div class="line">	 <span class="built_in">string</span> res; </div><div class="line">	 res.reserve(sub1.size() + sub2.size());</div><div class="line">	 </div><div class="line">	 <span class="built_in">string</span>::iterator it;</div><div class="line">	 </div><div class="line">	 <span class="keyword">for</span>(it = sub1.begin(); it != sub1.end(); it++)</div><div class="line">		 res.push_back(*it);</div><div class="line">	 </div><div class="line">	 <span class="keyword">for</span>(it = sub2.begin(); it != sub2.end(); it++)</div><div class="line">		 res.push_back(*it);</div><div class="line">	 </div><div class="line">	 <span class="keyword">return</span> res;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> <span class="comment">//<span class="doctag">TODO:</span>  keep in mind the transfer function, and how to design it  </span></div><div class="line"> <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;  scramble(<span class="built_in">string</span>&amp; s)</div><div class="line"> &#123;</div><div class="line">	 <span class="built_in">string</span>  ls, rs; </div><div class="line">	 <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; vls, vrs, vcurs; </div><div class="line">	 </div><div class="line">	 <span class="keyword">if</span>(s.size() == <span class="number">1</span>)</div><div class="line">	 &#123;</div><div class="line">		 vcurs.push_back(s); </div><div class="line">		 <span class="keyword">return</span> vcurs; </div><div class="line">	 &#125;</div><div class="line">	 </div><div class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;s.size(); i++)</div><div class="line">	 &#123;</div><div class="line">		 ls = s.substr(<span class="number">0</span>, i);</div><div class="line">		 rs = s.substr(i, s.size()); </div><div class="line">		 vls = scramble(ls);</div><div class="line">		 vrs = scramble(rs); 		 </div><div class="line">		 </div><div class="line">		 <span class="keyword">for</span>(<span class="keyword">int</span> m=<span class="number">0</span>; m&lt; vls.size(); m++)</div><div class="line">			 <span class="keyword">for</span>(<span class="keyword">int</span> n=<span class="number">0</span>; n &lt; vrs.size(); n++)</div><div class="line">			 &#123;				 </div><div class="line">				 vcurs.push_back(join(vls[m], vrs[n])); </div><div class="line">				 vcurs.push_back(join(vrs[n], vls[m])); 			 </div><div class="line">			 &#125;</div><div class="line">	 &#125;</div><div class="line"></div><div class="line"><span class="comment">/*how to delete duplicated string from vector&lt;string&gt; */</span> 	 </div><div class="line">	 <span class="built_in">std</span>::sort(vcurs.begin(), vcurs.end()); </div><div class="line">	 vcurs.erase( <span class="built_in">std</span>::unique(vcurs.begin(), vcurs.end()), vcurs.end()); </div><div class="line">	 <span class="keyword">return</span> vcurs; </div><div class="line"> &#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">string</span> s1 = <span class="string">"abcd"</span> ;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; outs = scramble(s1); </div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;outs.size(); i++)</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; outs[i] &lt;&lt; <span class="built_in">endl</span>; </div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>How to write a completed code, meaning, always take care the boundaries correctly, no missing situations. It’s easy to start from scratch and achieve somewhere, but hard to be completed.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/04/how-dynamic-programming-works/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/04/how-dynamic-programming-works/" itemprop="url">how dynamic programming works</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-04T18:07:36-04:00">
                2018-09-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/04/how-dynamic-programming-works/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/04/how-dynamic-programming-works/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetcode 64(Mini Path Sum): Given a m x n grid filled with non-negative numbers, find a path from top left to bottom right which minimizes the sum of all numbers along its path.</p>
<p>the first thought is to build a tree：</p>
<pre><code>     1
     /        \
  1       3 
 / \     / \
4   5   1   5
/  /\   /   /\
2  1 2  1   1 2 
</code></pre><p>while this is not a balanced tree, no regular tree way to maintain. Then what else solution?  Dynamic Programming is a strategy to solve a simple problem at first, then find the rules(status transfer from previous state to current state) for the remaining problems.</p>
<p>step1: the simpler problem, or as initial/boundary condition. e.g. only one row, or only one col, what’s the solution.</p>
<p>step2:  in general m rows, n cols, how to get the iterative rules after step1.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sol</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt;&amp; mat)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; dp; </div><div class="line">	</div><div class="line">	<span class="keyword">int</span> row = mat.size();</div><div class="line">	<span class="keyword">int</span> col = mat[<span class="number">0</span>].size(); </div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;row; i++)</div><div class="line">		dp[i][<span class="number">0</span>] += mat[i][<span class="number">0</span>];</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;col; j++)</div><div class="line">		dp[<span class="number">0</span>][j] += mat[<span class="number">0</span>][j];</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;row; i++)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;col; j++)</div><div class="line">			dp[i][j] = min(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]) + mat[i][j]; </div><div class="line">	</div><div class="line">	<span class="keyword">return</span> dp[row<span class="number">-1</span>][col<span class="number">-1</span>]; </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v1, v2, v3 ;</div><div class="line"> v1 = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>&#125;;</div><div class="line"> v2 = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>&#125;;</div><div class="line"> v3 = &#123;<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>&#125;</div><div class="line"> </div><div class="line"> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt;   mat;</div><div class="line"> mat.push_back(v1);</div><div class="line"> mat.push_back(v2);</div><div class="line"> mat.push_back(v3);</div><div class="line"> </div><div class="line"> <span class="keyword">int</span> out = sol(mat);</div><div class="line"> </div><div class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"output ="</span> &lt;&lt; out &lt;&lt; <span class="built_in">endl</span>; </div><div class="line"> </div><div class="line"> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>See DP solution is much clear than design the tree.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/how-recursive-works-with-passing-reference-variables/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/how-recursive-works-with-passing-reference-variables/" itemprop="url">how recursive works with passing reference variables</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T23:56:44-04:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/how-recursive-works-with-passing-reference-variables/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/how-recursive-works-with-passing-reference-variables/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetCode 62(unique paths):<br>        A robot is located at the top-left corner of a m x n grid (marked ‘Start’ in the diagram below). The robot can only move either down or right at any point in time. The robot is trying to reach the bottom-right corner of the grid (marked ‘Finish’ in the diagram below). How many possible unique paths are there?</p>
<p>solution: it’s easy to model as a math combination problem, assume the  right-step has m; the down-step has n. so each path from top left to bottom right, has (m+n) steps totally. the total unique paths is   C_(m+n)^m </p>
<p>passing by value: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sol</span><span class="params">(<span class="keyword">int</span> rm, <span class="keyword">int</span> rn)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">return</span> rm==<span class="number">0</span> ? <span class="number">1</span> : (rm+rn)/rm * sol(rm<span class="number">-1</span>, rn);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>what happened if rm-1 changed to  rm–?  </p>
<pre><code>warning: unsequenced modification and access to &apos;rm&apos;
</code></pre><p>what about passing as reference ? </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sol</span><span class="params">(<span class="keyword">int</span>&amp; m, <span class="keyword">int</span>&amp; n)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">return</span> m==<span class="number">0</span> ? <span class="number">1</span> : (m+n)/(<span class="keyword">float</span>)m * sol(--m, n);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>if using m– :</p>
<pre><code>error:  expects an l-value for 1st argument of sol(int&amp;, int&amp;)
</code></pre><p>m– is only r-value, can’t be used as reference varaible; but –m is r-value. </p>
<p>for m as a reference variable,  –m is the way to update the content of the address. while m– more like move to the next address?</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/how-backtracks-work/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/how-backtracks-work/" itemprop="url">how backtracks work</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T23:39:41-04:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/how-backtracks-work/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/how-backtracks-work/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetCode 50 (N-Queens):<br>     The n-queens puzzle is the problem of placing n queens on an n×n chessboard such that no two queens attack each other.</p>
<p>solution: each potentional position for a queen should satisfy no attach, then traverse the 2D grids to find out all good positions; it requires to find all possible combinations, so recursive call will be used also.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">bool</span> <span class="title">one_queen_visited</span><span class="params">(<span class="keyword">int</span>** mat, <span class="keyword">int</span> n, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; queen_idx)</span></span></div><div class="line"> &#123;</div><div class="line">	 <span class="keyword">int</span> row = queen_idx.first ;</div><div class="line">	 <span class="keyword">int</span> col = queen_idx.second; </div><div class="line">	 </div><div class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">	 &#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; j++)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(mat[row][j] == <span class="number">0</span>)</div><div class="line">				mat[row][j] = <span class="number">1</span>;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(mat[row][j] == <span class="number">100</span>)</div><div class="line">				<span class="keyword">return</span> <span class="literal">false</span>; </div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(mat[i][col] == <span class="number">0</span>)</div><div class="line">			 mat[i][col] = <span class="number">1</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(mat[i][col] == <span class="number">100</span>)</div><div class="line">			 <span class="keyword">return</span> <span class="literal">false</span>; </div><div class="line">	 &#125;</div><div class="line">		</div><div class="line">	 <span class="comment">//for left leaning </span></div><div class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=row, j=col; i&gt;=<span class="number">0</span> &amp;&amp; j&gt;=<span class="number">0</span>; i--, j--)</div><div class="line">	 &#123;</div><div class="line">			<span class="keyword">if</span>(mat[i][j] == <span class="number">0</span>)</div><div class="line">				mat[i][j] = <span class="number">1</span>; </div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(mat[i][j] == <span class="number">100</span>)</div><div class="line">				<span class="keyword">return</span> <span class="literal">false</span>; </div><div class="line">	 &#125;</div><div class="line">	 </div><div class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=row, j=col; i&lt;n &amp;&amp; j&lt;n; i++, j++)</div><div class="line">	 &#123;</div><div class="line">			<span class="keyword">if</span>(mat[i][j] == <span class="number">0</span>)</div><div class="line">				mat[i][j] = <span class="number">1</span>; </div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(mat[i][j] == <span class="number">100</span>)</div><div class="line">				<span class="keyword">return</span> <span class="literal">false</span>; </div><div class="line">	 &#125;	</div><div class="line">	  </div><div class="line">	 <span class="comment">//for right leaning </span></div><div class="line">		<span class="comment">//down</span></div><div class="line">	  <span class="keyword">for</span>(<span class="keyword">int</span> i=row, j=col; i&lt;n &amp;&amp; j&gt;=<span class="number">0</span>; i++, j--)</div><div class="line">	 &#123;</div><div class="line">			<span class="keyword">if</span>(mat[i][j] == <span class="number">0</span>)</div><div class="line">				mat[i][j] = <span class="number">1</span>; </div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(mat[i][j] == <span class="number">100</span>)</div><div class="line">				<span class="keyword">return</span> <span class="literal">false</span>; </div><div class="line">	 &#125;</div><div class="line">	  <span class="comment">//up </span></div><div class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=row, j=col; i&gt;=<span class="number">0</span> &amp;&amp; j&lt;n; i--, j++)</div><div class="line">	 &#123;</div><div class="line">			<span class="keyword">if</span>(mat[i][j] == <span class="number">0</span>)</div><div class="line">				mat[i][j] = <span class="number">1</span>; </div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(mat[i][j] == <span class="number">100</span>)</div><div class="line">				<span class="keyword">return</span> <span class="literal">false</span>; </div><div class="line">	 &#125;	</div><div class="line"> </div><div class="line">	 mat[row][col] = <span class="number">100</span>;  <span class="comment">//queen location marked as 100</span></div><div class="line">	 <span class="keyword">return</span> <span class="literal">true</span>; </div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> backtrack = <span class="number">0</span>; </div><div class="line">	 </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sol</span><span class="params">(<span class="keyword">int</span>** mat,  <span class="keyword">int</span> n, <span class="keyword">int</span> start_j=<span class="number">0</span>)</span></span></div><div class="line"> &#123;</div><div class="line">	 <span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;  idx; </div><div class="line">	 <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt;   queens; </div><div class="line">	 <span class="built_in">vector</span>&lt; <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; &gt;  queens_v; </div><div class="line">	 <span class="keyword">if</span>(start_j &gt; n) <span class="keyword">return</span> ;   <span class="comment">//end of recursive </span></div><div class="line">	 <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">	 &#123;</div><div class="line">		 <span class="keyword">for</span>(<span class="keyword">int</span> j= ((i==<span class="number">0</span>)? max(start_j, <span class="number">0</span>) : <span class="number">0</span>); j&lt;n; j++)</div><div class="line">		 &#123;</div><div class="line">			 idx =  <span class="built_in">std</span>::make_pair(i, j); </div><div class="line">			 <span class="keyword">if</span>(one_queen_visited(mat, n, idx)) <span class="comment">// find a fit queen position, store into  queens </span></div><div class="line">			 &#123;</div><div class="line">				 queens.push_back(idx);</div><div class="line">			 &#125;</div><div class="line">		 &#125;</div><div class="line">	 &#125; </div><div class="line">	 	 </div><div class="line">	 <span class="keyword">if</span>(queens.size() == n)</div><div class="line">	 &#123;</div><div class="line">		 queens_v.push_back(queens);</div><div class="line">		<span class="keyword">int</span>** mat_copy =  <span class="keyword">new</span> <span class="keyword">int</span>*[n] ;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">		&#123;</div><div class="line">			mat_copy[i] = <span class="keyword">new</span>  <span class="keyword">int</span>[n](); </div><div class="line">		&#125;	</div><div class="line">	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;queens.size(); i++)</div><div class="line">		&#123;</div><div class="line">			idx =  queens[i];</div><div class="line">			mat_copy[idx.first][idx.second] = <span class="number">1</span> ;</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; j++)</div><div class="line">				<span class="built_in">cout</span>&lt;&lt; mat_copy[i][j] &lt;&lt; <span class="string">' '</span> ;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	 &#125;</div><div class="line">		</div><div class="line">	clean_mat(mat, n);</div><div class="line">	sol(mat, n, ++backtrack); 			</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>I did actually new memory in C++ as following:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>** mat = (<span class="keyword">int</span>**) <span class="keyword">new</span>(n * <span class="keyword">sizeof</span>(<span class="keyword">int</span>*)); </div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;  i&lt;n; i++)</div><div class="line">	mat[i] = (<span class="keyword">int</span>*) <span class="keyword">new</span>( n * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div></pre></td></tr></table></figure>
<p>which failed, then realized only malloc works in this way.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/how-broad-first-search-works/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/how-broad-first-search-works/" itemprop="url">how broad first search works</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T23:35:58-04:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/how-broad-first-search-works/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/how-broad-first-search-works/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetCode 45 (jump game): Given an array of non-negative integers, you are initially positioned at the first index of the array.Each element in the array represents your maximum jump length at that position.Your goal is to reach the last index in the minimum number of jumps.</p>
<p> e.g. [2, 3, 1, 1, 4] –&gt; 2 </p>
<p>solution: at current position, bfs all the next positions it can jump to, when the back element is in next position list, then reached.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">sol</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums )</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator  it, cur_it ;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; *adj = <span class="keyword">new</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;[nums.size()]; 	</div><div class="line">	<span class="keyword">int</span> cur_node ; </div><div class="line">	<span class="keyword">for</span>(it=nums.begin(); it &lt; nums.end();  it++)</div><div class="line">	&#123;</div><div class="line">		cur_node = *it; </div><div class="line">		adj[cur_node].push_back(cur_node); </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=cur_node; i++)</div><div class="line">		&#123;</div><div class="line">			cur_it =  <span class="built_in">std</span>::next(it, i);</div><div class="line">			adj[cur_node].push_back(*cur_it); </div><div class="line">			<span class="keyword">if</span>( *cur_it == nums.back())&#123;</div><div class="line">				it = nums.end();  <span class="comment">//reach the last element, so return </span></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp; </div><div class="line">	<span class="keyword">int</span> last_element = nums.back(); </div><div class="line">	<span class="keyword">int</span> mini_path = <span class="number">1</span>; </div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; nums.size(); i++)</div><div class="line">	&#123;</div><div class="line">		tmp = adj[i]; </div><div class="line">		<span class="keyword">if</span>(!tmp.empty())</div><div class="line">		&#123; </div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;tmp.size(); j++)</div><div class="line">			&#123;</div><div class="line">				<span class="built_in">cout</span>&lt;&lt; tmp[j] &lt;&lt; <span class="string">' '</span> ;</div><div class="line">			&#125;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>; </div><div class="line">			<span class="keyword">if</span>(tmp.back() == last_element)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">return</span> mini_path; </div><div class="line">			&#125;</div><div class="line">			mini_path++; </div><div class="line">		&#125;</div><div class="line">	&#125;	</div><div class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/how-recursive-works/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/how-recursive-works/" itemprop="url">how recursive works</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T23:31:12-04:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/how-recursive-works/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/how-recursive-works/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leetCode 46 Permutations: given a collection of distinct integers, return all possible permutations.</p>
<pre><code>Input: [1, 2, 3]

Output:
[ [1,2,3], [1,3,2], [2, 1, 3], [2, 3, 1], [3, 1,2], 
[3,2,1] ] 
</code></pre><p>At first glipmse, it’s middle difficult, jump to recursive implementation. But there always confused failures, e.g. passing vector as reference to the recursive calls, and even do a deep copy of that vector, the base vector is always modified by the copied vector. This problem blocks me a whole day, actually I don’t know how to make a recursive calls work.</p>
<p>tip1) each recursive fun has its independent local variables ;</p>
<p>tip2) recursive calls are serialized, namely only when inside recursive fun is done, then the outside recursive will continue.</p>
<p>tip1 helps to explain when local variables changed unexpected; tip2 helps cause I trend to think all recursive calls are parallezed running, but the real running order is serialized, so no twist.</p>
<p>simulate how human brain solve this problem:</p>
<pre><code>&lt;1(fix), 2(fix), 3&gt; ;  &lt;1(fix), 3(fix), 2&gt; …
</code></pre><p>the first position has n potentional values, then the second position has (n-1) potentional values, etc. so design the very first implementation as:  traverse all potentional values in first position, and push it; then travers all potentional values in next position, and push it; till the last position, while only one element left, and push it. so a new combination is created. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; sol1(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; idx_vector ;</div><div class="line">		</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; nums.size(); i++) </div><div class="line">	&#123;</div><div class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp ;</div><div class="line">		tmp.push_back(nums[i]);  <span class="comment">//the first element in new created vector </span></div><div class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums1 =  nums ;</div><div class="line">		nums1.erase(nums1.begin()+i);  <span class="comment">//the second element in new created vector  </span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt; nums1.size(); j++)</div><div class="line">		&#123;</div><div class="line">			tmp.push_back(nums1[j]);</div><div class="line">			<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums2 = nums1; </div><div class="line">			nums2.erase(nums2.begin() + j);</div><div class="line">			<span class="keyword">if</span>(nums2.size() == <span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">					tmp.push_back(nums2[<span class="number">0</span>]);</div><div class="line">					idx_vector.push_back(tmp); 	</div><div class="line">					tmp.pop_back();</div><div class="line">			&#125;</div><div class="line">		tmp.pop_back(); </div><div class="line">		&#125;	</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> idx_vector; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>the first implmenation only works for fixed input <1, 3="" 2,="">, so how to design a recursive fun to make this idea more general ? it’s easy to abstract the process above: for ith position in the new combination vector, the potentional values is one less from (i-1)th position, traverse all possible values in ith position and push it, don’t forget pop it out for traversing to the next possible value; and the end of recursive is when only one element left.</1,></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sol</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; tmp, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; idx_vector )</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(nums.size() == <span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		tmp.push_back(nums[<span class="number">0</span>]);</div><div class="line">		idx_vector.push_back(tmp);</div><div class="line">		tmp.pop_back();</div><div class="line">		<span class="keyword">return</span> ;</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; nums.size(); i++)</div><div class="line">	&#123;</div><div class="line">		tmp.push_back(nums[i]);</div><div class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums2 = nums; </div><div class="line">		nums2.erase(nums2.begin()+i);</div><div class="line">		sol(nums2, tmp, idx_vector);</div><div class="line">		tmp.pop_back();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>test:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;; 	</div><div class="line">	<span class="keyword">int</span> size =  nums.size(); </div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp ;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; outs;</div><div class="line">	sol(nums, tmp, outs);</div><div class="line">	</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it ;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; size*(size<span class="number">-1</span>); i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">for</span>(it = outs[i].begin();  it != outs[i].end(); it++)</div><div class="line">			<span class="built_in">cout</span>&lt;&lt; *it &lt;&lt; <span class="string">' '</span> ; </div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"\n"</span> &lt;&lt; <span class="built_in">endl</span> ;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/10/MIT-s094/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/10/MIT-s094/" itemprop="url">MIT 6.S094 Deep Learning for Self Driving Cars</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-10T16:45:19-04:00">
                2018-08-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/10/MIT-s094/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/10/MIT-s094/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Deep-Reinforcement-Learning-link"><a href="#1-Deep-Reinforcement-Learning-link" class="headerlink" title="1 Deep Reinforcement Learning link"></a>1 Deep Reinforcement Learning <a href="https://www.dropbox.com/s/2z7276330jaw37k/lecture2.pdf?dl=1" target="_blank" rel="external">link</a></h2><pre><code>apps:  motion planning 
</code></pre><h2 id="2-Convolutional-Neural-Networks-link"><a href="#2-Convolutional-Neural-Networks-link" class="headerlink" title="2 Convolutional Neural Networks link"></a>2 Convolutional Neural Networks <a href="https://www.dropbox.com/s/q34bi7t0udms01x/lecture3.pdf?dl=1" target="_blank" rel="external">link</a></h2><pre><code>apps: End-2-end driving task(pedestrian detect)
</code></pre><h2 id="3-Recurrent-Neural-Networks-link"><a href="#3-Recurrent-Neural-Networks-link" class="headerlink" title="3 Recurrent Neural Networks link"></a>3 Recurrent Neural Networks <a href="https://goo.gl/qG4Ys9" target="_blank" rel="external">link</a></h2><pre><code>apps: steering control through time
</code></pre><h3 id="CNN-Project-DeepTesla"><a href="#CNN-Project-DeepTesla" class="headerlink" title="CNN Project: DeepTesla"></a>CNN Project: <a href="http://selfdrivingcars.mit.edu/deeptesla/" target="_blank" rel="external">DeepTesla</a></h3><h3 id="DRL-Project-DeepTraffic"><a href="#DRL-Project-DeepTraffic" class="headerlink" title="DRL Project: DeepTraffic"></a>DRL Project: <a href="http://selfdrivingcars.mit.edu/deeptraffic/" target="_blank" rel="external">DeepTraffic</a></h3><h3 id="Framework-ConvNetJS"><a href="#Framework-ConvNetJS" class="headerlink" title="Framework:  ConvNetJS"></a>Framework:  <a href="https://github.com/karpathy/convnetjs" target="_blank" rel="external">ConvNetJS</a></h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/10/C-template-and-STL-containers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/10/C-template-and-STL-containers/" itemprop="url">C++ template and STL containers</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-10T16:36:52-04:00">
                2018-08-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/10/C-template-and-STL-containers/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/10/C-template-and-STL-containers/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I used C++ couple years already, but never take a close look at it. when looking back to few C++ demo works at school, I had a strong feeling at that time, to make the code running is my only goal, how it work or how to improve it, is always ignored, I am afraid in the language details, as the wisdom say: the evil is in details.</p>
<p>after working for three years, I feel the necessary and urgent to back to the language itself(e.g. Linux, C/C++) as the first step to move forward in application development. Frameworks, engineering-based APIs are more close to final products, making them easy to be attracted, compared to how the details implemented. like the mechanical undergradute students, who first-time run ABAQUS with beatiful visulized results, feels so good. </p>
<p>anyway I have to delay the short satification or self-feeling-good. C is clean and the applications have clear structure, C++ is more metaphysics, I even don’t know where to start. even I thought I knew C++ well, but actualy there are many details behind, e.g. allocator in STL.</p>
<h2 id="template"><a href="#template" class="headerlink" title="template"></a>template</h2><p>template is used for generic programming, e.g. both vector<int> and vector<user-define-object> smell same at compiler time. Template reels off or abstract the common part “vector” as a container, and whatever type is ok to store in.  </user-define-object></int></p>
<h3 id="function-template"><a href="#function-template" class="headerlink" title="function template"></a>function template</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></div><div class="line">	<span class="title">void</span> <span class="title">func</span>(<span class="title">T</span> <span class="title">arg</span>)</div><div class="line"></div><div class="line"><span class="title">template</span> &lt;typename T&gt;</div><div class="line">	<span class="title">void</span> <span class="title">func</span>(<span class="title">T</span> <span class="title">arg</span>)</div><div class="line"></div><div class="line"><span class="title">template</span> &lt;class T&gt;</div><div class="line">	<span class="title">T</span> <span class="title">add</span>(<span class="title">T</span> <span class="title">n1</span>, <span class="title">int</span> <span class="title">v</span>)&#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>, <span class="title">class</span> <span class="title">T2</span>, <span class="title">class</span> <span class="title">T3</span>&gt;</span></div><div class="line">	<span class="title">T3</span> <span class="title">func</span>(<span class="title">T1</span> <span class="title">a1</span>, <span class="title">T2</span> <span class="title">a2</span>, <span class="title">int</span> <span class="title">arg3</span>=3)&#123;&#125;;</div></pre></td></tr></table></figure>
<p>the actual meaning of TYPE is deduced by compiler depending on the arg passed to this function.  “class” or “typename” is similar.</p>
<p>template supports default parameters, once the i-th argument is set with default value, all arguments after it must using default values.</p>
<h3 id="class-template"><a href="#class-template" class="headerlink" title="class template"></a>class template</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>, <span class="title">class</span> _<span class="title">Ref</span>, <span class="title">class</span> _<span class="title">Ptr</span>&gt;</span></div><div class="line"><span class="title">class</span> _<span class="title">list_iterator</span> &#123;</div><div class="line">	<span class="keyword">typedef</span> _List_iterator&lt;_Tp, _Tp&amp;, _Tp*&gt;  iterator ;</div><div class="line">	<span class="keyword">typedef</span> _List_iterator&lt;_Tp, <span class="keyword">const</span> _Tp&amp;, <span class="keyword">const</span> _Tp*&gt;  const_iterator ;</div><div class="line">	<span class="keyword">typedef</span> _List_iterator&lt;_Tp, _Ref, _Ptr&gt;  _Self ;</div><div class="line"></div><div class="line">	<span class="keyword">typedef</span> _Tp value_type ;</div><div class="line">	<span class="keyword">typedef</span> _Ptr  pointer;</div><div class="line">	<span class="keyword">typedef</span> _Ref  reference ;</div><div class="line">	<span class="keyword">typedef</span> _List_node&lt;_Tp&gt;  _Node; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>feel the power of template in STL source code. </p>
<h2 id="STL-containers"><a href="#STL-containers" class="headerlink" title="STL containers"></a>STL containers</h2><p>references:<br>&lt;&lt; the annotated STL source using SGI STL &gt;&gt; by jjHou<br><a href="https://rawgit.com/google/cxx-std-draft/allocator-paper/allocator_user_guide.html" target="_blank" rel="external">a visitor guide to C++ allocator</a><br><a href="https://www.kancloud.cn/digest/stl-sources/177262" target="_blank" rel="external">the annotated STL source</a><br>I took several days to start, cause the first section on allocator already blocked me.</p>
<h3 id="why-allocator"><a href="#why-allocator" class="headerlink" title="why allocator ?"></a>why allocator ?</h3><p>The logic of a dynamic container doesn’t depend on the specifies of how memory is obtained; namely, the design of container classes should be decoupled from the memory allocation policy. </p>
<h3 id="how-allocator-works"><a href="#how-allocator-works" class="headerlink" title="how allocator works ?"></a>how allocator works ?</h3><p>memory allocation and object construction is separated, allocator has four operations: allocate(), deallocate(), construct(), destroy(). there are std interface to allocators</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">AllocTraits = <span class="built_in">std</span>::allocator_traits&lt;alloc&gt; </div><div class="line"><span class="comment">// define an allocator of type "alloc" </span></div><div class="line">AllocTraits::pointer  p = AllocTraits::allocate(a, n)  </div><div class="line"><span class="comment">//get memory space for n objects of type T, but not construct yet </span></div><div class="line">AllocTraits::construct(a, trueaddress(ptr), x, y, z) ;    <span class="comment">//construct a T(x, y, z)</span></div><div class="line">AllocTraits::destroy(a, trueaddress(ptr));  <span class="comment">// ~T()</span></div><div class="line">AllocTraits::deallocate(a, ptr, <span class="number">1</span>) ;   <span class="comment">// deallocate the space for one T object</span></div></pre></td></tr></table></figure>
<p>WHEN we say A is an allocator for T , where T is a type e.g. AllocatTraits::value_type. we mean, A knows how to obtain and release memory to store objects of type T. <a href="https://github.com/cacay/MemoryPool/blob/master/C-11/" target="_blank" rel="external">git:allocator</a></p>
<h3 id="iterator"><a href="#iterator" class="headerlink" title="iterator"></a>iterator</h3><p>iterator is used to build algorithms in containers. while I don’t really get the traits </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> _<span class="title">Iterator</span>&gt;</span></div><div class="line"><span class="title">struct</span> <span class="title">iterator_traits</span> &#123;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::iterator_category  iterator_category ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::value_type	 value_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::difference_type  difference_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::pointer	pointer;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Iterator::reference reference ;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> _<span class="title">Tp</span>&gt;</span></div><div class="line"><span class="title">struct</span> <span class="title">iterator_traits</span>&lt;_Tp*&gt; &#123;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> random_access_iterator_tag  iterator_category ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Tp	 value_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="keyword">ptrdiff_t</span>  difference_type ;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Tp*	pointer;</div><div class="line">	<span class="keyword">typedef</span> <span class="keyword">typename</span> _Tp&amp; eference ;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><p>std::vector is dynamic, continous.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">template &lt;class _Tp,  class _Alloc = __STL_DEFAULT_ALLOCATOR(_Tp)&gt;</div><div class="line">class vector:: protected _Vector_base&lt;_Tp,  _Alloc&gt;</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef  _Tp value_type ;</div><div class="line">		typedef  value_type*  pointer ;</div><div class="line">		typedef  const value_type*  const_pointer ;</div><div class="line">		typedef value_type* iterator ;</div><div class="line">		typedef const value_type*  const_iterator ;</div><div class="line"></div><div class="line">		iterator begin() &#123;return _M_start;&#125;;</div><div class="line">		iterator end() &#123;return _M_finish ;&#125;;</div><div class="line"></div><div class="line">	protected:</div><div class="line">		_Tp* _M_start ; // the starting point of current used space </div><div class="line">		_Tp* _M_finish; // the ending point of current sued space </div><div class="line">	      _Tp*  _M_end_of_storage; // the end of total avialable space(capacity)</div><div class="line"></div><div class="line">	public:</div><div class="line">		explicit vector(const allocator_type&amp; __a = allocator_type())</div><div class="line">			: _Base(__a)&#123;&#125;  //default constructor </div><div class="line"></div><div class="line">		// construt of n elements of initial-value </div><div class="line">		vector(size_type __n, const _Tp&amp; __value, const allocator_type&amp; __a = allocator_type())</div><div class="line">			: _Base(__n, __a)</div><div class="line">		&#123;</div><div class="line">			_M_finish = uninitialized_fill_n(_M_start, __n, __value);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//copy construtor</div><div class="line">		vector(const vector&lt;_Tp, _Alloc&gt;&amp; __x)</div><div class="line">			:_Base(__x.size(),  __x.get_allocator())</div><div class="line">		&#123;</div><div class="line">			_M_finish = uninitialized_copy(__x.begin(),  __x.end(), _M_start);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		size_type  size() const &#123;return size_type(end() - begin());&#125;</div><div class="line">		size_type capacity() const &#123;return size_type(_M_end_of_storage - begin()); </div><div class="line">		bool empty() const&#123;return begin() == end();&#125;</div><div class="line">		reference operator[](size_type __n)&#123;return *(begin() + __n);&#125;</div><div class="line">		void reserve(size_type __n)&#123;</div><div class="line">			if (capacity() &lt; __n)</div><div class="line">			&#123;</div><div class="line">				const size_type __old_size = size(); </div><div class="line">				iterator __tmp = _M_allocate_and_copy(__n, _M_start, _M_finish);</div><div class="line">				destroy(_M_start, _M_finish);</div><div class="line">				_M_deallocate(_M_start, _M_end_of_storage-_M_start); </div><div class="line"></div><div class="line">				_M_start = __tmp;</div><div class="line">				_M_finish = __tmp + __old_size ;</div><div class="line">				_M_end_of_storage = _M_start + __n ;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void push_back(const _Tp&amp; __x)</div><div class="line">		&#123;</div><div class="line">			if(_M_finish != _M_end_of_storage)</div><div class="line">			&#123;</div><div class="line">				construct(_M_finish, __x);</div><div class="line">				++_M_finish;</div><div class="line">			&#125;else</div><div class="line">				_M_insert_aux(end(), __x);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		template&lt;class _Tp,  class _Alloc&gt;</div><div class="line">		inline bool operator==(const vector&lt;_Tp, _Alloc&gt;&amp; __x, const vector&lt;_Tp, _Alloc&gt;&amp; __y)</div><div class="line">		&#123;</div><div class="line">			return __x.size() == __y.size() &amp;&amp; </div><div class="line">			equal(__x.begin(), __x.end(), __y.begin());</div><div class="line">		&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>std::list is cycling double-direction link list.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">struct _List_node_base </div><div class="line">&#123;</div><div class="line">	_List_node_base * _M_next ;</div><div class="line">	_List_node_base * _M_prev ;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template &lt;class _Tp&gt;</div><div class="line">struct _List_node : public _List_node_base </div><div class="line">&#123;</div><div class="line">	_Tp _M_data;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">struct _List_iterator_base </div><div class="line">&#123;</div><div class="line">	typedef size_t   size_type ;</div><div class="line">	typedef ptrdiff_t   difference_type ;</div><div class="line">	typedef bidirectional_iterator_tag  iterator_category; </div><div class="line"></div><div class="line">	_List_node_base*  _M_node ;</div><div class="line"></div><div class="line">	//constructor </div><div class="line">	_List_iterator_base(_List_node_base* __x) : _M_node(__x)&#123;&#125;</div><div class="line">	_List_iterator_base()&#123;&#125;;</div><div class="line"></div><div class="line">	void _M_incr() &#123; _M_node = _M_node-&gt;_M_next; &#125;;</div><div class="line">	void _M_decr() &#123; _M_node = _M_node-&gt;_M_prev; &#125;;</div><div class="line">	bool operator==(const _List_iterator_base&amp; __x) const</div><div class="line">	&#123;</div><div class="line">		return _M_node == __x.M_node ;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template&lt;class _Tp,  class _Ref,  class _Ptr&gt;</div><div class="line">struct _List_iterator : public _List_iterator_base </div><div class="line">&#123;</div><div class="line">	typedef _List_iterator&lt;_Tp, _Tp&amp;, _Tp*&gt;  iterator ;</div><div class="line">	typedef _List_iterator&lt;_Tp, const _Tp&amp;, const _Tp*&gt;  const_iterator ;</div><div class="line">	typedef _List_iterator&lt;_Tp, _Ref, _Ptr&gt;  _Self ;</div><div class="line"></div><div class="line">	typedef _Tp value_type ;</div><div class="line">	typedef _Ptr  pointer;</div><div class="line">	typedef _Ref  reference ;</div><div class="line">	typedef _List_node&lt;_Tp&gt;  _Node; </div><div class="line"></div><div class="line">	//constructor </div><div class="line">	_List_iterator(_Node* __x): _List_iterator_base(__x)&#123;&#125;</div><div class="line">	_List_iterator()&#123;&#125;</div><div class="line"></div><div class="line">	reference operator*() const &#123;return ( (_Node*) _M_node)-&gt;_M_data; &#125;</div><div class="line"></div><div class="line">	_Self&amp;  operator++()</div><div class="line">	&#123;</div><div class="line">		this-&gt;_M_incr();</div><div class="line">		return *this;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template &lt;class _Tp,  class _Alloc=_STL_DEFAULT_ALLOCATOR(_Tp)&gt;</div><div class="line">class list : protected _List_base&lt;_Tp, _Alloc&gt;</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef _List_node&lt;_Tp&gt; _Node;</div><div class="line">	protected:</div><div class="line">		_List_node&lt;_Tp&gt; * _M_node; </div><div class="line">	public:</div><div class="line">		list(size_type __n,   const _Tp&amp;  __value,</div><div class="line">			const allocator_type&amp; __a = allocator_type())</div><div class="line">			: Base_(__a)</div><div class="line">		&#123;</div><div class="line">			insert(begin(), __n, __value);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		explicit list(size_type __n)</div><div class="line">			:_Base(allocator_type())</div><div class="line">		&#123;</div><div class="line">			insert(begin(), __n, _Tp());</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	protected:</div><div class="line">		_Node* _M_create_node(const _Tp&amp; __x)</div><div class="line">		&#123;</div><div class="line">			_Node* __p = _M_get_node(); </div><div class="line">			__STL_TRY</div><div class="line">			&#123;</div><div class="line">				_Construct(&amp;_p-&gt;_M_data, __x);</div><div class="line">			&#125;</div><div class="line">			return __p;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	public:</div><div class="line">		iterator begin() &#123; return (_Node*)(_M_node-&gt;_M_next);&#125;</div><div class="line">		iterator end() &#123; return _M_node; &#125;</div><div class="line">		bool empty() const &#123;return _M_node-&gt;_M_next == _M_node ;&#125; </div><div class="line">		size_type size() const &#123;</div><div class="line">			size_type  __result = 0;</div><div class="line">			distance( begin(),  end(), __result);</div><div class="line">			return __result;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		size_type max_size() const &#123;return size_type(-1);&#125;</div><div class="line">		reference front() &#123;return *begin();&#125;</div><div class="line">		reference back() &#123;return *(--end());&#125;</div><div class="line">		void swap(list&lt;_Tp, _Alloc&gt;&amp; __x)</div><div class="line">		&#123;</div><div class="line">			__STD::swap(_M_node, __x._M_node);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		interator insert(iterator __position,  const _Tp&amp; __x)</div><div class="line">		&#123;</div><div class="line">			_Node* __tmp = _M_create_node(__x);</div><div class="line"></div><div class="line">			__tmp-&gt;_M_next = __position._M_node ;</div><div class="line">			__tmp-&gt;_M_prev = __position._M_node-&gt;_M_prev ;</div><div class="line">			</div><div class="line">			__position._M_node-&gt;_M_prev-&gt;_M_next = __tmp;</div><div class="line">			__position._M_node-&gt;_M_prev  = __tmp;</div><div class="line">			</div><div class="line">			return __tmp;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void push_front(const _Tp&amp; __x)&#123;insert(begin(), __x);&#125;</div><div class="line">		void push_back(const _Tp&amp; __x)&#123;insert(end(), __x);&#125;</div><div class="line"></div><div class="line">		iterator erase(iterator __position)</div><div class="line">		&#123;</div><div class="line">			_List_node_base* __next_node = __position._M_node-&gt;_M_next ;</div><div class="line">			_List_node_base* __prev_node = __position._M_node-&gt;_M_prev ;</div><div class="line"></div><div class="line">			_Node* __n = (_Node*) __position._M_node ;</div><div class="line"></div><div class="line">			__prev_node-&gt;next = __next_node ;</div><div class="line">			__next_node-&gt;prev = __prev_node;</div><div class="line">	</div><div class="line">			_Destroy(&amp;__n-&gt;_M_data);</div><div class="line">			_M_put_data(__n);</div><div class="line">			return iterator((_Node*) __next_node);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="dequeue"><a href="#dequeue" class="headerlink" title="dequeue"></a>dequeue</h3><p>std::dequeue can operate elements at both ends, and the memory is multi-sectional, in each memory section is linear continous, with advantage of vector and list.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line">template &lt;class _Tp,  class _Ref,  class _Ptr&gt;</div><div class="line">struct _Deque_iterator &#123;</div><div class="line">	typedef _Deque_iterator&lt;_Tp, _Tp&amp;, _Tp*&gt;   iterator ;</div><div class="line">	typedef _Deque_iterator&lt;_Tp, const _Tp&amp;, const  _Tp*&gt;  const_iterator ;</div><div class="line">	static size_t _S_buffer_size() &#123;return __deque_buf_size(sizeof(_Tp));&#125;</div><div class="line"></div><div class="line">	typedef random_access_iterator_tag  iterator_category;</div><div class="line">	typedef _Tp value_type ;</div><div class="line">	typedef _Ptr  pointer;</div><div class="line">	typedef _Ref reference;</div><div class="line">	typedef size_t  size_type ;</div><div class="line">	typedef ptrdiff_t  difference_type ;</div><div class="line">	typedef _Tp** _Map_pointer ;</div><div class="line"></div><div class="line">	typedef _Deque_iterator _Self; </div><div class="line"></div><div class="line"></div><div class="line">	_Tp* _M_cur ; //current point in cache</div><div class="line">	_Tp* _M_first; //first point in cache</div><div class="line">	_Tp* _M_last; </div><div class="line">	_Map_pointer _M_node ; </div><div class="line">	/* deque support multi-section memory space, in each memory section is linear continous</div><div class="line">	 * Map index is used to point to the memory sections</div><div class="line">	 */</div><div class="line">	</div><div class="line">	_Deque_iterator(_Tp* __x, _Map_pointer __y)</div><div class="line">		:_M_cur(__x), </div><div class="line">		 _M_first(*__y),</div><div class="line">		 _M_last(*__y + _S_buffer_size()), </div><div class="line">		 _M_node(__y)</div><div class="line">	&#123;&#125;</div><div class="line"></div><div class="line">	//default </div><div class="line">	//copy</div><div class="line">	</div><div class="line">	difference_type operator-(const _Self&amp; __x) const</div><div class="line">	&#123;</div><div class="line">		return difference_type(_S_buffer_size()) *  (_M_node - __x.M_node - 1) + </div><div class="line">			(_M_cur - _M_first) + (__x._M_last - __x._M_cur);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_Self&amp; operator++()</div><div class="line">	&#123;</div><div class="line">		++_M_cur ; </div><div class="line">		if(_M_cur == _M_last)&#123;</div><div class="line">			_M_set_node(_M_node + 1);</div><div class="line">			_M_cur = _M_first;</div><div class="line">		&#125;</div><div class="line">		return *this;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_Self&amp; operator--()</div><div class="line">	&#123;</div><div class="line">		if(_M_cur == _M_first)&#123;</div><div class="line">			_M_set_node(_M_node - 1);</div><div class="line">			_M_cur = _M_last;</div><div class="line">		&#125;</div><div class="line">		--_M_cur ;</div><div class="line">		return *this;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">	</div><div class="line">/*  deque has two iterator:</div><div class="line">   start -&gt; the first element in first cache space;  </div><div class="line">   finish -&gt; the last element in last cache space */</div><div class="line"></div><div class="line">template &lt;class _Tp,  class _Alloc&gt;</div><div class="line">class _Deque_base &#123;</div><div class="line">	protected:		</div><div class="line">		_Tp** _M_map ;</div><div class="line">		size_t _M_map_size; </div><div class="line">		iterator _M_start;</div><div class="line">		iterator _M_finish;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">template &lt;class _Tp,  class _Alloc = __STL_DEFAULT_ALLOCATOR(_Tp)&gt;</div><div class="line">class deque : protected _Deque_base&lt;_Tp, _Alloc&gt;</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef typename _Base::iterator  iterator ;</div><div class="line">		typedef typename _Base::const_iterator  const_iterator ;</div><div class="line">	protected:</div><div class="line">		using _Base::_M_map ; </div><div class="line">		using _Base::_M_map_size ;</div><div class="line">		using _Base::_M_start ; </div><div class="line">		using _Base::_M_finish ;</div><div class="line"></div><div class="line">	public:</div><div class="line">		explicit deque(const allocator_type&amp; __a = allocator_type())</div><div class="line">			:_Base(__a, 0)</div><div class="line">		&#123;&#125;</div><div class="line"></div><div class="line">		deque(const deque&amp; __x):</div><div class="line">			_Base(__x.get_allocator(), __x.size())</div><div class="line">		&#123;</div><div class="line">			uninitialized_copy(__x.begin(),  __x.end(), _M_start);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		~deque()&#123; destroy(_M_start, _M_finish);&#125;</div><div class="line"></div><div class="line">		void push_back(const value_type&amp; __t)</div><div class="line">		&#123;</div><div class="line">			if(_M_finish._M_cur != _M_finish._M_last - 1)</div><div class="line">			&#123;</div><div class="line">				construct(_M_finish._M_cur, __t);</div><div class="line">				++_M_finish._M_cur ;</div><div class="line">			&#125;else</div><div class="line">				_M_push_back_aux(__t);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void push_front(const value_type&amp;  __t)</div><div class="line">		&#123;</div><div class="line">			if(_M_start._M_cur != _M_start._M_first)</div><div class="line">			&#123;</div><div class="line">				construct(_M_start._M_cur - 1,  __t);</div><div class="line">				--_M_start._M_cur;</div><div class="line">			&#125;else</div><div class="line">				_M_push_front_aux(__t);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void pop_back()</div><div class="line">		&#123;</div><div class="line">			if(_M_finish._M_cur != _M_finish._M_first)</div><div class="line">			&#123;</div><div class="line">				--_M_finish._M_cur;</div><div class="line">				destroy(_M_finish._M_cur);</div><div class="line">			&#125;else</div><div class="line">				_M_pop_back_aux();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		void pop_front()</div><div class="line">		&#123;</div><div class="line">			if(_M_start._M_cur != _M_start._M_last -1)</div><div class="line">			&#123;</div><div class="line">				destroy(_M_start._M_cur);</div><div class="line">				++_M_start._M_cur;</div><div class="line">			&#125;else</div><div class="line">				_M_pop_back_aux();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		iterator insert(iterator position, const value_type&amp;  __x)</div><div class="line">		&#123;</div><div class="line">			if(position._M_cur == _M_start._M_cur)</div><div class="line">			&#123;</div><div class="line">				push_front(__x);</div><div class="line">				return _M_start;</div><div class="line">			&#125;else if(position._M_cur == _M_finish._M_cur)</div><div class="line">			&#123;</div><div class="line">				push_back(__x);</div><div class="line">				iterator __tmp = _M_finish;</div><div class="line">				--__tmp;</div><div class="line">				return __tmp;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h3><p>std::stack only operate on the top element (first in last out), can’t iterate the container, the default container for stack is deque. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">temlate &lt;class _Tp, class _Sequence&gt;</div><div class="line">class stack</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef typname _Sequence::value_type  value_type ;</div><div class="line">		typedef typname _Sequence::size_type   size_type ;</div><div class="line">		typedef typname _Sequence	  container_type ;</div><div class="line">		typedef typname _Sequence::reference  reference ;</div><div class="line">		typedef typname _Sequence::const_reference const_reference;</div><div class="line">	protected:</div><div class="line">		_Sequence c;  // the fundmental container:  deque by default</div><div class="line">	public:</div><div class="line">		stack() : c() &#123;&#125;</div><div class="line">		explicit stack(const _Sequence&amp; __s) : c(__s) &#123;&#125;</div><div class="line">		</div><div class="line">		bool empty() const &#123; return c.empty();&#125;</div><div class="line">		size_type size() const &#123;return c.size();&#125;</div><div class="line">		reference top() &#123;return c.back(); &#125;</div><div class="line">		void push(const value_type&amp; __x)&#123; c.push_back(__x);&#125;</div><div class="line">		void pop() &#123; c.pop_back();&#125;</div><div class="line">	</div><div class="line">		template&lt;class _Tp,  class _Seq&gt;</div><div class="line">			bool operator==(const stack&lt;_Tp, _Seq&gt;&amp; __x, const stack&lt;_Tp, _Seq&gt;&amp; __y)</div><div class="line">			&#123;</div><div class="line">				return __x.c == __y.c ;</div><div class="line">			&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h2><p>std::queue supports only pop element from front, and push element into end, the default container is dequeue </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">template &lt;class _Tp, class _Sequence&gt;</div><div class="line">class queue</div><div class="line">&#123;</div><div class="line">	public:</div><div class="line">		typedef typname _Sequence::value_type  value_type ;</div><div class="line">		typedef typname _Sequence::size_type   size_type ;</div><div class="line">		typedef typname _Sequence	  container_type ;</div><div class="line">		typedef typname _Sequence::reference  reference ;</div><div class="line">		typedef typname _Sequence::const_reference const_reference;</div><div class="line">	protected:</div><div class="line">		_Sequence c;  // the fundmental container:  deque by default</div><div class="line">	public:</div><div class="line">		queue() : c() &#123;&#125;</div><div class="line">		explicit queue(const _Sequence&amp; __s) : c(__s) &#123;&#125;</div><div class="line"></div><div class="line">		bool empty() const &#123; return c.empty();&#125;</div><div class="line">		size_type size() const &#123;return c.size();&#125;</div><div class="line">		reference top() &#123;return c.back(); &#125;</div><div class="line">		void push(const value_type&amp; __x)&#123; c.push_back(__x);&#125;</div><div class="line">		void pop() &#123; c.pop_front();&#125;</div><div class="line">	</div><div class="line">		template&lt;class _Tp,  class _Seq&gt;</div><div class="line">			bool operator==(const queue&lt;_Tp, _Seq&gt;&amp; __x, const queue&lt;_Tp, _Seq&gt;&amp; __y)</div><div class="line">			&#123;</div><div class="line">				return __x.c == __y.c ;</div><div class="line">			&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="priority-queue"><a href="#priority-queue" class="headerlink" title="priority queue"></a>priority queue</h3><p>std::priority_queue is queue with priority.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/02/design-a-threadpool-in-pure-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/02/design-a-threadpool-in-pure-C/" itemprop="url">design a threadpool in pure C</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-02T00:44:08-04:00">
                2018-08-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/02/design-a-threadpool-in-pure-C/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/02/design-a-threadpool-in-pure-C/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>actually this post should be named as “pure C multithreads”, while it’s better to write some real code. <a href="https://github.com/Pithikos/C-Thread-Pool" target="_blank" rel="external">a simple threadpool in pure C</a></p>
<h2 id="exposed-APIs"><a href="#exposed-APIs" class="headerlink" title="exposed APIs"></a>exposed APIs</h2><p>at most simple case, what a threadpool object should do? </p>
<pre><code>thpool_init(num_threads);
thpool_destory(threapool_obj);
thpool_add_work(callback, args); 
// so user define event callback() can be passed in;  
</code></pre><p>threadpool is used to assign jobs (from job list) to a thread. so joblist should be an internal class; and it’s better to package thread, job as separate class too;  to add work, what kind of funcs need for joblist ?  at least, to add new job(from outside) to the joblist.</p>
<h2 id="internal-structures"><a href="#internal-structures" class="headerlink" title="internal structures:"></a>internal structures:</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread</span> &#123;</span></div><div class="line"> 	<span class="keyword">int</span> id;</div><div class="line"> 	<span class="keyword">pthread_t</span> thread;   <span class="comment">//pthread_t is a unsigned long int; it's system assigned</span></div><div class="line"> 	threadpool *thpool;  <span class="comment">//so thread know its domain</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">job</span> &#123;</span></div><div class="line">	(<span class="keyword">void</span>*) func(<span class="keyword">void</span>*); <span class="comment">// each job/task should have a callback func</span></div><div class="line">	(<span class="keyword">void</span>*) func_arg ; <span class="comment">//and func args</span></div><div class="line">	<span class="comment">//since consider joblist as a list, it's helpful to add pointers to neighbors</span></div><div class="line">	job* prev;</div><div class="line">	job* next;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">jobqueue</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> num_jobs;</div><div class="line">    job* front;</div><div class="line">    job* rear;</div><div class="line">    <span class="comment">//some flags to support add new node(job) to the list</span></div><div class="line"></div><div class="line">&#125;    </div><div class="line">   	 </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">threadpool_</span> &#123;</span></div><div class="line">    thread* threads_array;</div><div class="line">    jobqueue job_queue;</div><div class="line">    <span class="comment">// some flags</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="consider-syncronlization"><a href="#consider-syncronlization" class="headerlink" title="consider syncronlization"></a>consider syncronlization</h2><p>will multi threads call add_task() simutaneously? if so, jobqueue should have a mutex object;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">jobqueue</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> num_jobs;</div><div class="line">    job* front;</div><div class="line">    job* rear;</div><div class="line">    <span class="keyword">pthread_mutex_t</span>  jq_mutex;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>during threadpool initialization, will all threads be created simultaneously and immediately? if not, there should be thread status flags (creating, exisiting-but-idle, working, died); and to update these flags need protect by mutex object;    </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">threadpool_</span> &#123;</span></div><div class="line">    thread* threads_array;</div><div class="line">    jobqueue job_queue;</div><div class="line">    <span class="keyword">int</span> num_threads; <span class="comment">//stands for the number of all existing threads</span></div><div class="line">    <span class="keyword">pthread_mutex_t</span> tp_mutex;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>this is an interesting, when design a lib, what’s in my mind. hopefully implement by the end of week.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">180</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
