<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Docker,X11," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="XorgXorg is client-server architecture, including Xprotocol, Xclient, Xserver. Linux itself has no graphics interface, all GUI apps in Linux is based on X protcol. Xserver used to manage the Display d">
<meta name="keywords" content="Docker,X11">
<meta property="og:type" content="article">
<meta property="og:title" content="X11 GUI in docker">
<meta property="og:url" content="http://yoursite.com/2019/11/29/X11-GUI-in-docker/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="XorgXorg is client-server architecture, including Xprotocol, Xclient, Xserver. Linux itself has no graphics interface, all GUI apps in Linux is based on X protcol. Xserver used to manage the Display d">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://www.ipaomi.com/wp-content/uploads/2017/11/x_server_client_remote.gif">
<meta property="og:updated_time" content="2019-11-29T13:46:30.575Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="X11 GUI in docker">
<meta name="twitter:description" content="XorgXorg is client-server architecture, including Xprotocol, Xclient, Xserver. Linux itself has no graphics interface, all GUI apps in Linux is based on X protcol. Xserver used to manage the Display d">
<meta name="twitter:image" content="http://www.ipaomi.com/wp-content/uploads/2017/11/x_server_client_remote.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/11/29/X11-GUI-in-docker/"/>





  <title>X11 GUI in docker | Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/29/X11-GUI-in-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">X11 GUI in docker</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-29T08:43:13-05:00">
                2019-11-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/11/29/X11-GUI-in-docker/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/11/29/X11-GUI-in-docker/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Xorg"><a href="#Xorg" class="headerlink" title="Xorg"></a>Xorg</h2><p>Xorg is client-server architecture, including Xprotocol, Xclient, Xserver. Linux itself has no graphics interface, all GUI apps in Linux is based on X protcol.</p>
<p>Xserver used to manage the Display device, e.g. monitor, Xserver is responsible for displaying, and send the device input(e.g. keyboard click) to Xclient.</p>
<p>Xclient, or X app, which includes grahics libs, e.g. OpenGL, Vulkan e.t.c</p>
<h4 id="xauthority"><a href="#xauthority" class="headerlink" title="xauthority"></a>xauthority</h4><p>Xauthority file can be found in each user home directory and is used to store credentials in cookies used by xauth for authentication of X sessions. Once an X session is started, the cookie is used to authenticate connections to that specific display. You can find more info on X authentication and X authority in the xauth man pages (type man xauth in a terminal). if you are not the owner of this file you can’t login since you can’t store your credentials there.</p>
<p>when <code>Xorg</code> starts, <code>.Xauthority</code> file is send to Xorg, review this file by <code>xauth -f ~/.Xauthority</code> </p>
<p>ubuntu@ubuntu:~$ xauth -f ~/.Xauthority<br>Using authority file /home/wubantu/.Xauthority<br>xauth&gt; list<br>ubuntu/unix:1  MIT-MAGIC-COOKIE-1  ee227cb9465ac073a072b9d263b4954e<br>ubuntu/unix:0  MIT-MAGIC-COOKIE-1  71cdd2303de2ef9cf7abc91714bbb417<br>ubuntu/unix:10  MIT-MAGIC-COOKIE-1  7541848bd4e0ce920277cb0bb2842828</p>
<p><code>Xserver</code> is the host who will used to display/render graphics, and the other host is <code>Xclient</code>. if Xclient is from remote host, then need configure $DISPLAY in <code>Xserver</code>. To display X11 on remote Xserver,  need to copy the .Xauthority from Xserver to Xclient machine, and export $DISPLAY and $XAUTHORITY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export DISPLAY=&#123;Display number stored in the Xauthority file&#125;</div><div class="line">export XAUTHORITY=&#123;the file path of .Xauthority&#125;</div></pre></td></tr></table></figure>
<h4 id="xhost"><a href="#xhost" class="headerlink" title="xhost"></a>xhost</h4><p><a href="https://www.linuxidc.com/Linux/2012-11/74874.htm" target="_blank" rel="external">Xhost</a> is used to grant access to Xserver (on your local host), by default, the local client can access the local Xserer, but any remote client need get granted first through Xhost. taking an example, when ssh from hostA to hostB, and run <code>glxgears</code> in this ssh shel. for grahics/GPU resources,  hostA is used to display, so hostA is the Xserver.</p>
<h4 id="x11-forwarding"><a href="#x11-forwarding" class="headerlink" title="x11 forwarding"></a>x11 forwarding</h4><p>when Xserver and Xclient are in the same host machine, nothing big deal. but Xserver, Xclient can totally be on different machines, as well as Xprotocol communication between them. this is how SSH -X helps to run the app in Xclient, and display in Xserver, which needs <code>X11 Forwarding</code>.</p>
<p><img src="http://www.ipaomi.com/wp-content/uploads/2017/11/x_server_client_remote.gif" alt="image"></p>
<h4 id="test-benchmark"><a href="#test-benchmark" class="headerlink" title="test benchmark"></a>test benchmark</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssh 192.16.0.13</div><div class="line">xeyes</div></pre></td></tr></table></figure>
<h4 id="tmp-X11-unix"><a href="#tmp-X11-unix" class="headerlink" title="/tmp/.X11-unix"></a>/tmp/.X11-unix</h4><p>the X11(xorg) server communicates with client via some kind of reliable stream of bytes. </p>
<p>A Unix-domain socket is like the more familiar TCP ones, except that instead of connecting to an address and port, you connect to a path. You use an actual file (a socket file) to connect.</p>
<pre><code>srwxrwxrwx 1 root root 0 Nov 26 08:49 X0
</code></pre><p>the <code>s</code> in front of the permissions, which means its a socket. If you have multiple X servers running, you’ll have more than one file there.</p>
<p>is where X server put listening AF_DOMAIN sockets. </p>
<h4 id="DISPLAY-device"><a href="#DISPLAY-device" class="headerlink" title="DISPLAY device"></a>DISPLAY device</h4><p>DISPLAY format: <strong>hostname: displaynumber.screennumber</strong></p>
<p>hostname is the hostname or hostname IP of Xserver</p>
<p>displaynumber starting from 0<br>screennumber starting from 0</p>
<p>when using TCP(x11-unix protocol only works when Xclient and Xserver are in the same machine), displaynumber is the connection port number minus 6000; so if displaynumber is 0, namely the port is 6000. <code>DISPLAY</code> refers to a display device, and all graphics will be displayed on this device.<br>by deafult,  Xserver localhost doesn’t listen on TCP port. run: <code>sudo netstat -lnp | grep &quot;6010&quot;</code>, no return. <a href="https://askubuntu.com/questions/1143831/xserver-listen-on-tcp-ubuntu-19-04" target="_blank" rel="external">how to configure Xserver listen on TCP</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Add DisallowTCP=false under directive [security] in /etc/gdm3/custom.conf file. Now open file /etc/X11/xinit/xserverrc and change exec /usr/bin/X -nolisten tcp to exec /usr/bin/X11/X -listen tcp. Then restart GDM with command sudo systemctl restart gdm3. To verify the status of listen at port 6000, issue command ss -ta | grep -F 6000. Assume that $DISPLAY value is :0.</div></pre></td></tr></table></figure>
<h4 id="virtual-DISPLAY-device"><a href="#virtual-DISPLAY-device" class="headerlink" title="virtual DISPLAY device"></a>virtual DISPLAY device</h4><p><a href="https://bbs.archlinux.org/viewtopic.php?id=180904" target="_blank" rel="external">creating a virtual display/monitor</a><br><a href="https://bbs.archlinux.org/viewtopic.php?id=180904" target="_blank" rel="external">add fake display when no Monitor is plugged in</a></p>
<h2 id="Xserver-broadcast"><a href="#Xserver-broadcast" class="headerlink" title="Xserver broadcast"></a>Xserver broadcast</h2><p>the idea behind is to stand in one manager(Xserver) machine, and send command to a bunch of worker(Xclient) machines. the default way is all Xclient will talk to Xserver, which eat too much GPU and network bandwith resources on manager node. so it’s better that each worker node will do the display on its own. and if there is no monitor on these worker nodes, they can survive with virtual display.</p>
<h4 id="xvfb"><a href="#xvfb" class="headerlink" title="xvfb"></a>xvfb</h4><p><a href="http://manpages.ubuntu.com/manpages/xenial/man1/xvfb-run.1.html" target="_blank" rel="external">xvfb</a> is the virtual Xserver solution, but doesn’t run well(need check more)</p>
<h4 id="nvidia-xconfig"><a href="#nvidia-xconfig" class="headerlink" title="nvidia-xconfig"></a>nvidia-xconfig</h4><p><a href="https://devtalk.nvidia.com/default/topic/585014/how-to-configure-x-server-to-work-headless-as-well-with-any-monitor-connected-/" target="_blank" rel="external">configure X server to work headless as well with any monitor connected</a></p>
<h4 id="unity-headless"><a href="#unity-headless" class="headerlink" title="unity headless"></a>unity headless</h4><h2 id="env-setup"><a href="#env-setup" class="headerlink" title="env setup"></a>env setup</h2><p>to test with docker, vulkan, ssh, usually need the following packages: </p>
<h4 id="vulkan-dev-env"><a href="#vulkan-dev-env" class="headerlink" title="vulkan dev env"></a>vulkan dev env</h4><pre><code>sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt upgrade
apt-get install libvulkan1 vulkan vulkan-utils 
sudo apt install vulkan-sdk 
</code></pre><h4 id="nvidia-env"><a href="#nvidia-env" class="headerlink" title="nvidia env"></a>nvidia env</h4><pre><code>install nvidia-driver, nvidia-container-runtime
install mesa-utils  #glxgears
</code></pre><h4 id="docker-env"><a href="#docker-env" class="headerlink" title="docker env"></a>docker env</h4><pre><code>install docker 
</code></pre><h2 id="run-glxgear-vkcube-lgsvl-in-docker-through-ssh-tunnel"><a href="#run-glxgear-vkcube-lgsvl-in-docker-through-ssh-tunnel" class="headerlink" title="run glxgear/vkcube/lgsvl in docker through ssh tunnel"></a>run glxgear/vkcube/lgsvl in docker through ssh tunnel</h2><p>there is a very nice blog: <a href="https://dzone.com/articles/docker-x11-client-via-ssh" target="_blank" rel="external">Docker x11 client via SSH</a>, disccussed the arguments passing to the following samples</p>
<h4 id="run-glxgear"><a href="#run-glxgear" class="headerlink" title="run glxgear"></a>run glxgear</h4><p>glxgear is OpenGL benchmark test. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssh -X -v abc@192.168.0.13</div><div class="line">sudo docker run --runtime=nvidia -ti --rm -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix -v &quot;$HOME/.Xauthority:/root/.Xauthority&quot; --net=host 192.168.0.10:5000/glxgears</div></pre></td></tr></table></figure>
<p>if seting $DISPLAY=localhost:10.0 , then the gears will display at master node(ubuntu)</p>
<p>if setting $DISPLAY=:0,  then the gears will display at worker node(worker)</p>
<p>and w/o <code>/tmp/.X11-unix</code> it works as well. </p>
<h4 id="run-vkcube"><a href="#run-vkcube" class="headerlink" title="run vkcube"></a>run vkcube</h4><p>vkcube is Vulkan benchmark test.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ssh -X -v abc@192.168.0.13</div><div class="line">export DISPLAY=:0</div><div class="line">sudo docker run --runtime=nvidia -ti --rm -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix -v &quot;$HOME/.Xauthority:/root/.Xauthority&quot; --net=host  192.168.0.10:5000/vkcube</div></pre></td></tr></table></figure>
<p>in this way, vkcube is displayed in worker node(namely, using worker GPU resource), manager node has no burden at all. </p>
<p>if <code>$DISPLAY=localhost:10.0</code>, to run vkcube, give errors:</p>
<pre><code>No protocol specified
Cannot find a compatible Vulkan installable client driver (ICD).
Exiting ...
</code></pre><p>looks vulkan has limitation.</p>
<h4 id="run-lgsvl"><a href="#run-lgsvl" class="headerlink" title="run lgsvl"></a>run lgsvl</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export DISPLAY=:0</div><div class="line">sudo docker run --runtime=nvidia -ti --rm -p 8080:8080 -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix -v &quot;$HOME/.Xauthority:/root/.Xauthority&quot; --net=host  192.168.0.10:5000/lgsvl  /bin/bash </div><div class="line">./simulator</div></pre></td></tr></table></figure>
<p>works well! the good news as if take the manager node as the end user monitor, and all worker nodes in cloud, without display, then this parameters will be used in <code>docker service create</code> to host in the swarm. so the next step is to vitual display for each worker node.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://www.x.org/wiki/XServer/" target="_blank" rel="external">wiki: Xorg/Xserver</a><br><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-xwin/index.html" target="_blank" rel="external">IBM study: Xwindows</a><br><a href="https://www.cnblogs.com/ipaomi/p/7830778.html" target="_blank" rel="external">cnblogs: run GUI in remote server</a><br><a href="https://wiki.ubuntu.com/X/Config" target="_blank" rel="external">xorg.conf in ubuntu</a><br><a href="https://docs.citrix.com/en-us/linux-virtual-delivery-agent/current-release/configuration/configure-xauthority.html" target="_blank" rel="external">configure Xauthority</a><br><a href="https://stackoverflow.com/questions/44429394/x11-forwarding-of-a-gui-app-running-in-docker" target="_blank" rel="external">X11 forwarding of a GUI app running in docker</a><br><a href="https://www.cnblogs.com/kevin-boy/p/3223404.html" target="_blank" rel="external">cnblogs: Linux DISPLAY skills</a><br><a href="https://github.com/NVIDIA/nvidia-docker/issues/631" target="_blank" rel="external">nvidia-runtime-container feature: Vulkan support</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Docker/" rel="tag"># Docker</a>
          
            <a href="/tags/X11/" rel="tag"># X11</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/11/26/what-about-Tesla/" rel="next" title="what about Tesla">
                <i class="fa fa-chevron-left"></i> what about Tesla
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/29/recent-thoughts-in-ADS/" rel="prev" title="recent thoughts in ADS">
                recent thoughts in ADS <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">166</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Xorg"><span class="nav-number">1.</span> <span class="nav-text">Xorg</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#xauthority"><span class="nav-number">1.0.1.</span> <span class="nav-text">xauthority</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xhost"><span class="nav-number">1.0.2.</span> <span class="nav-text">xhost</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x11-forwarding"><span class="nav-number">1.0.3.</span> <span class="nav-text">x11 forwarding</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#test-benchmark"><span class="nav-number">1.0.4.</span> <span class="nav-text">test benchmark</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tmp-X11-unix"><span class="nav-number">1.0.5.</span> <span class="nav-text">/tmp/.X11-unix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DISPLAY-device"><span class="nav-number">1.0.6.</span> <span class="nav-text">DISPLAY device</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#virtual-DISPLAY-device"><span class="nav-number">1.0.7.</span> <span class="nav-text">virtual DISPLAY device</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xserver-broadcast"><span class="nav-number">2.</span> <span class="nav-text">Xserver broadcast</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#xvfb"><span class="nav-number">2.0.1.</span> <span class="nav-text">xvfb</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nvidia-xconfig"><span class="nav-number">2.0.2.</span> <span class="nav-text">nvidia-xconfig</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unity-headless"><span class="nav-number">2.0.3.</span> <span class="nav-text">unity headless</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#env-setup"><span class="nav-number">3.</span> <span class="nav-text">env setup</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#vulkan-dev-env"><span class="nav-number">3.0.1.</span> <span class="nav-text">vulkan dev env</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nvidia-env"><span class="nav-number">3.0.2.</span> <span class="nav-text">nvidia env</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#docker-env"><span class="nav-number">3.0.3.</span> <span class="nav-text">docker env</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#run-glxgear-vkcube-lgsvl-in-docker-through-ssh-tunnel"><span class="nav-number">4.</span> <span class="nav-text">run glxgear/vkcube/lgsvl in docker through ssh tunnel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#run-glxgear"><span class="nav-number">4.0.1.</span> <span class="nav-text">run glxgear</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#run-vkcube"><span class="nav-number">4.0.2.</span> <span class="nav-text">run vkcube</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#run-lgsvl"><span class="nav-number">4.0.3.</span> <span class="nav-text">run lgsvl</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#refer"><span class="nav-number">5.</span> <span class="nav-text">refer</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2019/11/29/X11-GUI-in-docker/';
          this.page.identifier = '2019/11/29/X11-GUI-in-docker/';
          this.page.title = 'X11 GUI in docker';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://zjlee.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
