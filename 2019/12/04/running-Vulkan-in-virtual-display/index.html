<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="install xserver-xorg-video-dummyapt-cache search xserver-xorg-video-dummy  apt-get update  sudo apt-get install xserver-xorg-video-dummy which depends on xorg-video-abi-20 and xserver-xorg-core, so ne">
<meta property="og:type" content="article">
<meta property="og:title" content="running Vulkan in virtual display">
<meta property="og:url" content="http://yoursite.com/2019/12/04/running-Vulkan-in-virtual-display/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="install xserver-xorg-video-dummyapt-cache search xserver-xorg-video-dummy  apt-get update  sudo apt-get install xserver-xorg-video-dummy which depends on xorg-video-abi-20 and xserver-xorg-core, so ne">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-12-04T14:40:49.435Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="running Vulkan in virtual display">
<meta name="twitter:description" content="install xserver-xorg-video-dummyapt-cache search xserver-xorg-video-dummy  apt-get update  sudo apt-get install xserver-xorg-video-dummy which depends on xorg-video-abi-20 and xserver-xorg-core, so ne">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/12/04/running-Vulkan-in-virtual-display/"/>





  <title>running Vulkan in virtual display | Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/04/running-Vulkan-in-virtual-display/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">running Vulkan in virtual display</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-04T09:40:22-05:00">
                2019-12-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/04/running-Vulkan-in-virtual-display/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/04/running-Vulkan-in-virtual-display/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="install-xserver-xorg-video-dummy"><a href="#install-xserver-xorg-video-dummy" class="headerlink" title="install xserver-xorg-video-dummy"></a>install xserver-xorg-video-dummy</h2><pre><code>apt-cache search xserver-xorg-video-dummy 
apt-get update 
sudo apt-get install xserver-xorg-video-dummy
</code></pre><p>which depends on <code>xorg-video-abi-20</code> and <code>xserver-xorg-core</code>, so need to install <code>xserver-xorg-core</code> first. after update xorg.conf as <a href="https://techoverflow.net/2019/02/23/how-to-run-x-server-using-xserver-xorg-video-dummy-driver-on-ubuntu/" target="_blank" rel="external">run Xserver using xserver-xorg-video-dummy driver</a>, and reboot the machine, which leads both keyboard and mouse doesn’t reponse any more. </p>
<h3 id="understand-xorg-conf"><a href="#understand-xorg-conf" class="headerlink" title="understand xorg.conf"></a>understand xorg.conf</h3><p>usually, <code>xorg.conf</code> is not in system any more, so most common use, the xorg will configure the system device by default. if additional device need to configure, can run in root <code>X -configure</code>, which will generate <code>xorg.conf.new</code> file at <code>/root</code>.</p>
<p>there are two <code>xorg.conf</code>, one generated by running <code>X -configure</code>, which located at <code>/root/xorg.conf.new</code> ;  the other is generated by <code>nvidia-xconfigure</code>,  which can be found at <code>/etc/X11/xorg.conf</code>.</p>
<p>the following list is from <a href="https://www.x.org/releases/X11R7.7/doc/man/man5/xorg.conf.5.xhtml" target="_blank" rel="external">xorg.conf doc</a></p>
<ul>
<li>ServerLayout section</li>
</ul>
<p>it is at the highest level, they bind together the input and output devices that will be used in a session.</p>
<p>input devices are described in <code>InputDevice</code> sections, output devices usualy consist of multiple independent components(GPU, monitor), which are defined in <code>Screen</code> section.  each <code>Screen</code> section binds togethere a graphics board(GPU) and a monitor. </p>
<p>the GPU are described in <code>Device</code> sections and monitors are described in <code>Monitor</code> sections</p>
<ul>
<li>FILES section</li>
</ul>
<p>used to specify some path names required by the server.</p>
<p>e.g. ModulePath, FontPath ..</p>
<ul>
<li>SERVERFLAGS section</li>
</ul>
<p>used to specify global Xorg server options.  all should be <code>Options</code></p>
<p><code>&quot;AutoAddDevices&quot;</code>,  enabled by default.</p>
<ul>
<li>MODULE section</li>
</ul>
<p>used to specify which Xorg server (extension) modules shoul be loaded.</p>
<ul>
<li>INPUTDEVICE section </li>
</ul>
<p>Recent X servers employ HAL or udev backends for input device enumeration and input hotplugging. It is usually not necessary to provide InputDevice sections in the xorg.conf if hotplugging is in use (i.e. AutoAddDevices is enabled). If hotplugging is enabled, InputDevice sections using the mouse, kbd and vmmouse driver will be ignored.</p>
<p><code>Identifier</code> and <code>Driver</code> are required in all <code>InputDevice</code> sections.  <code>Identifier</code> used to specify the unique name for this input device;  <code>Driver</code> used to specify the name of the driver.</p>
<p>An InputDevice section is considered active if it is referenced by an active ServerLayout section, if it is referenced by the −keyboard or −pointer command line options, or if it is selected implicitly as the core pointer or keyboard device in the absence of such explicit references. The most commonly used input drivers are evdev(4) on Linux systems, and kbd(4) and mousedrv(4) on other platforms.</p>
<p>a few driver-independent <code>Options</code> in <code>InputDevice</code>:</p>
<p><code>CorePointer</code> and <code>CoreKeyboard</code> are the inverse of option <code>Floating</code>, which, when enabled, the input device does not report evens through any master device or control a cursor. the device is only available to clients using X input Extension API.  </p>
<ul>
<li>Device section</li>
</ul>
<p>there must be at least one, for the video card(GPU) being used. <code>Identifier</code> and <code>Driver</code> are required in all <code>Device</code> sections.</p>
<ul>
<li>Monitor Section<br>there must be at least one, for the monitor being used. the default configuration will be created when one isn’t specified.  <code>Identifier</code> is the only mandatory.</li>
</ul>
<ul>
<li>Screen Section<br>There must be at least one, for the “screen” being used, represents the binding of a graphics device (Device section) and a monitor (Monitor section). A Screen section is considered “active” if it is referenced by an active ServerLayout section or by the −screen command line option. The <code>Identifier</code> and <code>Device</code> entries are mandatory. </li>
</ul>
<h3 id="debug-keyboard-mouse-not-response-after-X-upgrade"><a href="#debug-keyboard-mouse-not-response-after-X-upgrade" class="headerlink" title="debug keyboard/mouse not response after X upgrade"></a>debug keyboard/mouse not response after X upgrade</h3><ul>
<li><p>login to Ubuntu safe mode, by <code>F12</code> –&gt;  <code>Esc</code> (to display GRUB2 menu), then <code>enable network</code> –&gt;  <code>root shell</code></p>
</li>
<li><p>run <code>X -configure</code></p>
</li>
</ul>
<p>one line say:</p>
<pre><code>List of video drivers:  dummy, nvidia,  modesetting. 
</code></pre><h4 id="uninstall-xserver-xorg-video-dummy"><a href="#uninstall-xserver-xorg-video-dummy" class="headerlink" title="uninstall xserver-xorg-video-dummy"></a>uninstall xserver-xorg-video-dummy</h4><p>I thought the dummy video driver is the key reason, so uninstall it, then rerun the lines above, check <code>/var/log/Xorg.0.log</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[   386.768] List of video drivers:</div><div class="line">[   386.768] 	nvidia</div><div class="line">[   386.768] 	modesetting</div><div class="line">[   386.860] (++) Using config file: &quot;/root/xorg.conf.new&quot;</div><div class="line">[   386.860] (==) Using system config directory &quot;/usr/share/X11/xorg.conf.d&quot;</div><div class="line">[   386.860] (==) ServerLayout &quot;X.org Configured&quot;</div><div class="line">[   386.860] (**) |--&gt;Screen &quot;Screen0&quot; (0)</div><div class="line">[   386.860] (**) |   |--&gt;Monitor &quot;Monitor0&quot;</div><div class="line">[   386.861] (**) |   |--&gt;Device &quot;Card0&quot;</div><div class="line">[   386.861] (**) |   |--&gt;GPUDevice &quot;Card0&quot;</div><div class="line">[   386.861] (**) |--&gt;Input Device &quot;Mouse0&quot;</div><div class="line">[   386.861] (**) |--&gt;Input Device &quot;Keyboard0&quot;</div><div class="line">[   386.861] (==) Automatically adding devices</div><div class="line">[   386.861] (==) Automatically enabling devices</div><div class="line">[   386.861] (==) Automatically adding GPU devices</div><div class="line">[   386.861] (**) ModulePath set to &quot;/usr/lib/xorg/modules&quot;</div><div class="line">[   386.861] (WW) Hotplugging is on, devices using drivers &apos;kbd&apos;, &apos;mouse&apos; or &apos;vmmouse&apos; will be disabled.</div><div class="line">[   386.861] (WW) Disabling Mouse0</div><div class="line">[   386.861] (WW) Disabling Keyboard0</div><div class="line">Xorg detected  mouyourse at device /dev/input/mice.</div><div class="line">Please check your config if the mouse is still not</div><div class="line">operational, as by default Xorg tries to autodetect</div><div class="line">the protocol.</div></pre></td></tr></table></figure>
<p>there is a warning: <code>(WW) Hotplugging is on, devices using drivers &#39;kbd&#39;, &#39;mouse&#39; or &#39;vmmouse&#39; will be disabled</code></p>
<h4 id="disable-Hotplugging"><a href="#disable-Hotplugging" class="headerlink" title="disable Hotplugging"></a>disable Hotplugging</h4><p>first generate by <code>X -configure</code> at <code>/root/xorg.conf.new</code>, and copy it to <code>/etc/X11/xorg.conf</code>. then add the additional section in /etc/X11/xorg.conf, , which will disable Hotplugging: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Section &quot;ServerFlags&quot;</div><div class="line">Option &quot;AllowEmptyInput&quot; &quot;True&quot;</div><div class="line">Option &quot;AutoAddDevices&quot; &quot;False&quot;</div><div class="line">EndSection</div></pre></td></tr></table></figure>
<p>however, it reports: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(EE) Failed to load module &quot;evdev&quot; (module does not exist, 0)</div><div class="line">(EE) NVIDIA(0): Failed to initialize the GLX module; please check in your X</div><div class="line">(EE) NVIDIA(0):     log file that the GLX module has been loaded in your X</div><div class="line">(EE) NVIDIA(0):     server, and that the module is the NVIDIA GLX module.  If</div><div class="line">(EE) NVIDIA(0):     you continue to encounter problems, Please try</div><div class="line">(EE) NVIDIA(0):     reinstalling the NVIDIA driver.</div><div class="line">(EE) Failed to load module &quot;mouse&quot; (module does not exist, 0)</div><div class="line">(EE) No input driver matching `mouse&apos;</div></pre></td></tr></table></figure>
<h4 id="switch-to-nvidia-xorg-conf"><a href="#switch-to-nvidia-xorg-conf" class="headerlink" title="switch to nvidia xorg.conf"></a>switch to nvidia xorg.conf</h4><p>which reports:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(EE) Failed to load module &quot;mouse&quot; (module does not exist, 0)</div><div class="line">(EE) No input driver matching `mouse&apos;</div><div class="line">(EE) Failed to load module &quot;evdev&quot; (module does not exist, 0)</div><div class="line">(EE) No input driver matching `evdev&apos;</div></pre></td></tr></table></figure>
<p>it fix the Nvidia issue, but still can’t fix the input device and driver issue.</p>
<h4 id="switch-to-evdev-driver"><a href="#switch-to-evdev-driver" class="headerlink" title="switch to evdev driver"></a>switch to evdev driver</h4><p>as mentioned previously, <code>evdev</code> driver is the default driver for Linux, and will be loaded by Xserver by default. so try to both Keyboard and Mouse driver to <code>evdev</code>,</p>
<p>which reports:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(EE) No input driver matching `kbd&apos;</div><div class="line">(EE) Failed to load module &quot;kbd&quot; (module does not exist, 0)</div><div class="line">(EE) No input driver matching `mouse&apos;</div><div class="line">(EE) Failed to load module &quot;mouse&quot; (module does not exist, 0)</div></pre></td></tr></table></figure>
<p>looks it’s the problem of driver, even the default driver is missed. I try to copy master node’s <a href="https://forums.gentoo.org/viewtopic-p-4771817.html" target="_blank" rel="external">/usr/lib/xorg/modules/input/</a> to worker node, then it reports :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(EE) module ABI major version (24) doesn&apos;t match the server&apos;s version (22)</div><div class="line">(EE) Failed to load module &quot;evdev&quot; (module requirement mismatch, 0)</div></pre></td></tr></table></figure>
<p>which can be fixed by adding <code>Option IgnoreABI</code> .</p>
<h4 id="delete-customized-keyboard-and-mouse"><a href="#delete-customized-keyboard-and-mouse" class="headerlink" title="delete customized keyboard and mouse"></a>delete customized keyboard and mouse</h4><p>if enable Hotplugging, the X will auto detect the device, I’d try: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">Section &quot;ServerLayout&quot;</div><div class="line">    Identifier     &quot;Layout0&quot;</div><div class="line">    Screen      0  &quot;Screen0&quot; 0 0 </div><div class="line">EndSection</div><div class="line"></div><div class="line"></div><div class="line">Section &quot;Monitor&quot;</div><div class="line">    Identifier     &quot;Monitor0&quot;</div><div class="line">    VendorName     &quot;Unknown&quot;</div><div class="line">    ModelName      &quot;Unknown&quot;</div><div class="line">    HorizSync       28.0 - 33.0</div><div class="line">    VertRefresh     43.0 - 72.0</div><div class="line">    Option         &quot;DPMS&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Device&quot;</div><div class="line">    Identifier     &quot;Device0&quot;</div><div class="line">    Driver         &quot;nvidia&quot;</div><div class="line">    VendorName     &quot;NVIDIA Corporation&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Screen&quot;</div><div class="line">    Identifier     &quot;Screen0&quot;</div><div class="line">    Device         &quot;Device0&quot;</div><div class="line">    Monitor        &quot;Monitor0&quot;</div><div class="line">    DefaultDepth    24</div><div class="line">    SubSection     &quot;Display&quot;</div><div class="line">        Depth       24</div><div class="line">    EndSubSection</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;ServerFlags&quot;</div><div class="line">  Option &quot;AllowEmptyInput&quot; &quot;True&quot;</div><div class="line">  Option &quot;IgnoreABI&quot; &quot;True&quot;</div><div class="line">EndSection</div></pre></td></tr></table></figure>
<p>which reports:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(II) No input driver specified, ignoring this device.</div><div class="line">(II) This device may have been added with another device file.</div><div class="line">(II) config/udev: Adding input device Lenovo Precision USB Mouse (/dev/input/mouse0</div></pre></td></tr></table></figure>
<p>there is no ERROR any more, but looks the default Input driver (evdev?) can’t be found out …</p>
<h4 id="reinstall-xorg"><a href="#reinstall-xorg" class="headerlink" title="reinstall xorg"></a>reinstall xorg</h4><p>Mouse and keyboard can be driven by evdev or mouse/keyboard driver respectively. Xorg will load only <code>endev</code> automatically, To use mouse and/or keyboard driver instead of evdev they must be loaded in xorg.conf. There is no need to generate xorg.conf unless you want to fine tune your setup or need to customize keyboard layout or mouse/touchpad functionality.</p>
<ul>
<li>firstly configure new network interface for worker node:</li>
</ul>
<p><a href="https://unix.stackexchange.com/questions/303536/configuring-automatic-dhcp-network-connection-via-command-line-on-ubuntu-14-04" target="_blank" rel="external">configure DHCP network connection</a></p>
<p>setting at <code>/etc/network/interface</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">auto enp0s25 </div><div class="line">iface enp0s25 inet dhcp</div></pre></td></tr></table></figure>
<p>ifconfig enp0s25 down<br>ifconfig enp0s25 up</p>
<ul>
<li>then reinstall xorg: </li>
</ul>
<pre><code>sudo apt-get update 
sudo apt-get upgrade
sudo apt-get install xserver-xorg-core  xserver-xorg  xorg
</code></pre><p>which install these libs, <code>xserver-xorg-input-all</code>, <code>xserver-xorg-input-evdev</code>,  <code>xserver-xorg-inut-wacom</code>, <code>xserver-xorg-input-vmouse</code>,  <code>xserver-xorg-input-synaptics</code>, these are the exact missing parts(input device and drivers).  it looks when uninstall <code>video-dummy</code>, these modules are deleted by accident.</p>
<ul>
<li><p>reboot, both keyboard and mouse work !</p>
</li>
<li><p>“sudo startx” through ssh</p>
</li>
</ul>
<p>now the user password doesn’t work in normal login, but when ssh login from another machine, the password verify well. which can be fixed by ssh login from remote host first, then run <code>sudo startx</code>, which will bring the user-password verification back</p>
<h2 id="virtual-display"><a href="#virtual-display" class="headerlink" title="virtual display"></a>virtual display</h2><p><a href="https://xpra.org/trac/wiki/Xdummy" target="_blank" rel="external">xdummy</a></p>
<p><a href="http://xpra.org/xorg.conf" target="_blank" rel="external">xdummy: xorg.conf</a></p>
<p>run: <code>Xorg -noreset +extension GLX +extension RANDR +extension RENDER -logfile ./10.log -config ./xorg.conf :10</code> </p>
<ul>
<li>test with glxgears/OpengGL works</li>
</ul>
<p>1) DISPLAY=localhost:10.0  works</p>
<p>2) DISPLAY=:0  works, but you can’t see it, cause the worker host is in virtual display</p>
<ul>
<li>test with vkcube/Vulkan failed</li>
</ul>
<p>in summary, the vitual display can support OpenGL running, but doesn’t support Vulkan yet. <a href="https://unity.com/simulation" target="_blank" rel="external">unity simulation cloud SDK</a> is the vendor’s solution, but licensed.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="http://xpra.org/xorg.conf" target="_blank" rel="external">sample xorg.conf for dummy device</a></p>
<p><a href="https://askubuntu.com/questions/940476/keyboard-and-mouse-not-responding-at-reboot-after-xorg-conf-update" target="_blank" rel="external">Keyboard and mouse not responding at reboot after xorg.conf update</a></p>
<p><a href="https://askubuntu.com/questions/4662/where-is-the-x-org-config-file-how-do-i-configure-x-there" target="_blank" rel="external">how to Xconfigure</a></p>
<p><a href="https://www.linuxquestions.org/questions/linux-software-2/no-input-drivers-loading-in-x-4175577628/" target="_blank" rel="external">no input drivers loading in X</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/11/29/recent-thoughts-in-ADS/" rel="next" title="recent thoughts in ADS">
                <i class="fa fa-chevron-left"></i> recent thoughts in ADS
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/12/08/where-are-you-in-next-4-years-2/" rel="prev" title="where are you in next 4 years (2)">
                where are you in next 4 years (2) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">146</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#install-xserver-xorg-video-dummy"><span class="nav-number">1.</span> <span class="nav-text">install xserver-xorg-video-dummy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#understand-xorg-conf"><span class="nav-number">1.1.</span> <span class="nav-text">understand xorg.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-keyboard-mouse-not-response-after-X-upgrade"><span class="nav-number">1.2.</span> <span class="nav-text">debug keyboard/mouse not response after X upgrade</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#uninstall-xserver-xorg-video-dummy"><span class="nav-number">1.2.1.</span> <span class="nav-text">uninstall xserver-xorg-video-dummy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#disable-Hotplugging"><span class="nav-number">1.2.2.</span> <span class="nav-text">disable Hotplugging</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#switch-to-nvidia-xorg-conf"><span class="nav-number">1.2.3.</span> <span class="nav-text">switch to nvidia xorg.conf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#switch-to-evdev-driver"><span class="nav-number">1.2.4.</span> <span class="nav-text">switch to evdev driver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete-customized-keyboard-and-mouse"><span class="nav-number">1.2.5.</span> <span class="nav-text">delete customized keyboard and mouse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reinstall-xorg"><span class="nav-number">1.2.6.</span> <span class="nav-text">reinstall xorg</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#virtual-display"><span class="nav-number">2.</span> <span class="nav-text">virtual display</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#refer"><span class="nav-number">3.</span> <span class="nav-text">refer</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2019/12/04/running-Vulkan-in-virtual-display/';
          this.page.identifier = '2019/12/04/running-Vulkan-in-virtual-display/';
          this.page.title = 'running Vulkan in virtual display';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://zjlee.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
