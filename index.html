<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="what I don&apos;t know">
<meta property="og:type" content="website">
<meta property="og:title" content="Serious Autonomous Vehicles">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Serious Autonomous Vehicles">
<meta property="og:description" content="what I don&apos;t know">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serious Autonomous Vehicles">
<meta name="twitter:description" content="what I don&apos;t know">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Serious Autonomous Vehicles</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Serious Autonomous Vehicles</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/10/ROS-ADS-integrated-to-python-talk-to-lgsvl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/10/ROS-ADS-integrated-to-python-talk-to-lgsvl/" itemprop="url">ROS ADS integrated to python talk to lgsvl</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-10T08:35:12-05:00">
                2020-01-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/10/ROS-ADS-integrated-to-python-talk-to-lgsvl/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/01/10/ROS-ADS-integrated-to-python-talk-to-lgsvl/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p><a href="https://zjli2013.github.io/2020/01/04/ADS-stack-in-ros-talk-to-lgsvl/" target="_blank" rel="external">previously</a>, we had done ADS ros package directly talk with lgsvl. the step further is to trigger ADS ros nodes from scenario python script</p>
<p>a few requirements:</p>
<ul>
<li><p>for ADS ros should be integrated with each scenario python script, which means, when the python script finished, the ADS ros should exit</p>
</li>
<li><p>the ads ros package shell script is independ of python script </p>
</li>
</ul>
<h4 id="execute-shell-in-Python"><a href="#execute-shell-in-Python" class="headerlink" title="execute shell in Python"></a>execute shell in Python</h4><ul>
<li>to <a href="http://dreamsyssoft.com/python-scripting-tutorial/shell-tutorial.php" target="_blank" rel="external">call a shell command</a> directly with <code>os.system(cmd)</code> or </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">subprocess.call(&quot;ls -lt&quot;, shell=True)</div></pre></td></tr></table></figure>
<ul>
<li>to run shell script with a python subprocess </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">proc=subprocess.Popen([&quot;&quot;], stdout=subprocess.PIPE)</div></pre></td></tr></table></figure>
<p><code>subprocess.Popen()</code> return the process object</p>
<p>a few helpful commands to debug rosrun:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ps -aux | grep &quot;roscore&quot;  </div><div class="line"></div><div class="line">ps -aux | grep &quot;rosmaster&quot;</div><div class="line"></div><div class="line">killall -9 roscore </div><div class="line"></div><div class="line">killall -9 rosmaster</div></pre></td></tr></table></figure>
<h2 id="ros1-to-python3"><a href="#ros1-to-python3" class="headerlink" title="ros1 to python3"></a>ros1 to python3</h2><p>there is an real issue, due to the ADS ros package is mostly implemented by ROS1, maintained by the algorithm team. but lgsvl scenario is running with python3. <a href="http://design.ros2.org/articles/changes.html" target="_blank" rel="external">ROS1 matches Python2</a>. so there comes the solution, either to upgrade the ADS ros pakcage to ROS2, or find a way to run ROS1 in python3 env.</p>
<h4 id="conda-base-env"><a href="#conda-base-env" class="headerlink" title="conda base env"></a>conda base env</h4><p>we had decided to adapt ROS1 in python3 env. as the host machine has conda env, first need to <a href="https://stackoverflow.com/questions/54429210/how-do-i-prevent-conda-from-activating-the-base-environment-by-default" target="_blank" rel="external">disable conda base</a>. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">conda config --set auto_activate_base false</div></pre></td></tr></table></figure>
<p>as lgsvl scenario is runned with conda python3 env, inside which used <code>subprocess</code> to run ADS ros shell, in which creates a few new <code>gnome-terminal</code>s, which are non log-in terminal, and the trick things here: even though disabled auto activate base, and the terminal has no header <code>(base)</code>, but when check the python path, it still points to the <code>conda/bin/python</code>, which will fail <code>rosbridge_launch.server</code>, which is a pure ros1 and python2 module.</p>
<p>so need check if <code>conda --version</code> in the ads ros shell script is  in current terminal, if does, run <code>conda deactivate</code>, which gives error:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CommandNotFoundError: Your shell has not been properly configured to use &apos;conda deactivate&apos;.</div></pre></td></tr></table></figure>
<p>it looks there is some mess up, with init <code>conda.sh</code> is in <code>~/.bashrc</code>, but during the new terminal ceated, it doens’t confgiure all right. which can be fixed :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">conda --version </div><div class="line">if [ $? == 0 ]</div><div class="line">then </div><div class="line">    source ~/anaconda3/etc/profile.d/conda.sh</div><div class="line">    conda deactivate</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>in this way, we run lgsvl scenario in python3, as well as can new with python2 terminals to run ads ros nodes from this python3 terminal</p>
<h4 id="ros-scripts-path-is-not-python-path"><a href="#ros-scripts-path-is-not-python-path" class="headerlink" title="ros scripts path is not python path"></a>ros scripts path is not python path</h4><p>as we try to separate python scripts from ads ros nodes, so need some global env variable for the ros scripts path. </p>
<h2 id="kill-all-ros-nodes-gracefully"><a href="#kill-all-ros-nodes-gracefully" class="headerlink" title="kill all ros nodes gracefully"></a>kill all ros nodes gracefully</h2><p>we need restart/shutdown the ads ros nodes package at each time when python scenario script start/stop, which has two steps:</p>
<ul>
<li><p>to shutdown ros nodes, e.g.  <a href="https://answers.ros.org/question/237862/rosnode-kill/" target="_blank" rel="external">rosnode kill</a></p>
</li>
<li><p>to close all the gnome-terminals to run the ros nodes</p>
</li>
</ul>
<p>the second step is very tricky, need some understand. A terminal is a file. Like /dev/tty. Files do not have a process id. The process that “owns” the terminal is usually called the controlling process, or more correctly, the process group leader. <code>gnome-terminal</code> <a href="https://askubuntu.com/questions/775025/how-to-detect-the-number-of-opened-terminals-by-the-user" target="_blank" rel="external">runs a single pid</a>, it creates a child process for each and every window and/or tab. and can retrieve these child processes by the command:</p>
<pre><code>$ pgrep -P &lt;pid_of_gnome-terminal&gt;
</code></pre><p>Many terminals seem to <a href="https://askubuntu.com/questions/640096/how-do-i-check-which-terminal-i-am-using" target="_blank" rel="external">mask themselves as xterm-compatible</a>, which is reported by echo $TERM or echo $COLORTERM. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$! is the PID of the last backgrounded process.</div><div class="line">kill -0 $PID checks whether it&apos;s still running.</div><div class="line">$$ is the PID of the current shell.</div></pre></td></tr></table></figure>
<pre><code>#! /bin/bash

gnome_pid=`pgrep gnome-terminal`
subpids=`pgrep -P ${gnome_pid}`

if [ ! $1 ]; then
   echo &quot;missing the gnome-terminal pid, exit&quot;
   exit -1
fi

#shutdown the ros nodes 
rosnode kill -a  &gt; /dev/null  2&gt;&amp;1
killall -9 rosmaster &gt; /dev/null  2&gt;&amp;1

#shutdown the terminals where ros nodes hosted
for pid in $subpids
do
        if [[ $pid != $1 ]] ; then
                echo $pid
                kill $pid
        fi
done
</code></pre><p>tips: the implement has a litle problem when integrate with lgsvl when the simulation time is short, e.g. 1sec, then <code>ros_clear.sh</code> can’t catch the opened gnome-terminals from <code>ros_start.sh</code>. </p>
<h4 id="find-the-process-name-using-PID"><a href="#find-the-process-name-using-PID" class="headerlink" title="find the process name using PID"></a><a href="https://www.tecmint.com/find-process-name-pid-number-linux/" target="_blank" rel="external">find the process name using PID</a></h4><pre><code>$ ps aux | grep PID
$ ps -p PID -o format         
$ curpid=`ps -p $$ -o ppid=`
</code></pre><h4 id="the-output-of-ps-aux"><a href="#the-output-of-ps-aux" class="headerlink" title="the output of ps aux"></a><a href="https://www.computernetworkingnotes.com/linux-tutorials/ps-aux-command-and-ps-command-explained.html" target="_blank" rel="external">the output of ps aux</a></h4><ul>
<li>–&gt;  in the foreground process group<br>s –&gt;  is a session leader </li>
</ul>
<h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>so far, we integrated ads ros packages into python, which then talk to lgsvl. </p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="https://www.jianshu.com/p/2eb33b491024" target="_blank" rel="external">pythn subprocess from Jianshu</a></p>
<p><a href="https://www.cnblogs.com/vamei/archive/2012/10/07/2713023.html" target="_blank" rel="external">understand linux process group</a></p>
<p><a href="https://www.cyberciti.biz/faq/linux-pidof-command-examples-find-pid-of-program/" target="_blank" rel="external">pidof command</a></p>
<p><a href="https://askubuntu.com/questions/476641/how-can-i-get-the-name-of-the-current-terminal-from-command-line/476663#476663" target="_blank" rel="external">which_term</a></p>
<p><a href="https://stackoverflow.com/questions/9378021/how-to-get-process-details-from-its-pid" target="_blank" rel="external">get the info of a PID</a></p>
<p><a href="https://askubuntu.com/questions/476641/how-can-i-get-the-name-of-the-current-terminal-from-command-line" target="_blank" rel="external">get the pid of running terminal</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/04/ADS-stack-in-ros-talk-to-lgsvl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/04/ADS-stack-in-ros-talk-to-lgsvl/" itemprop="url">ADS stack in ros talk to lgsvl</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-04T23:02:13-05:00">
                2020-01-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/04/ADS-stack-in-ros-talk-to-lgsvl/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/01/04/ADS-stack-in-ros-talk-to-lgsvl/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h2 id="learning-is-about-repeat-100-times"><a href="#learning-is-about-repeat-100-times" class="headerlink" title="learning is about repeat 100 times !"></a>learning is about repeat 100 times !</h2><p>this maybe the third time to go through ROS, which still looks fresh, but does give a whole picture about how ROS works in ADS dev. </p>
<ul>
<li>what is ros topic and message </li>
</ul>
<p>the topic is the channel where nodes are subscribed for to read messages or where the nodes publish those messages; the message is the data itself, previously defined. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">rostopic echo [topic]</div><div class="line"></div><div class="line">rostopic list </div><div class="line"></div><div class="line">rosmsg show [message]</div><div class="line"></div><div class="line">rosrun [package_name] [node_name]</div><div class="line"></div><div class="line">rospack find [package_name]</div><div class="line"></div><div class="line">rosnode info [node_name]</div></pre></td></tr></table></figure>
<ul>
<li>what is a publisher/subscriber</li>
</ul>
<p>a publisher (node) publishes messages to a particular topic. <a href="http://wiki.ros.org/roscpp/Overview/Publishers%20and%20Subscribers" target="_blank" rel="external">publish()</a> is asynchronous, and only does work if there are subscribers connected on that topic. <code>publish()</code> itself is very fast, and it does as little work as possible:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">serialize the message to a buffer </div><div class="line">push the buffer onto a queue for later processing</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ros::Publisher advertise(const std::string&amp; topic, uint32_t queue_size, bool latch = false);</div></pre></td></tr></table></figure>
<p>the <code>queue size</code> is defined in  publihser/outgoing message queue. if publishing faster than roscpp can send the message over the wire, roscpp will start dropping OLD messages. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ros::Subscriber subscribe(const std::string&amp; topic, uint32_t queue_size, &lt;callback, which may involve multiple arguments&gt;, const ros::TransportHints&amp; transport_hints = ros::TransportHints());</div></pre></td></tr></table></figure>
<p>the queue_size is the incoming message/subscriber queue size, roscpp will use for your callback. if messages are arriving too fast and you are unable to keep up, roscpp will start throwing away OLD messages.</p>
<p><a href="https://answers.ros.org/question/243855/how-do-publishersubscriber-message-queues-work/" target="_blank" rel="external">in summary</a>: </p>
<pre><code>* publish() is asynchronous.
* When you publish, messages are pushed into a queue (A) for later processing. This queue is immediately pushed into the outgoing/publisher queue (B) . PS: If no one subscribes to the topic, the end is here.
* When a subscriber subscribes to that topic. Messages will be sent/pushed from the corresponding outgoing/publisher queue (B) to the incoming/subscriber queue (C).--&gt; this is done by internal thread
* When you spin/ callback, the messages handled are from the incoming/subscriber queue (C).
</code></pre><ul>
<li><a href="http://wiki.ros.org/Messages" target="_blank" rel="external">messages</a></li>
</ul>
<p><strong>msg</strong> files are simple text files for specifying the data structure of a message. These files are stored in the msg subdirectory of a package. the publisher and subscriber must send and receive the same <strong>type/topic</strong> of message</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;op&quot;: &quot;publish&quot;, &quot;topic&quot;: &quot;/talker&quot;, &quot;msg&quot;: &#123;&quot;data&quot; : &quot;_my_message&quot; &#125;&#125;</div></pre></td></tr></table></figure>
<p>lgsvl defines the rosBridge class, which has a Reader() and Writer(), corresponding to Subsciber and Publisher, respectfually. </p>
<h2 id="rosBridge-in-lgsvl"><a href="#rosBridge-in-lgsvl" class="headerlink" title="rosBridge in lgsvl"></a>rosBridge in lgsvl</h2><p>rosbridge is an adapter for non-ros apps to talk with ros. it’s common to package ADS software as ros node during dev stage, and rosbridge is the common way to integrate simulator with ADS software.</p>
<p>the base implementation of <code>rosBridge</code> in lgsvl is as following: </p>
<h4 id="RosBridge-cs"><a href="#RosBridge-cs" class="headerlink" title="RosBridge.cs"></a>RosBridge.cs</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ConcurrentQueue&lt;Action&gt;  QueuedActions ;</div><div class="line">Dictionary&lt;string, Tuple&lt;Func&lt;JSONNode, object&gt;, List&lt;Action&lt;object&gt;&gt;&gt;&gt; Readers ;</div></pre></td></tr></table></figure>
<p>the topic is packaged as:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123; &quot;op&quot;:  &quot;subscribe or publish or call_service or service_response or set_level&quot;,</div><div class="line">  &quot;topic&quot;:  &#123;&#125;,</div><div class="line">  &quot;type&quot;:  &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>AddReader(topic, callback)</li>
</ul>
<p>a few types/topices supported: </p>
<pre><code>Deteced3DObjectArray, 

Deteced2DObjectArray, 

VehicleControlData, 

Autoware.VehicleCmd, 

TwistStamped, 

Apollo.control_command 
</code></pre><p>which is the list of ros messages that lgsvl can parsing.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if(!Readers.ContainsKey(topic))</div><div class="line">&#123;</div><div class="line">   Readers.Add(topic, Tuple.Create&lt;Func&lt;JSONNode, object&gt;, List&lt;Action&lt;object&gt;&gt;&gt;(msg=&gt;converter(msg),  new List&lt;Action&lt;object&gt;&gt;()) ) ;</div><div class="line"></div><div class="line">&#125;  </div><div class="line"></div><div class="line">Readers[topic].Item2.Add(msg=&gt;callback(T)msg));</div></pre></td></tr></table></figure>
<p><code>AddReader</code> is the subscriber nodes in lgsvl. in <code>Sensor</code> group, there are three sensors do <code>AddReader</code>: </p>
<pre><code>GroundTruth3DVisualizer 

VehicleControlSensor 

GroudTruth2DVisualizer
</code></pre><p>which means, lgsvl server can read these three typies of messsages. </p>
<p>if there is no rendering/visual needs, only vehicle conroller (acc, brake) message is required for lgsvl. </p>
<ul>
<li>AddWriter(topic)</li>
</ul>
<p>the types/topic supported are: </p>
<pre><code>ImageData, 
PointCloudData, 
Detected3DObjectData, 
Detected2DObjectData, 
SignalDataArray, 
DetectedRadarObjectData, 
CanBusData, 
GpsData, 
ImuData, 
CorrectedImuData, 
GpsOdometryData, 
ClockData
</code></pre><p><code>AddWriter()</code> is a writer adapter, which returns a special type/topic writer/publisher. <code>AddWriter</code> is the publisher nodes in lgsvl, in <code>Sensor</code> group, the following sensors can publish message out:</p>
<pre><code>LidarSensor 
SignalSensor
 GpsInsSensor
GpsOdometrySensor
DepthCameraSensor
ImuSensor
SemanticCameraSensor
GroudTruth2DSensor
CanBusSensor
RadarSensor
GroudTruth3DSensor
ClockSensor
GpsSensor
ColorCameraSensor
</code></pre><ul>
<li>AddService(topic, callback)</li>
</ul>
<ul>
<li>OnMessage(sender, args)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">if (args.op==&quot;publish&quot;)</div><div class="line">&#123;</div><div class="line">   topic = json[&quot;topic&quot;]</div><div class="line">   Readers.TryGetValue(topic, out readerPair)</div><div class="line">   var parse = readerPair.Item1 ; </div><div class="line">   var readers = readerPair.Item2; </div><div class="line">   var msg = parse(json[&quot;msg&quot;]);</div><div class="line">   foreach (var reader in readers)</div><div class="line">   &#123;</div><div class="line">     QueuedActions.Enqueue(()=&gt;reader(msg));   //</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>ros subscriber uses a callback mechanism, when the message is coming, all readers who subscribe this topic will read in this message. </p>
<h4 id="RosWriter-cs"><a href="#RosWriter-cs" class="headerlink" title="RosWriter.cs"></a>RosWriter.cs</h4><p>the message output is in the format as:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123; </div><div class="line">  &quot;op&quot; :  &quot;publish&quot; ,</div><div class="line">  &quot;topic&quot; :  Topic, </div><div class="line">  &quot;msg&quot;:  message </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="websocket-in-ros-bridge"><a href="#websocket-in-ros-bridge" class="headerlink" title="websocket in ros bridge"></a>websocket in ros bridge</h4><p>the implementation of ros bridge in lgsvl is by <code>WebSocket</code>, which maintained a continously communication pipeline, for external ros nodes publishers.</p>
<h2 id="ros-ads-talk-to-lgsvl-rosbridge"><a href="#ros-ads-talk-to-lgsvl-rosbridge" class="headerlink" title="ros ads talk to lgsvl rosbridge"></a>ros ads talk to lgsvl rosbridge</h2><p>from the previous section, lgsvl talk to external ros nodes (which is the ADS stack) through rosbridge, and which needs external inputs, e.g. vehicle control command, 2d/3d ground truth visualizer. and the ADS stack ros nodes can subscribes Gps, canbus, Lidar, Radar, GroudTruth, SemanticCamera, DeepCamera topics through lgsvl rosbrige.</p>
<p>so the pipeline are simple as following:</p>
<pre><code>lgsvl rosbridge  --&gt;  {gps, radar, camera, lidar, groudTruth message} --&gt;  ADS stack nodes 

ADS stack nodes --&gt;  {vehicle control command message} --&gt; lgsvl rosbridge 
</code></pre><p>usually, the ADS stack nodes are a few related ros nodes, including RTK/GPS sensor, Lidar/Camera/Radar sensors, hdmap node, data fusion node e.t.c.</p>
<h4 id="run-ROS-ADS-stack"><a href="#run-ROS-ADS-stack" class="headerlink" title="run ROS ADS stack"></a>run ROS ADS stack</h4><p>the following nodes are used commonly in ADS dev:</p>
<ul>
<li><p>gps_node</p>
<pre><code>subscribe: /gps, /odom e.t.c

publish: /sensor/data topics
</code></pre></li>
<li><p>camera_node</p>
<pre><code>subscribe: /camera/raw_data

publish:  /objects_list,  /lane_object e.t.c
</code></pre></li>
<li><p>radar_node</p>
<pre><code>subscribe:  /radar/raw_data

publish: /obstacle/velocity , /obstacle/distance
</code></pre></li>
<li><p>hdmap_node</p>
<pre><code>subcribe: /rtk/data, /ins/data. 

publish:  /lane/info,  /speed_limit e.t.c.
</code></pre></li>
<li><p>fusion_node </p>
<pre><code>subscribe topics: /canbus, rtk/data, /ifv_lane,  /radar/blind, /radar/corner, /esr, /velodey, /lane/info e.t.c

publish topics: /object_list/, /road/info, /vehicle/status and visual related messages e.t.c.
</code></pre></li>
<li><p>planning_node </p>
<pre><code>subscribe topics:  /object_list,  /road/info, /vehicle/status from fusion_node

publish topics: /vehicle/cmd_ctl 
</code></pre></li>
</ul>
<h4 id="ADS-ros-launch"><a href="#ADS-ros-launch" class="headerlink" title="ADS ros launch"></a>ADS ros launch</h4><p>the previous section has a basic idea about what kind of ROS nodes usually needs to run the ADS stack. In road test or simulaiton test, we prefer a simple way to launch all ADS related nodes in one launch.</p>
<p>which usually give a simple launch file to start all nodes, or a shell script to start each ros nodes sequencially. </p>
<h4 id="system-verification"><a href="#system-verification" class="headerlink" title="system verification"></a>system verification</h4><p>ros is a common solution to package ADS stack and integrate with the simulation env during SIL sysem verification, as well as road test data collection. since ROS is the cheap solution for ADS dev and test, compared to CAEape/Vector, Dspace solution.</p>
<p>on the other hand, due to the hardware computing limitation, drivers depends, and espeically the ros is mostly run in Linux kind of non-realtime OS, which is not good for domain controller(HAD) test. so during the real test envrionment, we need to consider these true issues.</p>
<p>another topic is about how to quick build up a user-friend verification pipeline for, which keeps as little modification as possible, but can run in both simulation verification and physical verification.</p>
<h2 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h2><p><a href="http://wiki.ros.org/ROS/Tutorials" target="_blank" rel="external">ros overview</a></p>
<p><a href="https://msadowski.github.io/ros-web-tutorial-pt1/" target="_blank" rel="external">understand rosbridge:  simple ROS UI</a></p>
<p><a href="http://wiki.ros.org/roslibjs/Tutorials/BasicRosFunctionality" target="_blank" rel="external">roslibjs</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/29/mobile-vehicle-interface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/29/mobile-vehicle-interface/" itemprop="url">mobile vehicle interface</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-29T08:00:38-05:00">
                2019-12-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/29/mobile-vehicle-interface/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/29/mobile-vehicle-interface/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>human-machine interface(HMI), in-vehicle device(IVD).</p>
<p>human-vehicle interface(HVI), e.g. voice control, touch screen, face detection, e.t.c, which does well for young and passion generation, who have great voice, sharp fingers, and good-look face, and all these improving user experienced tech are based on similar AI. </p>
<p>what about the elders ? which should be, in the next 10 - 20 years, the most tough family and society issues in China, and as well as for Japan right now. </p>
<p>the basicaly option here is HVI is not enough for the elders groups, or at least is not the only choice for elders, who don’t have great voice, good-look face, or sharp fingers, and even no patient to talk/look/touch with the weak AI system. a very good alternative or additional supportting solution should be mobility vehicle interface(MVI)</p>
<h2 id="mobility-vehicle-interface"><a href="#mobility-vehicle-interface" class="headerlink" title="mobility vehicle interface"></a>mobility vehicle interface</h2><h4 id="what-kind-of-mobility-device"><a href="#what-kind-of-mobility-device" class="headerlink" title="what kind of mobility device"></a>what kind of mobility device</h4><p>mobility is a general name, for all kinds of mobile devices, especially for Iphone, Android smart phone and personal care robot. </p>
<h4 id="application-scenarios"><a href="#application-scenarios" class="headerlink" title="application scenarios"></a>application scenarios</h4><p>for an elder, who has daily needs for traffic transfer. e.g. go to hospital, to supermarket, to a special restuarant or a park for dinner or sit down with some old friends. </p>
<p>the elders are slow in movement and talk, and the current AI based human-vehicle-interface(HVI) definitely make the elders feel pressure.</p>
<p>a better or alternative solution is let the mobility device to talk to the vehicle, through an interface </p>
<h4 id="mobility-vehicle-interface-1"><a href="#mobility-vehicle-interface-1" class="headerlink" title="mobility vehicle interface"></a>mobility vehicle interface</h4><p>the mobility vehicle interface(MVI) can be based on existing vehicle OS and mobility OS. there are plenty existing in-vehicle OS, e.g. CarPlayer, Baidu OS, GENIV, QNX e.t.c; and on mobility OS side, the most common are iOS and Andriod.</p>
<p>most in-vehicle OS can run the same apps on mobility OS, e.g. google navigation map, instant messages, music, emergency call service e.t.c.</p>
<p>so the first solution is app2app. basically the same app ran in the personal mobility device(PMD) talk to the same app run in vehicle OS. </p>
<p>PMD has more time with the owner, so has more personality than vehicle, especially as vehicle in future is more like a public service, rather than a personal asset. </p>
<p>that’s why mobility vehicle interface(MVI) is a good option, especially for elders, who may not enjoy talk to AI.</p>
<p>beyond the easy to implement at this moment, app2app solution has a few limitations:</p>
<ul>
<li><p>the security is mainly provided by the app supplier, which is not a unit solution, as different app suppliers have different security mechanism.</p>
</li>
<li><p>as apps hosted in this system is growing, the adapters or interfaces to make the bridge grows too, which decrease the user experince and increase the system cost.</p>
</li>
</ul>
<p>so a better solution is a new mobility-vehicle interface protocol, which is the only bridge between personal mobility and vehicles. and no matter what kind of apps and how many apps hosts in both system, won’t be a burden for the sytem anymore.</p>
<h4 id="moblity-vehicle-interface-protocol"><a href="#moblity-vehicle-interface-protocol" class="headerlink" title="moblity vehicle interface protocol"></a>moblity vehicle interface protocol</h4>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/29/can-MaaS-survive-in-China/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/29/can-MaaS-survive-in-China/" itemprop="url">can MaaS survive in China</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-29T07:58:07-05:00">
                2019-12-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/29/can-MaaS-survive-in-China/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/29/can-MaaS-survive-in-China/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="the-difference-of-US-and-China-citizenship-vs-relationship"><a href="#the-difference-of-US-and-China-citizenship-vs-relationship" class="headerlink" title="the difference of US and China: citizenship  vs relationship"></a>the difference of US and China: citizenship  vs relationship</h4><p>the first class cities, e.g. Beijing, Shanghai, Shenzhen, are not different from Chicago, New York, in normal people’s lifestyle: they share the same luxurious brands, Starbucks, Texas beaf Steak, city public services, and the same international popular elements in eletronic consumers, clothing, vehicles, and even the office env.</p>
<p>However, down to the third class, or forth class cities in China and US, there are a huge difference. </p>
<p>the bottom difference is citizenship（公民意识） vs relationship（关系文化). in US and most developed countries, citizenship is a common sense, no matter in small towns or big cities. in China, the residents in big cities are similar to residents in developed countries; but the normal people in third cities value more about relationship, rather than citizenship, so basically the rules how to live a high-qualitied/successful life in these cities is not universal, which means if a resident from big cities jumping to these small cities, his experince about what is a good career/life choice has to be changed, and further which has a great influence about consuming habit and the acceptance of emerging market.</p>
<p>the Chinese goverment is pushing urbanization in most uncitizenlized areas, hopefully this process can be achieved in a few generations, which can be affected by both goverment policy and the external forces, e.g. trade war. any way, there is no short way.</p>
<h4 id="Chinese-subside-markets"><a href="#Chinese-subside-markets" class="headerlink" title="Chinese subside markets"></a>Chinese subside markets</h4><p>in China, one kind of the most profit business is e-trade, e.g. Alibaba, JD, Pinduoduo, e.t.c. they are sinking to the third/forth cities in China in recent years, which is a special phenomenon in China, the reason as I see, is due to the division between citizenship in top class cities and relationship in most small cities in China.</p>
<p>for most developed countries, e.g. US, the market is so flat that once one product/service is matured in big cities, there is no additional cost to expand to small towns in national wide. But here in China, the market, the society structure, the resident’s consuming habit are not flat due to the division as mentioned previously. so they need different bussniess strategy for product/service in big cities and most small towns. </p>
<p>for the emerging market, the investors and service/product providers need input from top consulting teams, e.g. PWC, Deloitte, BCG, but the research paper from these teams try to ignore the value gap in Chinese large cities and small cities. </p>
<p>Of course I can understand the consulting strategy, as emerging market is looking for new services in near future, and it should looks promising. taking mobility as a service (MaaS) as an example, from sharing cars to MaaS is likely happened in urban areas in next 10 years, and expand to most areas in west European and NA countries, but in the most small towns of China, it may never happen.</p>
<p>MaaS is a promising service if the society and resident’s value are similar (or plat). for developing countries, e.g. China, India, these emerging market wouldn’t be a great success in national wide. </p>
<h4 id="start-ups-in-MaaS"><a href="#start-ups-in-MaaS" class="headerlink" title="start-ups in MaaS"></a>start-ups in MaaS</h4><ul>
<li><a href="https://mobiag.com" target="_blank" rel="external">mobiag</a></li>
<li><a href="https://www.mobilleo.com" target="_blank" rel="external">mobilleo</a></li>
<li><a href="https://invers.com/shared-mobility-os/" target="_blank" rel="external">invers</a></li>
<li><a href="https://maymobility.com" target="_blank" rel="external">maymobility</a></li>
<li><a href="http://vaimoo.com" target="_blank" rel="external">vaimoo</a> in Brazil</li>
<li><a href="https://www.populus.ai/solutions/mobility-manager" target="_blank" rel="external">populus.ai</a></li>
<li><a href="https://www.staflsystems.com" target="_blank" rel="external">staflsystems</a></li>
<li><a href="https://www.polysync.io" target="_blank" rel="external">polysync.io</a></li>
<li><a href="https://www.geotab.com" target="_blank" rel="external">geotab</a></li>
<li></li>
</ul>
<h4 id="public-resources-in-moblity-as-a-service-MaaS"><a href="#public-resources-in-moblity-as-a-service-MaaS" class="headerlink" title="public resources in moblity as a service(MaaS)"></a>public resources in moblity as a service(MaaS)</h4><p><a href="https://maas-alliance.eu/the-alliance/" target="_blank" rel="external">Mass alliance</a></p>
<p><a href="https://www.parking-mobility.org" target="_blank" rel="external">International parking &amp; mobility institute</a></p>
<p><a href="https://austintexas.gov/micromobility" target="_blank" rel="external">shared mobility services in Texas</a></p>
<p><a href="">DI_Forces of change-the future of mobility</a></p>
<p><a href="">PWC_how shared mobility and automation will reolution</a></p>
<p><a href="">Princeton_strategies to Advanced automated and connected vehicles: a primer for state and local decision makers</a></p>
<p><a href="">Accenture_mobility as a service whitepaper</a></p>
<p><a href="https://www.bosch-mobility-solutions.com/en/highlights/connected-mobility/human-machine-interface/" target="_blank" rel="external">Bosch_HMI</a></p>
<p><a href="https://global.toyota/en/newsroom/corporate/20546438.html" target="_blank" rel="external">Toyota_Mobility ecosystem</a></p>
<p><a href="https://www.volkswagenag.com/en/news/stories/2017/02/the-e-mobility-module.html" target="_blank" rel="external">Volkswagen_E-mobility module</a></p>
<p><a href="https://new.siemens.com/global/en/products/mobility/road-solutions.html" target="_blank" rel="external">Siemens_Intelligent Traffic Systems</a></p>
<p><a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/766759/Mobilityasaservice.pdf" target="_blank" rel="external">MaaS in UK</a></p>
<p><a href="https://techliberation.com/about/" target="_blank" rel="external">the tech liberation front</a></p>
<p><a href="https://www.autonomousvehicletech.com" target="_blank" rel="external">autonomous vehicle technology</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/28/configure-hadoop-in-2-nodes-cluster/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/28/configure-hadoop-in-2-nodes-cluster/" itemprop="url">configure hadoop in 2-nodes cluster</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-28T09:39:10-05:00">
                2019-12-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/28/configure-hadoop-in-2-nodes-cluster/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/28/configure-hadoop-in-2-nodes-cluster/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>it’s by accident that I have to jump into data center, where 4 kinds of data need  deal with:</p>
<ul>
<li><p>sensor verification, with huge amount of special raw sensor data </p>
</li>
<li><p>AI perception training, with huge amout of fusioned sensor data </p>
</li>
<li><p>synthetic scenarios data, which used to resimualtion</p>
</li>
<li><p>inter-middle status log data for Planning and Control(P&amp;C)</p>
</li>
</ul>
<p>big data tool is a have-to go through for L3+ ADS team, which has already developed in top start-ups, e.g. WeRide and Pony.AI, as well as top OEMs from NA, Europen. Big data, as I understand is at least as same important to business, as to customers. compared to AI, which is more on customer’s experience. and 2B is a trending for Internet+ diserving into traditional industry. anyway, it’s a good try to get some ideas about big data ecosystem. and here is the first step: hadoop</p>
<h2 id="prepare-jdk-and-hadoop-in-single-node"><a href="#prepare-jdk-and-hadoop-in-single-node" class="headerlink" title="prepare jdk and hadoop in single node"></a>prepare jdk and hadoop in single node</h2><p>Java sounds like a Windows langage, there are a few apps requied Java in Ubuntu, e.g. osm browser e.t.c., but  I can’t tell the difference between <code>jdk</code> and <code>jre</code>, or  openjdk vs Oracle.  <code>jdk</code> is a dev toolkit, which includes <code>jre</code> and beyond. so when it’s always better to set <code>JAVA_HOME</code> to <code>jdk</code> folder. </p>
<h4 id="jdk-in-ubuntu"><a href="#jdk-in-ubuntu" class="headerlink" title="jdk in ubuntu"></a>jdk in ubuntu</h4><p>there are many different version of jdk, e.g. 8, 9, 11, 13 e.t.c.  here is used <code>jdk-11</code>, which can be download from Oracle website, there are two zip files, the <code>src</code> and the other. the pre-compiled zip is enough to Hadoop in Ubuntu.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tar xzvf  jdk-11.zip  </div><div class="line">cp -r jdk-11  /usr/local/jdk-11 </div><div class="line">cd /usr/local</div><div class="line">ln -s jdk-11 jdk</div></pre></td></tr></table></figure>
<p>append JAVA_HOME=/usr/local/jdk &amp;&amp; PATH=$PATH:$JAVA_HOME/bin to <code>~/.bashrc</code>, and can run test <code>java -version</code>.</p>
<p>what need to be careful here, as the current login user may be not fitted for multi-nodes cluster env, so it’s better to create the <code>hadoop group</code> and <code>hduser</code>, and use <code>hduse</code> as the login user in following steps.</p>
<h4 id="create-hadoop-user"><a href="#create-hadoop-user" class="headerlink" title="create hadoop user"></a>create hadoop user</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo addgroup  hadoop</div><div class="line">sudo adduser --ingroup hadoop  hduser </div><div class="line">sudo - hduser #login as hduser</div></pre></td></tr></table></figure>
<p>the other thing about <code>hduser</code>, is not in <code>sudo</code> group, which can be added by:</p>
<p>curren login user is <code>hduser</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">groups  # hadoop</div><div class="line">su -  # but password doesn't correct</div><div class="line"><span class="meta">#</span>login from the default user terminal</div><div class="line">sudo -i  </div><div class="line">usermod -aG sudo hduser</div><div class="line"><span class="meta">#</span>backto hduser terminal</div><div class="line">groups hduser  # :  hadoop  sudo </div><div class="line">exit </div><div class="line">su - hduser  #re-login as hduser </div><div class="line">``` </div><div class="line"><span class="meta"></span></div><div class="line">#### install and configure hadoop </div><div class="line"></div><div class="line">hadoop installation at Ubuntu is similar to Java, which has src.zip and pre-build.zip, where I directly download the `pre-build.zip`.</div><div class="line"></div><div class="line">another thing need take care is the version of hadoop. since `hadoop 2.x` has no `--daemon` option, which will leads error when master node is with `hadoop 3.x`.</div><div class="line"></div><div class="line">```shell</div><div class="line">tar xzvf  hadoop-3.2.1.zip  </div><div class="line">cp -r hadoop-3.2.1 /usr/local/hadoop-3.2.1</div><div class="line">cd /usr/local</div><div class="line">ln -s hadoop-3.2.1 hadoop</div></pre></td></tr></table></figure>
<p>add <code>HADOOP_HOME=/usr/local/hadoop</code> and <code>PATH=$PATH:$HADOOP_HOME/bin</code> to <code>~/.bashrc</code>. test with <code>hadoop version</code></p>
<p><a href="https://www.michael-noll.com/tutorials/running-hadoop-on-ubuntu-linux-multi-node-cluster/" target="_blank" rel="external">hadoop configure is find here</a></p>
<p>there is another issue with <code>JAVA_HOME not found</code>, which I modify the <code>JAVA_HOME</code> variable in <code>$HADOOP_HOME/etc/hadoop/hadoop_env.sh</code> </p>
<h4 id="passwordless-access-among-nodes"><a href="#passwordless-access-among-nodes" class="headerlink" title="passwordless access among nodes"></a>passwordless access among nodes</h4><ul>
<li>generate SSH key pair</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">on maste node:</div><div class="line">ssh-keygen -t rsa -b 4096 -C "master"</div><div class="line">on worker node:</div><div class="line">ssh-keygen -t rsa -b 4096 -C "worker"</div></pre></td></tr></table></figure>
<p>the following two steps need do on both machines, so that the local machine can ssh access both to itself and to the remote.</p>
<ul>
<li><p>enable SSH access to local machine</p>
<p>  ssh-copy-id hduser@192.168.0.10</p>
</li>
</ul>
<ul>
<li><p>copy public key to the remote node</p>
<p>  ssh-copy-id hduser@192.168.0.13</p>
</li>
</ul>
<p><a href="https://linuxize.com/post/how-to-setup-passwordless-ssh-login/" target="_blank" rel="external">tips</a>, if changed the default <code>id_rsa</code> name to sth else, doesn’t work. after the changes above, will generates a <code>known_hosts</code> at local machine, and an <code>authorized_keys</code>, which is the public key of the client ssh, at remote machine. </p>
<h4 id="test-hadoop"><a href="#test-hadoop" class="headerlink" title="test hadoop"></a>test hadoop</h4><ul>
<li>on master node</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">hduser@ubuntu:/usr/local/hadoop/sbin$ jps</div><div class="line">128816 SecondaryNameNode</div><div class="line">128563 DataNode</div><div class="line">129156 Jps</div><div class="line">128367 NameNode</div></pre></td></tr></table></figure>
<ul>
<li>on worker node:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hduser@worker:/usr/local/hadoop/logs$ jps</div><div class="line">985 Jps</div><div class="line">831 DataNode</div></pre></td></tr></table></figure>
<p>and  test with <code>mapreduce</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/25/deploy-lgsvl-in-docker-swarm-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/25/deploy-lgsvl-in-docker-swarm-4/" itemprop="url">deploy lgsvl in docker swarm 4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-25T05:39:07-05:00">
                2019-12-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/25/deploy-lgsvl-in-docker-swarm-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/25/deploy-lgsvl-in-docker-swarm-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="background"><a href="#background" class="headerlink" title="background"></a>background</h3><p>previously, tried to <a href="https://zjli2013.github.io/2019/12/15/deploy-lgsvl-in-docker-swarm-3/" target="_blank" rel="external">deploy lgsvl</a> in docker swarm, which is failde due to the conflict of host network to run lgsvl and the routing mesh of swarm, as I thought.</p>
<h3 id="http-listen-on"><a href="#http-listen-on" class="headerlink" title="http listen on *"></a>http listen on *</h3><p>why used <a href="https://github.com/lgsvl/simulator/issues/488#issuecomment-553265946" target="_blank" rel="external">–network=host</a>, is actually not a have-to, the alternative option is to use <code>&quot;*&quot;</code> as <code>Configure.webHost</code>, instead of <code>localhost</code> nor a special IP address, which lead o HttpListener error: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The requested address is not vaid in this context.</div></pre></td></tr></table></figure>
<p>then, we can <a href="https://github.com/lgsvl/simulator/issues/488#issuecomment-557746438" target="_blank" rel="external">docker run lgsvl</a> without host network limitations.</p>
<p>but still, if run by <code>docker service create</code>, it reports failure: <code>Error initiliazing Gtk+</code>. </p>
<h3 id="Gtk-UI-in-Unity"><a href="#Gtk-UI-in-Unity" class="headerlink" title="Gtk/UI in Unity"></a>Gtk/UI in Unity</h3><p>when starting lgsvl, it pops the resolution window, which is a plugin of Unity Editor, and implemented with <code>gtk</code>, as explained in last section, which leads to the failure to run lgsvl as service in docker swarm.</p>
<p>the simple solution is to disable resolution selection in Unity Editor.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Build Settings --&gt; Player Settings --&gt;  Disable Resolution</div></pre></td></tr></table></figure>
<p>then the popup window is bypassed.</p>
<h3 id="ignore-publish-port"><a href="#ignore-publish-port" class="headerlink" title="ignore publish port"></a>ignore publish port</h3><p>I tried to ignore <code>network host</code> and run directly with routing mesh, but it still doesn’t work. then I remember at the previous blog, when run vkcube or glxgears in docker swarm, it actually does use <code>--network host</code>, so it looks the failure of running lgsvl in docker swarm, is not due to <code>network host</code>, but is due to <code>Gtk/gui</code>. as we can bypass the resolution UI, then directly running as following, works as expected: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo docker service create --name lgsvl --generic-resource &quot;gpu=1&quot; --replicas 2 --env DISPLAY --mount src=&quot;X11-unix&quot;,dst=&quot;/tmp/.X11-unix&quot; --network host lgsvl</div></pre></td></tr></table></figure>
<h3 id="add-assets-into-container"><a href="#add-assets-into-container" class="headerlink" title="add assets into container"></a>add assets into container</h3><p>another update is to bind  assets from host into lgsvl image, which is stored as sqlite data.db, which is a necessary, as we bypassed the authentication, and the cluster has no access to external Internet.</p>
<h3 id="where-is-next"><a href="#where-is-next" class="headerlink" title="where is next"></a>where is next</h3><p>in recent two month, had digged into docker swarm to run lgsvl. so far, the main pipeline looks work now, and there are still a lot little fix there.</p>
<p>to run AV simulation in cloud, is a necessary way to test and verify L3+ AV algorithms/products. previous ADAS test is more on each individual feature itself, e.g. ACC, AEB .e.t.c, all of which are easy to define a benchmark test case, and engineers can easily define the test scenarios systemetically. But for L3+, the env status space is infinite in theory, there is no benchmark test cases any more, and at best we can do is statiscally test cases, which requires a huge number of test cases, which is where virutal simulation test in cloud make sense.</p>
<p>from tech viewpoint, the next thing is how to drive the L3+ dev by these simulation tools. and another intesting is the data infrastructure setup</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/15/web-service-bypass-in-lgsvl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/15/web-service-bypass-in-lgsvl/" itemprop="url">web service bypass in lgsvl</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-15T08:11:01-05:00">
                2019-12-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/15/web-service-bypass-in-lgsvl/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/15/web-service-bypass-in-lgsvl/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>previously had talked <a href="https://zjli2013.github.io/2019/10/22/lg-sim-source-code-review-2019-09/" target="_blank" rel="external">lg new version code review</a>, where introduced the new server-browser arch, which is focused on the lgsvl server side implementation, which was based on Nancy and sqliteDB; also a simple introduction about <a href="https://zjli2013.github.io/2019/08/30/reactjs-introduction/" target="_blank" rel="external">reactjs</a></p>
<p>the gap how client send a http request to the server is done by <code>axios</code>. also another issue is how to access asset resource across domain. namely, running the lgsvl service at one host(192.168.0.10), and http request send from another remote host(192.168.0.13). </p>
<h3 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h3><p>the following is <a href="https://upmostly.com/tutorials/using-axios-with-react-api-requests" target="_blank" rel="external">an example</a> on how Axios works. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">constructor() &#123;</div><div class="line">   this.state = &#123;</div><div class="line">     user: null </div><div class="line">   &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">componentDidMount() &#123;</div><div class="line">  axios.get(&apos;https://dog.ceo/api/breeds/image/random&apos;)</div><div class="line">  .then(response =&gt; &#123;</div><div class="line">    console.log(response.data);</div><div class="line">    if(response.status == 200)</div><div class="line">        setState(user, reponse.data)</div><div class="line">  &#125;)</div><div class="line">  .catch(error =&gt; &#123;</div><div class="line">    console.log(error);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"> render() &#123;</div><div class="line">   return (</div><div class="line">  )</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>from React componnet to DOM will call <code>componentDidMount()</code>, inside which axios send a GET request to <code>https://dog.ceo/api/breeds/image/random</code> for a random dog photo. and can also store the response as this component’s state. </p>
<h3 id="enact"><a href="#enact" class="headerlink" title="enact"></a>enact</h3><p><a href="https://enactjs.com/docs/tutorials/setup/" target="_blank" rel="external">enact</a> is a React project manager, the common usage: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">enact create . # generate project at current dir </div><div class="line">npm run serve </div><div class="line">npm run clean</div></pre></td></tr></table></figure>
<p>enact prject has a configure file, <code>package.json</code>, while can specify the proxy, which is <code>localhost</code> by default. if want to bind to a special IP address, this is the right place to modify.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&quot;enact&quot;: &#123;</div><div class="line">        &quot;theme&quot;: &quot;moonstone&quot;,</div><div class="line">        &quot;proxy&quot;: &quot;http://192.168.0.10:5050&quot;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>inside <code>lgsvl/webUI</code>, we need do this proxy configure, to support the across-domain access.</p>
<h3 id="Nancy-authentication"><a href="#Nancy-authentication" class="headerlink" title="Nancy authentication"></a>Nancy authentication</h3><p><code>this.RequiresAuthentication()</code>, which ensures that an authenticated user is available or it will return HttpStatusCode.Unauthorized. The CurrentUser must not be null and the UserName must not be empty for the user to be considered authenticated. By calling this RequiresAuthentication() method, all requests to this Module must be authenticated. if not authenticated, then the requests will be redirected to <code>http://account.lgsimulator.com</code>. You need to include the types in the Nancy.Security namespace in order for these extension methods to be available from inside your module.</p>
<p>this.RequiresAuthentication()  <code>is equal to</code> return (this.Context.CurrentUser == null) ? new HtmlResponse(HttpStatusCode.Unauthorized) : null;</p>
<p>all modules in lgsvl web server are authenticated by <a href="https://github.com/NancyFx/Nancy/wiki/Authentication-overview" target="_blank" rel="external">Nancy:RequiresAuthentication()</a>, for test purpose only, we can bypass this function, and pass the account directly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//  this.RequiresAuthentication();</div><div class="line">//  return service.List(filter, offset, count, this.Context.CurrentUser.Identity.Name)</div><div class="line">string currentUsername = &quot;test@abc.com&quot;;</div><div class="line">return service.List(filter, offset, count, currentUsername)</div></pre></td></tr></table></figure>
<p>in this way, no matter what’s the account in React client, server always realize the http request is from the user <code>test@abc.com</code>. </p>
<h3 id="sqlite-db"><a href="#sqlite-db" class="headerlink" title="sqlite db"></a>sqlite db</h3><p>in Linux, sqlite <code>data.db</code> is stored at <code>~/.config/unity3d/&lt;company name&gt;/&lt;product name&gt;/data.db</code></p>
<p>in Windows, <code>data.db</code> is stored at <code>C:/users/username/AppData/LocalLow/&lt;company name&gt;/&lt;product name&gt;/data.db</code></p>
<p>it’s interesting when register at lgsvlsimualtor.com, and it actually send the account info back to local db, which give the chance to bypass.</p>
<h3 id="debug-webUI"><a href="#debug-webUI" class="headerlink" title="debug webUI"></a>debug webUI</h3><p>the chrome and firefox has react-devtools plugins, which helps, but webUI doesn’t use it directly. to debug webUI it’s even simpler to go to dev mode in browser, and checking the few sections is enough</p>
<h4 id="refer"><a href="#refer" class="headerlink" title="refer"></a>refer</h4><ul>
<li><a href="https://programmingwithmosh.com/javascript/axios-in-react-bring-your-data-to-the-front/" target="_blank" rel="external">bring your data to the front</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/15/deploy-lgsvl-in-docker-swarm-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/15/deploy-lgsvl-in-docker-swarm-3/" itemprop="url"> deploy lgsvl in docker swarm 3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-15T08:04:41-05:00">
                2019-12-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/15/deploy-lgsvl-in-docker-swarm-3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/15/deploy-lgsvl-in-docker-swarm-3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="background"><a href="#background" class="headerlink" title="background"></a>background</h2><p>previously tried to <a href="https://zjli2013.github.io/2019/12/04/running-Vulkan-in-virtual-display/" target="_blank" rel="external">run Vulkan in virtual display</a>, which failed as I understand virtual display configure didn’t fit well with Vulkan. so this solution is direct display to allow each node has plugged monitor(which is called <strong>PC cluster</strong>). for future in cloud support, current solution won’t work. and earlier, also tried to <a href="https://zjli2013.github.io/2019/11/21/deploy-lgsvl-in-docker-swarm-2/" target="_blank" rel="external">deploy lgsvl in docker  swarm</a>, which so far can work with Vulkan as well, after a little bit <a href="https://zjli2013.github.io/2019/11/29/X11-GUI-in-docker/" target="_blank" rel="external">understand X11</a></p>
<p>a few demo test can run as followning:</p>
<h4 id="deploy-glxgears-OpenGL-in-PC-cluster"><a href="#deploy-glxgears-OpenGL-in-PC-cluster" class="headerlink" title="deploy glxgears/OpenGL in PC cluster"></a>deploy glxgears/OpenGL in PC cluster</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export DISPLAY=:0 </div><div class="line">xhost + </div><div class="line">sudo docker service create --name glx --generic-resource &quot;gpu=1&quot; --constraint &apos;node.role==manager&apos;  --env DISPLAY --mount src=&quot;X11-unix&quot;,dst=&quot;/tmp/.X11-unix&quot; --mount src=&quot;tmp&quot;,dst=&quot;/root/.Xauthority&quot;  --network host  192.168.0.10:5000/glxgears</div></pre></td></tr></table></figure>
<h4 id="deploy-vkcube-Vulkan-in-PC-cluster"><a href="#deploy-vkcube-Vulkan-in-PC-cluster" class="headerlink" title="deploy vkcube/Vulkan in PC cluster"></a>deploy vkcube/Vulkan in PC cluster</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export DISPLAY=:0 </div><div class="line">xhost +  </div><div class="line">sudo docker service create --name glx --generic-resource &quot;gpu=1&quot; --constraint &apos;node.role==manager&apos;  --env DISPLAY --mount src=&quot;X11-unix&quot;,dst=&quot;/tmp/.X11-unix&quot; --mount src=&quot;tmp&quot;,dst=&quot;/root/.Xauthority&quot;  --network host  192.168.0.10:5000/vkcube</div></pre></td></tr></table></figure>
<h4 id="deploy-service-with-“node-role-worker”"><a href="#deploy-service-with-“node-role-worker”" class="headerlink" title="deploy service with “node.role==worker”"></a>deploy service with “node.role==worker”</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export DISPLAY=:0</div><div class="line">xhost + </div><div class="line">sudo docker service create --name glx --generic-resource &quot;gpu=1&quot; --constraint &apos;node.role==worker&apos;  --env DISPLAY --mount src=&quot;tmp&quot;,dst=&quot;/root/.Xauthority&quot;  --network host  192.168.0.10:5000/glxgears</div></pre></td></tr></table></figure>
<h4 id="deploy-service-in-whole-swarm"><a href="#deploy-service-in-whole-swarm" class="headerlink" title="deploy service in whole swarm"></a>deploy service in whole swarm</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xhost + </div><div class="line">export DISPLAY=:0 </div><div class="line">sudo docker service create --name glx --generic-resource &quot;gpu=1&quot; --replicas 2  --env DISPLAY --mount src=&quot;tmp&quot;,dst=&quot;/root/.Xauthority&quot;  --network host  192.168.0.10:5000/vkcube</div></pre></td></tr></table></figure>
<p>which deploy vkcube service in both manager and worker node:</p>
<pre><code>overall progress: 2 out of 2 tasks 
1/2: running   [==================================================&gt;]     
2/2: running   [==================================================&gt;] 
verify: Service converged 
</code></pre><h4 id="understand-Xauthority"><a href="#understand-Xauthority" class="headerlink" title="understand .Xauthority"></a>understand .Xauthority</h4><p>as docker service can run with <code>--mount</code> arguments, which give the first try to copy <code>.Xauthority</code> to manager node, but <code>.X11-unix</code> is not copyable, which is not a normal file, but a socket.</p>
<p>in <code>docker service create</code>, when create a OpenGL/vulkan service in one remote worker node, and using <code>$DISPLAY=:0</code>, which means the display happens at the remote worker node. so in this way, the remote worker node is played the <code>Xserver</code> role; and since the vulkan service is actually run in the remote worker node, so the remote worker node is <code>Xclient</code> ? </p>
<p>assuming the lower implement of <code>docker swarm service</code>is based on <code>ssh</code>, then when the manager node start the service, it will build the ssh tunnel to the remote worker node, and with the $DISPLAY variable as null; even if the docker swarm can start the ssh tunnel with <code>-X</code>, which by default, will use the manager node’s <code>$DISPLAY=localhost:10.0</code></p>
<p><code>Xauthority cookie</code> is used to grant access to Xserver, so first make sure which machine is the Xserver, then the Xauthority should be included in that Xserer host machine. a few testes: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ssh in worker: echo $DISPLAY --&gt;  localhost:10.0</div><div class="line"></div><div class="line">xeyes --&gt; display in master monitor </div><div class="line"></div><div class="line">ssh in worker: xauth list --&gt; &#123;worker/unix:0  MIT-MAGIC-COOKIE-1  19282b0a651789ed27950801ef6f1441; worker/unix:10  MIT-MAGIC-COOKIE-1  a6cbe81637207bf0c168b3ad20a9267a &#125;</div><div class="line"></div><div class="line">in master: xauth list --&gt; &#123; ubuntu/unix:1  MIT-MAGIC-COOKIE-1  ee227cb9465ac073a072b9d263b4954e; ubuntu/unix:0  MIT-MAGIC-COOKIE-1  75893fb66941792235adba22362c4a6f; ubuntu/unix:10  MIT-MAGIC-COOKIE-1  785f20eb0ade772ceffb24eadeede645 &#125;</div></pre></td></tr></table></figure>
<p>so which cookie is is for this $DISPLAY ? it shouldb be the one on <code>ubuntu/unix:10</code>;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssh in worker:  export DISPLAY=:0</div><div class="line">xeyes  --&gt; display in worker monitor</div></pre></td></tr></table></figure>
<p>then it use the cookie:  <code>worker/unix:0</code>.</p>
<h4 id="deploy-lgsvl-service-in-swarm"><a href="#deploy-lgsvl-service-in-swarm" class="headerlink" title="deploy lgsvl service in swarm"></a>deploy lgsvl service in swarm</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xhost + </div><div class="line">export DISPLAY=:0</div><div class="line">sudo docker service create --name lgsvl --generic-resource &quot;gpu=1&quot; --replicas 2  --env DISPLAY --mount src=&quot;tmp&quot;,dst=&quot;/root/.Xauthority&quot;  --network host --publish published=8080,target=8080  192.168.0.10:5000/lgsvl</div></pre></td></tr></table></figure>
<p>which gives:</p>
<pre><code>overall progress: 0 out of 2 tasks 
1/2: container cannot be disconnected from host network or connected to host network
2/2: container cannot be disconnected from host network or connected to host network
</code></pre><p>basically, the service is deployed in <code>ingress network</code> by default, but as well, the service is configured with <code>host network</code>. so it conflict.</p>
<h2 id="swarm-network"><a href="#swarm-network" class="headerlink" title="swarm network"></a>swarm network</h2><p><img src="https://docs.docker.com/engine/swarm/images/ingress-lb.png" alt="image"></p>
<p>the <a href="https://docs.docker.com/engine/swarm/services/#publish-a%20services-ports-using-the-routing-mesh" target="_blank" rel="external">routing mesh</a> is the default internal balancer in swarm network; the other choice is to <a href="https://docs.docker.com/engine/swarm/services/#publish-a-services-ports-directly-on-the-swarm-node" target="_blank" rel="external">deploy serivce directly on the node</a>, namely <code>bypassing routing mesh</code>, which ask the service run in <code>global mode</code> and with pubished port setting as <code>mode=host</code>, which should be the same as <code>--network host</code> in <code>replicas mode</code>. </p>
<p>the limitation of bypassing routing mesh, is only one task on one node, and access the published port can only require the service from this special node, which doesn’ make sense in cloud env.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">     --mode global \</div><div class="line">     --publish mode=host,target=80,published=8080 \</div><div class="line">     --generic-resource &quot;gpu=1&quot;  \</div><div class="line">     --env DISPLAY  \</div><div class="line">     --mount src=&quot;tmp&quot;,dst=&quot;/root/.Xauthority&quot;  \</div><div class="line">     --mount src=&quot;X11-unix&quot;,dst=&quot;/tmp/.X11-unix&quot;  \</div><div class="line">     --network host  \</div><div class="line">     --name lgsvl \</div><div class="line">     lgsvl:latest</div></pre></td></tr></table></figure>
<p>tips: –mount src=”X11-unix”,dst=”/tmp/.X11-unix” is kind of cached. so once docker image has ran in worker node, then it doesn’t need to pass this parameter again, but once worker node restart, it need this parameter again</p>
<p>in summary about swarm netowrk, the routing mesh should be the right solution for cloud deployment. so how to bypass <code>--network host</code> ? </p>
<p>the reason of <code>host network</code> is the lgsvl server and webUI can works in same host; if not, there is kind of cross-domain security failures, which actually is another topic, namely, how to host lgsvl and webUI/React in different hosts.</p>
<p>need some study of webUI in next post.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/08/where-are-you-in-next-4-years-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/08/where-are-you-in-next-4-years-1/" itemprop="url">where are you in next 4 years (1)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-08T03:25:48-05:00">
                2019-12-08
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/08/where-are-you-in-next-4-years-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/08/where-are-you-in-next-4-years-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>it’s more than one year since I started this series “where are you in the next 5 years”, I wound love to transfer to “the next 4 years”, and thanks for the opportunity to get back in China, so there is a high chance to involve in the market heavily in a short time. </p>
<p>at the begining of the year, travelled around the whole nation, stay in Shanghai, Beijing, Shenzhen, Guangzhong. and that was a great chance to get familiar with the startups in autonomus vehicle, as this trip really gave me some input, and till now I had another half year in one of the top OEMs in China. combined with this two sources, which gave me the kind of the whole picture of ADS market happening in China. I would love to write this blog more in bussiness thought, rather than engineering way.  </p>
<h2 id="L4-startups"><a href="#L4-startups" class="headerlink" title="L4 startups"></a>L4 startups</h2><p>ADS leap time is about 2016 to the first half year of 2018. there are a bunch of startups and also most OEMs have build their ADS teams.</p>
<p>the startups, e.g. Pony.ai, WeRide, AutoX, roadstar(the new split), ToSimple, Momenta. which are still very active recently. </p>
<p>Today I have taken PlusAI’s tech open day, I have to say, most of these startups have very similar tech roadmap. I personally, think that’s a really sad thing. </p>
<p>a few teches they all have: </p>
<ul>
<li><p>simulation pipeline </p>
</li>
<li><p>data pipeline(collect, label, training)  </p>
</li>
<li><p>AI based perception, motion planning</p>
</li>
<li><p>friendly HMI </p>
</li>
</ul>
<p>WeRide and Pony.ai are in <code>Robtaxi service</code>;  ToSimple and PlusAI are in <code>highway logistics</code>;  Momenta is in <code>harbor transformation</code>.</p>
<p>Alibaba, jingdong, Meituan e.t.c are in small personal package delivery shuttles, similar as Nuro.</p>
<p>OEMs focus in the passenger vehicles.</p>
<p>DiDi focus in taxi services as well, similar as Uber, Waymo.</p>
<p>all of them can be called as ADS service suppliers. however, most of them use the exactly same sensor packages, including Lidar, Camera, Radar, GPS e.t.c. the software stacks during prodcut dev as mentioned above are mostly similar; there maybe a few special features during the services in deployment, e.g. Robtaxi may have a Uber-like call-taxi app e.t.c, Rather than that, nothing really is amazing about ADS itself.</p>
<p>and mostly this is not a tech problem, it’s must be defined or find out by the social guys, who are from the real needs. </p>
<p>in the engineering work environment, it’s easily to misunderstand the role of engineering. engineering is the bumper, only when the house need fixed, there is a need for bumper. However, in an engineering-centered env, it’s so easy to tell no difference between I have the bumper and I have the needs. My experieince till now, I am learning how to use the bumper well, but few thinks why need to learn to use the bumper.</p>
<p>on the other hand, what kind of tech is really helpful or profitable? </p>
<p>by chance, to talk with Unity China team, who are enhancing Unity3D engine with cloud support, <a href="https://unity.com/simulation" target="_blank" rel="external">unity simualtion</a>, which is the feature I am looking for a while. if the tech pipeline is the waterflow, the Unity team is the one standing at the upper flow, who can implement new features in engine. </p>
<p>just like Nvidia, Google e.t.c, these are the guys who really make a difference with their tech. and it’s profitable of course.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/08/where-are-you-in-next-4-years-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="David Z.J. Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serious Autonomous Vehicles">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/08/where-are-you-in-next-4-years-2/" itemprop="url">where are you in next 4 years (2)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-08T03:23:55-05:00">
                2019-12-08
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/08/where-are-you-in-next-4-years-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/12/08/where-are-you-in-next-4-years-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="backgroud"><a href="#backgroud" class="headerlink" title="backgroud"></a>backgroud</h3><p>joined the  zhongguancun self-driving car workshow today, different level than PlusAI’s tech show at last weekend. there are a few goverment speakers, e.g. zhongguancun tech officer. and sensor suppliers, e.g. SueStar, zhongke hui yan, holo matic, self-driving solution suppliers, e.g. pony.ai; xiantong tech e.t.c, and media press and investors, interesting thing the investors doesn’t look promising. </p>
<p>as mentioned last time, the ADS solution suppliers and most sensor startups join the champion, in about 2 years. and goverment are invovled with policy-friendy support. just the captial market or investors don’t buy it at this moment.</p>
<h3 id="XianTong"><a href="#XianTong" class="headerlink" title="XianTong"></a>XianTong</h3><p>XianTong, focused in city road cleaning, which is a special focus, rather than passenger vehicles, pacakge trucks, or small delivery robotics.  </p>
<p>They have some data in the cleanning serivces in large cities, e.g. beijing, shanghai, hangzhou, and Europen. </p>
<ul>
<li>current cleaner laybor’s harsh and dangerous working env </li>
<li>current cleaner laybor’s limitation to working hours, benefits requirements</li>
</ul>
<p>they mentioned the city cleaning market is about 300 billions in China, which looks promising, but how much percent of the cleaning vechiles in this market is not talked.</p>
<p>it’s maybe about 20% ~ 60%, as there are a lot human resources, city green plant needs e.t.c, which eats a lot of money, and the current cleaner vehicle products that support ADS maybe has an even smaller part in the whole vehicles used in city cleaning services. </p>
<p>so the whole city clearning service market sounds promising, but down to the clearning vehicles, and especailly without a matured and in-market cleaner vehicle product, it’s really difficult to digest and dig golden from the market. </p>
<p>I have a feeling, most startups has the similar gap, they do vision big, e.g. to assist the city, the companies, the bussiness, the end customers run/live more efficiently/enjoyable/profitable.</p>
<p>but the reality is not that friendly for them, as they spent investor’s money, which expect to get profitable return in a short time. which may push the startups to draw big pictures far beyond their ability, or even far beyond the whole industry’s ability.</p>
<p>as well as they draw big pictures, they are very limited to deep into the market, to understand the customers, to design the products with original creativity. </p>
<h3 id="creativity-or-application"><a href="#creativity-or-application" class="headerlink" title="creativity or application"></a>creativity or application</h3><p>for investors, these a special industry-application based startups, I think, at most may get investing profit at 1 ~ 4 times.</p>
<p>maybe it’s a good idea to understand the successful invest cases happened in last 5 years. And I am afraid that’s also a self-centered option, that most CV happened in high-tech, Internet-based startups. </p>
<p>cause the current self-driving market, especially the startups in China, which focus in ADS full-stack solutions, sensors, services providers, are not a game-change player. </p>
<p>in history, the first successful company to product PCs, smart phones, Internet searching serivce, social network servie, taxing service, booking (restrount) service, food delivery service, they are game changers. and somehow they are most talked in public, in investers, and most understandable by most knowledge consumers, e.g. engineers.</p>
<p>but are they the whole picture of the national economy?  what about the local seafood resturant, the local auto repair shops; or the company who product pig’s food, who product customers’ bikes; or the sales company who sell steel to Afria.</p>
<p>The economy is more plentiful and complex, than a mind-straight knowledge consumer can image. For a long time, I didn’t realise the local food restarant or a local gym, but they do higher money payback, and definitely higher social status, than a fixed income engineer. </p>
<p>so don’t try to find out the secret of each component of the whole economy, and then try to find out the most optimized way to live a life. there is no, or every way to live a life, it is the most optimized way.</p>
<p>so the CEOs of these startups, are not crazy to image themselves as the game changers, like Steve Jobs, so they know their energy.</p>
<h3 id="surviving-first"><a href="#surviving-first" class="headerlink" title="surviving first"></a>surviving first</h3><p>since as they know their limitation, so they are not nuts, so they are just enough energy to find a way to survive, even not in a good shape.</p>
<p>that’s the other part, as an naive young man, always forgot the fact that surviving is not beautiful most times.</p>
<p>the nature has tell the lesson: the young brids only kill his/her brothers/sisters, then he/she can survive to grow into adult. for the deers in Afria plant, each minite is either run to survive or being eaten.</p>
<p>companies or human as a single, has the same situation, even the goverment try to make it a little less harsh, but most time to survive is difficult.</p>
<h3 id="market-sharing"><a href="#market-sharing" class="headerlink" title="market sharing"></a>market sharing</h3><p>as a young man, 1000 billion market sounds like a piece of cake, when comes to the small company, who work so hard to get a million level sale, sounds like a piece of shit.</p>
<p>and that’s another naive mind about the reality. like I can’ see the money return from a local seafood resturout, and when I found out it does get more than a million every year, the whole me is shocked.</p>
<p>so there is no big or small piece of cake, as it come to survive. most CEOs, they are not nuzy, and they know clearly in their heart, that their company need to survivie and make a profitable income, and that’s enough, to change the world is not most people’s responsibility, but survive it is. however, these CEOs in publich, they talk their company or product as the game-changers, that’s what the investors’ want they to say.</p>
<p>so don’t think the market is too small any more, as well as it can support a family to live a life.</p>
<p>dream is not the option to most people, that’s the final summary. but survive is a have-to.</p>
<h3 id="life-is-evergreen"><a href="#life-is-evergreen" class="headerlink" title="life is evergreen"></a>life is evergreen</h3><p>life is not only about surviving. if else, human society is an animal world. thinking reasonal always give the doomed impression, and the life in blue; once more perceptual in mind, the day is sunny and joyful.</p>
<p>“the theory is grey, but the tree of life is evergreen”</p>
<h3 id="develop-team-in-OEM"><a href="#develop-team-in-OEM" class="headerlink" title="develop team in OEM"></a>develop team in OEM</h3><p>as <a href="https://zhuanlan.zhihu.com/p/95984348" target="_blank" rel="external">mentioned</a>, currently there are plenty of system simulation verification special suppliers, e.g. 51 vr, baidu, tencent, alibaba e.t.c, and definitely there softwares are more matured than our team. I am afriad jsut at this moment, the leader teams in OEM don’t realize that to build a simualtion tool espcially to support L3 is mission-impossible. if else, the requirements for simulation, should come from suppliers, rather than build OEM’s own simualtion develop team.</p>
<p>I still remember the first day to join this team, sounds like we are really creating something amazing, and nobody else there have more advantages than us. then gradually I realize we can’t customize the Unity engine, we can’t support matured cloud support, we can’t even implement the data pipeline for road test log and analysis. most current team members work stay in requirements level, and in a shadow mode. and actually most of these needs, does have a few external companies/teams have better solution. </p>
<p>there does a lot existing issues, from software architecture to ADS algorithms restructure, but these work is mostly not done by OEM develop team.</p>
<p>the second-level developing team, can’t make the top-class ADS product. as the new company will split out, this team is less possible to survive in the market, or the leaders have to set up a new developing team.</p>
<p>if AI is the direction, that’s another huge blank for this team. I think either go to the ADS software architecture or to AI is a better choice now.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="David Z.J. Lee" />
          <p class="site-author-name" itemprop="name">David Z.J. Lee</p>
           
              <p class="site-description motion-element" itemprop="description">what I don't know</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">142</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZJLi2013" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/zhengjia13/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Z.J. Lee</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zjlee.disqus.com/count.js" async></script>
    

    

  




	





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
